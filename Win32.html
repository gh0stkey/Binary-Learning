<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Win32 - &#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="1015827">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">BinaryLearning</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Binary-Learning.html" class="ht-space-link">
                    <h2>&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</h2>
                </a>
                <p><br><a href="https://github.com/gh0stkey/Binary-Learning" target="_blank">ᴀᴜᴛʜᴏʀ: ᴋᴇʏ</a><br><br>不积跬步，无以至千里；<br>不积小流，无以成江海。</p>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=1015833"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Binary-Learning.html">&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</a></li>
                                                                                     <li><a href="%E5%88%9D%E7%BA%A7%E7%AF%87.html">&#21021;&#32423;&#31687;</a></li>
                                                            </ul>
</div>            <h1 id="src-1015833"> <span>Win32</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-1015833_safe-id-V2luMzItV2luMzLor77nqIvku4vnu40">
        <h1 class="heading "><span>Win32&#35838;&#31243;&#20171;&#32461;</span></h1>
<p   
>&#24456;&#22810;&#20154;&#23545;Win32&#30340;&#35748;&#35782;&#26159;&#38169;&#35823;&#30340;&#65292;&#20182;&#20204;&#35748;&#20026;Win32&#23601;&#26159;&#30011;&#30028;&#38754;&#65292;&#37117;&#24050;&#32463;&#23398;MFC&#20102;&#36824;&#23398;&#20160;&#20040;Win32&#65311;</p>
<p   
>Win32&#19981;&#26159;&#29992;&#26469;&#30011;&#30028;&#38754;&#30340;&#65292;&#22914;&#26524;&#20320;&#20197;&#21518;&#35201;&#22312;Windows&#20889;&#22909;&#31243;&#24207;&#65292;&#26159;&#24517;&#39035;&#35201;&#23398;Win32&#30340;&#65307;&#25670;&#27491;&#23398;&#20064;&#24577;&#24230;&#12290;</p>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5a2X56ym57yW56CB">
        <h1 class="heading "><span>&#23383;&#31526;&#32534;&#30721;</span></h1>
<p   
>&#25105;&#20204;&#20250;&#32463;&#24120;&#25509;&#35302;&#21040;&#21508;&#31181;&#21508;&#26679;&#30340;&#23383;&#31526;&#32534;&#30721;&#65292;&#26412;&#31456;&#33410;&#23601;&#26469;&#35762;&#35299;&#19968;&#19979;&#24120;&#35265;&#30340;&#32534;&#30721;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Y6f5aeL55qEQVNDSUnnvJbnoIE">
        <h2 class="heading "><span>&#21407;&#22987;&#30340;ASCII&#32534;&#30721;</span></h2>
<p   
>&#35745;&#31639;&#26426;&#26159;&#30001;&#32654;&#22269;&#20154;&#21457;&#26126;&#30340;&#65292;&#25152;&#20197;&#19968;&#24320;&#22987;&#35774;&#35745;&#32534;&#30721;&#30340;&#26102;&#20505;&#21482;&#20250;&#32771;&#34385;&#21040;&#33258;&#36523;&#30340;&#20803;&#32032;&#65292;&#37319;&#29992;ASCII&#32534;&#30721;&#23436;&#20840;&#21487;&#20197;&#28385;&#36275;&#20854;&#38656;&#27714;&#65292;&#20294;&#26159;&#35745;&#31639;&#26426;&#26222;&#21450;&#20043;&#21518;&#65292;&#24456;&#22810;&#22269;&#23478;&#30340;&#25991;&#23383;&#26159;&#35937;&#24418;&#25991;&#23383;&#65292;&#25152;&#20197;&#25105;&#20204;&#20351;&#29992;ASCII&#32534;&#30721;&#26159;&#26080;&#27861;&#28385;&#36275;&#38656;&#27714;&#30340;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_0-3-42.png" alt="images/download/attachments/1015833/image2021-5-17_0-3-42.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItQVNDSUnnvJbnoIHnmoTmi5PlsZXvvJpHQjIzMTLmiJZHQjIzMTItODA">
        <h2 class="heading "><span>ASCII&#32534;&#30721;&#30340;&#25299;&#23637;&#65306;GB2312&#25110;GB2312-80</span></h2>
<p   
>&#30001;&#20110;ASCII&#32534;&#30721;&#26080;&#27861;&#28385;&#36275;&#38656;&#27714;&#65292;&#25152;&#20197;&#22312;&#20854;&#22522;&#30784;&#19978;&#36827;&#34892;&#25193;&#23637;&#65292;&#22823;&#23478;&#37117;&#30693;&#36947;ASCII&#32534;&#30721;&#21482;&#26377;0-127&#65292;&#29992;&#21313;&#20845;&#36827;&#21046;&#34920;&#31034;&#26159;0x00-0x7F&#65292;&#32780;&#20043;&#21518;&#30340;0x80-0xFF&#22312;&#26631;&#20934;&#30340;ASCII&#32534;&#30721;&#20013;&#26159;&#19981;&#23384;&#22312;&#30340;&#65292;&#25152;&#20197;&#23601;&#20986;&#29616;&#20102;&#25105;&#20204;&#25152;&#35828;&#30340;ASCII&#32534;&#30721;&#30340;&#25193;&#23637;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_0-7-45.png" alt="images/download/attachments/1015833/image2021-5-17_0-7-45.png" width="600"  />
    </p>
<p   
>&#20294;&#26159;&#36825;&#26679;&#33021;&#28385;&#36275;&#20013;&#25991;&#12289;&#38889;&#25991;&#36825;&#31181;&#35937;&#24418;&#25991;&#23383;&#21527;&#65311;&#20854;&#23454;&#24182;&#19981;&#21487;&#20197;&#65292;&#22914;&#19978;&#36825;&#24352;&#34920;&#23454;&#38469;&#19978;&#20351;&#29992;&#39057;&#29575;&#24456;&#20302;&#65292;&#32780;&#36825;&#26102;&#20505;GB2312&#32534;&#30721;&#65288;<strong class=" ">&#35813;&#32534;&#30721;&#19982;GBK&#27809;&#26377;&#20160;&#20040;&#26412;&#36136;&#21306;&#21035;&#65292;&#26080;&#38750;&#23601;&#26159;&#25910;&#24405;&#30340;&#27721;&#23383;&#21644;&#22270;&#24418;&#31526;&#21495;&#30340;&#21306;&#21035;&#65306;GB2312&#26631;&#20934;&#20849;&#25910;&#24405;6763&#20010;&#27721;&#23383;&#65292;GBK&#20849;&#25910;&#20837;21886&#20010;&#27721;&#23383;&#21644;&#22270;&#24418;&#31526;&#21495;</strong>&#65289;&#32771;&#34385;&#21040;&#36825;&#20010;&#22240;&#32032;&#23601;&#21344;&#29992;&#20102;&#36825;&#24352;&#34920;&#65292;&#37027;&#20040;&#26159;&#24590;&#20040;&#21344;&#29992;&#30340;&#21602;&#65311;&#20854;&#26412;&#36136;&#23601;&#26159;&#21019;&#24314;&#20004;&#24352;&#22914;&#19978;&#22270;&#25152;&#31034;&#30340;&#34920;&#65292;&#28982;&#21518;&#36827;&#34892;&#25340;&#25509;&#65292;&#20004;&#20010;&#23383;&#33410;&#21152;&#36215;&#26469;&#23601;&#32452;&#25104;&#19968;&#20010;&#26032;&#30340;&#20013;&#25991;&#25991;&#23383;&#12290;</p>
<p   
>&#20363;&#22914;&#65306;&#20013;&#22269;&#30340;&ldquo;&#20013;&rdquo;&#36825;&#20010;&#23383;&#65292;&#23601;&#26159;0xD0&#21644;0xD6&#25340;&#25509;&#36215;&#26469;&#30340;&#12290;&#36825;&#31181;&#32534;&#30721;&#26159;&#21542;&#23384;&#22312;&#38382;&#39064;&#65311;&#36825;&#26159;&#24517;&#28982;&#30340;&#65292;&#25105;&#20204;&#24050;&#32463;&#30693;&#36947;&#20102;&#35813;&#32534;&#30721;&#30340;&#35774;&#35745;&#21407;&#29702;&#65292;&#20551;&#35774;&#25105;&#20204;&#23558;&ldquo;&#20013;&#22269;&rdquo;&#36825;&#20004;&#20010;&#23383;&#21457;&#32473;&#22269;&#22806;&#30340;&#26379;&#21451;&#65292;&#20182;&#30340;&#30005;&#33041;&#19978;&#24182;&#27809;&#26377;&#35813;&#32534;&#30721;&#34920;&#65292;&#25152;&#20197;&#35299;&#26512;&#20986;&#26469;&#30340;&#21017;&#19981;&#20250;&#26159;&#27721;&#23383;&#65292;&#32780;&#20250;&#20986;&#29616;&#22823;&#23478;&#25152;&#29087;&#30693;&#30340;&ldquo;&#20081;&#30721;&rdquo;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItVW5pY29kZee8lueggQ">
        <h2 class="heading "><span>Unicode&#32534;&#30721;</span></h2>
<p   
>&#20026;&#20102;&#35299;&#20915;ASCII&#30340;&#32570;&#38519;&#65292;Unicode&#32534;&#30721;&#23601;&#35806;&#29983;&#20102;&#65292;&#37027;&#20040;Unicode&#26159;&#22914;&#20309;&#35299;&#20915;&#36825;&#19968;&#38382;&#39064;&#30340;&#21602;&#65311;</p>
<p   
>&#20854;&#23454;&#24456;&#31616;&#21333;&#65292;Unicode&#32534;&#30721;&#21019;&#24314;&#20102;&#19968;&#24352;&#21253;&#21547;&#19990;&#30028;&#19978;&#25152;&#26377;&#25991;&#23383;&#30340;&#32534;&#30721;&#34920;&#65292;&#21482;&#35201;&#19990;&#30028;&#19978;&#23384;&#22312;&#30340;&#25991;&#23383;&#31526;&#21495;&#65292;&#37117;&#20250;&#36171;&#20104;&#19968;&#20010;&#21807;&#19968;&#30340;&#32534;&#30721;&#12290;</p>
<p   
>Unicode&#32534;&#30721;&#30340;&#33539;&#22260;&#26159;&#65306;0x0-0x10FFFF&#65292;&#20854;&#21487;&#20197;&#23481;&#32435;100&#22810;&#19975;&#20010;&#31526;&#21495;&#65292;&#20294;&#26159;Unicode&#26412;&#36523;&#20063;&#23384;&#22312;&#38382;&#39064;&#65292;&#22240;&#20026;Unicode&#21482;&#26159;&#19968;&#20010;&#31526;&#21495;&#38598;&#65292;&#23427;&#21482;&#35268;&#23450;&#20102;&#31526;&#21495;&#30340;&#20108;&#36827;&#21046;&#20195;&#30721;&#65292;&#21364;&#27809;&#26377;&#35268;&#23450;&#36825;&#20010;&#20108;&#36827;&#21046;&#20195;&#30721;&#24212;&#35813;&#22914;&#20309;&#21435;&#23384;&#20648;&#12290;</p>
<p   
>&#20551;&#35774;&#20013;&#36825;&#20010;&#23383;&#20197;Unicode&#26041;&#24335;&#34920;&#31034;&#21344;2&#20010;&#23383;&#33410;&#65292;&#32780;&#22269;&#36825;&#20010;&#23383;&#21364;&#21344;4&#20010;&#65292;&#36825;&#20010;&#26102;&#20505;&#20320;&#35813;&#22914;&#20309;&#21435;&#23384;&#20648;&#65311;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItVW5pY29kZeWtmOWCqOeahOWunueOsOaWueW8jw">
        <h2 class="heading "><span>Unicode&#23384;&#20648;&#30340;&#23454;&#29616;&#26041;&#24335;</span></h2>
    <div class="section section-3" id="src-1015833_Win32-UTF-16">
        <h3 class="heading "><span>UTF-16</span></h3>
<p   
>UTF-16/UTF-8&#26159;Unicode&#23384;&#20648;&#30340;&#23454;&#29616;&#26041;&#24335;&#65307;UTF-16&#32534;&#30721;&#26159;&#20197;16&#20010;&#26080;&#31526;&#21495;&#25972;&#25968;&#20301;&#21333;&#20301;&#65292;&#27880;&#24847;&#26159;16&#20301;&#20026;&#19968;&#20010;&#21333;&#20301;&#65292;&#20294;&#19981;&#34920;&#31034;&#19968;&#20010;&#23383;&#31526;&#23601;&#21482;&#26377;16&#20301;&#65292;&#20855;&#20307;&#30340;&#35201;&#30475;&#23383;&#31526;&#30340;Unicode&#32534;&#30721;&#25152;&#22312;&#33539;&#22260;&#65292;&#26377;&#21487;&#33021;&#26159;2&#23383;&#33410;&#65292;&#26377;&#21487;&#33021;&#26159;4&#23383;&#33410;&#65292;<strong class=" ">&#29616;&#22312;&#26426;&#22120;&#19978;&#30340;Unicode&#32534;&#30721;&#19968;&#33324;&#25351;&#30340;&#23601;&#26159;UTF-16</strong>&#12290;</p>
<p   
>&#25105;&#20204;&#20030;&#20010;&#20363;&#23376;&#65288;&#34394;&#26500;&#65289;&#65306;</p>
<p   
>&#20013;&#65288;Unicode&#32534;&#30721;&#65289;&#65306;0x1234</p>
<p   
>&#22269;&#65288;Unicode&#32534;&#30721;&#65289;&#65306;0x12345</p>
<p   
>UTF-16&#23384;&#20648;&#30340;&#26102;&#20505;&#65292;&ldquo;&#20013;&rdquo;&#36825;&#20010;&#23383;&#32943;&#23450;&#26159;&#23384;&#20648;&#30340;0x1234&#65292;&#20294;&#26159;&ldquo;&#22269;&rdquo;&#36825;&#20010;&#23383;&#23601;&#19981;&#19968;&#26679;&#65292; &#25105;&#20204;&#30693;&#36947;UTF-16&#26159;16&#20301;&#65288;2&#23383;&#33410;&#65289;&#20026;&#19968;&#20010;&#21333;&#20301;&#65292;&#25152;&#20197;&#22269;&#36825;&#20010;&#23383;&#25286;&#19979;&#26469;&#23384;&#20648;&#24212;&#35813;&#26159;0x00 0x01 0x23 0x45&#12290;</p>
<p   
>UTF-16&#30340;&#20248;&#28857;&#19968;&#30475;&#20415;&#30693;&#65306;&#35745;&#31639;&#12289;&#25286;&#20998;&#12289;&#35299;&#26512;&#38750;&#24120;&#26041;&#20415;&#65292;2&#20010;&#23383;&#33410;&#20026;&#19968;&#20010;&#21333;&#20301;&#65292;&#19968;&#20010;&#19968;&#20010;&#26469;&#12290;</p>
<p   
>UTF-16&#26159;&#21542;&#26159;&#26368;&#20248;&#35299;&#21602;&#65311;&#20854;&#23454;&#19981;&#28982;&#65292;&#25105;&#20204;&#36890;&#36807;&#22914;&#19978;&#30340;&#20363;&#23376;&#20013;&#21487;&#20197;&#30475;&#21040;&#19968;&#20010;&#24456;&#26126;&#26174;&#30340;&#32570;&#28857;&#65292;<strong class=" ">&#37027;&#23601;&#26159;UTF-16&#20250;&#23384;&#22312;&#28010;&#36153;&#31354;&#38388;&#30340;&#24773;&#20917;&#65292;&#22240;&#20026;&#20854;16&#20301;&#65288;2&#23383;&#33410;&#65289;&#20026;&#19968;&#20010;&#21333;&#20301;&#65292;&#23427;&#38656;&#35201;&#23383;&#33410;&#23545;&#40784;&#65292;&#20363;&#22914;&#23383;&#27597;A&#21482;&#38656;&#35201;&#19968;&#20010;&#23383;&#33410;&#23601;&#21487;&#20197;&#34920;&#31034;&#65292;&#32780;&#20351;&#29992;UTF-16&#26102;&#23601;&#20250;&#21464;&#25104;2&#20010;&#23383;&#33410;&#65292;&#25152;&#20197;&#24456;&#28010;&#36153;&#65292;&#32780;&#36825;&#26102;&#20505;UTF-8&#27178;&#31354;&#20986;&#19990;</strong>&#12290;&#65288;UTF-16&#22312;&#26412;&#22320;&#23384;&#20648;&#26159;&#27809;&#26377;&#21861;&#38382;&#39064;&#30340;&#65292;&#39030;&#22810;&#23601;&#26159;&#28010;&#36153;&#19968;&#28857;&#30828;&#30424;&#31354;&#38388;&#65292;&#20294;&#26159;&#22914;&#26524;&#22312;&#32593;&#32476;&#20013;&#20256;&#36755;&#65292;&#37027;&#23601;&#22826;&#36807;&#20110;&#28010;&#36153;&#20102;&#65289;</p>
    </div>
    <div class="section section-3" id="src-1015833_Win32-UTF-8">
        <h3 class="heading "><span>UTF-8</span></h3>
<p   
>UTF-8&#31216;&#20043;&#20026;&#21487;&#21464;&#38271;&#23384;&#20648;&#26041;&#26696;&#65292;&#20854;&#23384;&#20648;&#26681;&#25454;&#23383;&#31526;&#22823;&#23567;&#26469;&#20998;&#37197;&#65292;&#20363;&#22914;&#23383;&#27597;A&#23601;&#20998;&#37197;&#19968;&#20010;&#23383;&#33410;&#65292;&#27721;&#23383;&ldquo;&#20013;&rdquo;&#23601;&#20998;&#37197;&#20004;&#20010;&#23383;&#33410;&#12290;</p>
<p   
>&#20248;&#28857;&#65306;&#33410;&#30465;&#31354;&#38388;&#65307;&#32570;&#28857;&#65306;&#35299;&#26512;&#24456;&#40635;&#28902;&#12290;</p>
<p   
>UTF-8&#23384;&#20648;&#30340;&#26041;&#24335;&#26159;&#26377;&#23545;&#24212;&#34920;&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_0-46-57.png" alt="images/download/attachments/1015833/image2021-5-17_0-46-57.png" width="600"  />
    </p>
<p   
>&#20363;&#22914;&#23383;&#27597;A&#65292;&#22312;0x000000 - 0x00007F&#33539;&#22260;&#20043;&#38388;&#65292;&#21017;&#37319;&#29992;0XXXXXX&#30340;&#26041;&#24335;&#36827;&#34892;&#23384;&#20648;&#65292;&#20063;&#23601;&#26159;&#25353;&#29031;&#19968;&#20010;&#23383;&#33410;&#30340;&#26041;&#24335;&#26469;&#19981;&#20250;&#25913;&#21464;&#20160;&#20040;&#65292;&#32780;&#27721;&#23383;&rdquo;&#20013;&ldquo;&#21017;&#19981;&#19968;&#26679;&#20102;&#12290;</p>
<p   
>&#20013;&#65288;Unicode&#32534;&#30721;&#65289;&#65306;0x4E 0x2D&#65292;&#23427;&#23646;&#20110;0x000800 - 0x00FFFF&#33539;&#22260;&#20043;&#38388;&#12290;</p>
<p   
>0x4E 0x2D = 0100 1110 0010 1101&#65292;&#20854;&#20197;UTF-8&#30340;&#26041;&#24335;&#23384;&#20648;&#23601;&#26159;1110 (0100) 10(11 1000) 10(10 1101)&#65292;&#25324;&#21495;&#21253;&#35065;&#36215;&#26469;&#30340;&#23601;&#26159;&#27721;&#23383;&ldquo;&#20013;&rdquo;&#30340;Unicode&#32534;&#30721;&#12290;</p>
<p   
>&#26368;&#21518;&#19968;&#20010;&#38382;&#39064;&#65292;&#20551;&#35774;&#25105;&#20204;&#25226;UTF-8&#30340;&#25991;&#26412;&#26684;&#24335;&#21457;&#32473;&#23545;&#26041;&#65292;&#37027;&#23545;&#26041;&#22914;&#26524;&#25353;&#29031;UTF-16&#30340;&#26041;&#24335;&#21435;&#35299;&#26512;&#35813;&#24590;&#20040;&#21150;&#65311;&#22914;&#20309;&#35753;&#23545;&#26041;&#21482;&#37319;&#29992;UTF-8&#30340;&#26041;&#24335;&#21435;&#35299;&#26512;&#21602;&#65311;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItQk9N77yIQnl0ZU9yZGVyTWFya--8iQ">
        <h2 class="heading "><span>BOM&#65288;Byte Order Mark&#65289;</span></h2>
<p   
>BOM&#20013;&#25991;&#20026;&#23383;&#33410;&#39034;&#24207;&#26631;&#35760;&#65292;&#20854;&#23601;&#26159;&#29992;&#26469;&#25554;&#20837;&#21040;&#25991;&#26412;&#25991;&#20214;&#36215;&#22987;&#20301;&#32622;&#24320;&#22836;&#30340;&#65292;&#29992;&#20110;&#35782;&#21035;Unicode&#25991;&#20214;&#30340;&#32534;&#30721;&#31867;&#22411;&#12290;</p>
<p   
>&#23545;&#24212;&#20851;&#31995;&#22914;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-1-28.png" alt="images/download/attachments/1015833/image2021-5-17_1-1-28.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzItQ-ivreiogOS4reeahOWuveWtl-espg">
        <h1 class="heading "><span>C&#35821;&#35328;&#20013;&#30340;&#23485;&#23383;&#31526;</span></h1>
<p   
>&#26412;&#31456;&#20027;&#35201;&#26159;&#35762;&#35299;&#22312;C&#35821;&#35328;&#20013;&#22914;&#20309;&#20351;&#29992;&#19978;&#19968;&#31456;&#25152;&#36848;&#30340;&#32534;&#30721;&#26684;&#24335;&#34920;&#31034;&#23383;&#31526;&#20018;&#12290;</p>
<p   
>ASCII&#30721;&#65306;char strBuff[] = &quot;&#20013;&#22269;&quot;;</p>
<p   
>Unicode&#32534;&#30721;&#65288;UTF-16&#65289;&#65306;wchar_t strBuff[] = L&quot;&#20013;&#22269;&quot;; // &#36825;&#37324;&#38656;&#35201;&#22312;&#21452;&#24341;&#21495;&#20043;&#21069;&#21152;&#19978;L&#26159;&#22240;&#20026;&#22914;&#26524;&#20320;&#19981;&#21152;&#30340;&#35805;&#65292;&#32534;&#35793;&#22120;&#20250;&#40664;&#35748;&#20351;&#29992;&#24403;&#21069;&#25991;&#20214;&#30340;&#32534;&#30721;&#26684;&#24335;&#21435;&#23384;&#20648;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#21152;&#19978;&#12290;&#65288;&#27880;&#24847;&#20351;&#29992;&#36825;&#20010;&#30340;&#26102;&#20505;&#38656;&#35201;&#21253;&#21547;stdio.h&#36825;&#20010;&#22836;&#25991;&#20214;&#65289;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-27-44.png" alt="images/download/attachments/1015833/image2021-5-17_1-27-44.png" width="600"  />
    </p>
<p   
><strong class=" ">Unicode&#32534;&#30721;&#36825;&#31181;&#34920;&#29616;&#24418;&#24335;&#23454;&#38469;&#19978;&#23601;&#26159;&#23485;&#23383;&#31526;&#65292;&#25152;&#20197;&#22312;&#25552;&#36215;&#23485;&#23383;&#31526;&#30340;&#26102;&#20505;&#25105;&#20204;&#23601;&#24212;&#35813;&#24819;&#21040;&#36825;&#31181;&#26041;&#24335;&#12290;</strong></p>
<p   
>ASCII&#32534;&#30721;&#21644;Unicode&#32534;&#30721;&#22312;&#20869;&#23384;&#20013;&#30340;&#23384;&#20648;&#26041;&#24335;&#19981;&#19968;&#26679;&#65292;&#25152;&#20197;&#25105;&#20204;&#20351;&#29992;&#30456;&#20851;&#20989;&#25968;&#30340;&#26102;&#20505;&#20063;&#35201;&#27880;&#24847;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;ASCII&#32534;&#30721;&#20351;&#29992;&#24038;&#36793;&#30340;&#65292;&#32780;Unicode&#21017;&#26159;&#21491;&#36793;&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-12-0.png" alt="images/download/attachments/1015833/image2021-5-17_1-12-0.png" width="600"  />
    </p>
<p   
>&#20363;&#22914;&#25105;&#20204;&#24819;&#35201;&#22312;&#25511;&#21046;&#21488;&#20013;&#25171;&#21360;&#19968;&#20010;&#23485;&#23383;&#31526;&#30340;&#23383;&#31526;&#20018;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-18-46.png" alt="images/download/attachments/1015833/image2021-5-17_1-18-46.png" width="600"  />
    </p>
<p   
>&#20877;&#19968;&#20010;&#20363;&#23376;&#23601;&#26159;&#23383;&#31526;&#20018;&#30340;&#38271;&#24230;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">char</code><code class="plain"> strBuff[] = </code><code class="string">"China"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">wchar_t strBuff1[] = L</code><code class="string">"China"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">trlen(strBuff); </code><code class="comments">//取得多字节字符串中字符长度，不包含 00</code></div>
<div class="line"><code class="plain">wcslen(strBuff1); </code><code class="comments">//取得多字节字符串中字符长度，不包含 00 00</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzItV2luMzJBUEnkuK3nmoTlrr3lrZfnrKY">
        <h1 class="heading "><span>Win32 API&#20013;&#30340;&#23485;&#23383;&#31526;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LqG6Kej5LuA5LmI5pivV2luMzJBUEk">
        <h2 class="heading "><span>&#20102;&#35299;&#20160;&#20040;&#26159;Win32 API</span></h2>
<p   
>Win32 API&#23601;&#26159;Windows&#25805;&#20316;&#31995;&#32479;&#25552;&#20379;&#32473;&#25105;&#20204;&#30340;&#20989;&#25968;&#65288;&#24212;&#29992;&#31243;&#24207;&#25509;&#21475;&#65289;&#65292;&#20854;&#20027;&#35201;&#23384;&#25918;&#22312;C:\Windows\System32&#65288;&#23384;&#20648;&#30340;DLL&#26159;64&#20301;&#65289;&#12289;C:\Windows\SysWOW64&#65288;&#23384;&#20648;&#30340;DLL&#26159;32&#20301;&#65289;&#19979;&#38754;&#30340;&#25152;&#26377;DLL&#25991;&#20214;&#65288;&#20960;&#21315;&#20010;&#65289;&#12290;</p>
<p   
>&#37325;&#35201;&#30340;DLL&#25991;&#20214;&#65306;</p>
<ol class=" "><li class=" "><p   
>Kernel32.dll&#65306;&#26368;&#26680;&#24515;&#30340;&#21151;&#33021;&#27169;&#22359;&#65292;&#20363;&#22914;&#20869;&#23384;&#31649;&#29702;&#12289;&#36827;&#31243;&#32447;&#31243;&#30456;&#20851;&#30340;&#20989;&#25968;&#31561;&#65307;</p>
</li><li class=" "><p   
>User32.dll&#65306;Windows&#29992;&#25143;&#30028;&#38754;&#30456;&#20851;&#30340;&#24212;&#29992;&#31243;&#24207;&#25509;&#21475;&#65292;&#20363;&#22914;&#21019;&#24314;&#31383;&#21475;&#12289;&#21457;&#36865;&#20449;&#24687;&#31561;&#65307;</p>
</li><li class=" "><p   
>GDI32.dll&#65306;&#20840;&#31216;&#26159;Graphical Device Interface&#65288;&#22270;&#24418;&#35774;&#22791;&#25509;&#21475;&#65289;&#65292;&#21253;&#21547;&#29992;&#20110;&#30011;&#22270;&#21644;&#26174;&#31034;&#25991;&#26412;&#30340;&#20989;&#25968;&#12290;</p>
</li></ol><p   
>&#22312;C&#35821;&#35328;&#20013;&#25105;&#20204;&#24819;&#35201;&#20351;&#29992;Win32 API&#30340;&#35805;&#30452;&#25509;&#22312;&#20195;&#30721;&#20013;&#21253;&#21547;windows.h&#36825;&#20010;&#22836;&#25991;&#20214;&#21363;&#21487;&#12290;</p>
<p   
>&#27604;&#22914;&#25105;&#20204;&#24819;&#35201;&#24377;&#20986;&#19968;&#20010;&#25552;&#31034;&#31383;&#21475;&#65292;Win32 API&#25991;&#26723;&#20013;&#24377;&#31383;API&#30340;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">int</code><code class="plain"> MessageBox(</code></div>
<div class="line"><code class="plain">    HWND hWnd,          </code><code class="comments">// handle to owner window</code></div>
<div class="line"><code class="plain">    LPCTSTR lpText,     </code><code class="comments">// text in message box</code></div>
<div class="line"><code class="plain">    LPCTSTR lpCaption,  </code><code class="comments">// message box title</code></div>
<div class="line"><code class="plain">    UINT uType          </code><code class="comments">// message box style</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#36825;&#20010;&#20195;&#30721;&#21487;&#33021;&#30475;&#36215;&#26469;&#38750;&#24120;&#21487;&#24597;&#65292;&#22909;&#20687;&#25105;&#20204;&#37117;&#27809;&#26377;&#25509;&#35302;&#36807;&#65292;<strong class=" ">&#20294;&#23454;&#38469;&#19978;&#20854;&#19981;&#26159;&#20160;&#20040;&#26032;&#30340;&#31867;&#22411;&#65292;&#25152;&#35859;&#30340;&#26032;&#30340;&#31867;&#22411;&#26080;&#38750;&#23601;&#26159;&#32473;&#21407;&#26377;&#30340;&#31867;&#22411;&#37325;&#26032;&#36215;&#20102;&#19968;&#20010;&#21517;&#23383;&#65292;&#36825;&#26679;&#20570;&#26159;&#20026;&#20102;&#23558;&#25152;&#26377;&#31867;&#22411;&#32479;&#19968;&#21270;&#65292;&#20415;&#20110;&#35835;&#20889;&#65292;&#22914;&#26524;&#28041;&#21450;&#21040;&#36328;&#24179;&#21488;&#30340;&#35805;&#23558;&#21407;&#26469;&#30340;&#31867;&#22411;&#20462;&#25913;&#19968;&#19979;&#23601;&#22909;&#20102;&#65292;&#26080;&#38656;&#23545;&#20195;&#30721;&#36827;&#34892;&#37325;&#20889;</strong>&#12290;</p>
<p   
>&#20363;&#22914;&#20197;&#19978;&#20195;&#30721;&#20013;&#30340;&#31867;&#22411;LPCTSTR&#65292;&#23454;&#38469;&#19978;&#25105;&#20204;&#36319;&#36827;&#19968;&#19979;&#20195;&#30721;&#65288;&#36873;&#20013;F12&#65289;&#20250;&#21457;&#29616;&#20854;&#26412;&#36136;&#23601;&#26159;const char *&#36825;&#20010;&#31867;&#22411;&#65292;&#21482;&#19981;&#36807;&#26159;&#25442;&#20102;&#19968;&#20010;&#21517;&#23383;&#32610;&#20102;&#12290;</p>
<p   
>&#24120;&#29992;&#30340;&#25968;&#25454;&#31867;&#22411;&#22312;Win32&#20013;&#37117;&#37325;&#26032;&#36215;&#20102;&#21517;&#23383;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-43-48.png" alt="images/download/attachments/1015833/image2021-5-17_1-43-48.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5ZyoV2luMzLkuK3kvb_nlKjlrZfnrKbkuLI">
        <h2 class="heading "><span>&#22312;Win32&#20013;&#20351;&#29992;&#23383;&#31526;&#20018;</span></h2>
<p   
>&#23383;&#31526;&#31867;&#22411;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">CHAR strBuff[] = </code><code class="string">"中国"</code><code class="plain">; </code><code class="comments">// char</code></div>
<div class="line"><code class="plain">WCHAR strBuff[] = L</code><code class="string">"中国"</code><code class="plain">; </code><code class="comments">// wchar_t</code></div>
<div class="line"><code class="plain">TCHAR strBuff[] = TEXT(</code><code class="string">"中国"</code><code class="plain">); </code><code class="comments">// TCHAR 根据当前项目的编码自动选择char还是wchar_t，在Win32中推荐使用这种方式</code></div>
</div>
    </div>
<p   
>&#23383;&#31526;&#20018;&#25351;&#38024;:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">PSTR strPoint = </code><code class="string">"中国"</code><code class="plain">; </code><code class="comments">// char*</code></div>
<div class="line"><code class="plain">PWSTR strPoint = L</code><code class="string">"中国"</code><code class="plain">; </code><code class="comments">// wchar_t*</code></div>
<div class="line"><code class="plain">PTSTR strPoint = TEXT(</code><code class="string">"中国"</code><code class="plain">); </code><code class="comments">// PTSTR 根据当前项目的编码自动选择如char*还是wchar_t*，在Win32中推荐使用这种方式</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5L2_55SoV2luMzJBUEnlvLnmoYY">
        <h2 class="heading "><span>&#20351;&#29992;Win32 API&#24377;&#26694;</span></h2>
<p   
>&#20043;&#21069;&#25105;&#20204;&#20102;&#35299;&#21040;Win32 API&#20013;&#30340;&#24377;&#26694;&#65292;&#20854;&#21517;&#31216;&#20026;MessageBox&#65292;&#20854;&#23454;&#38469;&#19978;&#26412;&#36136;&#23601;&#26159;MessageBoxW&#21644;MessageBoxA&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_1-51-13.png" alt="images/download/attachments/1015833/image2021-5-17_1-51-13.png" width="600"  />
    </p>
<p   
>MessageBoxA&#21482;&#25509;&#21463;ASCII&#32534;&#30721;&#30340;&#21442;&#25968;&#65292;&#32780;MessageBoxW&#21017;&#21482;&#25509;&#21463;Unicode&#32534;&#30721;&#30340;&#21442;&#25968;&#12290;</p>
<p   
>&#20174;&#26412;&#36136;&#19978;&#26469;&#35762;&#65292;Windows&#23383;&#31526;&#20018;&#37117;&#26159;&#23485;&#23383;&#31526;&#30340;&#65292;&#25152;&#20197;<strong class=" ">&#20351;&#29992;MessageBoxW&#36825;&#31181;&#26041;&#24335;&#24615;&#33021;&#20250;&#26356;&#22909;&#19968;&#20123;</strong>&#65292;&#22240;&#20026;&#24403;&#20320;&#20351;&#29992;MessageBoxA&#30340;&#26102;&#20505;&#65292;&#22312;&#21040;&#20869;&#26680;&#30340;&#26102;&#20505;&#65288;&#31995;&#32479;&#24213;&#23618;&#65289;&#20854;&#20250;&#36716;&#21270;Unicode&#65292;&#25152;&#20197;&#24615;&#33021;&#30456;&#23545;&#24046;&#19968;&#20123;&#12290;</p>
<p   
>&#24377;&#26694;&#35843;&#29992;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">CHAR strTitle[] = </code><code class="string">"Title"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">CHAR strContent[] = </code><code class="string">"Hello World!"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">MessageBoxA(</code><code class="value">0</code><code class="plain">, strContent, strTitle, MB_OK);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">WCHAR strTitle[] = L</code><code class="string">"Title"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">WCHAR strContent[] = L</code><code class="string">"Hello World!"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">MessageBoxW(</code><code class="value">0</code><code class="plain">, strContent, strTitle, MB_OK);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">TCHAR strTitle[] = TEXT(</code><code class="string">"Title"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">TCHAR strContent[] = TEXT(</code><code class="string">"Hello World!"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">MessageBox(</code><code class="value">0</code><code class="plain">, strContent, strTitle, MB_OK);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_2-3-22.png" alt="images/download/attachments/1015833/image2021-5-17_2-3-22.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6L-b56iL55qE5Yib5bu66L-H56iL">
        <h1 class="heading "><span>&#36827;&#31243;&#30340;&#21019;&#24314;&#36807;&#31243;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv6L-b56iL">
        <h2 class="heading "><span>&#20160;&#20040;&#26159;&#36827;&#31243;</span></h2>
<p   
>&#31243;&#24207;&#25152;&#38656;&#35201;&#30340;&#36164;&#28304;&#65288;&#25968;&#25454;&#12289;&#20195;&#30721;...&#65289;&#26159;&#30001;&#36827;&#31243;&#25552;&#20379;&#30340;&#65307;&#36827;&#31243;&#26159;&#19968;&#31181;&#31354;&#38388;&#19978;&#30340;&#27010;&#24565;&#65292;&#23427;&#30340;&#36131;&#20219;&#23601;&#26159;&#25552;&#20379;&#36164;&#28304;&#65292;&#33267;&#20110;&#36164;&#28304;&#22914;&#20309;&#20351;&#29992;&#65292;&#19982;&#23427;&#26080;&#20851;&#12290;</p>
<p   
>&#27599;&#19968;&#20010;&#36827;&#31243;&#37117;&#26377;&#33258;&#24049;&#30340;&#19968;&#20010;4GB&#22823;&#23567;&#30340;&#34394;&#25311;&#31354;&#38388;&#65292;&#20063;&#23601;&#26159;&#20174;0x0-0xFFFFFFFF&#36825;&#20010;&#33539;&#22260;&#12290;</p>
<p   
>&#36827;&#31243;&#20869;&#23384;&#31354;&#38388;&#30340;&#22320;&#22336;&#21010;&#20998;&#22914;&#19979;&#65292;&#27599;&#20010;&#36827;&#31243;&#30340;&#20869;&#26680;&#26159;&#21516;&#19968;&#20221;&#65288;&#39640;2G&#65289;&#65292;&#21482;&#26377;&#20854;&#20182;&#19977;&#20010;&#20998;&#21306;&#26159;&#36827;&#31243;&#29420;&#26377;&#30340;&#65288;&#20302;2G&#65289;&#65292;&#32780;&#21482;&#26377;&#29992;&#25143;&#27169;&#24335;&#21306;&#26159;&#25105;&#20204;&#20351;&#29992;&#30340;&#33539;&#22260;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-17_23-53-53.png" alt="images/download/attachments/1015833/image2021-5-17_23-53-53.png" width="600"  />
    </p>
<p   
>&#36827;&#31243;&#20063;&#21487;&#20197;&#29702;&#35299;&#20026;&#26159;&#19968;&#22534;&#27169;&#22359;&#32452;&#25104;&#30340;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;OD&#25171;&#24320;&#19968;&#20010;&#36827;&#31243;&#30475;&#19968;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2022-10-20_16-47-22.png" alt="images/download/attachments/1015833/image2022-10-20_16-47-22.png" width="600"  />
    </p>
<p   
>&#36825;&#37324;&#38754;&#26377;&#24456;&#22810;&#30340;&#27169;&#22359;&#65292;&#27599;&#20010;&#27169;&#22359;&#37117;&#26159;&#19968;&#20010;&#21487;&#25191;&#34892;&#25991;&#20214;&#65292;&#23427;&#20204;&#36981;&#23432;&#30456;&#21516;&#30340;&#26684;&#24335;&#65292;&#21363;PE&#32467;&#26500;&#65292;&#25152;&#20197;&#25105;&#20204;&#20063;&#21487;&#20197;&#29702;&#35299;&#36827;&#31243;&#23601;&#26159;&#19968;&#22534;PE&#32452;&#21512;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6L-b56iL55qE5Yib5bu6">
        <h2 class="heading "><span>&#36827;&#31243;&#30340;&#21019;&#24314;</span></h2>
<p   
>&#25105;&#20204;&#38656;&#35201;&#30693;&#36947;&#20219;&#20309;&#36827;&#31243;&#37117;&#26159;&#21035;&#30340;&#36827;&#31243;&#21019;&#24314;&#30340;&#65292;&#24403;&#25105;&#20204;&#22312;Windows&#19979;&#21452;&#20987;&#25171;&#24320;&#19968;&#20010;&#25991;&#20214;&#65292;&#23454;&#38469;&#19978;&#23601;&#26159;explore.exe&#36825;&#20010;&#36827;&#31243;&#21019;&#24314;&#30340;&#25105;&#20204;&#25171;&#24320;&#25991;&#20214;&#30340;&#36827;&#31243;&#65292;&#20854;&#20351;&#29992;&#30340;&#26041;&#27861;&#23601;&#26159;&#65306;CreateProcess()</p>
<p   
>&#36827;&#31243;&#21019;&#24314;&#30340;&#36807;&#31243;&#20063;&#23601;&#26159;<strong class=" ">CreateProcess&#20989;&#25968;</strong>&#65306;</p>
<ol class=" "><li class=" "><p   
>&#26144;&#23556;EXE&#25991;&#20214;&#65288;&#20302;2G&#65289;</p>
</li><li class=" "><p   
>&#21019;&#24314;&#20869;&#26680;&#23545;&#35937;EPROCESS&#65288;&#39640;2G&#65289;</p>
</li><li class=" "><p   
>&#26144;&#23556;&#31995;&#32479;DLL&#65288;ntdll.dll&#65289;</p>
</li><li class=" "><p   
>&#21019;&#24314;&#32447;&#31243;&#20869;&#26680;&#23545;&#35937;RTHREAD&#65288;&#39640;2G&#65289;</p>
</li><li class=" "><p   
>&#31995;&#32479;&#21551;&#21160;&#32447;&#31243;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#26144;&#23556;DLL&#65288;ntdll.LdrInitializeThunk&#65289;</p>
</li><li class=" "><p   
>&#32447;&#31243;&#24320;&#22987;&#25191;&#34892;</p>
</li></ol></li></ol><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-18_0-17-35.png" alt="images/download/attachments/1015833/image2021-5-18_0-17-35.png" width="600"  />
    </p>
<p   
>&#22914;&#19978;&#22270;&#23601;&#26159;&#25171;&#24320;A.exe&#30340;&#21019;&#24314;&#36807;&#31243;&#22270;&#65292;&#36827;&#31243;&#26159;&#31354;&#38388;&#19978;&#30340;&#27010;&#24565;&#65292;&#21482;&#29992;&#20110;&#25552;&#20379;&#20195;&#30721;&#21644;&#25968;&#25454;&#36164;&#28304;&#31561;&#31561;...&#32780;&#24819;&#35201;&#20351;&#29992;&#36825;&#20123;&#36164;&#28304;&#30340;&#26159;&#32447;&#31243;&#65292;&#27599;&#20010;&#36827;&#31243;&#33267;&#23569;&#38656;&#35201;&#19968;&#20010;&#32447;&#31243;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5Yib5bu66L-b56iL">
        <h1 class="heading "><span>&#21019;&#24314;&#36827;&#31243;</span></h1>
<p   
>&#21019;&#24314;&#36827;&#31243;&#30340;&#20989;&#25968;&#26159;CreateProcess()&#65292;&#36825;&#20010;&#20989;&#25968;&#30340;&#20351;&#29992;&#26041;&#27861;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL CreateProcess(</code></div>
<div class="line"><code class="plain">    LPCTSTR lpApplicationName,                 </code><code class="comments">// name of executable module 进程名（完整文件路径）</code></div>
<div class="line"><code class="plain">    LPTSTR lpCommandLine,                      </code><code class="comments">// command line string 命令行传参</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpProcessAttributes, </code><code class="comments">// SD 进程句柄</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpThreadAttributes,  </code><code class="comments">// SD 线程句柄</code></div>
<div class="line"><code class="plain">    BOOL bInheritHandles,                      </code><code class="comments">// handle inheritance option 句柄</code></div>
<div class="line"><code class="plain">    DWORD dwCreationFlags,                     </code><code class="comments">// creation flags 标志</code></div>
<div class="line"><code class="plain">    LPVOID lpEnvironment,                      </code><code class="comments">// new environment block 父进程环境变量</code></div>
<div class="line"><code class="plain">    LPCTSTR lpCurrentDirectory,                </code><code class="comments">// current directory name 父进程目录作为当前目录，设置目录</code></div>
<div class="line"><code class="plain">    LPSTARTUPINFO lpStartupInfo,               </code><code class="comments">// startup information 结构体详细信息（启动进程相关信息）</code></div>
<div class="line"><code class="plain">    LPPROCESS_INFORMATION lpProcessInformation </code><code class="comments">// process information 结构体详细信息（进程ID、线程ID、进程句柄、线程句柄）</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#26412;&#31456;&#33410;&#23545;<strong class=" ">CreateProcess&#20989;&#25968;</strong>&#30340;&#20102;&#35299;&#23601;&#26159;&#21069;2&#20010;&#21442;&#25968;&#21644;&#21518;2&#20010;&#21442;&#25968;&#65292;&#21069;&#20004;&#20010;&#21442;&#25968;&#65306;<strong class=" ">lpApplicationName&#12289;lpCommandLine</strong>&#65292;&#31532;&#19968;&#20010;&#26159;&#38656;&#35201;&#21551;&#21160;&#30340;&#36827;&#31243;&#25991;&#20214;&#36335;&#24452;&#65292;&#31532;&#20108;&#20010;&#26159;&#21629;&#20196;&#34892;&#21442;&#25968;&#65292;&#22914;&#26524;&#20320;&#21551;&#21160;&#30340;&#36827;&#31243;&#26377;&#21442;&#25968;&#30340;&#21487;&#20197;&#21487;&#20197;&#20256;&#20837;&#12290;</p>
<p   
>&#21629;&#20196;&#34892;&#21442;&#25968;&#26159;&#25351;&#22312;CMD&#21629;&#20196;&#34892;&#19979;&#36816;&#34892;&#31243;&#24207;&#25152;&#38656;&#35201;&#25552;&#20379;&#30340;&#21442;&#25968;&#65292;&#20363;&#22914;&#25105;&#20204;&#30340;main&#20837;&#21475;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"%s - %s"</code><code class="plain">, argv[</code><code class="value">0</code><code class="plain">], argv[</code><code class="value">1</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#20854;&#20989;&#25968;&#20256;&#21442;char* argv[]&#23601;&#26159;&#21629;&#20196;&#34892;&#21442;&#25968;&#65292;&#35201;&#20351;&#29992;&#30340;&#35805;&#23601;&#26159;argv[0]&#21017;&#34920;&#31034;&#31243;&#24207;&#26412;&#36523;&#65292;&#20854;&#20313;&#24448;&#21518;&#21017;&#26159;&#21442;&#25968;&#65292;argv[1]&#12289;argv[2]...&#31561;&#31561;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-19_17-30-15.png" alt="images/download/attachments/1015833/image2021-5-19_17-30-15.png" width="600"  />
    </p>
<p   
>&#25152;&#20197;&#25105;&#20204;&#35201;&#20351;&#29992;<strong class=" ">CreateProcess&#20989;&#25968;</strong>&#21019;&#24314;&#36827;&#31243;&#30340;&#35805;&#65292;&#22914;&#26524;&#38656;&#35201;&#25552;&#20379;&#21629;&#20196;&#34892;&#21442;&#25968;&#21017;&#38656;&#35201;&#22635;&#20889;&#31532;&#20108;&#20010;&#21442;&#25968;lpCommandLine&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-19_19-7-34.png" alt="images/download/attachments/1015833/image2021-5-19_19-7-34.png" width="600"  />
    </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdlib.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    TCHAR childProcessName[] = TEXT(</code><code class="string">"C:/WINDOWS/system32/cmd.exe"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    TCHAR childProcessCommandLine[] = TEXT(</code><code class="string">" /c ping 127.0.0.1"</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    STARTUPINFO si;</code></div>
<div class="line"><code class="plain">    PROCESS_INFORMATION pi;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    ZeroMemory(&amp;si, sizeof(si));</code></div>
<div class="line"><code class="plain">    ZeroMemory(&amp;pi, sizeof(pi));</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    si.cb = sizeof(si);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(CreateProcess(childProcessName, childProcessCommandLine, NULL, NULL, FALSE, </code><code class="value">0</code><code class="plain">, NULL, NULL, &amp;si, &amp;pi)) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateProcess Successfully! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateProcess Error: %d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    CloseHandle(pi.hProcess);</code></div>
<div class="line"><code class="plain">    CloseHandle(pi.hThread);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    system(</code><code class="string">"pause"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#19978;&#22270;&#25152;&#31034;&#20195;&#30721;&#65292;&#39318;&#20808;&#25105;&#23450;&#20041;&#20102;&#36827;&#31243;&#36335;&#24452;&#12289;&#36827;&#31243;&#21629;&#20196;&#34892;&#21442;&#25968;&#65292;&#20854;&#27425;<strong class=" ">&#21019;&#24314;&#20102;si&#12289;pi&#20004;&#20010;&#32467;&#26500;&#20307;</strong>&#65292;&#28982;&#21518;&#20351;&#29992;<strong class=" ">ZeroMemory&#20989;&#25968;&#29992;0&#22635;&#20805;&#32467;&#26500;&#20307;&#25968;&#25454;</strong>&#65292;&#20877;&#32473;<strong class=" ">si.cb&#25104;&#21592;&#36171;&#20540;</strong>&#24403;&#21069;&#32467;&#26500;&#20307;&#22823;&#23567;&#65288;&#20026;&#20160;&#20040;&#38656;&#35201;&#65311;&#36825;&#26159;&#22240;&#20026;Windows&#20250;&#26377;&#24456;&#22810;&#20010;&#29256;&#26412;&#65292;&#20415;&#20110;&#26410;&#26469;&#26356;&#26032;&#25442;&#20195;&#65289;&#65307;&#26368;&#21518;<strong class=" ">CreateProcess&#20989;&#25968;&#21019;&#24314;&#36827;&#31243;</strong>&#65292;&#30001;&#20110;CreateProcess&#20989;&#25968;&#26412;&#36523;&#36820;&#22238;&#20540;&#26159;&#24067;&#23572;&#31867;&#22411;&#30340;&#65292;&#25152;&#20197;&#20351;&#29992;if&#26469;&#21028;&#26029;&#65292;&#22914;&#26524;&#20986;&#38382;&#39064;&#21017;&#20351;&#29992;<strong class=" ">GetLastError&#20989;&#25968;&#26469;&#33719;&#21462;&#38382;&#39064;&#32534;&#21495;</strong>&#65292;&#20855;&#20307;&#32534;&#21495;&#23545;&#24212;&#20160;&#20040;&#20869;&#23481;&#21487;&#20197;&#21442;&#32771;&#30334;&#24230;&#30334;&#31185;&#65306;<a  class="external-link" href="https://baike.baidu.com/item/GetLastError/4278820?fr=aladdin">https://baike.baidu.com/item/GetLastError/4278820?fr=aladdin</a></p>
<p   
>&#22312;&#21019;&#24314;&#23436;&#36827;&#31243;&#20043;&#21518;&#38656;&#35201;&#20851;&#38381;&#36827;&#31243;&#65292;&#20294;&#26159;&#25105;&#20204;&#25152;&#30693;&#36947;&#65292;&#27599;&#20010;&#36827;&#31243;&#33267;&#23569;&#26377;&#19968;&#20010;&#32447;&#31243;&#65292;&#25152;&#20197;&#25105;&#20204;&#20063;&#35201;&#20851;&#38381;&#32447;&#31243;&#65292;&#20351;&#29992;<strong class=" ">CloseHandle&#20989;&#25968;</strong>&#26469;&#20851;&#38381;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-19_19-52-23.png" alt="images/download/attachments/1015833/image2021-5-19_19-52-23.png" width="600"  />
    </p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6K--5aSW5omp5bGVLeWPjeiwg-ivlShTVEFSVFVQSU5GT-e7k-aehOS9kyk">
        <h2 class="heading "><span>&#35838;&#22806;&#25193;&#23637;-&#21453;&#35843;&#35797;(STARTUPINFO&#32467;&#26500;&#20307;)</span></h2>
<p   
><strong class=" ">CreateProcess()&#20989;&#25968;</strong>&#21019;&#24314;&#36827;&#31243;&#65292;&#20854;&#26377;&#19968;&#20010;&#21442;&#25968;&#26159;<strong class=" ">STARTUPINFO&#32467;&#26500;&#20307;</strong>&#65292;&#36825;&#20010;&#21442;&#25968;&#26159;&#36827;&#31243;&#21551;&#21160;&#30340;&#19968;&#20123;&#20449;&#24687;&#65292;&#25105;&#20204;&#19968;&#24320;&#22987;&#20250;&#23558;&#20854;ZeroMemory()&#20989;&#25968;&#22788;&#29702;&#65292;&#22635;&#20805;0&#65292;&#37027;&#20040;&#22312;&#36816;&#34892;&#30340;&#26102;&#20505;&#26159;&#21542;&#36824;&#37117;&#26159;0&#21602;&#65311;&#25110;&#32773;&#35828;&#22312;&#36733;&#20837;&#35843;&#35797;&#24037;&#20855;&#30340;&#26102;&#20505;&#25152;&#26377;&#25104;&#21592;&#26159;&#21542;&#37117;&#26159;0&#21602;&#65311;</p>
<p   
>&#39318;&#20808;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;<strong class=" ">STARTUPINFO&#32467;&#26500;&#20307;</strong>&#30340;&#25104;&#21592;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _STARTUPINFOA {</code></div>
<div class="line"><code class="plain">    DWORD   cb;</code></div>
<div class="line"><code class="plain">    LPSTR   lpReserved;</code></div>
<div class="line"><code class="plain">    LPSTR   lpDesktop;</code></div>
<div class="line"><code class="plain">    LPSTR   lpTitle;</code></div>
<div class="line"><code class="plain">    DWORD   dwX;</code></div>
<div class="line"><code class="plain">    DWORD   dwY;</code></div>
<div class="line"><code class="plain">    DWORD   dwXSize;</code></div>
<div class="line"><code class="plain">    DWORD   dwYSize;</code></div>
<div class="line"><code class="plain">    DWORD   dwXCountChars;</code></div>
<div class="line"><code class="plain">    DWORD   dwYCountChars;</code></div>
<div class="line"><code class="plain">    DWORD   dwFillAttribute;</code></div>
<div class="line"><code class="plain">    DWORD   dwFlags;</code></div>
<div class="line"><code class="plain">    WORD    wShowWindow;</code></div>
<div class="line"><code class="plain">    WORD    cbReserved2;</code></div>
<div class="line"><code class="plain">    LPBYTE  lpReserved2;</code></div>
<div class="line"><code class="plain">    HANDLE  hStdInput;</code></div>
<div class="line"><code class="plain">    HANDLE  hStdOutput;</code></div>
<div class="line"><code class="plain">    HANDLE  hStdError;</code></div>
<div class="line"><code class="plain">} STARTUPINFOA, *LPSTARTUPINFOA;</code></div>
</div>
    </div>
<p   
>&#23558;&#36825;&#20960;&#20010;<strong class=" ">DWORD&#31867;&#22411;</strong>&#30340;&#25104;&#21592;&#25171;&#21360;&#19968;&#19979;&#30475;&#30475;&#65292;&#36890;&#36807;<strong class=" ">GetStartupInfo&#20989;&#25968;</strong>&#26469;&#33719;&#21462;&#20449;&#24687;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdlib.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    STARTUPINFO si;</code></div>
<div class="line"><code class="plain">    ZeroMemory(&amp;si, sizeof(si));</code></div>
<div class="line"><code class="plain">    si.cb = sizeof(si);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    GetStartupInfo(&amp;si);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"%d %d %d %d %d %d %d %d\n"</code><code class="plain">, si.dwX, si.dwY, si.dwXSize, si.dwYSize, si.dwXCountChars, si.dwYCountChars, si.dwFillAttribute, si.dwFlags); </code></div>
<div class="line"><code class="plain">    system(</code><code class="string">"pause"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#27491;&#24120;&#25171;&#24320;&#65288;P1&#65289;&#21644;&#22312;DTDebug&#35843;&#35797;&#24037;&#20855;&#65288;P2&#65289;&#20013;&#25171;&#24320;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-19_21-13-54.png" alt="images/download/attachments/1015833/image2021-5-19_21-13-54.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#21487;&#20197;&#24456;&#28165;&#26970;&#30340;&#30475;&#35265;&#20102;&#20960;&#20010;&#20540;&#22312;&#35843;&#35797;&#24037;&#20855;&#20013;&#25171;&#24320;&#21457;&#29983;&#21464;&#21270;&#65306;<strong class=" ">si.dwXSize, si.dwYSize, si.dwXCountChars, si.dwFillAttribute, si.dwFlags</strong></p>
<p   
>&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#26681;&#25454;&#36825;&#20960;&#20010;&#20540;&#26469;&#21028;&#26029;&#20174;&#32780;&#36827;&#34892;&#21453;&#35843;&#35797;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-19_22-7-56.png" alt="images/download/attachments/1015833/image2021-5-19_22-7-56.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5Y-l5p-E6KGo">
        <h1 class="heading "><span>&#21477;&#26564;&#34920;</span></h1>
<p   
>&#22312;&#19978;&#19968;&#31456;&#33410;&#20013;&#65292;&#25105;&#20204;&#20102;&#35299;&#21040;&#20102;CreateProcess()&#20989;&#25968;&#21019;&#24314;&#36827;&#31243;&#20250;&#26377;&#19968;&#20010;&#32467;&#26500;&#20307;<strong class=" ">LPPROCESS_INFORMATION lpProcessInformation</strong>&#65292;&#36825;&#20010;&#32467;&#26500;&#20307;&#20250;&#26377;&#36827;&#31243;&#21644;&#32447;&#31243;&#30340;ID&#12289;&#21477;&#26564;&#20449;&#24687;&#65292;&#37027;&#20040;&#20160;&#20040;&#26159;ID&#65311;&#20160;&#20040;&#26159;&#21477;&#26564;&#65311;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5qC45a-56LGh">
        <h2 class="heading "><span>&#20869;&#26680;&#23545;&#35937;</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv5YaF5qC45a-56LGh">
        <h3 class="heading "><span>&#20160;&#20040;&#26159;&#20869;&#26680;&#23545;&#35937;</span></h3>
<p   
>&#39318;&#20808;&#25105;&#20204;&#26469;&#20102;&#35299;&#19968;&#19979;&#20869;&#26680;&#23545;&#35937;&#65292;&#20197;&#21518;&#20250;&#32463;&#24120;&#19982;&#20869;&#26680;&#23545;&#35937;&#25171;&#20132;&#36947;&#65292;&#20363;&#22914;&#36827;&#31243;&#12289;&#32447;&#31243;&#12289;&#25991;&#20214;&#12289;&#20114;&#26021;&#20307;&#12289;&#20107;&#20214;&#31561;&#31561;&#22312;&#20869;&#26680;&#37117;&#26377;&#19968;&#20010;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#65292;&#36825;&#20123;&#32467;&#26500;&#20307;&#37117;&#30001;&#20869;&#26680;&#36127;&#36131;&#31649;&#29702;&#65292;&#25152;&#20197;&#25105;&#20204;&#37117;&#21487;&#20197;&#31216;&#20043;&#20026;&#20869;&#26680;&#23545;&#35937;&#65288;<strong class=" ">&#24403;&#25105;&#20204;&#21019;&#24314;&#19968;&#20010;&#36827;&#31243;&#65292;&#22312;&#20869;&#26680;&#23618;&#65288;&#39640;2G&#65289;&#23601;&#20250;&#21019;&#24314;&#19968;&#20010;&#32467;&#26500;&#20307;EPROCESS...</strong>&#65289;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-20_0-41-40.png" alt="images/download/attachments/1015833/image2021-5-20_0-41-40.png" width="600"  />
    </p>
<p   
>&#35760;&#19981;&#20303;&#27809;&#20851;&#31995;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;<strong class=" ">MSDN Library&#20013;&#25628;&#32034;CloseHandle&#36825;&#20010;&#20989;&#25968;</strong>&#65292;&#23427;&#26159;&#29992;&#26469;&#20851;&#38381;&#21477;&#26564;&#30340;&#65292;&#26242;&#26102;&#20808;&#19981;&#29992;&#31649;&#20854;&#21407;&#29702;&#65292;&#25105;&#20204;&#21482;&#35201;&#30693;&#36947;&#23427;&#25152;&#25903;&#25345;&#20851;&#38381;&#23601;&#37117;&#26159;&#20869;&#26680;&#23545;&#35937;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-20_0-46-21.png" alt="images/download/attachments/1015833/image2021-5-20_0-46-21.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt566h55CG5YaF5qC45a-56LGh">
        <h3 class="heading "><span>&#31649;&#29702;&#20869;&#26680;&#23545;&#35937;</span></h3>
<p   
>&#24403;&#25105;&#20204;&#20351;&#29992;&#22914;&#19979;&#22270;&#25152;&#31034;&#30340;&#20989;&#25968;&#21019;&#24314;&#26102;&#65292;&#20250;&#22312;&#20869;&#26680;&#23618;&#21019;&#24314;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#32780;&#25105;&#20204;&#35813;&#22914;&#20309;&#31649;&#29702;&#36825;&#20123;&#32467;&#26500;&#20307;&#21602;&#65311;&#25110;&#32773;&#35828;&#22914;&#20309;&#20351;&#29992;&#36825;&#20123;&#32467;&#26500;&#20307;&#21602;&#65311;&#20854;&#23454;&#24456;&#22909;&#35299;&#20915;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#20869;&#26680;&#32467;&#26500;&#20307;&#22320;&#22336;&#26469;&#31649;&#29702;&#65292;&#20294;&#26159;&#36825;&#26679;&#20570;&#23384;&#22312;&#38382;&#39064;&#65306;<strong class=" ">&#24212;&#29992;&#23618;&#24456;&#26377;&#21487;&#33021;&#25805;&#20316;&#19981;&#24403;&#23548;&#33268;&#20462;&#25913;&#21862;&#20869;&#26680;&#32467;&#26500;&#20307;&#30340;&#22320;&#22336;</strong>&#65292;&#25105;&#20204;&#20889;&#24212;&#29992;&#23618;&#20195;&#30721;&#37117;&#30693;&#36947;&#35775;&#38382;&#21040;&#19968;&#20010;&#19981;&#23384;&#22312;&#30340;&#20869;&#23384;&#22320;&#22336;&#23601;&#20250;&#25253;&#38169;&#65292;&#32780;&#22914;&#26524;&#35775;&#38382;&#21040;&#19968;&#20010;&#20869;&#26680;&#22320;&#22336;&#26159;&#38169;&#35823;&#30340;&#65292;&#24494;&#36719;&#31995;&#32479;&#19979;&#21017;&#30452;&#25509;&#20250;&#34013;&#23631;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-20_0-53-28.png" alt="images/download/attachments/1015833/image2021-5-20_0-53-28.png" width="600"  />
    </p>
<p   
>&#24494;&#36719;&#20026;&#20102;&#36991;&#20813;&#36825;&#31181;&#24773;&#20917;&#30340;&#21457;&#29983;&#65292;&#25152;&#20197;&#20854;&#19981;&#20250;&#35762;&#20869;&#26680;&#32467;&#26500;&#20307;&#30340;&#22320;&#22336;&#26292;&#38706;&#32473;&#24212;&#29992;&#23618;&#65292;&#20063;&#23601;&#26159;&#35828;&#27809;&#27861;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#26469;&#30452;&#25509;&#31649;&#29702;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6L-b56iL5Y-l5p-E6KGo">
        <h2 class="heading "><span>&#36827;&#31243;&#21477;&#26564;&#34920;</span></h2>
<p   
>&#27809;&#27861;&#30452;&#25509;&#31649;&#29702;&#20869;&#26680;&#23545;&#35937;&#65292;&#36825;&#26102;&#20505;&#21477;&#26564;&#34920;&#23601;&#35806;&#29983;&#20102;&#65292;&#20294;&#26159;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#21482;&#26377;&#36827;&#31243;&#25165;&#20250;&#26377;&#21477;&#26564;&#34920;&#65292;&#24182;&#19988;&#27599;&#19968;&#20010;&#36827;&#31243;&#37117;&#20250;&#26377;&#19968;&#20010;&#21477;&#26564;&#34920;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-20_1-1-58.png" alt="images/download/attachments/1015833/image2021-5-20_1-1-58.png" width="600"  />
    </p>
<p   
>&#21477;&#26564;&#26412;&#36136;&#19978;&#23601;&#19968;&#20010;&#38450;&#28779;&#22681;&#65292;&#23558;&#24212;&#29992;&#23618;&#12289;&#20869;&#26680;&#23618;&#38548;&#31163;&#24320;&#26469;&#65292;&#36890;&#36807;&#21477;&#26564;&#23601;&#21487;&#20197;&#25511;&#21046;&#36827;&#31243;&#20869;&#26680;&#32467;&#26500;&#20307;&#65292;&#25105;&#20204;&#24471;&#21040;&#25152;&#35859;&#21477;&#26564;&#30340;&#20540;&#23454;&#38469;&#19978;&#23601;&#26159;&#21477;&#26564;&#34920;&#37324;&#30340;&#19968;&#20010;&#32034;&#24341;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5aSa6L-b56iL5YWx5Lqr5LiA5Liq5YaF5qC45a-56LGh">
        <h2 class="heading "><span>&#22810;&#36827;&#31243;&#20849;&#20139;&#19968;&#20010;&#20869;&#26680;&#23545;&#35937;</span></h2>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;A&#36827;&#31243;&#36890;&#36807;<strong class=" ">CreateProcess&#20989;&#25968;</strong>&#21019;&#24314;&#20102;&#19968;&#20010;&#20869;&#26680;&#23545;&#35937;&#65307;B&#36827;&#31243;&#36890;&#36807;<strong class=" ">OpenProcess&#20989;&#25968;</strong>&#21487;&#20197;&#25171;&#24320;&#21035;&#20154;&#21019;&#24314;&#22909;&#30340;&#19968;&#20010;&#36827;&#31243;&#65292;&#20063;&#23601;&#26159;&#21487;&#20197;&#25805;&#20316;&#20854;&#30340;&#20869;&#26680;&#23545;&#35937;&#65307;A&#36827;&#31243;&#24819;&#35201;&#25805;&#20316;&#20869;&#26680;&#23545;&#35937;&#23601;&#36890;&#36807;&#20854;&#23545;&#24212;&#30340;&#21477;&#26564;&#34920;&#30340;&#21477;&#26564;&#65288;&#32034;&#24341;&#65289;&#26469;&#25805;&#20316;&#65307;B&#36827;&#31243;&#25805;&#20316;&#36825;&#20010;&#20869;&#26680;&#23545;&#35937;&#20063;&#26159;&#36890;&#36807;&#23427;&#33258;&#24049;&#30340;&#21477;&#26564;&#34920;&#30340;&#21477;&#26564;&#65288;&#32034;&#24341;&#65289;&#26469;&#25805;&#20316;&#20869;&#26680;&#23545;&#35937;&#12290;&#65288;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65306;&#21477;&#26564;&#34920;&#26159;&#19968;&#20010;&#31169;&#26377;&#30340;&#65292;&#21477;&#26564;&#20540;&#23601;&#26159;&#36827;&#31243;&#33258;&#24049;&#21477;&#26564;&#34920;&#30340;&#32034;&#24341;&#65289;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_0-19-38.png" alt="images/download/attachments/1015833/image2021-5-21_0-19-38.png" width="600"  />
    </p>
<p   
>&#22312;&#20043;&#21069;&#30340;&#20363;&#23376;&#20013;&#25105;&#20204;&#25552;&#21040;&#20102;CloseHandle&#36825;&#20010;&#20989;&#25968;&#26159;&#29992;&#26469;&#20851;&#38381;&#36827;&#31243;&#12289;&#32447;&#31243;&#30340;&#65292;&#20854;&#23454;&#23427;&#30340;&#26412;&#36136;&#23601;&#26159;&#37322;&#25918;&#21477;&#26564;&#65292;&#20294;&#26159;&#24182;&#19981;&#20195;&#34920;&#25191;&#34892;&#20102;&#36825;&#20010;&#20989;&#25968;&#65292;&#21019;&#24314;&#30340;&#20869;&#26680;&#23545;&#35937;&#23601;&#20250;<strong class=" ">&#24443;&#24213;&#28040;&#22833;</strong>&#65307;&#22914;&#19978;&#22270;&#20013;&#25152;&#31034;&#20869;&#26680;&#23545;&#35937;&#23384;&#22312;&#19968;&#20010;&#35745;&#25968;&#22120;&#65292;&#30446;&#21069;&#26159;2&#65292;&#23427;&#30340;&#20540;&#26159;&#26681;&#25454;&#35843;&#29992;A&#30340;&#27425;&#25968;&#26469;&#20915;&#23450;&#30340;&#65292;&#22914;&#26524;&#25105;&#20204;&#21482;&#26159;&#22312;A&#36827;&#31243;&#20013;&#25191;&#34892;&#20102;<strong class=" ">CloseHandle&#20989;&#25968;</strong>&#65292;&#20869;&#26680;&#23545;&#35937;&#24182;&#19981;&#20250;&#28040;&#22833;&#65292;&#22240;&#20026;&#36827;&#31243;B&#36824;&#22312;&#20351;&#29992;&#65292;&#32780;&#21482;&#26377;&#36827;&#31243;B&#20063;&#25191;&#34892;&#20102;<strong class=" ">CloseHandle&#20989;&#25968;</strong>&#65292;&#36825;&#20010;&#20869;&#26680;&#23545;&#35937;&#30340;&#35745;&#25968;&#22120;&#20026;0&#65292;&#23601;&#20250;&#20851;&#38381;&#28040;&#22833;&#20102;&#12290;</p>
<p   
><strong class=" ">&#26368;&#21518;</strong>&#65306;&#27880;&#24847;&#65292;&#20197;&#19978;&#25152;&#36848;&#29305;&#24615;&#36866;&#21512;&#20110;&#38500;&#20102;&#32447;&#31243;&#20197;&#22806;&#30340;&#25152;&#26377;&#20869;&#26680;&#23545;&#35937;&#65292;&#21019;&#24314;&#36827;&#31243;&#65292;&#21516;&#26102;&#20063;&#20250;&#21019;&#24314;&#32447;&#31243;&#65292;&#22914;&#26524;&#20320;&#24819;&#25226;&#32447;&#31243;&#20851;&#38381;&#65292;&#39318;&#20808;&#38656;&#35201;<strong class=" ">CloseHandle&#20989;&#25968;</strong>&#35201;&#35753;&#20854;&#35745;&#25968;&#22120;&#20026;0&#65292;&#20854;&#27425;&#38656;&#35201;&#26377;&#20154;&#23558;&#20854;&#20851;&#38381;&#65292;&#25152;&#20197;&#20551;&#35774;&#25105;&#20204;&#21019;&#24314;&#20102;&#19968;&#20010;IE&#36827;&#31243;&#25171;&#24320;&#20102;&#19968;&#20010;&#32593;&#31449;&#65292;&#22914;&#26524;&#25105;&#20204;&#21482;&#26159;&#22312;&#20195;&#30721;&#20013;&#20351;&#29992;&#20102;<strong class=" ">CloseHandle&#20989;&#25968;</strong>&#65292;&#36825;&#26679;IE&#27983;&#35272;&#22120;&#24182;&#19981;&#20250;&#20851;&#38381;&#65292;&#38656;&#35201;&#25105;&#20204;&#25163;&#21160;&#28857;&#20987;&#31383;&#21475;&#30340;&#20851;&#38381;&#25353;&#38062;&#25165;&#34892;&#65288;<strong class=" ">&#21482;&#26377;&#32447;&#31243;&#20851;&#38381;&#20102;&#65292;&#36827;&#31243;&#25165;&#20250;&#20851;&#38381;</strong>&#65289;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Y-l5p-E5piv5ZCmIuWPr-S7pSLooqvnu6fmib8">
        <h2 class="heading "><span>&#21477;&#26564;&#26159;&#21542;&quot;&#21487;&#20197;&quot;&#34987;&#32487;&#25215;</span></h2>
<p   
>&#38500;&#20102;&#25105;&#20204;&#19978;&#36848;&#30340;&#26041;&#24335;&#21487;&#20197;&#36827;&#34892;&#20849;&#20139;&#20869;&#26680;&#23545;&#35937;&#20197;&#22806;&#65292;Windows&#36824;&#35774;&#35745;&#20102;&#19968;&#31181;&#26041;&#24335;&#26469;&#25552;&#20379;&#25105;&#20204;&#20849;&#20139;&#20869;&#26680;&#23545;&#35937;&#65292;&#25105;&#20204;&#20808;&#26469;&#20102;&#35299;&#19968;&#19979;&#21477;&#26564;&#26159;&#21542;&quot;&#21487;&#20197;&quot;&#34987;&#32487;&#25215;&#12290;</p>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65288;<strong class=" ">&#21477;&#26564;&#34920;&#26159;&#26377;&#19977;&#21015;&#30340;&#65292;&#20998;&#21035;&#26159;&#21477;&#26564;&#20540;&#12289;&#20869;&#26680;&#32467;&#26500;&#20307;&#22320;&#22336;&#12289;&#21477;&#26564;&#26159;&#21542;&#21487;&#20197;&#34987;&#32487;&#25215;</strong>&#65289;&#65292;&#27604;&#22914;&#35828;&#25105;&#20204;&#22312;A&#36827;&#31243;&#65288;&#29238;&#36827;&#31243;&#65289;&#21019;&#24314;&#20102;4&#20010;&#20869;&#26680;&#23545;&#35937;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_0-51-37.png" alt="images/download/attachments/1015833/image2021-5-21_0-51-37.png" width="600"  />
    </p>
<p   
>&#36825;&#22235;&#20010;&#20989;&#25968;&#37117;&#26377;&#19968;&#20010;&#21442;&#25968;<strong class=" ">LPSECURITY_ATTRIBUTES lpThreadAttributes</strong>&#65292;&#36890;&#36807;&#36825;&#20010;&#21442;&#25968;&#25105;&#20204;&#21487;&#20197;&#21028;&#26029;&#20989;&#25968;&#26159;&#21542;&#21019;&#24314;&#30340;&#26159;&#20869;&#26680;&#23545;&#35937;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_0-57-16.png" alt="images/download/attachments/1015833/image2021-5-21_0-57-16.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#21487;&#20197;&#36319;&#36827;&#30475;&#19968;&#19979;&#36825;&#20010;&#21442;&#25968;&#65292;&#23427;&#23601;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_1-2-23.png" alt="images/download/attachments/1015833/image2021-5-21_1-2-23.png" width="600"  />
    </p>
<p   
>&#32467;&#26500;&#20307;&#25104;&#21592;&#20998;&#21035;&#26159;&#65306;<strong class=" ">1.&#32467;&#26500;&#20307;&#38271;&#24230;&#65307;2.&#23433;&#20840;&#25551;&#36848;&#31526;&#65307;3.&#21477;&#26564;&#26159;&#21542;&#34987;&#32487;&#25215;</strong>&#12290;</p>
<p   
>&#31532;&#19968;&#20010;&#25104;&#21592;&#25105;&#20204;&#35265;&#24618;&#19981;&#24618;&#20102;&#65292;&#22312;Windows&#35774;&#35745;&#19979;&#37117;&#20250;&#26377;&#36825;&#26679;&#19968;&#20010;&#25104;&#21592;&#65307;&#31532;&#20108;&#20010;&#23433;&#20840;&#25551;&#36848;&#31526;&#65292;&#36825;&#20010;&#23545;&#25105;&#20204;&#26469;&#35828;&#23454;&#38469;&#19978;&#27809;&#26377;&#20219;&#20309;&#24847;&#20041;&#65292;&#19968;&#33324;&#30041;&#31354;&#23601;&#34892;&#65292;&#40664;&#35748;&#23427;&#20250;&#36981;&#24490;&#29238;&#36827;&#31243;&#30340;&#26469;&#65292;&#20854;&#20027;&#35201;&#20316;&#29992;&#23601;&#26159;<strong class=" ">&#25551;&#36848;&#35841;&#21019;&#24314;&#20102;&#35813;&#23545;&#35937;&#65292;&#35841;&#26377;&#35775;&#38382;&#12289;&#20351;&#29992;&#35813;&#23545;&#35937;&#30340;&#26435;&#38480;</strong>&#12290;</p>
<p   
>&#31532;&#19977;&#20010;&#25104;&#21592;&#26159;&#25105;&#20204;&#37325;&#28857;&#38656;&#35201;&#20851;&#27880;&#30340;&#65292;&#22240;&#20026;&#20854;&#20915;&#23450;&#20102;&#21477;&#26564;&#26159;&#21542;&#21487;&#20197;&#34987;&#32487;&#25215;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#35753;CreateProcess&#20989;&#25968;&#21019;&#24314;&#30340;&#36827;&#31243;&#12289;&#32447;&#31243;&#21477;&#26564;&#21487;&#20197;&#34987;&#32487;&#25215;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_1-29-4.png" alt="images/download/attachments/1015833/image2021-5-21_1-29-4.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Y-l5p-E5piv5ZCmIuWFgeiuuCLooqvnu6fmib8">
        <h2 class="heading "><span>&#21477;&#26564;&#26159;&#21542;&quot;&#20801;&#35768;&quot;&#34987;&#32487;&#25215;</span></h2>
<p   
>&#25105;&#20204;&#21487;&#20197;&#35753;&#21477;&#26564;&#34987;&#32487;&#25215;&#65292;&#20294;&#20063;&#20165;&#20165;&#26159;&#21487;&#20197;&#65292;&#35201;&#30495;&#27491;&#23436;&#25104;&#32487;&#25215;&#65292;&#25110;&#32773;&#35828;&#25105;&#20204;&#20801;&#35768;&#23376;&#36827;&#31243;&#32487;&#25215;&#29238;&#36827;&#31243;&#30340;&#21477;&#26564;&#65292;&#36825;&#26102;&#20505;&#23601;&#38656;&#35201;&#21478;&#22806;&#19968;&#20010;&#21442;&#25968;&#20102;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_1-38-10.png" alt="images/download/attachments/1015833/image2021-5-21_1-38-10.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#36824;&#26159;&#20197;CreateProcess&#20989;&#25968;&#20030;&#20363;&#65292;&#20854;&#26377;&#19968;&#20010;&#21442;&#25968;<strong class=" ">BOOL bInheritHandles</strong>&#65292;&#36825;&#20010;&#21442;&#25968;&#20915;&#23450;&#20102;&#26159;&#21542;&#20801;&#35768;&#21019;&#24314;&#30340;&#23376;&#36827;&#31243;&#32487;&#25215;&#21477;&#26564;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_1-42-32.png" alt="images/download/attachments/1015833/image2021-5-21_1-42-32.png" width="600"  />
    </p>
<p   
>&#21482;&#26377;&#36825;&#20010;&#21442;&#25968;&#35774;&#32622;&#20026;TRUE&#26102;&#65292;&#25105;&#20204;&#21019;&#24314;&#30340;&#23376;&#36827;&#31243;&#25165;&#20801;&#35768;&#32487;&#25215;&#29238;&#36827;&#31243;&#30340;&#21477;&#26564;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6L-b56iL55u45YWzQVBJ">
        <h1 class="heading "><span>&#36827;&#31243;&#30456;&#20851;API</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItSUTkuI7lj6Xmn4Q">
        <h2 class="heading "><span>ID&#19982;&#21477;&#26564;</span></h2>
<p   
>&#22914;&#26524;&#25105;&#20204;&#25104;&#21151;&#21019;&#24314;&#20102;&#19968;&#20010;&#36827;&#31243;&#65292;CreateProcess&#20989;&#25968;&#20250;&#32473;&#25105;&#20204;&#36820;&#22238;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#21253;&#21547;&#22235;&#20010;&#25968;&#25454;&#65306;&#36827;&#31243;&#32534;&#21495;&#65288;ID&#65289;&#12289;&#36827;&#31243;&#21477;&#26564;&#12289;&#32447;&#31243;&#32534;&#21495;&#65288;ID&#65289;&#12289;&#32447;&#31243;&#21477;&#26564;&#12290;</p>
<p   
>&#36827;&#31243;ID&#20854;&#23454;&#25105;&#20204;&#26089;&#23601;&#35265;&#36807;&#20102;&#65292;&#36890;&#24120;&#25105;&#20204;&#31216;&#20043;&#20026;PID&#65292;&#22312;&#20219;&#21153;&#31649;&#29702;&#22120;&#30340;&#36827;&#31243;&#26639;&#19979;&#23601;&#21487;&#20197;&#24456;&#28165;&#26970;&#30340;&#30475;&#35265;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_16-36-52.png" alt="images/download/attachments/1015833/image2021-5-21_16-36-52.png" width="600"  />
    </p>
<p   
>&#27599;&#20010;&#36827;&#31243;&#37117;&#26377;&#19968;&#20221;&#31169;&#26377;&#30340;&#21477;&#26564;&#34920;&#65292;&#32780;&#25805;&#20316;&#31995;&#32479;&#20063;&#26377;&#19968;&#20221;&#21477;&#26564;&#34920;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;&#20840;&#23616;&#21477;&#26564;&#34920;&#65292;&#36825;&#24352;&#34920;&#37324;&#21253;&#21547;&#20102;&#25152;&#26377;&#27491;&#22312;&#36816;&#34892;&#30340;&#36827;&#31243;&#12289;&#32447;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-21_16-38-51.png" alt="images/download/attachments/1015833/image2021-5-21_16-38-51.png" width="600"  />
    </p>
<p   
>PID&#25105;&#20204;&#23601;&#21487;&#20197;&#29702;&#35299;&#20026;&#26159;&#20840;&#23616;&#21477;&#26564;&#34920;&#20013;&#30340;&#19968;&#20010;&#32034;&#24341;&#65292;&#37027;&#20040;PID&#21644;&#21477;&#26564;&#30340;&#21306;&#21035;&#23601;&#24456;&#23481;&#26131;&#30475;&#20986;&#26469;&#26469;&#20102;&#65292;<strong class=" ">PID&#26159;&#20840;&#23616;&#30340;&#65292;&#22312;&#20219;&#20309;&#36827;&#31243;&#20013;&#37117;&#26377;&#24847;&#20041;&#65292;&#37117;&#21487;&#20197;&#20351;&#29992;&#65292;&#32780;&#21477;&#26564;&#21017;&#26159;&#23616;&#37096;&#30340;&#12289;&#31169;&#26377;&#30340;</strong>&#65307;PID&#26159;<strong class=" ">&#21807;&#19968;&#30340;&#65292;&#32477;&#23545;&#19981;&#21487;&#33021;&#20986;&#29616;&#37325;&#22797;&#30340;&#23384;&#22312;</strong>&#65292;&#20294;&#26159;&#24403;&#36827;&#31243;&#28040;&#22833;&#65292;&#37027;&#20040;&#36825;&#20010;PID&#23601;&#26377;&#21487;&#33021;&#20250;&#20998;&#32473;&#21478;&#22806;&#19968;&#20010;&#36827;&#31243;&#12290;&#65288;<strong class=" ">PID&#19981;&#26159;&#21477;&#26564;&#65292;&#20294;&#26159;&#21487;&#20197;&#36890;&#36807;PID&#33719;&#24471;&#21040;&#20840;&#23616;&#21477;&#26564;&#34920;&#20013;&#20854;&#23545;&#24212;&#30340;&#21477;&#26564;</strong>&#65289;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItVGVybWluYXRlUHJvY2Vzc-WHveaVsA">
        <h2 class="heading "><span>TerminateProcess&#20989;&#25968;</span></h2>
<p   
>&#25105;&#20204;&#21487;&#20197;&#26469;&#35770;&#35777;&#19968;&#19979;&#22914;&#19978;&#25152;&#36848;&#30340;&#27010;&#24565;&#65292;&#39318;&#20808;A&#36827;&#31243;&#25171;&#24320;IE&#27983;&#35272;&#22120;&#65292;&#28982;&#21518;&#33719;&#21462;&#36827;&#31243;ID&#21644;&#21477;&#26564;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_0-19-16.png" alt="images/download/attachments/1015833/image2021-5-22_0-19-16.png" width="600"  />
    </p>
<p   
>&#20854;&#27425;B&#36827;&#31243;&#20351;&#29992;TerminateProcess&#20989;&#25968;&#26469;&#32456;&#27490;A&#36827;&#31243;&#65292;&#39318;&#20808;&#20351;&#29992;&#21477;&#26564;&#20449;&#24687;&#32456;&#27490;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// TerminateProcess函数</code></div>
<div class="line"><code class="plain">BOOL TerminateProcess(</code></div>
<div class="line"><code class="plain">  HANDLE hProcess, </code><code class="comments">// handle to the process 句柄</code></div>
<div class="line"><code class="plain">  UINT uExitCode   </code><code class="comments">// exit code for the process 退出代码</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/plugins/servlet/confluence/placeholder/unknown-attachment.png" alt="images/plugins/servlet/confluence/placeholder/unknown-attachment.png"   />
        <br/><span class="caption">image2021-5-22_0-22-40.png?version=2&amp;modificationDate=1621614305000&amp;api=v2</span>
    </p>
<p   
>TerminateProcess&#20989;&#25968;&#26159;&#29992;&#26469;&#32456;&#27490;&#36827;&#31243;&#30340;&#65292;&#20855;&#20307;&#30340;&#21487;&#20197;&#21442;&#32771;MSDN Library&#65292;&#22312;&#36825;&#37324;&#25105;&#20204;&#24456;&#28165;&#26970;&#30340;&#21487;&#20197;&#30475;&#35265;&#32456;&#27490;&#36827;&#31243;&#22833;&#36133;&#20102;&#65292;&#36825;&#20010;&#38169;&#35823;&#32534;&#21495;&#30340;&#24847;&#24605;&#23601;&#26159;&#21477;&#26564;&#26080;&#25928;&#65292;&#37027;&#20040;&#23601;&#35770;&#35777;&#20102;&#21477;&#26564;&#26159;&#31169;&#26377;&#30340;&#65292;&#20854;&#20182;&#36827;&#31243;&#26080;&#27861;&#26681;&#25454;&#36825;&#20010;&#21477;&#26564;&#26469;&#32456;&#27490;&#36827;&#31243;&#65292;&#20294;&#26159;<strong class=" ">&#25105;&#20204;&#24819;&#35201;&#30495;&#27491;&#30340;&#20851;&#38381;&#36825;&#20010;&#36827;&#31243;&#65292;&#37027;&#23601;&#38656;&#35201;&#20511;&#21161;PID&#26469;&#33719;&#21462;&#21477;&#26564;&#20102;&#65292;&#20855;&#20307;&#32454;&#33410;&#22914;&#19979;</strong>&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItT3BlblByb2Nlc3Plh73mlbA">
        <h2 class="heading "><span>OpenProcess&#20989;&#25968;</span></h2>
<p   
>&#20102;&#35299;&#20102;TerminateProcess&#20989;&#25968;&#21518;&#65292;&#25105;&#20204;&#24819;&#35201;&#30495;&#27491;&#30340;&#21435;&#20851;&#38381;&#19968;&#20010;&#36827;&#31243;&#65292;&#38656;&#35201;&#20511;&#21161;OpenProcess&#20989;&#25968;&#65292;<strong class=" ">&#36825;&#20010;&#20989;&#25968;&#26159;&#29992;&#26469;&#25171;&#24320;&#36827;&#31243;&#23545;&#35937;&#30340;</strong>&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE OpenProcess(</code></div>
<div class="line"><code class="plain">  DWORD dwDesiredAccess,  </code><code class="comments">// access flag 你希望的访问权限</code></div>
<div class="line"><code class="plain">  BOOL bInheritHandle,    </code><code class="comments">// handle inheritance option 是否可以被继承</code></div>
<div class="line"><code class="plain">  DWORD dwProcessId       </code><code class="comments">// process identifier 进程ID</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_0-39-55.png" alt="images/download/attachments/1015833/image2021-5-22_0-39-55.png" width="600"  />
    </p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#65292;&#25105;&#36890;&#36807;PID&#25171;&#24320;&#36827;&#31243;&#65288;OpenProcess&#20989;&#25968;&#65289;&#65292;&#25317;&#26377;&#25152;&#26377;&#26435;&#65292;&#19981;&#32487;&#25215;&#21477;&#26564;&#34920;&#65292;&#24403;OpenProcess&#20989;&#25968;&#25191;&#34892;&#23436;&#25104;&#20043;&#21518;&#65292;&#25105;&#23601;&#33719;&#24471;&#19968;&#20010;&#21477;&#26564;&#65292;&#36890;&#36807;&#36825;&#20010;&#21477;&#26564;&#25105;&#23601;&#21487;&#20197;&#32456;&#27490;&#36827;&#31243;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hProcess;</code></div>
<div class="line"><code class="plain">hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, </code><code class="value">0x524</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">if</code><code class="plain">(!TerminateProcess(hProcess, </code><code class="value">0</code><code class="plain">)) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"终止进程失败：%d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Lul5oyC6LW355qE5b2i5byP5Yib5bu66L-b56iL">
        <h2 class="heading "><span>&#20197;&#25346;&#36215;&#30340;&#24418;&#24335;&#21019;&#24314;&#36827;&#31243;</span></h2>
<p   
>CreateProcess&#20989;&#25968;&#30340;&#25152;&#26377;&#21442;&#25968;&#37117;&#38656;&#35201;&#20102;&#35299;&#19968;&#19979;&#65292;&#29616;&#22312;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;&#31532;&#20845;&#20010;&#21442;&#25968;<strong class=" ">DWORD dwCreationFlags</strong>&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL CreateProcess(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpApplicationName,                 </code><code class="comments">// name of executable module</code></div>
<div class="line"><code class="plain">  LPTSTR lpCommandLine,                      </code><code class="comments">// command line string</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpProcessAttributes, </code><code class="comments">// SD</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpThreadAttributes,  </code><code class="comments">// SD</code></div>
<div class="line"><code class="plain">  BOOL bInheritHandles,                      </code><code class="comments">// handle inheritance option</code></div>
<div class="line"><code class="plain">  DWORD dwCreationFlags,                     </code><code class="comments">// creation flags &lt;--这个参数</code></div>
<div class="line"><code class="plain">  LPVOID lpEnvironment,                      </code><code class="comments">// new environment block</code></div>
<div class="line"><code class="plain">  LPCTSTR lpCurrentDirectory,                </code><code class="comments">// current directory name</code></div>
<div class="line"><code class="plain">  LPSTARTUPINFO lpStartupInfo,               </code><code class="comments">// startup information</code></div>
<div class="line"><code class="plain">  LPPROCESS_INFORMATION lpProcessInformation </code><code class="comments">// process information</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#24403;&#25105;&#20204;&#21019;&#24314;&#19968;&#20010;&#25511;&#21046;&#21488;&#36827;&#31243;&#26102;&#65292;&#20250;&#21457;&#29616;&#23376;&#36827;&#31243;&#21644;&#29238;&#36827;&#31243;&#37117;&#22312;&#21516;&#19968;&#20010;&#21629;&#20196;&#34892;&#25511;&#21046;&#21488;&#20013;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-4-57.png" alt="images/download/attachments/1015833/image2021-5-22_1-4-57.png" width="600"  />
    </p>
<p   
>&#32780;&#22914;&#26524;&#25105;&#20204;&#24819;&#35201;&#21306;&#20998;&#30340;&#35805;&#23601;&#38656;&#35201;&#20511;&#21161;<strong class=" ">dwCreationFlags</strong>&#36825;&#20010;&#21442;&#25968;&#65292;&#23558;&#20854;&#20462;&#25913;&#20026;<strong class=" ">CREATE_NEW_CONSOLE</strong>&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-6-34.png" alt="images/download/attachments/1015833/image2021-5-22_1-6-34.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-7-24.png" alt="images/download/attachments/1015833/image2021-5-22_1-7-24.png" width="600"  />
    </p>
<p   
>&#20294;&#26159;&#36825;&#20010;&#24182;&#19981;&#26159;&#25105;&#20204;&#26368;&#37325;&#35201;&#30340;&#65292;&#25110;&#32773;&#35828;&#19981;&#26159;&#20854;&#30495;&#27491;&#26377;&#24847;&#20041;&#30340;&#21442;&#25968;&#65292;&#26377;&#24847;&#20041;&#30340;&#26159;&#21442;&#25968;&#20540;&#20026;<strong class=" ">CREATE_SUSPENDED</strong>&#65292;&#20063;&#23601;&#26159;&#20197;&#25346;&#36215;&#30340;&#24418;&#24335;&#21019;&#24314;&#36827;&#31243;&#12290;</p>
<p   
>&#32780;&#22914;&#26524;&#26159;&#20197;&#25346;&#36215;&#30340;&#26041;&#24335;&#21019;&#24314;&#36827;&#31243;&#65292;&#37027;&#20040;&#36827;&#31243;&#30340;&#21019;&#24314;&#36807;&#31243;&#23601;&#20250;&#21457;&#29983;&#21464;&#21270;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-12-9.png" alt="images/download/attachments/1015833/image2021-5-22_1-12-9.png" width="600"  />
    </p>
<p   
>&#37027;&#20063;&#23601;&#35828;&#26126;&#20102;&#19968;&#28857;&#65292;&#25346;&#36215;&#26412;&#36136;&#19978;<strong class=" ">&#25346;&#36215;&#30340;&#26159;&#32447;&#31243;</strong>&#65292;&#36827;&#31243;&#36824;&#26159;&#20250;&#21019;&#24314;&#30340;&#65292;&#25152;&#20197;&#65292;&#26368;&#32456;&#22914;&#26524;&#24819;&#24674;&#22797;&#30340;&#35805;&#20063;&#26159;&#24674;&#22797;&#32447;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-17-20.png" alt="images/download/attachments/1015833/image2021-5-22_1-17-20.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5qih5Z2X55uu5b2V5LiO5bel5L2c55uu5b2V">
        <h2 class="heading "><span>&#27169;&#22359;&#30446;&#24405;&#19982;&#24037;&#20316;&#30446;&#24405;</span></h2>
<p   
>&#36890;&#36807;<strong class=" ">GetModuleFileName</strong>&#21644;<strong class=" ">GetCurrentDirectory</strong>&#20989;&#25968;&#21487;&#20197;&#20998;&#21035;&#33719;&#24471;&#24403;&#21069;&#27169;&#22359;&#30446;&#24405;&#21644;&#24403;&#21069;&#24037;&#20316;&#30446;&#24405;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">char</code><code class="plain"> strModule[</code><code class="value">256</code><code class="plain">];</code></div>
<div class="line"><code class="plain">GetModuleFileName(NULL,strModule, </code><code class="value">256</code><code class="plain">); </code><code class="comments">// 得到当前模块目录，当前exe所在的路径，包含exe文件名</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">char</code><code class="plain"> strWork[</code><code class="value">1000</code><code class="plain">];</code></div>
<div class="line"><code class="plain">GetCurrentDirectory(</code><code class="value">1000</code><code class="plain">, strWork); </code><code class="comments">// 获取当前工作目录</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">printf(</code><code class="string">"模块目录：%s \n工作目录：%s \n"</code><code class="plain">, strModule, strWork);</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#24037;&#20316;&#30446;&#24405;&#26159;&#21487;&#20197;&#20462;&#25913;&#30340;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;<strong class=" ">CreateProcess&#20989;&#25968;&#26469;&#21019;&#24314;&#19968;&#20010;&#36827;&#31243;&#65292;&#24182;&#19988;&#20462;&#25913;&#20854;&#24037;&#20316;&#30446;&#24405;</strong>&#65292;&#36825;&#26159;CreateProcess&#20989;&#25968;&#30340;&#31532;&#20843;&#20010;&#21442;&#25968;<strong class=" ">LPCTSTR lpCurrentDirectory</strong>&#12290;</p>
<p   
>&#20551;&#35774;&#25105;&#20204;&#26377;&#36825;&#26679;&#19968;&#20010;&#38656;&#27714;&#65306;&#25171;&#24320;&#24403;&#21069;&#24037;&#20316;&#30446;&#24405;&#19979;&#30340;1.txt&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-36-22.png" alt="images/download/attachments/1015833/image2021-5-22_1-36-22.png" width="600"  />
    </p>
<p   
>&#32780;&#36825;&#26102;&#20505;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;CreateProcess&#20989;&#25968;&#20462;&#25913;&#24037;&#20316;&#36335;&#24452;&#65292;&#35753;&#20854;&#35835;&#21462;&#25105;&#20204;&#25351;&#23450;&#24037;&#20316;&#30446;&#24405;&#30340;&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-40-3.png" alt="images/download/attachments/1015833/image2021-5-22_1-40-3.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YW25LuW6L-b56iL55u45YWzQVBJ">
        <h2 class="heading "><span>&#20854;&#20182;&#36827;&#31243;&#30456;&#20851;API</span></h2>
<p   
>&#33719;&#21462;&#24403;&#21069;&#36827;&#31243;ID&#65288;PID&#65289;&#65306;GetCurrentProcessId</p>
<p   
>&#33719;&#21462;&#24403;&#21069;&#36827;&#31243;&#21477;&#26564;&#65306;GetCurrentProcess</p>
<p   
>&#33719;&#21462;&#21629;&#20196;&#34892;&#65306;GetCommandLine</p>
<p   
>&#33719;&#21462;&#21551;&#21160;&#20449;&#24687;&#65306;GetStartupInfo</p>
<p   
>&#36941;&#21382;&#36827;&#31243;ID&#65306;EnumProcesses</p>
<p   
>&#24555;&#29031;&#65306;CreateToolhelp32Snapshot</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5Yib5bu657q_56iL">
        <h1 class="heading "><span>&#21019;&#24314;&#32447;&#31243;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv57q_56iL">
        <h2 class="heading "><span>&#20160;&#20040;&#26159;&#32447;&#31243;</span></h2>
<ol class=" "><li class=" "><p   
>&#32447;&#31243;&#26159;&#38468;&#23646;&#22312;&#36827;&#31243;&#19978;&#30340;&#25191;&#34892;&#23454;&#20307;&#65292;&#26159;&#20195;&#30721;&#30340;&#25191;&#34892;&#27969;&#31243;&#65307;</p>
</li><li class=" "><p   
>&#19968;&#20010;&#36827;&#31243;&#21487;&#20197;&#21253;&#21547;&#22810;&#20010;&#32447;&#31243;&#65288;<strong class=" ">&#19968;&#20010;&#36827;&#31243;&#33267;&#23569;&#35201;&#21253;&#21547;&#19968;&#20010;&#32447;&#31243;&#65292;&#36827;&#31243;&#26159;&#31354;&#38388;&#19978;&#30340;&#27010;&#24565;&#65292;&#32447;&#31243;&#26159;&#26102;&#38388;&#19978;&#30340;&#27010;&#24565;</strong>&#65289;&#12290;</p>
</li></ol><p   
>&#36890;&#36807;Windows&#20219;&#21153;&#31649;&#29702;&#22120;&#25105;&#20204;&#20063;&#21487;&#20197;&#24456;&#28165;&#26224;&#30340;&#30475;&#35265;&#27599;&#20010;&#36827;&#31243;&#24403;&#21069;&#30340;&#32447;&#31243;&#25968;&#37327;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_1-46-16.png" alt="images/download/attachments/1015833/image2021-5-22_1-46-16.png" width="600"  />
    </p>
<p   
>&#26377;&#20960;&#20010;&#32447;&#31243;&#23601;&#34920;&#31034;&#30528;&#26377;&#20960;&#20010;&#20195;&#30721;&#22312;&#25191;&#34892;&#65292;&#20294;&#26159;&#23427;&#20204;&#24182;&#19981;&#19968;&#23450;&#26159;&#21516;&#26102;&#25191;&#34892;&#65292;&#20363;&#22914;&#21333;&#26680;&#30340;CPU&#24773;&#20917;&#19979;&#26159;&#19981;&#23384;&#22312;&#22810;&#32447;&#31243;&#30340;&#65292;&#32447;&#31243;&#30340;&#25191;&#34892;&#26159;&#26377;&#26102;&#38388;&#39034;&#24207;&#30340;&#65292;&#20294;&#26159;CPU&#20999;&#25442;&#30340;&#38750;&#24120;&#24555;&#65292;&#25152;&#20197;&#32473;&#25105;&#20204;&#30340;&#24863;&#35273;&#21644;&#22810;&#26680;CPU&#27809;&#20160;&#20040;&#21306;&#21035;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Yib5bu657q_56iLLjE">
        <h2 class="heading "><span>&#21019;&#24314;&#32447;&#31243;</span></h2>
<p   
>&#21019;&#24314;&#32447;&#31243;&#20351;&#29992;CreateThread&#20989;&#25968;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateThread( </code><code class="comments">// 返回值是线程句柄</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpThreadAttributes, </code><code class="comments">// SD 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  SIZE_T dwStackSize,                       </code><code class="comments">// initial stack size 初始堆栈</code></div>
<div class="line"><code class="plain">  LPTHREAD_START_ROUTINE lpStartAddress,    </code><code class="comments">// thread function 线程执行的函数代码</code></div>
<div class="line"><code class="plain">  LPVOID lpParameter,                       </code><code class="comments">// thread argument 线程需要的参数</code></div>
<div class="line"><code class="plain">  DWORD dwCreationFlags,                    </code><code class="comments">// creation option 标识，也可以以挂起形式创建线程</code></div>
<div class="line"><code class="plain">  LPDWORD lpThreadId                        </code><code class="comments">// thread identifier 返回当前线程ID</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#32447;&#31243;&#25191;&#34892;&#20989;&#25968;&#30340;&#35821;&#27861;&#35201;&#27714;&#22914;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_2-6-49.png" alt="images/download/attachments/1015833/image2021-5-22_2-6-49.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#23581;&#35797;&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#25191;&#34892;for&#24490;&#29615;&#65292;&#22914;&#19979;&#22270;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_2-3-22.png" alt="images/download/attachments/1015833/image2021-5-22_2-3-22.png" width="600"  />
    </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 线程执行的函数有语法要求，参考MSDN Library</code></div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 要执行的代码</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">100</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">500</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"++++++ %d \n"</code><code class="plain">, i);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建线程</code></div>
<div class="line"><code class="plain">    CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 要执行的代码</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">100</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">500</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"------ %d \n"</code><code class="plain">, i);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#32447;&#31243;&#38388;&#19981;&#20250;&#30456;&#20114;&#37197;&#21512;&#65292;&#32780;&#26159;&#21508;&#33258;&#25191;&#34892;&#33258;&#24049;&#30340;&#65292;&#22914;&#26524;&#24819;&#35201;&#37197;&#21512;&#23601;&#38656;&#35201;&#20102;&#35299;&#32447;&#31243;&#36890;&#20449;&#65292;&#36825;&#20010;&#21518;&#38754;&#20250;&#23398;&#20064;&#21040;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5ZCR57q_56iL5Ye95pWw5Lyg6YCS5Y-C5pWw">
        <h2 class="heading "><span>&#21521;&#32447;&#31243;&#20989;&#25968;&#20256;&#36882;&#21442;&#25968;</span></h2>
<p   
>&#21521;&#32447;&#31243;&#20256;&#36882;&#21442;&#25968;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#24819;&#35201;&#33258;&#23450;&#20041;&#32447;&#31243;&#25191;&#34892;for&#24490;&#29615;&#30340;&#27425;&#25968;&#65292;&#23558;n&#20256;&#36882;&#36827;&#21435;&#65292;&#36825;&#26102;&#20505;&#38656;&#35201;&#27880;&#24847;&#21442;&#25968;&#20256;&#36882;&#21040;&#32447;&#31243;&#21442;&#25968;&#26102;&#22312;&#22534;&#26632;&#20013;&#23384;&#22312;&#65292;&#24182;&#19988;&#20256;&#36882;&#30340;&#26102;&#20505;&#38656;&#35201;&#24378;&#21046;&#36716;&#25442;&#19968;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_2-12-19.png" alt="images/download/attachments/1015833/image2021-5-22_2-12-19.png" width="600"  />
    </p>
<p   
>&#20026;&#20102;&#20445;&#35777;&#21442;&#25968;&#30340;&#29983;&#21629;&#21608;&#26399;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#23558;&#21442;&#25968;&#25918;&#22312;&#20840;&#23616;&#21464;&#37327;&#21306;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-22_2-16-23.png" alt="images/download/attachments/1015833/image2021-5-22_2-16-23.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt57q_56iL5o6n5Yi2">
        <h1 class="heading "><span>&#32447;&#31243;&#25511;&#21046;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6K6p57q_56iL5YGc5LiL5p2l">
        <h2 class="heading "><span>&#35753;&#32447;&#31243;&#20572;&#19979;&#26469;</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItU2xlZXDlh73mlbA">
        <h3 class="heading "><span>Sleep&#20989;&#25968;</span></h3>
<p   
>Sleep&#20989;&#25968;&#26159;&#35753;&#24403;&#21069;&#25191;&#34892;&#21040;&#26412;&#20989;&#25968;&#26102;&#24310;&#36831;&#25351;&#23450;&#30340;&#27627;&#31186;&#20043;&#21518;&#20877;&#21521;&#19979;&#36208;&#65292;&#20363;&#22914;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">100</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">    Sleep(</code><code class="value">500</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"------ %d \n"</code><code class="plain">, i);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItU3VzcGVuZFRocmVhZOWHveaVsA">
        <h3 class="heading "><span>SuspendThread&#20989;&#25968;</span></h3>
<p   
>SuspendThread&#20989;&#25968;&#29992;&#20110;&#26242;&#20572;&#65288;&#25346;&#36215;&#65289;&#26576;&#20010;&#32447;&#31243;&#65292;&#24403;&#26242;&#20572;&#21518;&#35813;&#32447;&#31243;&#19981;&#20250;&#21344;&#29992;CPU&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#24456;&#31616;&#21333;&#65292;&#21482;&#38656;&#35201;&#20256;&#20837;&#19968;&#20010;&#32447;&#31243;&#21477;&#26564;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD SuspendThread(</code></div>
<div class="line"><code class="plain">  HANDLE hThread   </code><code class="comments">// handle to thread</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItUmVzdW1lVGhyZWFk5Ye95pWw">
        <h3 class="heading "><span>ResumeThread&#20989;&#25968;</span></h3>
<p   
>ResumeThread&#20989;&#25968;&#29992;&#20110;&#24674;&#22797;&#34987;&#26242;&#20572;&#65288;&#25346;&#36215;&#65289;&#30340;&#32447;&#31243;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#20063;&#24456;&#31616;&#21333;&#65292;&#21482;&#38656;&#35201;&#20256;&#20837;&#19968;&#20010;&#32447;&#31243;&#21477;&#26564;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD ResumeThread(</code></div>
<div class="line"><code class="plain">  HANDLE hThread   </code><code class="comments">// handle to thread</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#25346;&#36215;&#20960;&#27425;&#23601;&#35201;&#24674;&#22797;&#20960;&#27425;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">SuspendThread(hThread);</code></div>
<div class="line"><code class="plain">SuspendThread(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ResumeThread(hThread);</code></div>
<div class="line"><code class="plain">ResumeThread(hThread);</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt562J5b6F57q_56iL57uT5p2f">
        <h2 class="heading "><span>&#31561;&#24453;&#32447;&#31243;&#32467;&#26463;</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItV2FpdEZvclNpbmdsZU9iamVjdOWHveaVsA">
        <h3 class="heading "><span>WaitForSingleObject&#20989;&#25968;</span></h3>
<p   
>WaitForSingleObject&#20989;&#25968;&#29992;&#20110;&#31561;&#24453;<strong class=" ">&#19968;&#20010;&#20869;&#26680;&#23545;&#35937;</strong>&#29366;&#24577;&#21457;&#29983;&#21464;&#26356;&#65292;&#37027;&#20063;&#23601;&#26159;&#25191;&#34892;&#32467;&#26463;&#20043;&#21518;&#65292;&#25165;&#20250;&#32487;&#32493;&#21521;&#19979;&#25191;&#34892;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD WaitForSingleObject(</code></div>
<div class="line"><code class="plain">  HANDLE hHandle,        </code><code class="comments">// handle to object 句柄</code></div>
<div class="line"><code class="plain">  DWORD dwMilliseconds   </code><code class="comments">// time-out interval 等待超时时间（毫秒）</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_12-34-19.png" alt="images/download/attachments/1015833/image2021-5-23_12-34-19.png" width="600"  />
    </p>
<p   
>&#22914;&#26524;&#20320;&#24819;&#19968;&#30452;&#31561;&#24453;&#30340;&#35805;&#65292;&#21487;&#20197;&#23558;&#31532;&#20108;&#21442;&#25968;&#30340;&#20540;&#35774;&#32622;&#20026;<strong class=" ">INFINITE</strong>&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hThread;</code></div>
<div class="line"><code class="plain">hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">WaitForSingleObject(hThread, INFINITE);</code></div>
<div class="line"><code class="plain">printf(</code><code class="string">"OK..."</code><code class="plain">);</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItV2FpdEZvck11bHRpcGxlT2JqZWN0c-WHveaVsA">
        <h3 class="heading "><span>WaitForMultipleObjects&#20989;&#25968;</span></h3>
<p   
>WaitForMultipleObjects&#20989;&#25968;&#19982;WaitForSingleObject&#20989;&#25968;<strong class=" ">&#20316;&#29992;&#26159;&#19968;&#26679;</strong>&#30340;&#65292;&#21482;&#19981;&#36807;&#23427;&#21487;&#20197;&#31561;&#24453;<strong class=" ">&#22810;&#20010;&#20869;&#26680;&#23545;&#35937;&#30340;&#29366;&#24577;</strong>&#21457;&#29983;&#21464;&#26356;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD WaitForMultipleObjects(</code></div>
<div class="line"><code class="plain">  DWORD nCount,             </code><code class="comments">// number of handles in array 内核对象的数量</code></div>
<div class="line"><code class="plain">  CONST HANDLE *lpHandles,  </code><code class="comments">// object-handle array 内核对象的句柄数组</code></div>
<div class="line"><code class="plain">  BOOL bWaitAll,            </code><code class="comments">// wait option 等待模式</code></div>
<div class="line"><code class="plain">  DWORD dwMilliseconds      </code><code class="comments">// time-out interval 等待超时时间（毫秒）</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_15-30-41.png" alt="images/download/attachments/1015833/image2021-5-23_15-30-41.png" width="600"  />
    </p>
<p   
>&#31561;&#24453;&#27169;&#24335;&#30340;&#20540;&#26159;&#24067;&#23572;&#31867;&#22411;&#65292;&#19968;&#20010;&#26159;TRUE&#65292;&#19968;&#20010;&#26159;FALSE&#65292;TRUE&#23601;&#26159;&#31561;&#24453;&#25152;&#26377;&#23545;&#35937;&#30340;&#25152;&#26377;&#29366;&#24577;&#21457;&#29983;&#21464;&#26356;&#65292;FALSE&#21017;&#26159;&#31561;&#24453;&#20219;&#24847;&#19968;&#20010;&#23545;&#35937;&#30340;&#29366;&#24577;&#21457;&#29983;&#21464;&#26356;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hThread[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"><code class="plain">hThread[</code><code class="value">0</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">hThread[</code><code class="value">1</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">WaitForMultipleObjects(</code><code class="value">2</code><code class="plain">, hThread, TRUE, INFINITE);</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItR2V0RXhpdENvZGVUaHJlYWTlh73mlbA">
        <h3 class="heading "><span>GetExitCodeThread&#20989;&#25968;</span></h3>
<p   
>&#32447;&#31243;&#20989;&#25968;&#20250;&#26377;&#19968;&#20010;&#36820;&#22238;&#20540;&#65288;DWORD&#65289;&#65292;&#36825;&#20010;&#36820;&#22238;&#20540;&#21487;&#20197;&#26681;&#25454;&#20320;&#30340;&#38656;&#27714;&#36827;&#34892;&#36820;&#22238;&#65292;&#32780;&#25105;&#20204;&#38656;&#35201;&#22914;&#20309;&#33719;&#21462;&#36825;&#20010;&#36820;&#22238;&#32467;&#26524;&#21602;&#65311;&#36825;&#26102;&#20505;&#23601;&#21487;&#20197;&#20351;&#29992;<strong class=" ">GetExitCodeThread</strong>&#20989;&#25968;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL GetExitCodeThread(</code></div>
<div class="line"><code class="plain">  HANDLE hThread,      </code><code class="comments">// handle to the thread</code></div>
<div class="line"><code class="plain">  LPDWORD lpExitCode   </code><code class="comments">// termination status</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_15-37-48.png" alt="images/download/attachments/1015833/image2021-5-23_15-37-48.png" width="600"  />
    </p>
<p   
>&#26681;&#25454;MSDN Library&#25105;&#20204;&#21487;&#20197;&#30693;&#36947;&#35813;&#20989;&#25968;&#30340;&#21442;&#25968;&#20998;&#21035;&#26159;&#32447;&#31243;&#21477;&#26564;&#65292;&#32780;&#21478;&#19968;&#20010;&#21017;&#26159;out&#31867;&#22411;&#21442;&#25968;&#65292;&#36825;&#31181;&#31867;&#22411;&#21017;&#21487;&#20197;&#29702;&#35299;&#20026;GetExitCodeThread&#20989;&#25968;&#30340;&#36820;&#22238;&#32467;&#26524;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hThread;</code></div>
<div class="line"><code class="plain">hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">WaitForSingleObject(hThread, INFINITE);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD exitCode;</code></div>
<div class="line"><code class="plain">GetExitCodeThread(hThread, &amp;exitCode);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">printf(</code><code class="string">"Exit Code: %d \n"</code><code class="plain">, exitCode);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_15-44-6.png" alt="images/download/attachments/1015833/image2021-5-23_15-44-6.png" width="600"  />
    </p>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#36825;&#20010;&#20989;&#25968;&#24212;&#35813;&#25645;&#37197;&#30528;&#22914;&#19978;&#25152;&#23398;&#30340;2&#20010;&#31561;&#24453;&#20989;&#25968;&#19968;&#36215;&#20351;&#29992;&#65292;&#19981;&#28982;&#33719;&#21462;&#21040;&#30340;&#20540;&#23601;&#19981;&#20250;&#26159;&#32447;&#31243;&#20989;&#25968;&#36820;&#22238;&#30340;&#20540;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6K6-572u44CB6I635Y-W57q_56iL5LiK5LiL5paH">
        <h2 class="heading "><span>&#35774;&#32622;&#12289;&#33719;&#21462;&#32447;&#31243;&#19978;&#19979;&#25991;</span></h2>
<p   
><strong class=" ">&#32447;&#31243;&#19978;&#19979;&#25991;</strong>&#26159;&#25351;&#26576;&#19968;&#26102;&#38388;&#28857;CPU&#23492;&#23384;&#22120;&#21644;&#31243;&#24207;&#35745;&#25968;&#22120;&#30340;&#20869;&#23481;&#65292;&#22914;&#26524;&#24819;&#35201;&#35774;&#32622;&#12289;&#33719;&#21462;&#32447;&#31243;&#19978;&#19979;&#25991;&#23601;&#38656;&#35201;&#20808;&#23558;&#32447;&#31243;<strong class=" ">&#25346;&#36215;</strong>&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItR2V0VGhyZWFkQ29udGV4dOWHveaVsA">
        <h3 class="heading "><span>GetThreadContext&#20989;&#25968;</span></h3>
<p   
>GetThreadContext&#20989;&#25968;&#29992;&#20110;&#33719;&#21462;&#32447;&#31243;&#19978;&#19979;&#25991;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL GetThreadContext(</code></div>
<div class="line"><code class="plain">  HANDLE hThread,       </code><code class="comments">// handle to thread with context 句柄</code></div>
<div class="line"><code class="plain">  LPCONTEXT lpContext   </code><code class="comments">// context structure</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_15-52-19.png" alt="images/download/attachments/1015833/image2021-5-23_15-52-19.png" width="600"  />
    </p>
<p   
>&#31532;&#19968;&#20010;&#21442;&#25968;&#23601;&#26159;&#32447;&#31243;&#21477;&#26564;&#65292;&#36825;&#20010;&#24456;&#22909;&#29702;&#35299;&#65292;&#37325;&#28857;&#26159;&#31532;&#20108;&#20010;&#21442;&#25968;&#65292;&#20854;&#26159;&#19968;&#20010;CONTEXT&#32467;&#26500;&#20307;&#65292;&#35813;&#32467;&#26500;&#20307;&#21253;&#21547;&#25351;&#23450;&#32447;&#31243;&#30340;&#19978;&#19979;&#25991;&#65292;&#20854;ContextFlags&#25104;&#21592;&#30340;&#20540;&#25351;&#23450;&#20102;&#35201;&#35774;&#32622;&#32447;&#31243;&#19978;&#19979;&#25991;&#30340;&#21738;&#20123;&#37096;&#20998;&#12290;</p>
<p   
>&#24403;&#25105;&#20204;&#23558;CONTEXT&#32467;&#26500;&#20307;&#30340;ContextFlags&#25104;&#21592;&#30340;&#20540;&#35774;&#32622;&#20026;CONTEXT_INTEGER&#26102;&#21017;&#21487;&#20197;&#33719;&#21462;edi&#12289;esi&#12289;ebx&#12289;edx&#12289;ecx&#12289;eax&#36825;&#20123;&#23492;&#23384;&#22120;&#30340;&#20540;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_16-1-25.png" alt="images/download/attachments/1015833/image2021-5-23_16-1-25.png" width="600"  />
    </p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#23581;&#35797;&#33719;&#21462;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hThread;</code></div>
<div class="line"><code class="plain">hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">SuspendThread(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CONTEXT c;</code></div>
<div class="line"><code class="plain">c.ContextFlags = CONTEXT_INTEGER;</code></div>
<div class="line"><code class="plain">GetThreadContext(hThread, &amp;c);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">printf(</code><code class="string">"%x %x \n"</code><code class="plain">, c.Eax, c.Ecx);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_16-1-50.png" alt="images/download/attachments/1015833/image2021-5-23_16-1-50.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItU2V0VGhyZWFkQ29udGV4dOWHveaVsA">
        <h3 class="heading "><span>SetThreadContext&#20989;&#25968;</span></h3>
<p   
>GetThreadContext&#20989;&#25968;&#26159;&#20010;&#35774;&#32622;&#20462;&#25913;&#32447;&#31243;&#19978;&#19979;&#25991;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL SetThreadContext(</code></div>
<div class="line"><code class="plain">  HANDLE hThread,            </code><code class="comments">// handle to thread</code></div>
<div class="line"><code class="plain">  CONST CONTEXT *lpContext   </code><code class="comments">// context structure</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#23581;&#35797;&#20462;&#25913;Eax&#65292;&#28982;&#21518;&#20877;&#33719;&#21462;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE hThread;</code></div>
<div class="line"><code class="plain">hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">SuspendThread(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CONTEXT c;</code></div>
<div class="line"><code class="plain">c.ContextFlags = CONTEXT_INTEGER;</code></div>
<div class="line"><code class="plain">c.Eax = </code><code class="value">0x123</code><code class="plain">;</code></div>
<div class="line"><code class="plain">SetThreadContext(hThread, &amp;c);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CONTEXT c1;</code></div>
<div class="line"><code class="plain">c1.ContextFlags = CONTEXT_INTEGER;</code></div>
<div class="line"><code class="plain">GetThreadContext(hThread, &amp;c1);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">printf(</code><code class="string">"%x \n"</code><code class="plain">, c1.Eax);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-23_16-9-51.png" alt="images/download/attachments/1015833/image2021-5-23_16-9-51.png" width="600"  />
    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5Li055WM5Yy6">
        <h1 class="heading "><span>&#20020;&#30028;&#21306;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt57q_56iL5a6J5YWo6Zeu6aKY">
        <h2 class="heading "><span>&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;</span></h2>
<p   
>&#27599;&#20010;&#32447;&#31243;&#37117;&#26377;&#33258;&#24049;&#30340;&#26632;&#65292;&#23616;&#37096;&#21464;&#37327;&#26159;&#23384;&#20648;&#22312;&#26632;&#20013;&#30340;&#65292;&#36825;&#23601;&#24847;&#21619;&#30528;&#27599;&#20010;&#36827;&#31243;&#37117;&#20250;&#26377;&#19968;&#20221;&#33258;&#24049;&#30340;&ldquo;&#21477;&#26564;&#21464;&#37327;&rdquo;&#65288;&#26632;&#65289;&#65292;&#22914;&#26524;&#32447;&#31243;&#20165;&#20165;&#20351;&#29992;&#33258;&#24049;&#30340;&ldquo;&#23616;&#37096;&#21464;&#37327;&rdquo;&#37027;&#23601;&#19981;&#23384;&#22312;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#65292;&#21453;&#20043;&#65292;<strong class=" ">&#22914;&#26524;&#22810;&#20010;&#32447;&#31243;&#20849;&#29992;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#21602;</strong>&#65311;&#37027;&#20040;&#22312;&#20160;&#20040;&#24773;&#20917;&#19979;&#20250;&#26377;&#38382;&#39064;&#21602;&#65311;<strong class=" ">&#37027;&#23601;&#26159;&#24403;&#22810;&#32447;&#31243;&#20849;&#29992;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#24182;&#23545;&#20854;&#36827;&#34892;&#20462;&#25913;&#26102;&#21017;&#23384;&#22312;&#23433;&#20840;&#38382;&#39064;</strong>&#65292;&#22914;&#26524;&#20165;&#20165;&#26159;&#35835;&#30340;&#35805;&#27809;&#26377;&#38382;&#39064;&#12290;</p>
<p   
>&#22914;&#19979;&#25152;&#31034;&#20195;&#30721;&#65292;&#25105;&#20204;&#20889;&#20102;&#19968;&#20010;&#32447;&#31243;&#20989;&#25968;&#65292;&#35813;&#20989;&#25968;&#30340;&#20316;&#29992;&#23601;&#26159;&#20351;&#29992;&#20840;&#23616;&#21464;&#37327;&#65292;&#27169;&#25311;&#30340;&#21151;&#33021;&#23601;&#26159;&#21806;&#21334;&#29289;&#21697;&#65292;&#20840;&#23616;&#21464;&#37327;countNumber&#34920;&#31034;&#35813;&#29289;&#21697;&#30340;&#24635;&#26159;&#65292;&#20854;&#20540;&#26159;10&#65292;&#32780;&#22914;&#26524;&#26377;&#22810;&#20010;&#22320;&#26041;&#65288;&#32447;&#31243;&#65289;&#21435;&#21334;&#65288;&#20351;&#29992;&#65289;&#36825;&#20010;&#29289;&#21697;&#65288;&#20840;&#23616;&#21464;&#37327;&#65289;&#65292;&#21017;&#20250;&#20986;&#29616;&#24046;&#38169;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> countNumber = </code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (countNumber &gt; </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Sell num: %d\n"</code><code class="plain">, countNumber);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 售出-1</code></div>
<div class="line"><code class="plain">        countNumber--;</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Count: %d\n"</code><code class="plain">, countNumber);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    HANDLE hThread1;</code></div>
<div class="line"><code class="plain">    hThread1 = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#22270;&#65292;&#25105;&#20204;&#36816;&#34892;&#20102;&#20195;&#30721;&#65292;&#21457;&#29616;&#20250;&#20986;&#29616;&#37325;&#22797;&#21806;&#21334;&#65292;&#24182;&#19988;&#21040;&#26368;&#21518;&#24635;&#25968;&#31455;&#21464;&#25104;&#20102;-1&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_15-4-41.png" alt="images/download/attachments/1015833/image2021-5-27_15-4-41.png" width="600"  />
    </p>
<p   
>&#20986;&#29616;&#36825;&#26679;&#30340;&#38382;&#39064;&#20854;&#26412;&#36136;&#21407;&#22240;&#26159;&#20160;&#20040;&#21602;&#65311;<strong class=" ">&#22240;&#20026;&#22810;&#32447;&#31243;&#22312;&#25191;&#34892;&#30340;&#26102;&#20505;&#26159;&#21516;&#27493;&#36827;&#34892;&#30340;&#65292;&#24182;&#19981;&#26159;&#25353;&#29031;&#39034;&#24207;&#26469;&#65292;&#25152;&#20197;&#23601;&#37117;&#20250;&#31378;&#24687;&#65292;&#33258;&#28982;&#23601;&#20250;&#20986;&#29616;&#36825;&#31181;&#24773;&#20917;</strong>&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6Kej5Yaz6Zeu6aKY">
        <h3 class="heading "><span>&#35299;&#20915;&#38382;&#39064;</span></h3>
<p   
>&#24819;&#35201;&#35299;&#20915;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#65292;&#23601;&#38656;&#35201;&#24341;&#20280;&#20986;&#19968;&#20010;&#27010;&#24565;&#65306;&#20020;&#30028;&#36164;&#28304;&#65292;<strong class=" ">&#20020;&#30028;&#36164;&#28304;&#34920;&#31034;&#23545;&#35813;&#36164;&#28304;&#30340;&#35775;&#38382;&#19968;&#27425;&#21482;&#33021;&#26377;&#19968;&#20010;&#32447;&#31243;&#65307;&#35775;&#38382;&#20020;&#30028;&#36164;&#28304;&#30340;&#37027;&#19968;&#27573;&#31243;&#24207;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;&#20020;&#30028;&#21306;</strong>&#12290;</p>
<p   
>&#37027;&#20040;&#25105;&#20204;&#22914;&#20309;&#23454;&#29616;&#20020;&#30028;&#21306;&#21602;&#65311;&#31532;&#19968;&#65292;<strong class=" ">&#25105;&#20204;&#21487;&#20197;&#33258;&#24049;&#26469;&#20889;</strong>&#65292;&#20294;&#26159;&#36825;&#38656;&#35201;&#19968;&#23450;&#38376;&#27099;&#65292;&#20808;&#19981;&#36807;&#22810;&#30340;&#21435;&#20102;&#35299;&#65307;&#31532;&#20108;&#65292;<strong class=" ">&#21487;&#20197;&#20351;&#29992;WIndows&#25552;&#20379;&#30340;API&#26469;&#23454;&#29616;</strong>&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5a6e546w5Li055WM5Yy6">
        <h2 class="heading "><span>&#23454;&#29616;&#20020;&#30028;&#21306;</span></h2>
<p   
>&#39318;&#20808;&#20250;&#26377;&#19968;&#20010;&#20196;&#29260;&#65292;&#20551;&#35774;&#32447;&#31243;1&#33719;&#21462;&#20102;&#36825;&#20010;&#20196;&#29260;&#65292;&#37027;&#20040;&#36825;&#26102;&#20505;&#20196;&#29260;&#21017;&#21482;&#20026;&#32447;&#31243;1&#25152;&#26377;&#65292;&#28982;&#21518;&#32447;&#31243;1&#20250;&#25191;&#34892;&#20195;&#30721;&#21435;&#35775;&#38382;&#20840;&#23616;&#21464;&#37327;&#65292;&#26368;&#21518;&#24402;&#36824;&#20196;&#29260;&#65307;<strong class=" ">&#22914;&#26524;&#20854;&#20182;&#32447;&#31243;&#24819;&#35201;&#21435;&#35775;&#38382;&#36825;&#20010;&#20840;&#23616;&#21464;&#37327;&#23601;&#38656;&#35201;&#33719;&#21462;&#36825;&#20010;&#20196;&#29260;&#65292;&#20294;&#24403;&#20196;&#29260;&#24050;&#32463;&#34987;&#21462;&#36208;&#26102;&#21017;&#26080;&#27861;&#35775;&#38382;</strong>&#12290;</p>
<p   
>&#20551;&#35774;&#20320;&#33258;&#24049;&#26469;&#23454;&#29616;&#20020;&#30028;&#21306;&#65292;&#21487;&#33021;&#22312;&#21028;&#26029;&#20196;&#29260;&#26377;&#27809;&#26377;&#34987;&#25343;&#36208;&#30340;&#26102;&#20505;&#23601;&#21448;&#20250;&#20986;&#29616;&#38382;&#39064;&#65292;&#25152;&#20197;&#33258;&#24049;&#23454;&#29616;&#20020;&#30028;&#21306;&#36824;&#26159;&#26377;&#19968;&#23450;&#30340;&#38376;&#27099;&#30340;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_15-24-36.png" alt="images/download/attachments/1015833/image2021-5-27_15-24-36.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt57q_56iL6ZSB">
        <h2 class="heading "><span>&#32447;&#31243;&#38145;</span></h2>
<p   
>&#32447;&#31243;&#38145;&#23601;&#26159;&#20020;&#30028;&#21306;&#30340;&#23454;&#29616;&#26041;&#24335;&#65292;&#36890;&#36807;&#32447;&#31243;&#38145;&#25105;&#20204;&#21487;&#20197;&#23436;&#32654;&#35299;&#20915;&#22914;&#19978;&#25152;&#36848;&#30340;&#38382;&#39064;&#65292;&#20854;&#27493;&#39588;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#21019;&#24314;&#20840;&#23616;&#21464;&#37327;&#65306;CRITICAL_SECTION cs;</p>
</li><li class=" "><p   
>&#21021;&#22987;&#21270;&#20840;&#23616;&#21464;&#37327;&#65306;InitializeCriticalSection(&amp;cs);</p>
</li><li class=" "><p   
>&#23454;&#29616;&#20020;&#30028;&#21306;&#65306;&#36827;&#20837; &rarr; EnterCriticalSection(&amp;cs); &#31163;&#24320; &rarr; LeaveCriticalSection(&amp;cs);</p>
</li></ol><p   
>&#25105;&#20204;&#23601;&#21487;&#20197;&#36825;&#26679;&#25913;&#20889;&#20043;&#21069;&#30340;&#21806;&#21334;&#29289;&#21697;&#30340;&#20195;&#30721;&#65306;</p>
<p   
>&#22312;&#20351;&#29992;&#20840;&#23616;&#21464;&#37327;&#24320;&#22987;&#21069;&#26500;&#24314;&#24182;&#36827;&#20837;&#20020;&#30028;&#21306;&#65292;&#20351;&#29992;&#23436;&#20043;&#21518;&#31163;&#24320;&#20020;&#30028;&#21306;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CRITICAL_SECTION cs; </code><code class="comments">// 创建全局变量</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> countNumber = </code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (</code><code class="value">1</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">        EnterCriticalSection(&amp;cs); </code><code class="comments">// 构建临界区，获取令牌</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (countNumber &gt; </code><code class="value">0</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">            printf(</code><code class="string">"Thread: %d\n"</code><code class="plain">, *((</code><code class="keyword">int</code><code class="plain">*)lpParameter));</code></div>
<div class="line"><code class="plain">            printf(</code><code class="string">"Sell num: %d\n"</code><code class="plain">, countNumber);</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 售出-1</code></div>
<div class="line"><code class="plain">            countNumber--;</code></div>
<div class="line"><code class="plain">            printf(</code><code class="string">"Count: %d\n"</code><code class="plain">, countNumber);</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            LeaveCriticalSection(&amp;cs); </code><code class="comments">// 离开临临界区，归还令牌</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;  </code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        LeaveCriticalSection(&amp;cs); </code><code class="comments">// 离开临临界区，归还令牌</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    InitializeCriticalSection(&amp;cs); </code><code class="comments">// 使用之前进行初始化</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> a = </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    hThread = CreateThread(NULL, NULL, ThreadProc, (LPVOID)&amp;a, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> b = </code><code class="value">2</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    HANDLE hThread1;</code></div>
<div class="line"><code class="plain">    hThread1 = CreateThread(NULL, NULL, ThreadProc, (LPVOID)&amp;b, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_15-54-0.png" alt="images/download/attachments/1015833/image2021-5-27_15-54-0.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5LqS5pal5L2T">
        <h1 class="heading "><span>&#20114;&#26021;&#20307;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5qC457qn5Li055WM6LWE5rqQ5oCO5LmI5Yqe77yf">
        <h2 class="heading "><span>&#20869;&#26680;&#32423;&#20020;&#30028;&#36164;&#28304;&#24590;&#20040;&#21150;&#65311;</span></h2>
<p   
>&#19978;&#19968;&#31456;&#20013;&#25105;&#20204;&#20102;&#35299;&#20102;&#20351;&#29992;&#32447;&#31243;&#38145;&#26469;&#35299;&#20915;&#22810;&#20010;&#32447;&#31243;&#20849;&#29992;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#30340;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#65307;<strong class=" ">&#37027;&#20040;&#20551;&#35774;A&#36827;&#31243;&#30340;B&#32447;&#31243;&#21644;C&#36827;&#31243;&#30340;D&#32447;&#31243;</strong>&#65292;&#21516;&#26102;&#20351;&#29992;&#30340;&#26159;&#20869;&#26680;&#32423;&#30340;&#20020;&#30028;&#36164;&#28304;&#65288;<strong class=" ">&#20869;&#26680;&#23545;&#35937;&#65306;&#32447;&#31243;&#12289;&#25991;&#20214;&#12289;&#36827;&#31243;...</strong>&#65289;&#35813;&#24590;&#20040;&#35753;&#36825;&#20010;&#35775;&#38382;&#26159;&#23433;&#20840;&#30340;&#65311;<strong class=" ">&#20351;&#29992;&#32447;&#31243;&#38145;&#30340;&#26041;&#24335;&#26126;&#26174;&#19981;&#34892;&#65292;&#22240;&#20026;&#32447;&#31243;&#38145;&#20165;&#33021;&#25511;&#21046;&#21516;&#36827;&#31243;&#20013;&#30340;&#22810;&#32447;&#31243;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_16-8-12.png" alt="images/download/attachments/1015833/image2021-5-27_16-8-12.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#36825;&#26102;&#20505;&#25105;&#20204;&#23601;&#38656;&#35201;&#19968;&#20010;<strong class=" ">&#33021;&#22815;&#25918;&#22312;&#20869;&#26680;&#20013;&#30340;&#20196;&#29260;</strong>&#26469;&#25511;&#21046;&#65292;&#32780;&#23454;&#29616;&#36825;&#20010;&#20316;&#29992;&#30340;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;<strong class=" ">&#20114;&#26021;&#20307;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_16-10-43.png" alt="images/download/attachments/1015833/image2021-5-27_16-10-43.png" width="600"  />
    </p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5LqS5pal5L2T55qE5L2_55So">
        <h3 class="heading "><span>&#20114;&#26021;&#20307;&#30340;&#20351;&#29992;</span></h3>
<p   
>&#21019;&#24314;&#20114;&#26021;&#20307;&#30340;&#20989;&#25968;&#20026;<strong class=" ">CreateMutex</strong>&#65292;&#35813;&#20989;&#25968;&#30340;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateMutex(</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpMutexAttributes,  </code><code class="comments">// SD 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  BOOL bInitialOwner,                       </code><code class="comments">// initial owner 是否希望互斥体创建出来就有信号，或者说就可以使用，如果希望的话就为FALSE；官方解释为如果该值为TRUE则表示当前进程拥有该互斥体所有权</code></div>
<div class="line"><code class="plain">  LPCTSTR lpName                            </code><code class="comments">// object name 互斥体的名字</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>&#25105;&#20204;&#21487;&#20197;&#27169;&#25311;&#19968;&#19979;&#25805;&#20316;&#36164;&#28304;&#28982;&#21518;&#21019;&#24314;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建互斥体</code></div>
<div class="line"><code class="plain">    HANDLE cm = CreateMutex(NULL, FALSE, </code><code class="string">"XYZ"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 等待互斥体状态发生变化，也就是有信号或为互斥体拥有者，获取令牌</code></div>
<div class="line"><code class="plain">    WaitForSingleObject(cm, INFINITE);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 操作资源</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">5</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Process: A Thread: B -- %d \n"</code><code class="plain">, i);</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 释放令牌</code></div>
<div class="line"><code class="plain">    ReleaseMutex(cm);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#36816;&#34892;&#20004;&#20010;&#36827;&#31243;&#26469;&#30475;&#19968;&#19979;&#20114;&#26021;&#20307;&#30340;&#20316;&#29992;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_16-57-41.png" alt="images/download/attachments/1015833/image2021-5-27_16-57-41.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LqS5pal5L2T5ZKM57q_56iL6ZSB55qE5Yy65Yir">
        <h2 class="heading "><span>&#20114;&#26021;&#20307;&#21644;&#32447;&#31243;&#38145;&#30340;&#21306;&#21035;</span></h2>
<ol class=" "><li class=" "><p   
>&#32447;&#31243;&#38145;&#21482;&#33021;&#29992;&#20110;&#21333;&#20010;&#36827;&#31243;&#38388;&#30340;&#32447;&#31243;&#25511;&#21046;</p>
</li><li class=" "><p   
>&#20114;&#26021;&#20307;&#21487;&#20197;&#35774;&#23450;&#31561;&#24453;&#36229;&#26102;&#65292;&#20294;&#32447;&#31243;&#38145;&#19981;&#33021;</p>
</li><li class=" "><p   
>&#32447;&#31243;&#24847;&#22806;&#32467;&#26463;&#26102;&#65292;&#20114;&#26021;&#20307;&#21487;&#20197;&#36991;&#20813;&#26080;&#38480;&#31561;&#24453;</p>
</li><li class=" "><p   
>&#20114;&#26021;&#20307;&#25928;&#29575;&#27809;&#26377;&#32447;&#31243;&#38145;&#39640;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6K--5aSW5omp5bGVLeS6kuaWpeS9k-mYsuatoueoi-W6j-WkmuW8gA">
        <h2 class="heading "><span>&#35838;&#22806;&#25193;&#23637;-&#20114;&#26021;&#20307;&#38450;&#27490;&#31243;&#24207;&#22810;&#24320;</span></h2>
<p   
>CreateMutex&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;MSDN Library&#30340;&#20171;&#32461;&#26159;&#36825;&#26679;&#30340;&#65306;<strong class=" ">&#22914;&#26524;&#20989;&#25968;&#25104;&#21151;&#65292;&#36820;&#22238;&#20540;&#26159;&#19968;&#20010;&#25351;&#21521;mutex&#23545;&#35937;&#30340;&#21477;&#26564;&#65307;&#22914;&#26524;&#21629;&#21517;&#30340;mutex&#23545;&#35937;&#22312;&#20989;&#25968;&#35843;&#29992;&#21069;&#24050;&#32463;&#23384;&#22312;&#65292;&#20989;&#25968;&#36820;&#22238;&#29616;&#26377;&#23545;&#35937;&#30340;&#21477;&#26564;&#65292;GetLastError&#36820;&#22238;ERROR_ALREADY_EXISTS&#65288;&#34920;&#31034;&#20114;&#26021;&#20307;&#20197;&#21450;&#23384;&#22312;&#65289;&#65307;&#21542;&#21017;&#65292;&#35843;&#29992;&#32773;&#21019;&#24314;&#35813;mutex&#23545;&#35937;&#65307;&#22914;&#26524;&#20989;&#25968;&#22833;&#36133;&#65292;&#36820;&#22238;&#20540;&#20026;NULL&#65292;&#35201;&#33719;&#24471;&#25193;&#23637;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292;&#35831;&#35843;&#29992;GetLastError&#33719;&#21462;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_16-53-41.png" alt="images/download/attachments/1015833/image2021-5-27_16-53-41.png" width="600"  />
    </p>
<p   
>&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#21033;&#29992;&#20114;&#26021;&#20307;&#26469;&#38450;&#27490;&#31243;&#24207;&#36827;&#34892;&#22810;&#24320;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建互斥体</code></div>
<div class="line"><code class="plain">    HANDLE cm = CreateMutex(NULL, TRUE, </code><code class="string">"XYZ"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断互斥体是否创建失败</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (cm != NULL) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 判断互斥体是否已经存在，如果存在则表示程序被多次打开</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (GetLastError() == ERROR_ALREADY_EXISTS) {</code></div>
<div class="line"><code class="plain">            printf(</code><code class="string">"该程序已经开启了，请勿再次开启！"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">            getchar();</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 等待互斥体状态发生变化，也就是有信号或为互斥体拥有者，获取令牌</code></div>
<div class="line"><code class="plain">            WaitForSingleObject(cm, INFINITE);</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 操作资源</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">5</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"Process: A Thread: B -- %d \n"</code><code class="plain">, i);</code></div>
<div class="line"><code class="plain">                Sleep(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 释放令牌</code></div>
<div class="line"><code class="plain">            ReleaseMutex(cm);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateMutex 创建失败! 错误代码: %d\n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-27_17-7-1.png" alt="images/download/attachments/1015833/image2021-5-27_17-7-1.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5LqL5Lu2">
        <h1 class="heading "><span>&#20107;&#20214;</span></h1>
<p   
>&#20107;&#20214;&#26412;&#36523;&#20063;&#26159;&#19968;&#31181;&#20869;&#26680;&#23545;&#35937;&#65292;&#20854;&#20063;&#26159;&#26159;&#29992;&#26469;&#25511;&#21046;&#32447;&#31243;&#30340;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6YCa55-l57G75Z6L">
        <h2 class="heading "><span>&#36890;&#30693;&#31867;&#22411;</span></h2>
<p   
>&#20107;&#20214;&#26412;&#36523;&#21487;&#20197;&#20570;&#20026;&#36890;&#30693;&#31867;&#22411;&#26469;&#20351;&#29992;&#65292;&#21019;&#24314;&#20107;&#20214;&#20351;&#29992;&#20989;&#25968;<strong class=" ">CreateEvent</strong>&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateEvent(</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpEventAttributes, </code><code class="comments">// SD 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  BOOL bManualReset,                       </code><code class="comments">// reset type 如果你希望当前事件类型是通知类型则写TRUE，反之FALSE</code></div>
<div class="line"><code class="plain">  BOOL bInitialState,                      </code><code class="comments">// initial state 初始状态，决定创建出来时候是否有信号，有为TRUE，没有为FALSE</code></div>
<div class="line"><code class="plain">  LPCTSTR lpName                           </code><code class="comments">// object name 事件名字</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#37027;&#20040;&#36890;&#30693;&#31867;&#22411;&#21040;&#24213;&#26159;&#20160;&#20040;&#65311;&#25105;&#20204;&#21487;&#20197;&#20889;&#19968;&#27573;&#20195;&#30721;&#26469;&#30475;&#19968;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HANDLE e_event;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 等待事件</code></div>
<div class="line"><code class="plain">    WaitForSingleObject(e_event, INFINITE);</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"ThreadProc - running ...\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProcB(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 等待事件</code></div>
<div class="line"><code class="plain">    WaitForSingleObject(e_event, INFINITE);</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"ThreadProcB - running ...\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建事件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 第二个参数，FALSE表示非通知类型通知，也就是互斥；TRUE则表示为通知类型</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 第三个参数表示初始状态没有信号</code></div>
<div class="line"><code class="plain">    e_event = CreateEvent(NULL, TRUE, FALSE, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建2个线程</code></div>
<div class="line"><code class="plain">    HANDLE hThread[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">0</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">1</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProcB, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置事件为已通知，也就是设置为有信号</code></div>
<div class="line"><code class="plain">    SetEvent(e_event);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 等待线程执行结束，销毁内核对象</code></div>
<div class="line"><code class="plain">    WaitForMultipleObjects(</code><code class="value">2</code><code class="plain">, hThread, TRUE, INFINITE);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">1</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 事件类型也是内核对象，所以也需要关闭句柄</code></div>
<div class="line"><code class="plain">    CloseHandle(e_event);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#36816;&#34892;&#20102;&#20195;&#30721;&#65292;&#20250;&#21457;&#29616;&#20004;&#20010;&#32447;&#31243;&#37117;&#25191;&#34892;&#20102;&#65292;&#32780;&#22914;&#26524;&#26159;&#20043;&#21069;&#25105;<strong class=" ">&#20204;&#20351;&#29992;&#20114;&#26021;&#20307;&#30340;&#35805;&#21017;&#32447;&#31243;A&#20808;&#25191;&#34892;&#28982;&#21518;&#32447;&#31243;B&#31561;&#24453;&#32447;&#31243;A&#24402;&#36824;&#20196;&#29260;&#65288;&#25191;&#34892;&#32467;&#26463;&#65289;&#25165;&#20250;&#25191;&#34892;</strong>&#65292;&#36825;&#37324;&#25105;&#20204;&#22312;&#32447;&#31243;&#20989;&#25968;&#30340;&#26368;&#21518;&#20351;&#29992;&#20102;getchar()&#38459;&#27490;&#20102;&#32447;&#31243;&#25191;&#34892;&#32467;&#26463;&#65292;&#20294;&#26159;&#20004;&#20010;&#32447;&#31243;&#36824;&#26159;&#37117;&#25191;&#34892;&#20102;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_17-55-17.png" alt="images/download/attachments/1015833/image2021-5-28_17-55-17.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#20462;&#25913;&#19979;&#21019;&#24314;&#20107;&#20214;&#20989;&#25968;&#30340;&#21442;&#25968;&#20026;&#20114;&#26021;&#65292;&#26469;&#30475;&#19968;&#19979;&#65292;&#37027;&#20040;&#20114;&#26021;&#21644;&#36890;&#30693;&#31867;&#22411;&#30340;&#21306;&#21035;&#19968;&#19979;&#23601;&#24456;&#26126;&#26174;&#30340;&#23637;&#31034;&#20986;&#26469;&#20102;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_17-53-36.png" alt="images/download/attachments/1015833/image2021-5-28_17-53-36.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#36890;&#30693;&#31867;&#22411;&#23454;&#29616;&#30340;&#21407;&#29702;&#26159;&#20160;&#20040;&#21602;&#65311;&#23454;&#38469;&#19978;&#36825;&#20010;&#36319;WaitForSingleObject&#20989;&#25968;&#26377;&#20851;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#19979;MSDN Library&#23545;&#35813;&#20989;&#25968;&#30340;&#20171;&#32461;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_17-2-34.png" alt="images/download/attachments/1015833/image2021-5-28_17-2-34.png" width="600"  />
    </p>
<p   
>&#21487;&#20197;&#24456;&#28165;&#26224;&#30340;&#30475;&#35265;&#26368;&#21518;&#35828;&#21040;&#65292;&#35813;&#20989;&#25968;&#20250;&#20462;&#25913;&#20869;&#26680;&#23545;&#35937;&#30340;&#29366;&#24577;&#65292;&#25152;&#20197;&#36890;&#30693;&#31867;&#22411;&#30340;&#21407;&#29702;&#23601;&#24456;&#31616;&#21333;&#20102;&#65292;<strong class=" ">&#23601;&#26159;&#24403;&#20107;&#20214;&#23545;&#35937;&#20026;&#36890;&#30693;&#31867;&#22411;&#26102;&#35813;&#20989;&#25968;&#23601;&#19981;&#20250;&#21435;&#20462;&#25913;&#23545;&#35937;&#30340;&#29366;&#24577;</strong>&#65292;&#36825;&#20010;&#29366;&#24577;&#25105;&#20204;&#21487;&#20197;&#29702;&#35299;&#25104;&#26159;&#21344;&#29992;&#65292;<strong class=" ">&#24403;WaitForSingleObject&#20989;&#25968;&#21028;&#26029;&#20026;&#38750;&#21344;&#29992;&#26102;&#23601;&#20462;&#25913;&#20869;&#26680;&#23545;&#35937;&#30340;&#29366;&#24577;&#20026;&#21344;&#29992;&#28982;&#21518;&#21521;&#19979;&#25191;&#34892;&#65292;&#32780;&#20854;&#20182;&#32447;&#31243;&#24819;&#20351;&#29992;&#23601;&#38656;&#35201;&#31561;&#24453;</strong>&#65292;&#36825;&#23601;&#26159;<strong class=" ">&#20114;&#26021;</strong>&#30340;&#27010;&#24565;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt57q_56iL5ZCM5q2l">
        <h2 class="heading "><span>&#32447;&#31243;&#21516;&#27493;</span></h2>
<p   
><strong class=" ">&#32447;&#31243;&#20114;&#26021;</strong>&#65306;&#32447;&#31243;&#20114;&#26021;&#26159;&#25351;&#23545;&#20110;&#20849;&#20139;&#30340;&#36827;&#31243;&#31995;&#32479;&#36164;&#28304;&#65292;&#22312;&#21508;&#21333;&#20010;&#32447;&#31243;&#35775;&#38382;&#26102;&#30340;&#25490;&#23427;&#24615;&#65307;&#24403;&#26377;&#33509;&#24178;&#20010;&#32447;&#31243;&#37117;&#35201;&#20351;&#29992;&#26576;&#19968;&#20849;&#20139;&#36164;&#28304;&#26102;&#65292;&#20219;&#20309;&#26102;&#21051;&#26368;&#22810;&#21482;&#20801;&#35768;&#19968;&#20010;&#32447;&#31243;&#21435;&#20351;&#29992;&#65292;&#20854;&#23427;&#35201;&#20351;&#29992;&#35813;&#36164;&#28304;&#30340;&#32447;&#31243;&#24517;&#39035;&#31561;&#24453;&#65292;&#30452;&#21040;&#21344;&#29992;&#36164;&#28304;&#32773;&#37322;&#25918;&#35813;&#36164;&#28304;&#12290;</p>
<p   
><strong class=" ">&#32447;&#31243;&#21516;&#27493;</strong>&#65306; &#32447;&#31243;&#21516;&#27493;&#26159;&#25351;&#32447;&#31243;&#20043;&#38388;&#25152;&#20855;&#26377;&#30340;&#19968;&#31181;&#21046;&#32422;&#20851;&#31995;&#65292;&#19968;&#20010;&#32447;&#31243;&#30340;&#25191;&#34892;&#20381;&#36182;&#21478;&#19968;&#20010;&#32447;&#31243;&#30340;&#28040;&#24687;&#65292;&#24403;&#23427;&#27809;&#26377;&#24471;&#21040;&#21478;&#19968;&#20010;&#32447;&#31243;&#30340;&#28040;&#24687;&#26102;&#24212;&#31561;&#24453;&#65292;&#30452;&#21040;&#28040;&#24687;&#21040;&#36798;&#26102;&#25165;&#34987;&#21796;&#37266;&#65307;&#21516;&#27493;&#30340;&#21069;&#25552;&#26159;&#20114;&#26021;&#65292;&#20854;&#27425;&#23601;&#26159;&#26377;&#24207;&#65292;<strong class=" ">&#20114;&#26021;&#24182;&#19981;&#20195;&#34920;A&#32447;&#31243;&#35775;&#38382;&#20020;&#30028;&#36164;&#28304;&#21518;&#23601;&#19968;&#23450;&#26159;B&#32447;&#31243;&#20877;&#21435;&#35775;&#38382;&#65292;&#20063;&#26377;&#21487;&#33021;&#26159;A&#32447;&#31243;&#65292;&#36825;&#23601;&#26159;&#23646;&#20110;&#26080;&#24207;&#30340;&#29366;&#24577;</strong>&#65292;&#25152;&#20197;&#21516;&#27493;&#23601;&#26159;<strong class=" ">&#20114;&#26021;&#21152;&#19978;&#26377;&#24207;</strong>&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt55Sf5Lqn6ICF5LiO5raI6LS56ICF">
        <h3 class="heading "><span>&#29983;&#20135;&#32773;&#19982;&#28040;&#36153;&#32773;</span></h3>
<p   
>&#24819;&#35201;&#35777;&#26126;&#20107;&#20214;&#21644;&#20114;&#26021;&#20307;&#26368;&#26412;&#36136;&#30340;&#21306;&#21035;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#29983;&#20135;&#32773;&#19982;&#28040;&#36153;&#32773;&#27169;&#22411;&#26469;&#20030;&#20363;&#23376;&#65292;&#37027;&#20040;&#36825;&#20010;&#27169;&#22411;&#26159;&#20160;&#20040;&#24847;&#24605;&#21602;&#65311;</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>&#29983;&#20135;&#32773;&#28040;&#36153;&#32773;&#27169;&#24335;&#23601;&#26159;&#36890;&#36807;&#19968;&#20010;&#23481;&#22120;&#26469;&#35299;&#20915;&#29983;&#20135;&#32773;&#21644;&#28040;&#36153;&#32773;&#30340;&#24378;&#32806;&#21512;&#65288;&#20381;&#36182;&#24615;&#65289;&#38382;&#39064;&#12290;&#29983;&#20135;&#32773;&#21644;&#28040;&#36153;&#32773;&#24444;&#27492;&#20043;&#38388;&#19981;&#30452;&#25509;&#36890;&#35759;&#65292;&#32780;&#36890;&#36807;&#38459;&#22622;&#38431;&#21015;&#26469;&#36827;&#34892;&#36890;&#35759;&#65292;&#25152;&#20197;&#29983;&#20135;&#32773;&#29983;&#20135;&#23436;&#25968;&#25454;&#20043;&#21518;&#19981;&#29992;&#31561;&#24453;&#28040;&#36153;&#32773;&#22788;&#29702;&#65292;&#30452;&#25509;&#25172;&#32473;&#38459;&#22622;&#38431;&#21015;&#65292;&#28040;&#36153;&#32773;&#19981;&#25214;&#29983;&#20135;&#32773;&#35201;&#25968;&#25454;&#65292;&#32780;&#26159;&#30452;&#25509;&#20174;&#38459;&#22622;&#38431;&#21015;&#37324;&#21462;&#65292;&#38459;&#22622;&#38431;&#21015;&#23601;&#30456;&#24403;&#20110;&#19968;&#20010;&#32531;&#20914;&#21306;&#65292;&#24179;&#34913;&#20102;&#29983;&#20135;&#32773;&#21644;&#28040;&#36153;&#32773;&#30340;&#22788;&#29702;&#33021;&#21147;&#12290;</p>
        </div>
    </div>
<p   
>&#25105;&#20204;&#23601;&#21487;&#20197;&#29702;&#35299;&#20026;&#29983;&#20135;&#32773;&#29983;&#20135;&#19968;&#20010;&#29289;&#21697;&#65292;&#23558;&#20854;&#25918;&#36827;&#23481;&#22120;&#37324;&#65292;&#28982;&#21518;&#28040;&#36153;&#32773;&#20174;&#23481;&#22120;&#20013;&#21462;&#29289;&#21697;&#36827;&#34892;&#28040;&#36153;&#65292;&#23601;&#36825;&#26679;&ldquo;&#25353;&#37096;&#23601;&#29677;&rdquo;&#19979;&#21435;...</p>
    <div class="section section-4" id="src-1015833_safe-id-V2luMzIt5LqS5pal5L2TLjE">
        <h4 class="heading "><span>&#20114;&#26021;&#20307;</span></h4>
<p   
>&#39318;&#20808;&#25105;&#20204;&#26469;&#20889;&#19968;&#27573;&#20114;&#26021;&#20307;&#19979;&#30340;&#29983;&#20135;&#32773;&#19982;&#28040;&#36153;&#32773;&#30340;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 容器</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> container;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 次数</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> count = </code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 互斥体</code></div>
<div class="line"><code class="plain">HANDLE hMutex;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 生产者</code></div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; count; i++) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 等待互斥体，获取令牌</code></div>
<div class="line"><code class="plain">        WaitForSingleObject(hMutex, INFINITE);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 获取当前进程ID</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">int</code><code class="plain"> threadId = GetCurrentThreadId();</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 生产存放进容器</code></div>
<div class="line"><code class="plain">        container = </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Thread: %d, Build: %d \n"</code><code class="plain">, threadId, container);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 释放令牌</code></div>
<div class="line"><code class="plain">        ReleaseMutex(hMutex);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 消费者</code></div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProcB(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; count; i++) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 等待互斥体，获取令牌</code></div>
<div class="line"><code class="plain">        WaitForSingleObject(hMutex, INFINITE);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 获取当前进程ID</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">int</code><code class="plain"> threadId = GetCurrentThreadId();</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Thread: %d, Consume: %d \n"</code><code class="plain">, threadId, container);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 消费</code></div>
<div class="line"><code class="plain">        container = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 释放令牌</code></div>
<div class="line"><code class="plain">        ReleaseMutex(hMutex);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建互斥体</code></div>
<div class="line"><code class="plain">    hMutex = CreateMutex(NULL, FALSE, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建2个线程</code></div>
<div class="line"><code class="plain">    HANDLE hThread[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">0</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">1</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProcB, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    WaitForMultipleObjects(</code><code class="value">2</code><code class="plain">, hThread, TRUE, INFINITE);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">1</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    CloseHandle(hMutex);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36816;&#34892;&#32467;&#26524;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_17-57-34.png" alt="images/download/attachments/1015833/image2021-5-28_17-57-34.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#21487;&#20197;&#28165;&#26224;&#30340;&#30475;&#35265;&#32467;&#26524;&#24182;&#19981;&#26159;&#25105;&#20204;&#24819;&#35201;&#30340;&#65292;&#29983;&#20135;&#19968;&#27425;&#28040;&#36153;&#19968;&#27425;&#30340;&#26377;&#24207;&#36827;&#34892;&#65292;&#29978;&#33267;&#36824;&#20986;&#29616;&#20102;&#20808;&#28040;&#36153;&#21518;&#29983;&#20135;&#30340;&#24773;&#20917;&#65292;&#36825;&#20010;&#38382;&#39064;&#25105;&#20204;&#21487;&#20197;&#21435;&#20462;&#25913;&#20195;&#30721;&#35299;&#20915;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_18-3-24.png" alt="images/download/attachments/1015833/image2021-5-28_18-3-24.png" width="600"  />
    </p>
<p   
>&#36825;&#26679;&#34429;&#28982;&#30475;&#20284;&#35299;&#20915;&#20102;&#38382;&#39064;&#65292;&#20294;&#26159;&#23454;&#38469;&#19978;&#20063;&#21516;&#26679;&#20250;&#20986;&#29616;&#19968;&#31181;&#38382;&#39064;&#65292;&#37027;&#23601;&#26159;for&#24490;&#29615;&#25191;&#34892;&#20102;&#19981;&#27490;10&#27425;&#65292;&#36825;&#26679;&#20250;&#20498;&#26159;&#36807;&#20998;&#30340;<strong class=" ">&#21344;&#29992;&#35745;&#31639;&#36164;&#28304;</strong>&#12290;</p>
    </div>
    <div class="section section-4" id="src-1015833_safe-id-V2luMzIt5LqL5Lu2LjE">
        <h4 class="heading "><span>&#20107;&#20214;</span></h4>
<p   
>&#25105;&#20204;&#20351;&#29992;&#20107;&#20214;&#30340;&#26041;&#24335;&#23601;&#21487;&#20197;&#26356;&#21152;&#23436;&#32654;&#30340;&#35299;&#20915;&#36825;&#19968;&#38656;&#27714;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 容器</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> container = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 次数</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> count = </code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 事件</code></div>
<div class="line"><code class="plain">HANDLE eventA;</code></div>
<div class="line"><code class="plain">HANDLE eventB;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 生产者</code></div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; count; i++) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 等待事件，修改事件A状态</code></div>
<div class="line"><code class="plain">        WaitForSingleObject(eventA, INFINITE);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 获取当前进程ID</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">int</code><code class="plain"> threadId = GetCurrentThreadId();</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 生产存放进容器</code></div>
<div class="line"><code class="plain">        container = </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Thread: %d, Build: %d \n"</code><code class="plain">, threadId, container);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 给eventB设置信号</code></div>
<div class="line"><code class="plain">        SetEvent(eventB);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 消费者</code></div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProcB(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; count; i++) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 等待事件，修改事件B状态</code></div>
<div class="line"><code class="plain">        WaitForSingleObject(eventB, INFINITE);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 获取当前进程ID</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">int</code><code class="plain"> threadId = GetCurrentThreadId();</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Thread: %d, Consume: %d \n"</code><code class="plain">, threadId, container);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 消费</code></div>
<div class="line"><code class="plain">        container = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 给eventA设置信号</code></div>
<div class="line"><code class="plain">        SetEvent(eventA);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建事件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 线程同步的前提是互斥</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 顺序按照先生产后消费，所以事件A设置信号，事件B需要通过生产者线程来设置信号</code></div>
<div class="line"><code class="plain">    eventA = CreateEvent(NULL, FALSE, TRUE, NULL);</code></div>
<div class="line"><code class="plain">    eventB = CreateEvent(NULL, FALSE, FALSE, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建2个线程</code></div>
<div class="line"><code class="plain">    HANDLE hThread[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">0</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    hThread[</code><code class="value">1</code><code class="plain">] = CreateThread(NULL, NULL, ThreadProcB, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    WaitForMultipleObjects(</code><code class="value">2</code><code class="plain">, hThread, TRUE, INFINITE);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">0</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread[</code><code class="value">1</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 事件类型也是内核对象，所以也需要关闭句柄</code></div>
<div class="line"><code class="plain">    CloseHandle(eventA);</code></div>
<div class="line"><code class="plain">    CloseHandle(eventB);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36816;&#34892;&#32467;&#26524;&#22914;&#19979;&#22270;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_18-13-7.png" alt="images/download/attachments/1015833/image2021-5-28_18-13-7.png" width="600"  />
    </p>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt56qX5Y-j55qE5pys6LSo">
        <h1 class="heading "><span>&#31383;&#21475;&#30340;&#26412;&#36136;</span></h1>
<p   
>&#20043;&#21069;&#25105;&#20204;&#23398;&#20064;&#20889;&#30340;&#31243;&#24207;&#37117;&#26159;&#22522;&#20110;&#25511;&#21046;&#21488;&#30340;&#65292;&#32780;&#20174;&#26412;&#31456;&#24320;&#22987;&#23398;&#20064;&#22270;&#24418;&#21270;&#30028;&#38754;&#30456;&#20851;&#30340;&#30693;&#35782;&#12290;</p>
<p   
>&#20043;&#21069;&#25105;&#20204;&#25152;&#23398;&#20064;&#30340;&#36827;&#31243;&#12289;&#32447;&#31243;&#20043;&#31867;&#30340;&#20989;&#25968;&#65292;&#20854;&#25509;&#21475;&#26469;&#28304;&#20110;kernel32.dll &rarr; ntoskrnl.exe&#65307;&#32780;&#25105;&#20204;&#35201;&#23398;&#20064;&#30340;&#22270;&#24418;&#21270;&#30028;&#38754;&#30340;&#25509;&#21475;&#65292;&#23427;&#23601;&#26469;&#28304;&#20110;user32.dll&#12289;gdi32.dll &rarr; win32k.sys&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_18-21-33.png" alt="images/download/attachments/1015833/image2021-5-28_18-21-33.png" width="600"  />
    </p>
<p   
>user32.dll&#21644;gdi32.dll&#30340;&#21306;&#21035;&#22312;&#21738;&#21602;&#65311;<strong class=" ">&#21069;&#32773;&#26159;&#20320;&#24819;&#20351;&#29992;Windows&#24050;&#32463;&#30011;&#22909;&#30340;&#30028;&#38754;&#23601;&#29992;&#23427;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;GUI&#32534;&#31243;&#65307;&#21518;&#32773;&#26159;&#20320;&#24819;&#33258;&#24049;&#30011;&#19968;&#20010;&#30028;&#38754;&#65292;&#20363;&#22914;&#20320;&#35201;&#30011;&#19968;&#26421;&#33457;&#65292;&#37027;&#20040;&#23601;&#20351;&#29992;&#21518;&#32773;&#65292;&#22240;&#20026;&#36825;&#28041;&#21450;&#21040;&#32472;&#22270;&#30456;&#20851;&#30340;&#20869;&#23481;&#65292;&#25105;&#20204;&#31216;&#20043;&#20026;GDI&#32534;&#31243;</strong>&#12290;</p>
<p   
>&#20043;&#21069;&#25105;&#20204;&#20102;&#35299;&#36807;HANDLE&#21477;&#26564;&#65292;&#20854;&#37117;&#26159;&#31169;&#26377;&#30340;&#65292;&#32780;&#22312;&#22270;&#24418;&#30028;&#38754;&#20013;&#26377;&#19968;&#20010;<strong class=" ">&#26032;&#30340;&#21477;&#26564;</strong>&#65292;&#20854;&#21483;HWND&#65292;win32k.sys&#25552;&#20379;&#22312;&#20869;&#26680;&#23618;&#21019;&#24314;&#22270;&#24418;&#21270;&#30028;&#38754;&#65292;&#25105;&#20204;&#24819;&#35201;&#22312;&#24212;&#29992;&#23618;&#35843;&#29992;&#23601;&#38656;&#35201;&#23545;&#24212;&#30340;&#21477;&#26564;HWND&#65292;<strong class=" ">&#32780;&#36825;&#20010;&#21477;&#26564;&#34920;&#26159;&#20840;&#23616;&#30340;&#65292;&#24182;&#19988;&#21482;&#26377;&#19968;&#20010;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_19-37-31.png" alt="images/download/attachments/1015833/image2021-5-28_19-37-31.png" width="600"  />
    </p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItR0RJLeWbvuW9ouiuvuWkh-aOpeWPow">
        <h2 class="heading "><span>GDI - &#22270;&#24418;&#35774;&#22791;&#25509;&#21475;</span></h2>
<p   
>GDI&#26159;Graphics Device Interface&#30340;&#32553;&#20889;&#65292;&#20854;&#20013;&#25991;&#20026;&#22270;&#24418;&#35774;&#22791;&#25509;&#21475;&#12290;</p>
<p   
>&#26412;&#31456;&#20027;&#35201;&#26159;&#23398;&#20064;&#22914;&#20309;&#36827;&#34892;GDI&#32534;&#31243;&#65292;&#20294;&#26159;&#25105;&#20204;&#22312;&#26085;&#24120;&#30340;&#24037;&#20316;&#20013;&#26159;&#19981;&#38656;&#35201;&#29992;&#21040;&#30340;&#65292;&#24182;&#19988;&#27809;&#26377;&#20160;&#20040;&#23454;&#38469;&#24847;&#20041;&#65288;&#38656;&#35201;&#30340;&#37117;&#26377;&#29616;&#25104;&#30340;&#65289;&#65292;&#25105;&#20204;&#23398;&#20064;&#23427;&#23601;&#26159;&#20026;&#20102;&#26469;&#20102;&#35299;&#31383;&#21475;&#30340;&#26412;&#36136;&#12289;<strong class=" ">&#28040;&#24687;&#26426;&#21046;</strong>&#30340;&#26412;&#36136;&#12290;</p>
<p   
>&#20851;&#20110;GDI&#26377;&#36825;&#20040;&#20960;&#20010;&#27010;&#24565;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#35774;&#22791;&#23545;&#35937;&#65306;&#30011;&#30340;&#20301;&#32622;</p>
</li><li class=" "><p   
>DC&#65288;Device Contexts&#65289;&#65306;&#35774;&#22791;&#19978;&#19979;&#25991;&#23545;&#35937;&#65288;&#20869;&#23384;&#65289;</p>
</li><li class=" "><p   
>&#22270;&#20687;&#65288;&#22270;&#24418;&#65289;&#23545;&#35937;&#65306;&#20915;&#23450;&#20320;&#35201;&#30011;&#30340;&#19996;&#35199;&#30340;&#23646;&#24615;</p>
</li></ol><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_19-39-33.png" alt="images/download/attachments/1015833/image2021-5-28_19-39-33.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6L-b6KGM566A5Y2V55qE57uY55S7">
        <h2 class="heading "><span>&#36827;&#34892;&#31616;&#21333;&#30340;&#32472;&#30011;</span></h2>
<p   
>&#22914;&#19979;&#20195;&#30721;&#23601;&#26159;&#22312;&#26700;&#38754;&#20013;&#36827;&#34892;&#32472;&#30011;&#65292;&#20855;&#20307;&#20195;&#30721;&#24847;&#24605;&#37117;&#22312;&#27880;&#37322;&#20013;&#20102;&#65292;&#19981;&#20102;&#35299;&#30340;&#21487;&#20197;&#22312;MSDN Library&#20013;&#26597;&#35810;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HWND hWnd; </code><code class="comments">// 窗口句柄</code></div>
<div class="line"><code class="plain">    HDC hDc; </code><code class="comments">// 设备上下文对象</code></div>
<div class="line"><code class="plain">    HPEN hPen; </code><code class="comments">// 画笔</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 设备对象，要绘画的位置</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置为NULL则表示在桌面中绘画</code></div>
<div class="line"><code class="plain">    hWnd = (HWND)NULL;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 获取设备的上下文对象（DC）</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">        语法格式：</code></div>
<div class="line"><code class="comments">        HDC GetDC(</code></div>
<div class="line"><code class="comments">            HWND hWnd   // handle to window</code></div>
<div class="line"><code class="comments">        );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    hDc = GetDC(hWnd);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 创建画笔，设置线条的属性</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">        语法格式：</code></div>
<div class="line"><code class="comments">        HPEN CreatePen(</code></div>
<div class="line"><code class="comments">            int fnPenStyle,    // pen style</code></div>
<div class="line"><code class="comments">            int nWidth,        // pen width</code></div>
<div class="line"><code class="comments">            COLORREF crColor   // pen color</code></div>
<div class="line"><code class="comments">        );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    hPen = CreatePen(PS_SOLID, </code><code class="value">5</code><code class="plain">, RGB(</code><code class="value">0xFF</code><code class="plain">,</code><code class="value">00</code><code class="plain">,</code><code class="value">00</code><code class="plain">)); </code><code class="comments">// RGB表示红绿蓝，红绿蓝的组合就可以组成新的一种颜色。</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 关联</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">        语法格式：</code></div>
<div class="line"><code class="comments">        HGDIOBJ SelectObject(</code></div>
<div class="line"><code class="comments">            HDC hdc,          // handle to DC</code></div>
<div class="line"><code class="comments">            HGDIOBJ hgdiobj   // handle to object</code></div>
<div class="line"><code class="comments">        );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    SelectObject(hDc, hPen);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 开始画线</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">        语法格式：</code></div>
<div class="line"><code class="comments">        BOOL LineTo(</code></div>
<div class="line"><code class="comments">            HDC hdc,    // device context handle</code></div>
<div class="line"><code class="comments">            int nXEnd,  // x-coordinate of ending point</code></div>
<div class="line"><code class="comments">            int nYEnd   // y-coordinate of ending point</code></div>
<div class="line"><code class="comments">        );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    LineTo(hDc, </code><code class="value">400</code><code class="plain">, </code><code class="value">400</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 释放资源</code></div>
<div class="line"><code class="plain">    DeleteObject(hPen);</code></div>
<div class="line"><code class="plain">    ReleaseDC(hWnd, hDc);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_21-32-45.png" alt="images/download/attachments/1015833/image2021-5-28_21-32-45.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5raI5oGv6Zif5YiX">
        <h1 class="heading "><span>&#28040;&#24687;&#38431;&#21015;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv5raI5oGv">
        <h2 class="heading "><span>&#20160;&#20040;&#26159;&#28040;&#24687;</span></h2>
<p   
>&#24403;&#25105;&#20204;&#28857;&#20987;&#40736;&#26631;&#30340;&#26102;&#20505;&#65292;&#25110;&#32773;&#24403;&#25105;&#20204;&#25353;&#19979;&#38190;&#30424;&#30340;&#26102;&#20505;&#65292;&#25805;&#20316;&#31995;&#32479;&#37117;&#35201;&#25226;&#36825;&#20123;&#21160;&#20316;&#35760;&#24405;&#19979;&#26469;&#65292;&#23384;&#20648;&#21040;&#19968;&#20010;&#32467;&#26500;&#20307;&#20013;&#65292;&#36825;&#20010;<strong class=" ">&#32467;&#26500;&#20307;</strong>&#23601;&#26159;&#28040;&#24687;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5raI5oGv6Zif5YiXLjE">
        <h2 class="heading "><span>&#28040;&#24687;&#38431;&#21015;</span></h2>
<p   
>&#27599;&#20010;&#32447;&#31243;&#21482;&#26377;&#19968;&#20010;&#28040;&#24687;&#38431;&#21015;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/plugins/servlet/confluence/placeholder/unknown-attachment.png" alt="images/plugins/servlet/confluence/placeholder/unknown-attachment.png"   />
        <br/><span class="caption">image2021-5-28_21-47-51.png?version=2&amp;modificationDate=1622209820000&amp;api=v2</span>
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt56qX5Y-j5LiO57q_56iL">
        <h2 class="heading "><span>&#31383;&#21475;&#19982;&#32447;&#31243;</span></h2>
<p   
>&#24403;&#25105;&#20204;&#25226;&#40736;&#26631;&#28857;&#20987;&#24038;&#36793;&#31383;&#21475;&#20851;&#38381;&#25353;&#38062;&#65292;&#20026;&#20160;&#20040;&#23427;&#20250;&#20851;&#38381;&#65292;&#36825;&#20010;&#20851;&#38381;&#65288;&#22352;&#26631;&#12289;&#24038;&#21491;&#38190;...&#65289;&#25805;&#20316;&#31995;&#32479;&#20250;&#23553;&#35013;&#21040;&#32467;&#26500;&#20307;&#37324;&#65288;&#28040;&#24687;&#65289;&#65292;&#37027;&#20040;&#36825;&#20010;&#28040;&#24687;&#22914;&#20309;&#31934;&#30830;&#30340;&#20256;&#36882;&#32473;&#23545;&#24212;&#36827;&#31243;&#30340;&#32447;&#31243;&#21602;&#65311;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_21-52-48.png" alt="images/download/attachments/1015833/image2021-5-28_21-52-48.png" width="600"  />
    </p>
<p   
>&#37027;&#26159;&#22240;&#20026;&#25805;&#20316;&#31995;&#32479;&#21487;&#20197;&#23558;&#22352;&#26631;&#20043;&#31867;&#30340;&#20316;&#20026;&#32034;&#24341;&#65292;&#21435;&#25214;&#21040;&#23545;&#24212;&#30340;&#31383;&#21475;&#65292;&#31383;&#21475;&#22312;&#20869;&#26680;&#20013;&#26159;&#26377;&#31383;&#21475;&#23545;&#35937;&#30340;&#65292;&#32780;&#36825;&#20010;&#31383;&#21475;&#23545;&#35937;&#23601;&#20250;&#21253;&#21547;&#19968;&#20010;&#25104;&#21592;&#65292;&#36825;&#20010;&#25104;&#21592;&#23601;&#26159;&#32447;&#31243;&#23545;&#35937;&#30340;&#25351;&#38024;&#65292;&#32447;&#31243;&#21448;&#21253;&#21547;&#20102;&#28040;&#24687;&#65292;&#25152;&#20197;&#36825;&#26679;&#19968;&#20010;&#39034;&#24207;&#23601;&#24456;&#23481;&#26131;&#29702;&#35299;&#20102;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-28_21-57-18.png" alt="images/download/attachments/1015833/image2021-5-28_21-57-18.png" width="600"  />
    </p>
<p   
>&#27880;&#24847;&#65306;&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#26377;&#22810;&#20010;&#31383;&#21475;&#65292;&#20294;&#26159;&#19968;&#20010;&#31383;&#21475;&#21482;&#23646;&#20110;&#19968;&#20010;&#32447;&#31243;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt56ys5LiA5LiqV2luZHdvc-eoi-W6jw">
        <h1 class="heading "><span>&#31532;&#19968;&#20010;Windwos&#31243;&#24207;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5paw5bu6V2luZG93c-eql-WPo-eoi-W6j-mhueebrg">
        <h2 class="heading "><span>&#26032;&#24314;Windows&#31383;&#21475;&#31243;&#24207;&#39033;&#30446;</span></h2>
<p   
>VC6&#26032;&#24314;&#24037;&#31243;&#65292;&#36873;&#25321;Win32 Application&#65292;&#19979;&#19968;&#27493;&#36873;&#25321;&#19968;&#20010;&#31616;&#21333;&#30340;Win32&#30340;&#31243;&#24207;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-30_22-6-47.png" alt="images/download/attachments/1015833/image2021-5-30_22-6-47.png" width="600"  />
    </p>
<p   
>&#25511;&#21046;&#21488;&#31243;&#24207;&#26159;&#20174;Main&#20989;&#25968;&#20026;&#20837;&#21475;&#24320;&#22987;&#25191;&#34892;&#30340;&#65292;&#32780;Win32&#31383;&#21475;&#31243;&#24207;&#26159;&#20174;WinMain&#20989;&#25968;&#24320;&#22987;&#25191;&#34892;&#30340;&#12290;</p>
<p   
>&#26032;&#24314;&#30340;&#39033;&#30446;&#37324;&#30340;&#22836;&#25991;&#20214;&#24050;&#32463;&#25226;&#38656;&#35201;&#29992;&#21040;&#30340;Windows.h&#22836;&#25991;&#20214;&#21253;&#21547;&#20102;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-5-30_22-7-34.png" alt="images/download/attachments/1015833/image2021-5-30_22-7-34.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItV2luTWFpbuWHveaVsA">
        <h2 class="heading "><span>WinMain&#20989;&#25968;</span></h2>
<p   
>WinMain&#20989;&#25968;&#20316;&#20026;Win32&#31383;&#21475;&#31243;&#24207;&#30340;&#20837;&#21475;&#20989;&#25968;&#65292;&#25105;&#20204;&#38656;&#35201;&#20102;&#35299;&#19968;&#19979;&#20854;&#20989;&#25968;&#30340;&#21442;&#25968;&#65292;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">int</code><code class="plain"> WINAPI WinMain(</code></div>
<div class="line"><code class="plain">  HINSTANCE hInstance,      </code><code class="comments">// handle to current instance</code></div>
<div class="line"><code class="plain">  HINSTANCE hPrevInstance,  </code><code class="comments">// handle to previous instance </code></div>
<div class="line"><code class="plain">  LPSTR lpCmdLine,          </code><code class="comments">// command line</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">int</code><code class="plain"> nCmdShow              </code><code class="comments">// show state</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#21442;&#25968;&#35299;&#37322;&#65306;</p>
<ol class=" "><li class=" "><p   
>HINSTANCE hInstance&#65292;&#36825;&#26159;&#19968;&#20010;&#21477;&#26564;&#65292;&#22312;Win32&#20013;H&#24320;&#22836;&#30340;&#36890;&#24120;&#37117;&#26159;&#21477;&#26564;&#65292;&#36825;&#37324;&#30340;HINSTANCE&#26159;&#25351;&#21521;&#27169;&#22359;&#30340;&#21477;&#26564;&#65292;&#23454;&#38469;&#19978;&#36825;&#20010;&#20540;&#23601;&#26159;&#27169;&#22359;&#22312;&#36827;&#31243;&#31354;&#38388;&#20869;&#30340;&#20869;&#23384;&#22320;&#22336;&#65307;</p>
</li><li class=" "><p   
>HINSTANCE hPrevInstance&#65292;&#35813;&#21442;&#25968;&#27704;&#36828;&#20026;&#31354;NULL&#65292;&#26080;&#38656;&#29702;&#35299;&#65307;</p>
</li><li class=" "><p   
>&#31532;&#19977;&#12289;&#31532;&#22235;&#20010;&#21442;&#25968;&#65288;LPSTR lpCmdLine&#12289;int nCmdShow&#65289;&#26159;&#30001;CreateProcess&#30340;LPTSTR lpCommandLine&#12289;LPSTARTUPINFO lpStartupInfo&#21442;&#25968;&#20256;&#36882;&#30340;&#12290;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6LCD6K-V5L-h5oGv6L6T5Ye6">
        <h2 class="heading "><span>&#35843;&#35797;&#20449;&#24687;&#36755;&#20986;</span></h2>
<p   
>&#25105;&#20204;&#22312;&#31383;&#21475;&#31243;&#24207;&#20013;&#24819;&#35201;&#36755;&#20986;&#20449;&#24687;&#23601;&#19981;&#21487;&#20197;&#20351;&#29992;printf&#20102;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#21478;&#22806;&#19968;&#20010;&#20989;&#25968;OutputDebugString&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">void</code><code class="plain"> OutputDebugString(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpOutputString</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#20256;&#21442;&#23601;&#26159;&#19968;&#20010;LPCTSTR&#31867;&#22411;&#65288;&#23383;&#31526;&#20018;&#65289;&#65292;&#20294;&#26159;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#36825;&#20010;&#20989;&#25968;&#21482;&#33021;&#25171;&#21360;&#22266;&#23450;&#23383;&#31526;&#20018;&#65292;&#19981;&#33021;&#25171;&#21360;&#26684;&#24335;&#21270;&#30340;&#23383;&#31526;&#20018;&#65292;&#25152;&#20197;&#22914;&#26524;&#38656;&#35201;&#26684;&#24335;&#21270;&#36755;&#20986;&#65292;&#38656;&#35201;&#22312;&#36825;&#20043;&#21069;&#20351;&#29992;sprintf&#20989;&#25968;&#36827;&#34892;&#26684;&#24335;&#21270;&#65288;&#33258;&#34892;&#26597;&#38405;&#65289;&#65292;&#36825;&#37324;&#25105;&#20204;&#21487;&#20197;&#23581;&#35797;&#36755;&#20986;&#24403;&#21069;&#27169;&#22359;&#30340;&#21477;&#26564;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> APIENTRY WinMain(HINSTANCE hInstance,</code></div>
<div class="line"><code class="plain">                     HINSTANCE hPrevInstance,</code></div>
<div class="line"><code class="plain">                     LPSTR     lpCmdLine,</code></div>
<div class="line"><code class="plain">                     </code><code class="keyword">int</code><code class="plain">       nCmdShow)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// TODO: Place code here.</code></div>
<div class="line"><code class="plain">    DWORD dwAddr = (DWORD)hInstance;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    sprintf(szOutBuff, </code><code class="string">"hInstance address: %x \n"</code><code class="plain">, dwAddr); </code><code class="comments">// 该函数需要包含stdio.h头文件</code></div>
<div class="line"><code class="plain">    OutputDebugString(szOutBuff);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36816;&#34892;&#35813;&#20195;&#30721;&#23601;&#20250;&#22312;Debug&#36755;&#20986;&#26694;&#20013;&#21457;&#29616;&#25171;&#21360;&#30340;&#23383;&#31526;&#20018;&#65292;&#36825;&#23601;&#26159;&#19968;&#20010;&#20869;&#23384;&#22320;&#22336;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_13-46-20.png" alt="images/download/attachments/1015833/image2021-6-1_13-46-20.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Yib5bu656qX5Y-j56iL5bqP">
        <h2 class="heading "><span>&#21019;&#24314;&#31383;&#21475;&#31243;&#24207;</span></h2>
<p   
>&#22914;&#19979;&#20195;&#30721;&#21019;&#24314;&#20102;&#19968;&#20010;&#31616;&#21333;&#30340;&#31383;&#21475;&#31243;&#24207;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// Windows.cpp : Defines the entry point for the application.</code></div>
<div class="line"><code class="comments">//</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 窗口函数定义</code></div>
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 必须要调用一个默认的消息处理函数，关闭、最小化、最大化都是由默认消息处理函数处理的</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> DefWindowProc(hwnd, uMsg, wParam, lParam);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> APIENTRY WinMain(HINSTANCE hInstance,</code></div>
<div class="line"><code class="plain">                     HINSTANCE hPrevInstance,</code></div>
<div class="line"><code class="plain">                     LPSTR     lpCmdLine,</code></div>
<div class="line"><code class="plain">                     </code><code class="keyword">int</code><code class="plain">       nCmdShow)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 定义创建的窗口(创建注册窗口类)</code></div>
<div class="line"><code class="plain">    TCHAR className[] = TEXT(</code><code class="string">"My First Window"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    WNDCLASS wndClass = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置窗口背景色</code></div>
<div class="line"><code class="plain">    wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置类名字</code></div>
<div class="line"><code class="plain">    wndClass.lpszClassName = className;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置模块地址</code></div>
<div class="line"><code class="plain">    wndClass.hInstance = hInstance;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 处理消息的窗口函数</code></div>
<div class="line"><code class="plain">    wndClass.lpfnWndProc = WindowProc; </code><code class="comments">// 不是调用函数，只是告诉操作系统，当前窗口对应的窗口回调函数是什么</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 注册窗口类</code></div>
<div class="line"><code class="plain">    RegisterClass(&amp;wndClass);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 创建并显示窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    CreateWindow 语法格式：</code></div>
<div class="line"><code class="comments">    HWND CreateWindow(</code></div>
<div class="line"><code class="comments">        LPCTSTR lpClassName,  // registered class name 类名字</code></div>
<div class="line"><code class="comments">        LPCTSTR lpWindowName, // window name 窗口名字</code></div>
<div class="line"><code class="comments">        DWORD dwStyle,        // window style 窗口外观的样式</code></div>
<div class="line"><code class="comments">        int x,                // horizontal position of window 相对于父窗口x坐标</code></div>
<div class="line"><code class="comments">        int y,                // vertical position of window 相对于父窗口y坐标</code></div>
<div class="line"><code class="comments">        int nWidth,           // window width 窗口宽度：像素</code></div>
<div class="line"><code class="comments">        int nHeight,          // window height 窗口长度：像素</code></div>
<div class="line"><code class="comments">        HWND hWndParent,      // handle to parent or owner window 父窗口句柄</code></div>
<div class="line"><code class="comments">        HMENU hMenu,          // menu handle or child identifier 菜单句柄</code></div>
<div class="line"><code class="comments">        HINSTANCE hInstance,  // handle to application instance 模块</code></div>
<div class="line"><code class="comments">        LPVOID lpParam        // window-creation data  附加数据</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    HWND hWnd = CreateWindow(className, TEXT(</code><code class="string">"窗口"</code><code class="plain">), WS_OVERLAPPEDWINDOW, </code><code class="value">10</code><code class="plain">, </code><code class="value">10</code><code class="plain">, </code><code class="value">600</code><code class="plain">, </code><code class="value">300</code><code class="plain">, NULL, NULL, hInstance, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hWnd == NULL) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 如果为NULL则窗口创建失败，输出错误信息</code></div>
<div class="line"><code class="plain">        sprintf(szOutBuff, </code><code class="string">"Error: %d"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 显示窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    ShowWindow 语法格式：</code></div>
<div class="line"><code class="comments">    BOOL ShowWindow(</code></div>
<div class="line"><code class="comments">        HWND hWnd,     // handle to window 窗口句柄</code></div>
<div class="line"><code class="comments">        int nCmdShow   // show state 显示的形式</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    ShowWindow(hWnd, SW_SHOW);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 接收消息并处理</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    GetMessage 语法格式：</code></div>
<div class="line"><code class="comments">    BOOL GetMessage(</code></div>
<div class="line"><code class="comments">        LPMSG lpMsg,         // message information OUT类型参数，这是一个指针</code></div>
<div class="line"><code class="comments">        // 后三个参数都是过滤条件</code></div>
<div class="line"><code class="comments">        HWND hWnd,           // handle to window 窗口句柄，如果为NULL则表示该线程中的所有消息都要</code></div>
<div class="line"><code class="comments">        UINT wMsgFilterMin,  // first message 第一条信息</code></div>
<div class="line"><code class="comments">        UINT wMsgFilterMax   // last message 最后一条信息</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    MSG msg;</code></div>
<div class="line"><code class="plain">    BOOL bRet;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain">( (bRet = GetMessage( &amp;msg, NULL, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain"> )) != </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    { </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (bRet == -</code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// handle the error and possibly exit</code></div>
<div class="line"><code class="plain">            sprintf(szOutBuff, </code><code class="string">"Error: %d"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">            OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 转换消息</code></div>
<div class="line"><code class="plain">            TranslateMessage(&amp;msg);</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 分发消息：就是给系统调用窗口处理函数</code></div>
<div class="line"><code class="plain">            DispatchMessage(&amp;msg);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#26159;&#31383;&#21475;&#31243;&#24207;&#21019;&#24314;&#25191;&#34892;&#27969;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_14-34-8.png" alt="images/download/attachments/1015833/image2021-6-1_14-34-8.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5raI5oGv57G75Z6L">
        <h1 class="heading "><span>&#28040;&#24687;&#31867;&#22411;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5raI5oGv55qE5Lqn55Sf5LiO5aSE55CG5rWB56iL">
        <h2 class="heading "><span>&#28040;&#24687;&#30340;&#20135;&#29983;&#19982;&#22788;&#29702;&#27969;&#31243;</span></h2>
<p   
>&#28040;&#24687;&#30340;&#20135;&#29983;&#19982;&#22788;&#29702;&#27969;&#31243;&#65292;&#20174;&#28040;&#24687;&#21457;&#36215;&#36825;&#20010;&#28857;&#24320;&#22987;&#35828;&#65292;&#20551;&#35774;&#25105;&#20204;&#28857;&#20987;&#20102;&#26576;&#20010;&#31383;&#21475;&#26102;&#23601;&#20250;&#20135;&#29983;&#19968;&#20010;&#28040;&#24687;&#65292;&#25805;&#20316;&#31995;&#32479;&#24471;&#21040;&#36825;&#20010;&#28040;&#24687;&#21518;&#20808;&#21028;&#26029;&#24403;&#21069;&#28857;&#20987;&#30340;&#26159;&#21738;&#20010;&#31383;&#21475;&#65292;&#25214;&#21040;&#23545;&#24212;&#30340;&#31383;&#21475;&#23545;&#35937;&#65292;&#20877;&#26681;&#25454;&#31383;&#21475;&#23545;&#35937;&#30340;&#37324;&#30340;&#26576;&#19968;&#20010;&#25104;&#21592;&#25214;&#21040;&#23545;&#24212;&#32447;&#31243;&#65292;&#19968;&#26086;&#25214;&#21040;&#20102;&#23545;&#24212;&#32447;&#31243;&#65292;&#25805;&#20316;&#31995;&#32479;&#23601;&#20250;&#25226;&#23553;&#35013;&#22909;&#30340;&#28040;&#24687;&#65288;&#36825;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#21253;&#21547;&#20102;&#20320;&#40736;&#26631;&#28857;&#20987;&#30340;&#22352;&#26631;&#31561;&#31561;&#28040;&#24687;&#65289;&#23384;&#21040;&#23545;&#24212;&#30340;&#28040;&#24687;&#38431;&#21015;&#37324;&#65292;&#24212;&#29992;&#31243;&#24207;&#23601;&#20250;&#36890;&#36807;GetMessage&#19981;&#20572;&#30340;&#20174;&#28040;&#24687;&#38431;&#21015;&#20013;&#21462;&#28040;&#24687;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_14-46-15.png" alt="images/download/attachments/1015833/image2021-6-1_14-46-15.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5raI5oGv57uT5p6E5L2T">
        <h2 class="heading "><span>&#28040;&#24687;&#32467;&#26500;&#20307;</span></h2>
<p   
>&#25105;&#20204;&#26159;&#36890;&#36807;GetMessage&#20989;&#25968;&#25509;&#25910;&#28040;&#24687;&#30340;&#65292;&#20854;&#31532;&#19968;&#20010;&#21442;&#25968;&#23601;&#26159;&#25509;&#25910;&#30340;&#28040;&#24687;&#65288;&#32467;&#26500;&#20307;&#65289;&#65292;&#25152;&#20197;&#21487;&#20197;&#22312;&#20043;&#21069;&#30340;<strong class=" ">&#20195;&#30721;&#20013;&#36873;&#20013;MSG&#28982;&#21518;F12</strong>&#36319;&#36827;&#30475;&#19968;&#19979;&#28040;&#24687;&#32467;&#26500;&#20307;&#30340;&#23450;&#20041;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_14-48-40.png" alt="images/download/attachments/1015833/image2021-6-1_14-48-40.png" width="600"  />
    </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct tagMSG {</code></div>
<div class="line"><code class="plain">  HWND   hwnd;      </code><code class="comments">// 所属窗口句柄</code></div>
<div class="line"><code class="plain">  UINT   message;   </code><code class="comments">// 消息类型：编号</code></div>
<div class="line"><code class="plain">  WPARAM wParam;    </code><code class="comments">// 附加数据，进一步描述消息的</code></div>
<div class="line"><code class="plain">  LPARAM lParam;    </code><code class="comments">// 附加数据，进一步描述消息的</code></div>
<div class="line"><code class="plain">  DWORD  time;      </code><code class="comments">// 消息产生的时间</code></div>
<div class="line"><code class="plain">  POINT  pt;        </code><code class="comments">// 在哪里产生的</code></div>
<div class="line"><code class="plain">} MSG, *PMSG; </code></div>
</div>
    </div>
<p   
>&#33021;&#20135;&#29983;&#28040;&#24687;&#30340;&#24773;&#20917;&#26377;&#22235;&#31181;&#24773;&#20917;&#65306;<strong class=" ">1. &#38190;&#30424; 2. &#40736;&#26631; 3. &#20854;&#20182;&#24212;&#29992;&#31243;&#24207; 4. &#25805;&#20316;&#31995;&#32479;&#20869;&#26680;&#31243;&#24207;</strong>&#65292;&#26377;&#36825;&#20040;&#22810;&#28040;&#24687;&#35201;&#22788;&#29702;&#65292;&#25152;&#20197;&#25805;&#20316;&#31995;&#32479;&#20250;&#23558;&#25152;&#26377;&#28040;&#24687;&#21306;&#20998;&#31867;&#21035;&#65292;&#27599;&#20010;&#28040;&#24687;&#37117;&#26377;&#29420;&#19968;&#26080;&#20108;&#30340;&#32534;&#21495;&#12290;</p>
<p   
>&#28040;&#24687;&#36825;&#20010;&#32467;&#26500;&#20307;&#23384;&#20648;&#30340;&#20449;&#24687;&#20063;&#19981;&#22810;&#65292;&#21482;&#33021;&#30693;&#36947;&#28040;&#24687;&#23646;&#20110;&#21738;&#20010;&#31383;&#21475;&#65292;&#26681;&#26412;&#19981;&#30693;&#36947;&#23545;&#24212;&#31383;&#21475;&#20989;&#25968;&#26159;&#20160;&#20040;&#65292;&#25152;&#20197;&#25105;&#20204;&#19981;&#24471;&#19981;&#22312;&#20043;&#21518;&#23545;&#28040;&#24687;&#36827;&#34892;&#20998;&#21457;&#65288;DispatchMessage&#20989;&#25968;&#65289;&#65292;&#32780;&#21518;&#30001;&#20869;&#26680;&#21457;&#36215;&#35843;&#29992;&#26469;&#25191;&#34892;&#31383;&#21475;&#20989;&#25968;&#12290;</p>
<p   
>&#25442;&#32780;&#35328;&#20043;&#65292;&#25105;&#20204;&#36825;&#20010;&#28040;&#24687;&#30340;&#32467;&#26500;&#20307;&#23454;&#38469;&#19978;&#23601;&#26159;<strong class=" ">&#20256;&#36882;&#32473;&#20102;&#31383;&#21475;&#20989;&#25968;</strong>&#65292;<strong class=" ">&#20854;&#22235;&#20010;&#21442;&#25968;&#23545;&#24212;&#30528;&#28040;&#24687;&#32467;&#26500;&#20307;&#30340;&#21069;&#22235;&#20010;&#25104;&#21592;</strong>&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5raI5oGv57G75Z6LLjE">
        <h2 class="heading "><span>&#28040;&#24687;&#31867;&#22411;</span></h2>
<p   
>&#25105;&#20204;&#24819;&#35201;&#20851;&#27880;&#33258;&#24049;&#24819;&#35201;&#20851;&#27880;&#30340;&#28040;&#24687;&#31867;&#22411;&#65292;&#39318;&#20808;&#21487;&#20197;&#22312;&#31383;&#21475;&#20989;&#25968;&#20013;&#25171;&#21360;&#28040;&#24687;&#31867;&#22411;&#26469;&#30475;&#30475;&#37117;&#26377;&#20160;&#20040;&#28040;&#24687;&#31867;&#22411;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 窗口函数定义</code></div>
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    sprintf(szOutBuff, </code><code class="string">"Message: %x - %x \n"</code><code class="plain">, hwnd, uMsg);</code></div>
<div class="line"><code class="plain">    OutputDebugString(szOutBuff);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 必须要调用一个默认的消息处理函数，关闭、最小化、最大化都是由默认消息处理函数处理的</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> DefWindowProc(hwnd, uMsg, wParam, lParam);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_23-41-40.png" alt="images/download/attachments/1015833/image2021-6-1_23-41-40.png" width="600"  />
    </p>
<p   
>&#21487;&#20197;&#30475;&#35265;&#36825;&#36793;&#36755;&#20986;&#20102;&#19968;&#20010;0x1&#65292;&#24819;&#35201;&#30693;&#36947;&#36825;&#20010;&#23545;&#24212;&#30528;&#20160;&#20040;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;<strong class=" ">C:\Program Files\Microsoft Visual Studio\VC98\Include</strong>&#30446;&#24405;&#20013;&#25214;&#21040;<strong class=" ">WINUSER.H</strong>&#36825;&#20010;&#25991;&#20214;&#26469;&#26597;&#30475;&#65292;&#25628;&#32034;0x0001&#23601;&#21487;&#20197;&#25214;&#21040;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-1_23-46-11.png" alt="images/download/attachments/1015833/image2021-6-1_23-46-11.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23545;&#24212;&#30340;&#23439;&#23601;&#26159;<strong class=" ">WM_CREATE</strong>&#65292;&#36825;&#20010;&#28040;&#24687;&#30340;&#24847;&#24605;&#23601;&#26159;&#31383;&#21475;&#21019;&#24314;&#65292;&#25152;&#20197;&#25105;&#20204;&#26377;&#24456;&#22810;&#28040;&#24687;&#26159;&#19981;&#38656;&#35201;&#20851;&#27880;&#30340;&#65292;&#32780;&#19988;&#28040;&#24687;&#26102;&#21051;&#37117;&#22312;&#20135;&#29983;&#65292;&#38750;&#24120;&#38750;&#24120;&#22810;&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5aSE55CG56qX5Y-j5YWz6Zet">
        <h3 class="heading "><span>&#22788;&#29702;&#31383;&#21475;&#20851;&#38381;</span></h3>
<p   
>&#22312;&#31383;&#21475;&#20851;&#38381;&#26102;&#65292;&#23454;&#38469;&#19978;&#36827;&#31243;&#24182;&#19981;&#20250;&#20851;&#38381;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#22312;&#31383;&#21475;&#20989;&#25968;&#20013;&#31579;&#36873;&#26465;&#20214;&#65292;&#24403;&#31383;&#21475;&#20851;&#38381;&#20102;&#23601;&#36864;&#20986;&#36827;&#31243;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 窗口函数定义</code></div>
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">switch</code><code class="plain">(uMsg) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 当窗口关闭则退出进程</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> WM_DESTROY:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            PostQuitMessage(</code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 必须要调用一个默认的消息处理函数，关闭、最小化、最大化都是由默认消息处理函数处理的</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> DefWindowProc(hwnd, uMsg, wParam, lParam);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5aSE55CG6ZSu55uY5oyJ5LiL">
        <h3 class="heading "><span>&#22788;&#29702;&#38190;&#30424;&#25353;&#19979;</span></h3>
<p   
>&#25105;&#20204;&#38500;&#20102;&#21487;&#20197;&#22788;&#29702;&#31383;&#21475;&#20851;&#38381;&#65292;&#22788;&#29702;&#38190;&#30424;&#25353;&#19979;&#20063;&#26159;&#27809;&#38382;&#39064;&#30340;&#65292;&#38190;&#30424;&#25353;&#19979;&#30340;&#23439;&#26159;WM_KEYDOWN&#65292;&#20294;&#26159;&#25105;&#20204;&#24819;&#35201;&#25353;&#19979;a&#36825;&#20010;&#38190;&#20043;&#21518;&#25165;&#22788;&#29702;&#35813;&#24590;&#20040;&#21150;&#65311;&#39318;&#20808;&#25105;&#20204;&#38656;&#35201;&#26597;&#38405;&#19968;&#19979;MSDN Library&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(</code></div>
<div class="line"><code class="plain">  HWND hwnd,       </code><code class="comments">// handle to window</code></div>
<div class="line"><code class="plain">  UINT uMsg,       </code><code class="comments">// WM_KEYDOWN</code></div>
<div class="line"><code class="plain">  WPARAM wParam,   </code><code class="comments">// virtual-key code</code></div>
<div class="line"><code class="plain">  LPARAM lParam    </code><code class="comments">// key data</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#21487;&#20197;&#24456;&#28165;&#26970;&#30340;&#30475;&#35265;&#31383;&#21475;&#20989;&#25968;&#30340;&#31532;&#19977;&#20010;&#21442;&#25968;&#23601;&#26159;&#34394;&#25311;&#38190;&#30721;&#65288;&#38190;&#30424;&#19978;&#27599;&#20010;&#38190;&#37117;&#23545;&#24212;&#19968;&#20010;&#34394;&#25311;&#38190;&#30721;&#65289;&#65292;&#25105;&#20204;&#21487;&#20197;&#36755;&#20986;&#19979;&#25353;&#19979;a&#65292;&#20854;&#23545;&#24212;&#34394;&#25311;&#38190;&#30721;&#26159;&#20160;&#20040;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 窗口函数定义</code></div>
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">switch</code><code class="plain">(uMsg) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 当键盘按下则处理</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> WM_KEYDOWN:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"><code class="plain">            sprintf(szOutBuff, </code><code class="string">"keycode: %x \n"</code><code class="plain">, wParam);</code></div>
<div class="line"><code class="plain">            OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 必须要调用一个默认的消息处理函数，关闭、最小化、最大化都是由默认消息处理函数处理的</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> DefWindowProc(hwnd, uMsg, wParam, lParam);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_0-10-19.png" alt="images/download/attachments/1015833/image2021-6-2_0-10-19.png" width="600"  />
    </p>
<p   
>&#22914;&#19978;&#22270;&#25152;&#31034;&#65292;&#25353;&#19979;a&#20043;&#21518;&#36755;&#20986;&#30340;&#34394;&#25311;&#38190;&#30721;&#26159;0x41&#65292;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#26681;&#25454;&#36825;&#20010;&#26469;&#36827;&#34892;&#21028;&#26029;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6L2s5o2i5raI5oGv">
        <h2 class="heading "><span>&#36716;&#25442;&#28040;&#24687;</span></h2>
<p   
>&#20043;&#21069;&#25105;&#20204;&#20030;&#20363;&#21487;&#20197;&#22788;&#29702;&#38190;&#30424;&#25353;&#19979;&#30340;&#28040;&#24687;&#65292;&#20294;&#26159;&#25105;&#20204;&#24819;&#35201;&#30452;&#35266;&#30340;&#30475;&#21040;&#24213;&#36755;&#20837;&#20102;&#20160;&#20040;&#32780;&#19981;&#26159;&#34394;&#25311;&#38190;&#30721;&#35813;&#24590;&#20040;&#21150;&#65311;&#36825;&#26102;&#20505;&#25105;&#20204;&#23601;&#38656;&#35201;&#20351;&#29992;WM_CHAR&#36825;&#20010;&#23439;&#20102;&#65292;&#20294;&#26159;&#22312;&#36825;&#20043;&#21069;&#65292;&#25105;&#20204;&#30340;&#28040;&#24687;&#26159;&#24517;&#39035;&#35201;&#32463;&#36807;&#36716;&#25442;&#30340;&#65292;&#21482;&#26377;&#20854;&#36716;&#25442;&#20102;&#65292;&#25105;&#20204;&#30340;&#34394;&#25311;&#38190;&#30721;&#25165;&#33021;&#21464;&#25104;&#20855;&#20307;&#30340;&#23383;&#31526;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_0-17-29.png" alt="images/download/attachments/1015833/image2021-6-2_0-17-29.png" width="600"  />
    </p>
<p   
>WM_CHAR&#23439;&#23545;&#24212;&#30340;&#31383;&#21475;&#20989;&#25968;&#21442;&#25968;&#20316;&#29992;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(</code></div>
<div class="line"><code class="plain">  HWND hwnd,       </code><code class="comments">// handle to window</code></div>
<div class="line"><code class="plain">  UINT uMsg,       </code><code class="comments">// WM_CHAR</code></div>
<div class="line"><code class="plain">  WPARAM wParam,   </code><code class="comments">// character code (TCHAR)</code></div>
<div class="line"><code class="plain">  LPARAM lParam    </code><code class="comments">// key data</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31532;&#19977;&#20010;&#21442;&#25968;&#23601;&#26159;&#23383;&#31526;&#25152;&#20197;&#25105;&#20204;&#30452;&#25509;&#36755;&#20986;&#36825;&#20010;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_0-16-57.png" alt="images/download/attachments/1015833/image2021-6-2_0-16-57.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5a2Q56qX5Y-j5o6n5Lu2">
        <h1 class="heading "><span>&#23376;&#31383;&#21475;&#25511;&#20214;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YWz5LqO5a2Q56qX5Y-j5o6n5Lu2">
        <h2 class="heading "><span>&#20851;&#20110;&#23376;&#31383;&#21475;&#25511;&#20214;</span></h2>
<ol class=" "><li class=" "><p   
>Windows&#25552;&#20379;&#20102;&#20960;&#20010;&#39044;&#23450;&#20041;&#30340;&#31383;&#21475;&#31867;&#20197;&#26041;&#20415;&#25105;&#20204;&#30340;&#20351;&#29992;&#65292;&#25105;&#20204;&#19968;&#33324;&#21483;&#23427;&#20204;&#20026;&#23376;&#31383;&#21475;&#25511;&#20214;&#65292;&#31616;&#31216;&#25511;&#20214;&#65307;</p>
</li><li class=" "><p   
>&#25511;&#20214;&#20250;&#33258;&#24049;&#22788;&#29702;&#28040;&#24687;&#65292;&#24182;&#22312;&#33258;&#24049;&#29366;&#24577;&#21457;&#29983;&#25913;&#21464;&#26102;&#36890;&#30693;&#29238;&#31383;&#21475;&#65307;</p>
</li><li class=" "><p   
>&#39044;&#23450;&#20041;&#30340;&#25511;&#20214;&#26377;&#65306;&#25353;&#38062;&#12289;&#22797;&#36873;&#26694;&#12289;&#32534;&#36753;&#26694;&#12289;&#38745;&#24577;&#23383;&#31526;&#20018;&#26631;&#31614;&#21644;&#28378;&#21160;&#26465;&#31561;&#12290;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Yib5bu657yW6L6R5qGG5ZKM5oyJ6ZKu">
        <h2 class="heading "><span>&#21019;&#24314;&#32534;&#36753;&#26694;&#21644;&#25353;&#38062;</span></h2>
<p   
>&#25105;&#20204;&#24819;&#20351;&#29992;&#23376;&#31383;&#21475;&#25511;&#20214;&#21487;&#20197;&#20351;&#29992;CreateWindow&#20989;&#25968;&#26469;&#21019;&#24314;&#65292;&#21019;&#24314;&#20301;&#32622;&#25105;&#20204;&#21487;&#20197;&#36873;&#22312;&#31383;&#21475;&#20989;&#25968;&#20013;&#65292;&#24403;&#31383;&#21475;&#21019;&#24314;&#21017;&#24320;&#22987;&#21019;&#24314;&#23376;&#31383;&#21475;&#25511;&#20214;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// Windows.cpp : Defines the entry point for the application.</code></div>
<div class="line"><code class="comments">//</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"><code class="comments">// 定义子窗口标识</code></div>
<div class="line"><code class="plain">#define CWA_EDIT </code><code class="value">0x100</code></div>
<div class="line"><code class="plain">#define CWA_BUTTON_0 </code><code class="value">0x101</code></div>
<div class="line"><code class="plain">#define CWA_BUTTON_1 </code><code class="value">0x102</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 定义全局模块</code></div>
<div class="line"><code class="plain">HINSTANCE gHinstance;</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="comments">// 窗口函数定义</code></div>
<div class="line"><code class="plain">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">switch</code><code class="plain"> (uMsg) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 当键盘按下则处理</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> WM_CHAR:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"><code class="plain">            sprintf(szOutBuff, </code><code class="string">"keycode: %c \n"</code><code class="plain">, wParam);</code></div>
<div class="line"><code class="plain">            OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 当窗口创建则开始创建子窗口控件</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> WM_CREATE:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 创建编辑框</code></div>
<div class="line"><code class="plain">            CreateWindow(</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">"EDIT"</code><code class="plain">),  </code><code class="comments">// registered class name 注册的类名，使用EDIT则为编辑框</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">""</code><code class="plain">), </code><code class="comments">// window name 窗口名称</code></div>
<div class="line"><code class="plain">                WS_CHILD | WS_VISIBLE | WS_VSCROLL | ES_MULTILINE,        </code><code class="comments">// window style 子窗口控件样式：子窗口、创建后可以看到、滚动条、自动换行</code></div>
<div class="line"><code class="plain">                </code><code class="value">0</code><code class="plain">,                </code><code class="comments">// horizontal position of window 在父窗口上的x坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">0</code><code class="plain">,                </code><code class="comments">// vertical position of window 在父窗口上的y坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">400</code><code class="plain">,           </code><code class="comments">// window width 控件宽度</code></div>
<div class="line"><code class="plain">                </code><code class="value">300</code><code class="plain">,          </code><code class="comments">// window height 控件高度</code></div>
<div class="line"><code class="plain">                hwnd,      </code><code class="comments">// menu handle or child identifier 父窗口句柄</code></div>
<div class="line"><code class="plain">                (HMENU)CWA_EDIT,          </code><code class="comments">// menu handle or child identifier 子窗口标识</code></div>
<div class="line"><code class="plain">                gHinstance,  </code><code class="comments">// handle to application instance 模块</code></div>
<div class="line"><code class="plain">                NULL        </code><code class="comments">// window-creation data 附加数据</code></div>
<div class="line"><code class="plain">            );</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="comments">// 创建"设置"按钮</code></div>
<div class="line"><code class="plain">            CreateWindow(</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">"BUTTON"</code><code class="plain">),  </code><code class="comments">// registered class name 注册的类名，使用BUTTON则为按钮</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">"设置"</code><code class="plain">), </code><code class="comments">// window name 按钮名称</code></div>
<div class="line"><code class="plain">                WS_CHILD | WS_VISIBLE,        </code><code class="comments">// window style 子窗口控件样式：子窗口、创建后可以看到</code></div>
<div class="line"><code class="plain">                </code><code class="value">450</code><code class="plain">,                </code><code class="comments">// horizontal position of window 在父窗口上的x坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">150</code><code class="plain">,                </code><code class="comments">// vertical position of window 在父窗口上的y坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">80</code><code class="plain">,           </code><code class="comments">// window width 控件宽度</code></div>
<div class="line"><code class="plain">                </code><code class="value">20</code><code class="plain">,          </code><code class="comments">// window height 控件高度</code></div>
<div class="line"><code class="plain">                hwnd,      </code><code class="comments">// menu handle or child identifier 父窗口句柄</code></div>
<div class="line"><code class="plain">                (HMENU)CWA_BUTTON_0,          </code><code class="comments">// menu handle or child identifier 子窗口标识</code></div>
<div class="line"><code class="plain">                gHinstance,  </code><code class="comments">// handle to application instance 模块</code></div>
<div class="line"><code class="plain">                NULL        </code><code class="comments">// window-creation data 附加数据</code></div>
<div class="line"><code class="plain">            );</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="comments">// 创建"获取"按钮</code></div>
<div class="line"><code class="plain">            CreateWindow(</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">"BUTTON"</code><code class="plain">),  </code><code class="comments">// registered class name 注册的类名，使用BUTTON则为按钮</code></div>
<div class="line"><code class="plain">                TEXT(</code><code class="string">"获取"</code><code class="plain">), </code><code class="comments">// window name 按钮名称</code></div>
<div class="line"><code class="plain">                WS_CHILD | WS_VISIBLE,        </code><code class="comments">// window style 子窗口控件样式：子窗口、创建后可以看到</code></div>
<div class="line"><code class="plain">                </code><code class="value">450</code><code class="plain">,                </code><code class="comments">// horizontal position of window 在父窗口上的x坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">100</code><code class="plain">,                </code><code class="comments">// vertical position of window 在父窗口上的y坐标</code></div>
<div class="line"><code class="plain">                </code><code class="value">80</code><code class="plain">,           </code><code class="comments">// window width 控件宽度</code></div>
<div class="line"><code class="plain">                </code><code class="value">20</code><code class="plain">,          </code><code class="comments">// window height 控件高度</code></div>
<div class="line"><code class="plain">                hwnd,      </code><code class="comments">// menu handle or child identifier 父窗口句柄</code></div>
<div class="line"><code class="plain">                (HMENU)CWA_BUTTON_1,          </code><code class="comments">// menu handle or child identifier 子窗口标识</code></div>
<div class="line"><code class="plain">                gHinstance,  </code><code class="comments">// handle to application instance 模块</code></div>
<div class="line"><code class="plain">                NULL        </code><code class="comments">// window-creation data 附加数据</code></div>
<div class="line"><code class="plain">            );</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 当按钮点击则处理</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> WM_COMMAND:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 宏WM_COMMAND中，wParam参数的低16位中有标识，根据标识我们才能判断哪个按钮和编辑框，使用LOWORD()可以获取低16位</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">switch</code><code class="plain"> (LOWORD(wParam)) {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 当按钮为设置</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> CWA_BUTTON_0:</code></div>
<div class="line"><code class="plain">                {</code></div>
<div class="line"><code class="plain">                    </code><code class="comments">// SetDlgItemText函数修改编辑框内容</code></div>
<div class="line"><code class="plain">                    SetDlgItemText(hwnd, (</code><code class="keyword">int</code><code class="plain">)CWA_EDIT, TEXT(</code><code class="string">"HACK THE WORLD"</code><code class="plain">));</code></div>
<div class="line"><code class="plain">                    </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">                }</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 当按钮为获取</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> CWA_BUTTON_1:</code></div>
<div class="line"><code class="plain">                {</code></div>
<div class="line"><code class="plain">                    </code><code class="comments">// MessageBox弹框输出编辑框内容</code></div>
<div class="line"><code class="plain">                    TCHAR szEditBuffer[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"><code class="plain">                    GetDlgItemText(hwnd, (</code><code class="keyword">int</code><code class="plain">)CWA_EDIT, szEditBuffer, </code><code class="value">0x80</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                    MessageBox(NULL, szEditBuffer, NULL, NULL);</code></div>
<div class="line"><code class="plain">                    </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">                }</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 必须要调用一个默认的消息处理函数，关闭、最小化、最大化都是由默认消息处理函数处理的</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> DefWindowProc(hwnd, uMsg, wParam, lParam);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> APIENTRY WinMain(HINSTANCE hInstance,</code></div>
<div class="line"><code class="plain">                     HINSTANCE hPrevInstance,</code></div>
<div class="line"><code class="plain">                     LPSTR     lpCmdLine,</code></div>
<div class="line"><code class="plain">                     </code><code class="keyword">int</code><code class="plain">       nCmdShow)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">char</code><code class="plain"> szOutBuff[</code><code class="value">0x80</code><code class="plain">];</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 定义创建的窗口(创建注册窗口类)</code></div>
<div class="line"><code class="plain">    TCHAR className[] = TEXT(</code><code class="string">"My First Window"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    WNDCLASS wndClass = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置窗口背景色</code></div>
<div class="line"><code class="plain">    wndClass.hbrBackground = (HBRUSH)COLOR_BACKGROUND;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置类名字</code></div>
<div class="line"><code class="plain">    wndClass.lpszClassName = className;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置模块地址</code></div>
<div class="line"><code class="plain">    gHinstance = hInstance;</code></div>
<div class="line"><code class="plain">    wndClass.hInstance = hInstance;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 处理消息的窗口函数</code></div>
<div class="line"><code class="plain">    wndClass.lpfnWndProc = WindowProc; </code><code class="comments">// 不是调用函数，只是告诉操作系统，当前窗口对应的窗口回调函数是什么</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 注册窗口类</code></div>
<div class="line"><code class="plain">    RegisterClass(&amp;wndClass);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 创建并显示窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    CreateWindow 语法格式：</code></div>
<div class="line"><code class="comments">    HWND CreateWindow(</code></div>
<div class="line"><code class="comments">        LPCTSTR lpClassName,  // registered class name 类名字</code></div>
<div class="line"><code class="comments">        LPCTSTR lpWindowName, // window name 窗口名字</code></div>
<div class="line"><code class="comments">        DWORD dwStyle,        // window style 窗口外观的样式</code></div>
<div class="line"><code class="comments">        int x,                // horizontal position of window 相对于父窗口x坐标</code></div>
<div class="line"><code class="comments">        int y,                // vertical position of window 相对于父窗口y坐标</code></div>
<div class="line"><code class="comments">        int nWidth,           // window width 窗口宽度：像素</code></div>
<div class="line"><code class="comments">        int nHeight,          // window height 窗口长度：像素</code></div>
<div class="line"><code class="comments">        HWND hWndParent,      // handle to parent or owner window 父窗口句柄</code></div>
<div class="line"><code class="comments">        HMENU hMenu,          // menu handle or child identifier 菜单句柄</code></div>
<div class="line"><code class="comments">        HINSTANCE hInstance,  // handle to application instance 模块</code></div>
<div class="line"><code class="comments">        LPVOID lpParam        // window-creation data  附加数据</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    HWND hWnd = CreateWindow(className, TEXT(</code><code class="string">"窗口"</code><code class="plain">), WS_OVERLAPPEDWINDOW, </code><code class="value">10</code><code class="plain">, </code><code class="value">10</code><code class="plain">, </code><code class="value">600</code><code class="plain">, </code><code class="value">300</code><code class="plain">, NULL, NULL, hInstance, NULL);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hWnd == NULL) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 如果为NULL则窗口创建失败，输出错误信息</code></div>
<div class="line"><code class="plain">        sprintf(szOutBuff, </code><code class="string">"Error: %d"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 显示窗口</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    ShowWindow 语法格式：</code></div>
<div class="line"><code class="comments">    BOOL ShowWindow(</code></div>
<div class="line"><code class="comments">        HWND hWnd,     // handle to window 窗口句柄</code></div>
<div class="line"><code class="comments">        int nCmdShow   // show state 显示的形式</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    ShowWindow(hWnd, SW_SHOW);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 接收消息并处理</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    GetMessage 语法格式：</code></div>
<div class="line"><code class="comments">    BOOL GetMessage(</code></div>
<div class="line"><code class="comments">        LPMSG lpMsg,         // message information OUT类型参数，这是一个指针</code></div>
<div class="line"><code class="comments">        // 后三个参数都是过滤条件</code></div>
<div class="line"><code class="comments">        HWND hWnd,           // handle to window 窗口句柄，如果为NULL则表示该线程中的所有消息都要</code></div>
<div class="line"><code class="comments">        UINT wMsgFilterMin,  // first message 第一条信息</code></div>
<div class="line"><code class="comments">        UINT wMsgFilterMax   // last message 最后一条信息</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    MSG msg;</code></div>
<div class="line"><code class="plain">    BOOL bRet;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain">( (bRet = GetMessage( &amp;msg, NULL, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain"> )) != </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    { </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (bRet == -</code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// handle the error and possibly exit</code></div>
<div class="line"><code class="plain">            sprintf(szOutBuff, </code><code class="string">"Error: %d"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">            OutputDebugString(szOutBuff);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 转换消息</code></div>
<div class="line"><code class="plain">            TranslateMessage(&amp;msg);</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 分发消息：就是给系统调用窗口处理函数</code></div>
<div class="line"><code class="plain">            DispatchMessage(&amp;msg);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36816;&#34892;&#32467;&#26524;&#22914;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_1-25-5.png" alt="images/download/attachments/1015833/image2021-6-2_1-25-5.png" width="600"  />
    </p>
<p   
>Windows&#39044;&#23450;&#20041;&#30340;&#31383;&#21475;&#31867;&#21487;&#20197;&#22312;MSDN Library&#30340;CreateWindow&#20989;&#25968;&#19979;&#38754;&#25214;&#21040;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_0-55-43.png" alt="images/download/attachments/1015833/image2021-6-2_0-55-43.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6Jma5ouf5YaF5a2Y5LiO54mp55CG5YaF5a2Y">
        <h1 class="heading "><span>&#34394;&#25311;&#20869;&#23384;&#19982;&#29289;&#29702;&#20869;&#23384;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6Jma5ouf5YaF5a2Y5LiO54mp55CG5YaF5a2Y55qE5YWz57O7">
        <h2 class="heading "><span>&#34394;&#25311;&#20869;&#23384;&#19982;&#29289;&#29702;&#20869;&#23384;&#30340;&#20851;&#31995;</span></h2>
<p   
>&#27599;&#20010;&#36827;&#31243;&#37117;&#26377;&#33258;&#24049;&#30340;4GB&#20869;&#23384;&#65292;&#20294;&#26159;&#36825;&#20010;4GB&#20869;&#23384;&#24182;&#19981;&#26159;&#30495;&#23454;&#23384;&#22312;&#30340;&#65292;&#32780;&#26159;&#19968;&#22359;&#34394;&#25311;&#20869;&#23384;&#12290;</p>
<p   
>&#22312;&#36827;&#31243;A&#30340;0x12345678&#20869;&#23384;&#22320;&#22336;&#20013;&#23384;&#20837;&#19968;&#20010;&#20540;&#65292;&#22312;&#36827;&#31243;B&#30340;0x12345678&#20869;&#23384;&#22320;&#22336;&#20013;&#20063;&#23384;&#20837;&#19968;&#20010;&#20540;&#65292;&#20004;&#32773;&#24182;&#19981;&#20250;&#20914;&#31361;&#65292;&#32780;&#26159;&#21508;&#33258;&#23384;&#25918;&#21508;&#33258;&#30340;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_16-45-14.png" alt="images/download/attachments/1015833/image2021-6-2_16-45-14.png" width="600"  />
    </p>
<p   
>&#20294;&#26159;&#23384;&#25918;&#30340;&#36825;&#20010;&#20540;&#26159;&#23384;&#25918;&#22312;&#29289;&#29702;&#20869;&#23384;&#19978;&#30340;&#65292;&#25152;&#20197;&#36825;&#37324;&#30340;&#34394;&#25311;&#20869;&#23384;&#21644;&#29289;&#29702;&#20869;&#23384;&#23601;&#26377;&#19968;&#20010;&#23545;&#24212;&#20851;&#31995;&#65292;&#24403;&#20320;&#30495;&#27491;&#20351;&#29992;&#30340;&#26102;&#20505;&#25165;&#20250;&#32473;&#20998;&#37197;&#29289;&#29702;&#20869;&#23384;&#65292;&#19981;&#20351;&#29992;&#30340;&#26102;&#20505;&#21017;&#23601;&#21482;&#26377;&#34394;&#25311;&#20869;&#23384;&#65288;&#31354;&#22836;&#25903;&#31080;&#65289;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_16-47-48.png" alt="images/download/attachments/1015833/image2021-6-2_16-47-48.png" width="600"  />
    </p>
<p   
>&#27599;&#19968;&#20010;&#29289;&#29702;&#20869;&#23384;&#30340;&#22823;&#23567;&#26159;4KB&#65292;<strong class=" ">&#25353;&#29031;4KB&#22823;&#23567;&#26469;&#20998;&#39029;&#65288;Page&#65289;</strong>&#65292;&#25152;&#20197;&#22914;&#19978;&#22270;&#25152;&#31034;&#65292;&#23601;&#26377;&#29289;&#29702;&#39029;&#36825;&#20010;&#27010;&#24565;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6Jma5ouf5YaF5a2Y5Zyw5Z2A5YiS5YiG">
        <h2 class="heading "><span>&#34394;&#25311;&#20869;&#23384;&#22320;&#22336;&#21010;&#20998;</span></h2>
<p   
>&#27599;&#20010;&#36827;&#31243;&#37117;&#26377;4GB&#30340;&#34394;&#25311;&#20869;&#23384;&#65292;&#34394;&#25311;&#20869;&#23384;&#30340;&#22320;&#22336;&#26159;&#22914;&#20309;&#21010;&#20998;&#30340;&#65311;&#39318;&#20808;&#65292;&#25105;&#20204;&#38656;&#35201;&#30693;&#36947;&#19968;&#20010;&#34394;&#25311;&#20869;&#23384;&#20998;&#20026;<strong class=" ">&#39640;2G&#12289;&#20302;2G</strong>&#12290;</p>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#29992;&#25143;&#31354;&#38388;&#26159;&#20302;2G&#65292;&#20869;&#26680;&#31354;&#38388;&#26159;&#39640;2G&#65292;&#23545;&#25105;&#20204;&#26469;&#35828;&#21482;&#33021;<strong class=" ">&#20351;&#29992;&#20302;2G&#30340;&#29992;&#25143;&#31354;&#38388;</strong>&#65292;<strong class=" ">&#39640;2G&#20869;&#26680;&#31354;&#38388;&#26159;&#25152;&#26377;&#36827;&#31243;&#20849;&#29992;&#30340;</strong>&#12290;</p>
<p   
>&#20294;&#26159;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#20302;2G&#30340;&#29992;&#25143;&#31354;&#38388;&#20351;&#29992;&#36824;&#26377;<strong class=" ">&#21069;64KB&#30340;&#31354;&#25351;&#38024;&#36171;&#20540;&#21306;&#21644;&#21518;64KB&#30340;&#29992;&#25143;&#31105;&#20837;&#21306;&#26159;&#25105;&#20204;&#30446;&#21069;&#19981;&#33021;&#20351;&#29992;&#30340;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_16-59-9.png" alt="images/download/attachments/1015833/image2021-6-2_16-59-9.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-1-46.png" alt="images/download/attachments/1015833/image2021-6-2_17-1-46.png" width="600"  />
    </p>
<p   
>&#26415;&#35821;&#65306;&#32447;&#24615;&#22320;&#22336;&#23601;&#26159;&#34394;&#25311;&#20869;&#23384;&#30340;&#22320;&#22336;</p>
<p   
><strong class=" ">&#29305;&#21035;&#35828;&#26126;</strong>&#65306;&#32447;&#24615;&#22320;&#22336;&#26377;4G &#65292;&#20294;&#26410;&#24517;&#37117;&#33021;&#35775;&#38382;&#65292;&#25152;&#20197;&#38656;&#35201;&#35760;&#24405;&#21738;&#20123;&#22320;&#26041;&#20998;&#37197;&#20102;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt54mp55CG5YaF5a2Y">
        <h2 class="heading "><span>&#29289;&#29702;&#20869;&#23384;</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Y-v5L2_55So55qE54mp55CG5YaF5a2Y">
        <h3 class="heading "><span>&#21487;&#20351;&#29992;&#30340;&#29289;&#29702;&#20869;&#23384;</span></h3>
<p   
>&#20026;&#20102;&#31649;&#29702;&#26041;&#20415;&#65292;&#29289;&#29702;&#20869;&#23384;&#20197;4KB&#22823;&#23567;&#26469;&#20998;&#39029;&#65292;&#37027;&#20040;&#22312;&#31995;&#32479;&#37324;&#38754;&#36825;&#20010;&#29289;&#29702;&#39029;&#30340;&#25968;&#37327;&#26159;&#22810;&#23569;&#21602;&#65311;&#25105;&#20351;&#29992;&#30340;&#34394;&#25311;&#26426;&#26159;&#21487;&#20197;&#35774;&#32622;&#20869;&#23384;&#22823;&#23567;&#30340;&#65288;&#20174;&#29289;&#29702;&#19978;&#21487;&#20197;&#29702;&#35299;&#20026;&#36825;&#23601;&#26159;&#19968;&#20010;&#20869;&#23384;&#26465;&#65289;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-30-25.png" alt="images/download/attachments/1015833/image2021-6-2_17-30-25.png" width="600"  />
    </p>
<p   
>&#27604;&#22914;&#25105;&#29616;&#22312;&#30340;&#26159;&#26159;2GB&#65288;2048MB&#65289;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;&#20219;&#21153;&#31649;&#29702;&#22120;&#28165;&#26224;&#30340;&#30475;&#35265;&#29289;&#29702;&#20869;&#23384;&#30340;&#24635;&#25968;&#26159;&#25509;&#36817;2048*1024&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-31-33.png" alt="images/download/attachments/1015833/image2021-6-2_17-31-33.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#36825;&#19968;&#22359;&#29289;&#29702;&#20869;&#23384;&#33021;&#26377;&#22810;&#23569;&#29289;&#29702;&#39029;&#21602;&#65311;&#25105;&#20204;&#21487;&#20197;&#23558;&#24635;&#25968;/4&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-35-12.png" alt="images/download/attachments/1015833/image2021-6-2_17-35-12.png" width="600"  />
    </p>
<p   
>&#20063;&#23601;&#26159;&#26377;524138&#20010;&#29289;&#29702;&#39029;&#65288;&#21313;&#36827;&#21046;&#65289;&#65292;&#36716;&#20026;&#21313;&#20845;&#36827;&#21046;&#23601;&#26159;0x7FF6A</p>
<p   
>&#37027;&#20040;&#29289;&#29702;&#39029;&#38754;&#21482;&#26377;&#36825;&#20123;&#19981;&#22815;&#29992;&#35813;&#24590;&#20040;&#21150;&#65311;<strong class=" ">&#36825;&#26102;&#20505;&#25805;&#20316;&#31995;&#32479;&#20250;&#20998;&#37197;&#30828;&#30424;&#31354;&#38388;&#26469;&#20570;&#34394;&#25311;&#20869;&#23384;</strong>&#12290;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;<strong class=" ">&#31995;&#32479;&#23646;&#24615;&#26469;&#26597;&#30475;&#12289;&#26356;&#25913;&#24403;&#21069;&#20998;&#37197;&#30340;&#34394;&#25311;&#20869;&#23384;&#22823;&#23567;</strong>&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-39-19.png" alt="images/download/attachments/1015833/image2021-6-2_17-39-19.png" width="600"  />
    </p>
<p   
>&#21487;&#20197;&#30475;&#35265;&#24403;&#21069;&#21021;&#22987;&#22823;&#23567;&#26159;2046MB&#65292;&#37027;&#20040;&#36825;&#20010;&#26159;&#23384;&#25918;&#22312;&#21738;&#30340;&#21602;&#65311;&#25105;&#20204;&#21487;&#20197;&#22312;C&#30424;&#19979;&#26597;&#30475;&#65288;&#38656;&#35201;&#26174;&#31034;&#31995;&#32479;&#38544;&#34255;&#25991;&#20214;&#65289;pagefile.sys&#36825;&#20010;&#25991;&#20214;&#65292;&#23427;&#21018;&#22909;&#26159;2046MB&#36825;&#20010;&#22823;&#23567;&#65292;&#36825;&#20010;&#25991;&#20214;&#23601;&#26159;&#29992;&#26469;&#20570;&#34394;&#25311;&#20869;&#23384;&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-41-30.png" alt="images/download/attachments/1015833/image2021-6-2_17-41-30.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Y-v6K-G5Yir55qE54mp55CG5YaF5a2Y">
        <h3 class="heading "><span>&#21487;&#35782;&#21035;&#30340;&#29289;&#29702;&#20869;&#23384;</span></h3>
<p   
><strong class=" ">32&#20301;&#25805;&#20316;&#31995;&#32479;&#26368;&#22810;&#21487;&#20197;&#35782;&#21035;&#29289;&#29702;&#20869;&#23384;&#20026;64G</strong>&#65292;&#20294;&#26159;&#25805;&#20316;&#31995;&#32479;&#20250;&#36827;&#34892;&#38480;&#21046;&#65292;<strong class=" ">&#20363;&#22914;XP&#36825;&#20010;&#31995;&#32479;&#21482;&#33021;&#35782;&#21035;4G&#30340;&#29289;&#29702;&#20869;&#23384;</strong>&#65288;Windows Server 2003&#26381;&#21153;&#22120;&#29256;&#26412;&#21487;&#20197;&#35782;&#21035;4G&#20197;&#19978;&#65289;&#12290;</p>
<p   
>&#20294;&#26159;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;HOOK&#31995;&#32479;&#20989;&#25968;&#26469;&#31361;&#30772;XP&#25805;&#20316;&#31995;&#32479;&#30340;4GB&#38480;&#21046;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt54mp55CG6aG155qE5L2_55So">
        <h2 class="heading "><span>&#29289;&#29702;&#39029;&#30340;&#20351;&#29992;</span></h2>
<p   
>&#25105;&#20204;&#30693;&#36947;&#20102;&#36827;&#31243;&#22312;&#20351;&#29992;&#34394;&#25311;&#20869;&#23384;&#26102;&#65292;&#23601;&#20250;&#20998;&#37197;&#19968;&#22359;&#29289;&#29702;&#20869;&#23384;&#65288;&#29289;&#29702;&#39029;&#65289;&#65292;&#20294;&#26159;&#26377;&#37027;&#20040;&#22810;&#31243;&#24207;&#65292;&#24456;&#24555;&#23601;&#20250;&#21344;&#28385;&#29289;&#29702;&#39029;&#65292;&#25805;&#20316;&#31995;&#32479;&#19981;&#20250;&#36825;&#26679;&#35774;&#35745;&#65292;&#32780;&#26159;&#20250;&#21435;&#30475;&#20320;&#30340;&#31243;&#24207;&#26159;&#21542;&#38656;&#35201;&#39057;&#32321;&#30340;&#20351;&#29992;&#29289;&#29702;&#39029;&#65292;&#22914;&#26524;&#19981;&#26159;&#24456;&#39057;&#32321;&#23601;&#20250;&#23558;&#20320;&#23384;&#20648;&#22312;&#29289;&#29702;&#39029;&#30340;&#20869;&#23481;&#25918;&#22312;pagefile.sys&#25991;&#20214;&#20013;&#65292;&#28982;&#21518;&#23558;&#36825;&#20010;&#29289;&#29702;&#39029;&#20998;&#37197;&#32473;&#20854;&#20182;&#38656;&#35201;&#30340;&#36827;&#31243;&#65307;</p>
<p   
>&#22914;&#26524;&#20320;&#30340;&#31243;&#24207;&#20877;&#27425;&#35775;&#38382;&#29289;&#29702;&#39029;&#30340;&#35805;&#65292;&#23601;&#20250;&#37325;&#26032;&#32473;&#20320;&#20998;&#37197;&#29289;&#29702;&#39029;&#65292;&#28982;&#21518;&#25226;&#25968;&#25454;&#20174;pagefile.sys&#25991;&#20214;&#20013;&#25343;&#20986;&#26469;&#25918;&#21040;&#26032;&#30340;&#29289;&#29702;&#39029;&#20013;&#65292;&#36825;&#37117;&#26159;&#25805;&#20316;&#31995;&#32479;&#22312;&#25805;&#20316;&#30340;&#65292;&#20889;&#31243;&#24207;&#26159;&#24863;&#21463;&#19981;&#21040;&#36825;&#26679;&#30340;&#32454;&#33410;&#30340;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_17-51-1.png" alt="images/download/attachments/1015833/image2021-6-2_17-51-1.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt56eB5pyJ5YaF5a2Y55qE55Sz6K-36YeK5pS-">
        <h1 class="heading "><span>&#31169;&#26377;&#20869;&#23384;&#30340;&#30003;&#35831;&#37322;&#25918;</span></h1>
<p   
>&#29289;&#29702;&#20869;&#23384;&#20998;&#20026;&#20004;&#31867;&#65292;&#19968;&#20010;&#26159;&#31169;&#26377;&#20869;&#23384;&#65288;Private&#65289;&#19968;&#20010;&#26159;&#20849;&#20139;&#20869;&#23384;&#65288;Mapped&#65289;&#65292;&#31169;&#26377;&#20869;&#23384;&#30340;&#24847;&#24605;&#26159;&#36825;&#22359;&#29289;&#29702;&#20869;&#23384;&#65288;&#29289;&#29702;&#39029;&#65289;&#21482;&#26377;&#20320;&#20351;&#29992;&#65292;&#32780;&#20849;&#20139;&#20869;&#23384;&#21017;&#26159;&#22810;&#20010;&#36827;&#31243;&#19968;&#36215;&#29992;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/plugins/servlet/confluence/placeholder/unknown-attachment.png" alt="images/plugins/servlet/confluence/placeholder/unknown-attachment.png"   />
        <br/><span class="caption">image2021-6-2_18-6-49.png?version=2&amp;modificationDate=1622628469111&amp;api=v2</span>
    </p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt55Sz6K-35YaF5a2Y55qE5Lik56eN5pa55byP">
        <h2 class="heading "><span>&#30003;&#35831;&#20869;&#23384;&#30340;&#20004;&#31181;&#26041;&#24335;</span></h2>
<ol class=" "><li class=" "><p   
>&#31169;&#26377;&#20869;&#23384;&#36890;&#36807;<strong class=" ">VirtualAlloc/VirtualAllocEx&#20989;&#25968;</strong>&#30003;&#35831;&#65292;&#36825;&#20004;&#20010;&#20989;&#25968;&#22312;&#24213;&#23618;&#23454;&#29616;&#26159;&#27809;&#26377;&#21306;&#21035;&#30340;&#65292;&#20294;&#26159;&#21518;&#32773;&#26159;&#21487;&#20197;&#22312;&#20854;&#20182;&#36827;&#31243;&#20013;&#30003;&#35831;&#20869;&#23384;&#12290;</p>
</li><li class=" "><p   
>&#20849;&#20139;&#20869;&#23384;&#36890;&#36807;<strong class=" ">CreateFileMapping&#20989;&#25968;</strong>&#26144;&#23556;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5a2Y55Sz6K-35LiO6YeK5pS-">
        <h2 class="heading "><span>&#20869;&#23384;&#30003;&#35831;&#19982;&#37322;&#25918;</span></h2>
<p   
>&#30003;&#35831;&#20869;&#23384;&#30340;&#20989;&#25968;&#26159;<strong class=" ">VirtualAlloc</strong>&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">LPVOID VirtualAlloc(</code></div>
<div class="line"><code class="plain">  LPVOID lpAddress,        </code><code class="comments">// region to reserve or commit 要分配的内存区域的地址，没有特殊需求通常不指定</code></div>
<div class="line"><code class="plain">  SIZE_T dwSize,           </code><code class="comments">// size of region 分配的大小，一个物理页大小是0x1000（4KB），看你需要申请多少个物理页就乘以多少</code></div>
<div class="line"><code class="plain">  DWORD flAllocationType,  </code><code class="comments">// type of allocation 分配的类型，常用的是MEM_COMMIT（占用线性地址，也需要物理内存）和MEM_RESERVE（占用线性地址，但不需要物理内存）</code></div>
<div class="line"><code class="plain">  DWORD flProtect          </code><code class="comments">// type of access protection 该内存的初始保护属性</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31532;&#19977;&#12289;&#31532;&#22235;&#21442;&#25968;&#21487;&#20197;&#26681;&#25454;MSDN Library&#26597;&#30475;&#31995;&#32479;&#23450;&#20041;&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_18-20-32.png" alt="images/download/attachments/1015833/image2021-6-2_18-20-32.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_18-20-40.png" alt="images/download/attachments/1015833/image2021-6-2_18-20-40.png" width="600"  />
    </p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#21017;&#34920;&#31034;&#30003;&#35831;2&#20010;&#29289;&#29702;&#39029;&#65292;&#21344;&#29992;&#32447;&#24615;&#22320;&#22336;&#24182;&#20998;&#37197;&#29289;&#29702;&#20869;&#23384;&#65292;&#35813;&#20869;&#23384;&#21487;&#35835;&#20889;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">LPVOID pm = VirtualAlloc(NULL, </code><code class="value">0x1000</code><code class="plain">*</code><code class="value">2</code><code class="plain">, MEM_COMMIT, PAGE_READWRITE);</code></div>
</div>
    </div>
<p   
>&#37027;&#20040;&#20869;&#23384;&#30003;&#35831;&#22909;&#20102;&#25105;&#20204;&#19981;&#24819;&#35201;&#20102;&#65292;&#36825;&#26102;&#20505;&#23601;&#38656;&#35201;&#37322;&#25918;&#65292;&#37322;&#25918;&#20989;&#25968;&#20026;<strong class=" ">VirtualFree</strong>&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL VirtualFree(</code></div>
<div class="line"><code class="plain">  LPVOID lpAddress,   </code><code class="comments">// address of region 内存区域的地址</code></div>
<div class="line"><code class="plain">  SIZE_T dwSize,      </code><code class="comments">// size of region 内存大小</code></div>
<div class="line"><code class="plain">  DWORD dwFreeType    </code><code class="comments">// operation type 如何释放，释放的类型，一共有两个类型：MEM_DECOMMIT（释放物理内存，但线性地址保留）、MEM_RELEASE（释放物理内存，释放线性地址，使用这个设置的时候内存大小就必须为0）</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#25152;&#20197;&#25105;&#20204;&#24819;&#35201;<strong class=" ">&#37322;&#25918;&#29289;&#29702;&#20869;&#23384;&#65292;&#37322;&#25918;&#32447;&#24615;&#22320;&#22336;</strong>&#23601;&#20889;&#22914;&#19979;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VirtualFree(pm, </code><code class="value">0</code><code class="plain">, MEM_RELEASE);</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5aCG5LiO5qCI">
        <h2 class="heading "><span>&#22534;&#19982;&#26632;</span></h2>
<p   
><strong class=" ">&#20043;&#21069;&#25105;&#20204;&#23398;&#20064;&#36807;&#30340;malloc&#25110;&#32773;new&#30003;&#35831;&#20869;&#23384;&#65292;&#23427;&#20204;&#26159;&#30003;&#35831;&#30340;&#20160;&#20040;&#20869;&#23384;&#21602;&#65311;</strong>&#20854;&#23454;&#36890;&#36807;&#23427;&#20204;&#30003;&#35831;&#30340;&#20869;&#23384;&#26159;&#20551;&#30003;&#35831;&#65292;&#22240;&#20026;&#23427;&#20204;&#26159;&#20174;&#24050;&#32463;&#30003;&#35831;&#22909;&#30340;&#20869;&#23384;&#20013;&#30003;&#35831;&#32473;&#33258;&#24049;&#29992;&#30340;&#65292;&#36890;&#36807;&#23427;&#20204;&#30003;&#35831;&#30340;&#20869;&#23384;&#31216;&#20026;&#22534;&#20869;&#23384;&#65292;&#23616;&#37096;&#21464;&#37327;&#31216;&#20026;&#26632;&#20869;&#23384;&#12290;</p>
<p   
>&#26080;&#35770;&#22534;&#20869;&#23384;&#36824;&#26159;&#26632;&#20869;&#23384;&#65292;&#37117;&#26159;&#25805;&#20316;&#31995;&#32479;&#21551;&#21160;&#26102;&#25805;&#20316;&#31995;&#32479;&#20351;&#29992;<strong class=" ">VirtualAlloc&#20989;&#25968;</strong>&#26367;&#25105;&#20204;&#30003;&#35831;&#22909;&#30340;&#12290;</p>
<p   
>&#25152;&#20197;&#22534;&#12289;&#26632;&#30340;&#26412;&#36136;&#23601;&#26159;&#31169;&#26377;&#20869;&#23384;&#65292;&#20063;&#23601;&#26159;&#36890;&#36807;<strong class=" ">VirtualAlloc&#20989;&#25968;</strong>&#30003;&#35831;&#30340;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> x = </code><code class="value">0x12345678</code><code class="plain">; </code><code class="comments">// 栈</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain">* y = (</code><code class="keyword">int</code><code class="plain">*)malloc(sizeof(</code><code class="keyword">int</code><code class="plain">)*</code><code class="value">128</code><code class="plain">); </code><code class="comments">// 堆</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5YWx5Lqr5YaF5a2Y55qE55Sz6K-36YeK5pS-">
        <h1 class="heading "><span>&#20849;&#20139;&#20869;&#23384;&#30340;&#30003;&#35831;&#37322;&#25918;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YWx5Lqr5YaF5a2Y">
        <h2 class="heading "><span>&#20849;&#20139;&#20869;&#23384;</span></h2>
<p   
>&#20849;&#20139;&#20869;&#23384;&#36890;&#36807;<strong class=" ">CreateFileMapping&#20989;&#25968;</strong>&#26144;&#23556;&#65292;&#35813;&#20989;&#25968;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateFileMapping( </code><code class="comments">// 内核对象，这个对象可以为我们准备物理内存，还可以将文件映射到物理页</code></div>
<div class="line"><code class="plain">  HANDLE hFile,                       </code><code class="comments">// handle to file 文件句柄，如果不想将文件映射到物理页，则不指定该参数</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpAttributes, </code><code class="comments">// security 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  DWORD flProtect,                    </code><code class="comments">// protection 保护模式，物理页的属性</code></div>
<div class="line"><code class="plain">  DWORD dwMaximumSizeHigh,            </code><code class="comments">// high-order DWORD of size 高32位，在32位计算机里通常设置为空</code></div>
<div class="line"><code class="plain">  DWORD dwMaximumSizeLow,             </code><code class="comments">// low-order DWORD of size 低32位，指定物理内存的大小</code></div>
<div class="line"><code class="plain">  LPCTSTR lpName                      </code><code class="comments">// object name 对象名字，公用时写，自己使用则可以不指定</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#35813;&#20989;&#25968;&#30340;&#20316;&#29992;&#23601;&#26159;&#20026;&#25105;&#20204;&#20934;&#22791;&#22909;&#29289;&#29702;&#20869;&#23384;&#65288;&#29289;&#29702;&#39029;&#65289;&#65292;&#20294;&#26159;&#21019;&#24314;&#22909;&#20102;&#24182;&#19981;&#20195;&#34920;&#23601;&#21487;&#20197;&#20351;&#29992;&#20102;&#65292;&#25105;&#20204;&#36824;&#38656;&#35201;&#36890;&#36807;<strong class=" ">MapViewOffile&#20989;&#25968;</strong>&#23558;&#29289;&#29702;&#39029;&#19982;&#32447;&#24615;&#22320;&#22336;&#36827;&#34892;&#26144;&#23556;&#65292;<strong class=" ">MapViewOffile&#20989;&#25968;</strong>&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">LPVOID MapViewOfFile(</code></div>
<div class="line"><code class="plain">  HANDLE hFileMappingObject,   </code><code class="comments">// handle to file-mapping object file-mapping对象的句柄</code></div>
<div class="line"><code class="plain">  DWORD dwDesiredAccess,       </code><code class="comments">// access mode 访问模式(虚拟内存的限制必须比物理地址更加严格)</code></div>
<div class="line"><code class="plain">  DWORD dwFileOffsetHigh,      </code><code class="comments">// high-order DWORD of offset 高32位，在32位计算机里通常设置为空</code></div>
<div class="line"><code class="plain">  DWORD dwFileOffsetLow,       </code><code class="comments">// low-order DWORD of offset 低32位，指定从哪里开始映射</code></div>
<div class="line"><code class="plain">  SIZE_T dwNumberOfBytesToMap  </code><code class="comments">// number of bytes to map 共享内存的大小，一般与物理页大小一致</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#define MapFileName </code><code class="string">"共享内存"</code></div>
<div class="line"><code class="plain">#define BUF_SIZE </code><code class="value">0x1000</code></div>
<div class="line"><code class="plain">HANDLE g_hMapFile;</code></div>
<div class="line"><code class="plain">LPTSTR g_lpBuff;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 内核对象：准备好物理页，无效句柄值-1、物理页可读写、申请一个物理页</code></div>
<div class="line"><code class="plain">    g_hMapFile = CreateFileMapping(INVALID_HANDLE_VALUE, NULL, PAGE_READWRITE, </code><code class="value">0</code><code class="plain">, BUF_SIZE, MapFileName);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 将物理页与线性地址进行映射</code></div>
<div class="line"><code class="plain">    g_lpBuff = (LPTSTR)MapViewOfFile(g_hMapFile, FILE_MAP_ALL_ACCESS, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, BUF_SIZE);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 向物理内存中存储</code></div>
<div class="line"><code class="plain">    *(PDWORD)g_lpBuff = </code><code class="value">0x12345678</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 关闭映射，关闭映射则表示释放了线形地址，但是物理页还存在</code></div>
<div class="line"><code class="plain">    UnmapViewOfFile(g_lpBuff);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 关闭句柄，这样才能释放物理页，但需要等待物理页使用完毕才会真正的释放，这里只是告诉系统我们当前进程不使用该句柄（物理页）罢了</code></div>
<div class="line"><code class="plain">    CloseHandle(g_hMapFile);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_21-52-57.png" alt="images/download/attachments/1015833/image2021-6-2_21-52-57.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5paH5Lu257O757uf">
        <h1 class="heading "><span>&#25991;&#20214;&#31995;&#32479;</span></h1>
<p   
>&#25991;&#20214;&#31995;&#32479;&#26159;&#25805;&#20316;&#31995;&#32479;&#29992;&#20110;&#31649;&#29702;&#30913;&#30424;&#19978;&#25991;&#20214;&#30340;&#26041;&#27861;&#21644;&#25968;&#25454;&#32467;&#26500;&#65307;&#31616;&#21333;&#28857;&#35828;&#23601;&#26159;&#22312;&#30913;&#30424;&#19978;&#22914;&#20309;&#32452;&#32455;&#25991;&#20214;&#30340;&#26041;&#27861;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_21-53-48.png" alt="images/download/attachments/1015833/image2021-6-2_21-53-48.png" width="600"  />
    </p>
<p   
>&#22312;Windows&#19979;&#26377;NTFS&#12289;FAT32&#36825;&#20004;&#31181;&#25991;&#20214;&#31995;&#32479;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#26597;&#30475;&#26412;&#22320;&#30913;&#30424;&#30340;&#23646;&#24615;&#26597;&#30475;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_22-43-42.png" alt="images/download/attachments/1015833/image2021-6-2_22-43-42.png" width="600"  />
    </p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Y2355u45YWzQVBJ">
        <h2 class="heading "><span>&#21367;&#30456;&#20851;API</span></h2>
<p   
>&#21367;&#21487;&#20197;&#29702;&#35299;&#20026;&#23601;&#26159;&#25105;&#20204;&#30340;&#26412;&#22320;&#30913;&#30424;&#65288;&#36923;&#36753;&#39537;&#21160;&#22120;&#65289;&#65292;&#25105;&#20204;&#21487;&#20197;&#25226;&#19968;&#22359;2GB&#30340;&#20869;&#23384;&#26465;&#20998;&#20026;&#20004;&#20010;&#21367;&#65292;&#21367;&#37324;&#22836;&#30340;&#23601;&#26159;&#25991;&#20214;&#21644;&#30446;&#24405;&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5Y2377yI6YC76L6R6amx5Yqo5Zmo77yJ">
        <h3 class="heading "><span>&#33719;&#21462;&#21367;&#65288;&#36923;&#36753;&#39537;&#21160;&#22120;&#65289;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetLogicalDrives</strong>&#29992;&#20110;&#33719;&#21462;&#24403;&#21069;&#35745;&#31639;&#26426;&#25152;&#26377;&#36923;&#36753;&#39537;&#21160;&#22120;&#65292;&#35821;&#27861;&#26684;&#24335;&#20026;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD GetLogicalDrives(VOID); </code><code class="comments">// 返回值是一个DOWRD，没有参数</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#20195;&#30721;&#65292;&#25105;&#20204;&#26368;&#32456;&#33719;&#21462;&#21040;&#30340;&#23601;&#26159;&#19968;&#20010;&#21313;&#20845;&#36827;&#21046;&#30340;d&#65292;&#22312;MSDN Library&#20013;&#26126;&#30830;&#35828;&#26126;&#20102;&#36825;&#20010;&#36820;&#22238;&#20540;&#34920;&#31034;&#30340;&#32467;&#26524;&#65306;</p>
<p   
>&#20108;&#36827;&#21046;&#20301;&#26631;&#24535;&#30528;&#23384;&#22312;&#21738;&#20123;&#39537;&#21160;&#22120;&#65292;<strong class=" ">&#20301;0&#20026;1&#21017;&#34920;&#31034;&#23384;&#22312;&#39537;&#21160;&#22120;A&#65292;&#20301;1&#20026;1&#21017;&#34920;&#31034;&#23384;&#22312;&#39537;&#21160;&#22120;B</strong>&#65292;&#20197;&#27492;&#31867;&#25512;&#65292;&#36825;&#37324;&#25105;&#20204;&#33719;&#21462;&#30340;0xd&#20108;&#36827;&#21046;&#26159;1101&#65292;&#20301;1&#20026;1&#12289;&#20301;2&#20026;0&#12289;&#20301;3&#20026;1&#12289;&#20301;4&#20026;1&#65292;&#37027;&#20040;&#23601;&#34920;&#31034;&#25105;&#20204;&#23384;&#22312;&#39537;&#21160;&#22120;A&#12289;C&#12289;D&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 获取卷（逻辑驱动器）</code></div>
<div class="line"><code class="plain">DWORD gLd = GetLogicalDrives();</code></div>
<div class="line"><code class="plain">printf(</code><code class="string">"GetLogicalDrives: %x"</code><code class="plain">, gLd);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_23-0-14.png" alt="images/download/attachments/1015833/image2021-6-2_23-0-14.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_23-6-34.png" alt="images/download/attachments/1015833/image2021-6-2_23-6-34.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5omA5pyJ6YC76L6R6amx5Yqo5Zmo55qE5a2X56ym5Liy">
        <h3 class="heading "><span>&#33719;&#21462;&#25152;&#26377;&#36923;&#36753;&#39537;&#21160;&#22120;&#30340;&#23383;&#31526;&#20018;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetLogicalDriveStrings</strong>&#29992;&#20110;&#33719;&#21462;&#25152;&#26377;&#36923;&#36753;&#39537;&#21160;&#22120;&#30340;&#23383;&#31526;&#20018;&#65292;&#35821;&#27861;&#26684;&#24335;&#20026;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD GetLogicalDriveStrings(</code></div>
<div class="line"><code class="plain">  DWORD nBufferLength,  </code><code class="comments">// size of buffer 输入类型，要获取字符串的大小</code></div>
<div class="line"><code class="plain">  LPTSTR lpBuffer       </code><code class="comments">// drive strings buffer 输出类型，将获取的字符串放到该参数中</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#25105;&#21487;&#20197;&#33719;&#21462;&#25152;&#26377;&#36923;&#36753;&#39537;&#21160;&#22120;&#30340;&#23383;&#31526;&#20018;&#65292;&#37027;&#20040;&#24456;&#28165;&#26224;&#30340;&#21487;&#20197;&#30475;&#35265;&#36923;&#36753;&#39537;&#21160;&#22120;&#30340;&#23383;&#31526;&#20018;&#23601;&#26159;&#30424;&#31526;&#21152;&#19978;&#20882;&#21495;&#21644;&#21453;&#26012;&#26464;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 获取一个逻辑驱动器的字符串</code></div>
<div class="line"><code class="plain">DWORD nBufferLength = </code><code class="value">100</code><code class="plain">;</code></div>
<div class="line"><code class="keyword">char</code><code class="plain"> szOutBuffer[</code><code class="value">100</code><code class="plain">];</code></div>
<div class="line"><code class="plain">GetLogicalDriveStrings(nBufferLength, szOutBuffer);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_23-13-34.png" alt="images/download/attachments/1015833/image2021-6-2_23-13-34.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5Y2377yI6YC76L6R6amx5Yqo5Zmo77yJ55qE57G75Z6L">
        <h3 class="heading "><span>&#33719;&#21462;&#21367;&#65288;&#36923;&#36753;&#39537;&#21160;&#22120;&#65289;&#30340;&#31867;&#22411;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetLogicalDriveStrings</strong>&#29992;&#20110;&#33719;&#21462;&#21367;&#30340;&#31867;&#22411;&#65292;&#35821;&#27861;&#26684;&#24335;&#20026;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">UINT GetDriveType(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpRootPathName   </code><code class="comments">// root directory 根目录，这里我们可以使用驱动器字符串</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#33719;&#21462;&#20102;&#36923;&#36753;&#39537;&#21160;&#22120;C&#30340;&#31867;&#22411;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 获取卷的类型</code></div>
<div class="line"><code class="plain">UINT type;</code></div>
<div class="line"><code class="plain">type = GetDriveType(TEXT(</code><code class="string">"C:\\"</code><code class="plain">));</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">if</code><code class="plain"> (type == DRIVE_UNKNOWN) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"无法确定驱动器的类型 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_NO_ROOT_DIR) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"根路径是无效的，例如: 在该路径上没有安装任何卷 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_REMOVABLE) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"磁盘可以从驱动器中取出 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_FIXED) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"磁盘不能从驱动器中取出 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_REMOTE) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"该驱动器是一个远程（网络）驱动器 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_CDROM) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"该驱动器是一个CD-ROM驱动器 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (type == DRIVE_RAMDISK) {</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"该驱动器是一个RAM磁盘 \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-2_23-34-27.png" alt="images/download/attachments/1015833/image2021-6-2_23-34-27.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5Y2355qE5L-h5oGv">
        <h3 class="heading "><span>&#33719;&#21462;&#21367;&#30340;&#20449;&#24687;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetVolumeInformation</strong>&#29992;&#20110;&#33719;&#21462;&#21367;&#30340;&#20449;&#24687;&#65292;&#35821;&#27861;&#26684;&#24335;&#20026;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL GetVolumeInformation(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpRootPathName,           </code><code class="comments">// root directory 输入类型，驱动器字符串</code></div>
<div class="line"><code class="plain">  LPTSTR lpVolumeNameBuffer,        </code><code class="comments">// volume name buffer 输出类型，返回卷名</code></div>
<div class="line"><code class="plain">  DWORD nVolumeNameSize,            </code><code class="comments">// length of name buffer 输入类型，卷名长度</code></div>
<div class="line"><code class="plain">  LPDWORD lpVolumeSerialNumber,     </code><code class="comments">// volume serial number 输出类型，卷宗序列号</code></div>
<div class="line"><code class="plain">  LPDWORD lpMaximumComponentLength, </code><code class="comments">// maximum file name length 输出类型，指定文件系统支持的文件名组件的最大长度</code></div>
<div class="line"><code class="plain">  LPDWORD lpFileSystemFlags,        </code><code class="comments">// file system options 输出类型，与指定文件系统相关的标志</code></div>
<div class="line"><code class="plain">  LPTSTR lpFileSystemNameBuffer,    </code><code class="comments">// file system name buffer 输出类型，文件系统（如FAT或NTFS）名称</code></div>
<div class="line"><code class="plain">  DWORD nFileSystemNameSize         </code><code class="comments">// length of file system name buffer 输入类型，文件系统名称的长度</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#33719;&#21462;&#20102;&#36923;&#36753;&#39537;&#21160;&#22120;C&#30340;&#30456;&#20851;&#20449;&#24687;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 获取卷的信息</code></div>
<div class="line"><code class="plain">TCHAR szVolumeName[</code><code class="value">260</code><code class="plain">];</code></div>
<div class="line"><code class="plain">DWORD dwVolumeSerialNumber;</code></div>
<div class="line"><code class="plain">DWORD dwMaximumComponentLength;</code></div>
<div class="line"><code class="plain">DWORD dwFileSystemFlags;</code></div>
<div class="line"><code class="plain">TCHAR szFileSystemNameBuffer[</code><code class="value">260</code><code class="plain">];</code></div>
<div class="line"><code class="plain">GetVolumeInformation(</code><code class="string">"C:\\"</code><code class="plain">, szVolumeName, </code><code class="value">260</code><code class="plain">, &amp;dwVolumeSerialNumber, &amp;dwMaximumComponentLength, &amp;dwFileSystemFlags, szFileSystemNameBuffer, </code><code class="value">260</code><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-8-48.png" alt="images/download/attachments/1015833/image2021-6-3_0-8-48.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt55uu5b2V55u45YWzQVBJ">
        <h2 class="heading "><span>&#30446;&#24405;&#30456;&#20851;API</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Yib5bu655uu5b2V">
        <h3 class="heading "><span>&#21019;&#24314;&#30446;&#24405;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">CreateDirectory</strong>&#29992;&#20110;&#21019;&#24314;&#30446;&#24405;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL CreateDirectory(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpPathName,                         </code><code class="comments">// directory name 目录名称，需要指定完整路径包含盘符的</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpSecurityAttributes  </code><code class="comments">// SD 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#22312;C&#30424;&#19979;&#21019;&#24314;test&#30446;&#24405;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 创建目录，如果不指定绝对路径，则默认会在程序当前目录下</code></div>
<div class="line"><code class="plain">CreateDirectory(TEXT(</code><code class="string">"C:\\test"</code><code class="plain">), NULL);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-26-12.png" alt="images/download/attachments/1015833/image2021-6-3_0-26-12.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Yig6Zmk55uu5b2V">
        <h3 class="heading "><span>&#21024;&#38500;&#30446;&#24405;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">RemoveDirectory</strong>&#29992;&#20110;&#21024;&#38500;&#30446;&#24405;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL RemoveDirectory(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpPathName   </code><code class="comments">// directory name 目录名称，需要指定完整路径包含盘符的</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#21024;&#38500;C&#30424;&#19979;&#30340;test&#30446;&#24405;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 删除目录</code></div>
<div class="line"><code class="plain">RemoveDirectory(TEXT(</code><code class="string">"C:\\test"</code><code class="plain">));</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5L-u5pS555uu5b2V5ZCN56ew77yI56e75Yqo77yJ">
        <h3 class="heading "><span>&#20462;&#25913;&#30446;&#24405;&#21517;&#31216;&#65288;&#31227;&#21160;&#65289;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">MoveFile</strong>&#29992;&#20110;&#20462;&#25913;&#30446;&#24405;&#21517;&#31216;&#65288;&#31227;&#21160;&#65289;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL MoveFile(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpExistingFileName, </code><code class="comments">// file name 目录名</code></div>
<div class="line"><code class="plain">  LPCTSTR lpNewFileName       </code><code class="comments">// new file name 新目录名</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#23558;C&#30424;&#19979;&#30340;test&#25991;&#20214;&#22841;&#37325;&#21629;&#21517;&#20026;test1&#65292;&#20063;&#21487;&#20197;&#29702;&#35299;&#20026;&#20197;&#26032;&#30340;&#21517;&#31216;&#31227;&#21160;&#21040;&#26032;&#30340;&#30446;&#24405;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 修改目录名称（移动）</code></div>
<div class="line"><code class="plain">MoveFile(TEXT(</code><code class="string">"C:\\test"</code><code class="plain">), TEXT(</code><code class="string">"C:\\test1"</code><code class="plain">));</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-30-18.png" alt="images/download/attachments/1015833/image2021-6-3_0-30-18.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W56iL5bqP5b2T5YmN55uu5b2V">
        <h3 class="heading "><span>&#33719;&#21462;&#31243;&#24207;&#24403;&#21069;&#30446;&#24405;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetCurrentDirectory</strong>&#29992;&#20110;&#33719;&#21462;&#31243;&#24207;&#24403;&#21069;&#30446;&#24405;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD GetCurrentDirectory(</code></div>
<div class="line"><code class="plain">  DWORD nBufferLength,  </code><code class="comments">// size of directory buffer 输入类型，获取当前目录名的大小</code></div>
<div class="line"><code class="plain">  LPTSTR lpBuffer       </code><code class="comments">// directory buffer 输出类型，当前目录名称</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 获取程序当前目录</code></div>
<div class="line"><code class="plain">TCHAR dwOutDirectory[</code><code class="value">200</code><code class="plain">];</code></div>
<div class="line"><code class="plain">GetCurrentDirectory(</code><code class="value">200</code><code class="plain">, dwOutDirectory);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-33-36.png" alt="images/download/attachments/1015833/image2021-6-3_0-33-36.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6K6-572u56iL5bqP5b2T5YmN55uu5b2V">
        <h3 class="heading "><span>&#35774;&#32622;&#31243;&#24207;&#24403;&#21069;&#30446;&#24405;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">SetCurrentDirectory</strong>&#29992;&#20110;&#35774;&#32622;&#31243;&#24207;&#24403;&#21069;&#30446;&#24405;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL SetCurrentDirectory(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpPathName   </code><code class="comments">// new directory name 新的目录名称</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 设置程序当前目录</code></div>
<div class="line"><code class="plain">SetCurrentDirectory(TEXT(</code><code class="string">"C:\\test"</code><code class="plain">));</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5paH5Lu255u45YWzQVBJ">
        <h2 class="heading "><span>&#25991;&#20214;&#30456;&#20851;API</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Yib5bu65paH5Lu2">
        <h3 class="heading "><span>&#21019;&#24314;&#25991;&#20214;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">CreateFile</strong>&#29992;&#20110;&#21019;&#24314;&#25991;&#20214;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateFile(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName,                         </code><code class="comments">// file name 文件名</code></div>
<div class="line"><code class="plain">  DWORD dwDesiredAccess,                      </code><code class="comments">// access mode 访问模式</code></div>
<div class="line"><code class="plain">  DWORD dwShareMode,                          </code><code class="comments">// share mode 共享模式，如果为0则是排他性，就是目前在使用时其他人是无法使用的</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpSecurityAttributes, </code><code class="comments">// SD 安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  DWORD dwCreationDisposition,                </code><code class="comments">// how to create 如何创建，可以打开一个已经存在的文件</code></div>
<div class="line"><code class="plain">  DWORD dwFlagsAndAttributes,                 </code><code class="comments">// file attributes 文件属性，可以创建隐藏文件</code></div>
<div class="line"><code class="plain">  HANDLE hTemplateFile                        </code><code class="comments">// handle to template file </code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#20197;&#21487;&#35835;&#21487;&#20889;&#26041;&#24335;&#19981;&#31649;&#26377;&#27809;&#26377;&#65292;&#26377;&#23601;&#35206;&#30422;&#27809;&#26377;&#23601;&#26032;&#24314;&#30340;&#26041;&#24335;&#21019;&#24314;&#19968;&#20010;&#38544;&#34255;&#25991;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 创建文件</code></div>
<div class="line"><code class="plain">CreateFile(TEXT(</code><code class="string">"C:\\A.txt"</code><code class="plain">), GENERIC_READ|GENERIC_WRITE, </code><code class="value">0</code><code class="plain">, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_HIDDEN, NULL);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-51-50.png" alt="images/download/attachments/1015833/image2021-6-3_0-51-50.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5YWz6Zet5paH5Lu2">
        <h3 class="heading "><span>&#20851;&#38381;&#25991;&#20214;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">CloseHandle</strong>&#29992;&#20110;&#20851;&#38381;&#25991;&#20214;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL CloseHandle(</code></div>
<div class="line"><code class="plain">  HANDLE hObject   </code><code class="comments">// handle to object 文件句柄</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_0-53-6.png" alt="images/download/attachments/1015833/image2021-6-3_0-53-6.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5paH5Lu25aSn5bCP">
        <h3 class="heading "><span>&#33719;&#21462;&#25991;&#20214;&#22823;&#23567;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetFileSize</strong>&#29992;&#20110;&#33719;&#21462;&#25991;&#20214;&#22823;&#23567;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD GetFileSize(</code></div>
<div class="line"><code class="plain">  HANDLE hFile,           </code><code class="comments">// handle to file 输入类型，文件句柄</code></div>
<div class="line"><code class="plain">  LPDWORD lpFileSizeHigh  </code><code class="comments">// high-order word of file size，输出类型，高32位的文件大小，这个没有用，长度一般在低32位中，也就是当前函数的返回值</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 创建文件</code></div>
<div class="line"><code class="plain">HANDLE hFile = CreateFile(TEXT(</code><code class="string">"C:\\A.txt"</code><code class="plain">), GENERIC_READ, </code><code class="value">0</code><code class="plain">, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);</code></div>
<div class="line"><code class="comments">// 获取文件大小，单位是字节</code></div>
<div class="line"><code class="plain">DWORD lpFileSizeHigh;</code></div>
<div class="line"><code class="plain">DWORD dwLow = GetFileSize(hFile, &amp;lpFileSizeHigh);</code></div>
<div class="line"><code class="comments">// 关闭文件</code></div>
<div class="line"><code class="plain">CloseHandle(hFile);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_1-0-17.png" alt="images/download/attachments/1015833/image2021-6-3_1-0-17.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6I635Y-W5paH5Lu255qE5bGe5oCn5ZKM5L-h5oGv">
        <h3 class="heading "><span>&#33719;&#21462;&#25991;&#20214;&#30340;&#23646;&#24615;&#21644;&#20449;&#24687;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">GetFileAttributes&#12289;GetFileAttributesEx</strong>&#29992;&#20110;&#33719;&#21462;&#25991;&#20214;&#30340;&#23646;&#24615;&#21644;&#20449;&#24687;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD GetFileAttributes( </code><code class="comments">// 这个仅能获取属性</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName   </code><code class="comments">// name of file or directory 文件或目录的名称</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL GetFileAttributesEx( </code><code class="comments">// 这个可以获取属性、信息</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName,                   </code><code class="comments">// file or directory name 输入类型，文件或目录的名称</code></div>
<div class="line"><code class="plain">  GET_FILEEX_INFO_LEVELS fInfoLevelId,  </code><code class="comments">// attribute class 输入类型，这个只有GetFileExInfoStandard一个值</code></div>
<div class="line"><code class="plain">  LPVOID lpFileInformation              </code><code class="comments">// attribute information 输出类型，文件属性和信息的结果</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">WIN32_FILE_ATTRIBUTE_DATA data; </code><code class="comments">// 定义一个结构体</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">GetFileAttributesEx(TEXT(</code><code class="string">"C:\\A.txt"</code><code class="plain">), GetFileExInfoStandard, &amp;data); </code><code class="comments">// 传递结构体指针</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_1-9-3.png" alt="images/download/attachments/1015833/image2021-6-3_1-9-3.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6K-7L-WGmS_mi7fotJ0v5Yig6Zmk5paH5Lu2">
        <h3 class="heading "><span>&#35835;/&#20889;/&#25335;&#36125;/&#21024;&#38500;&#25991;&#20214;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">ReadFile&#12289;WriteFile&#12289;CopyFile&#12289;DeleteFile</strong>&#29992;&#20110;&#35835;/&#20889;/&#25335;&#36125;/&#21024;&#38500;&#25991;&#20214;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL ReadFile( </code><code class="comments">// 读取文件</code></div>
<div class="line"><code class="plain">  HANDLE hFile,                </code><code class="comments">// handle to file 文件句柄</code></div>
<div class="line"><code class="plain">  LPVOID lpBuffer,             </code><code class="comments">// data buffer 输出类型，数据放哪</code></div>
<div class="line"><code class="plain">  DWORD nNumberOfBytesToRead,  </code><code class="comments">// number of bytes to read 要读多少字节</code></div>
<div class="line"><code class="plain">  LPDWORD lpNumberOfBytesRead, </code><code class="comments">// number of bytes read 真正读多少字节</code></div>
<div class="line"><code class="plain">  LPOVERLAPPED lpOverlapped    </code><code class="comments">// overlapped buffer</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL WriteFile( </code><code class="comments">// 写入文件</code></div>
<div class="line"><code class="plain">  HANDLE hFile,                    </code><code class="comments">// handle to file 文件句柄</code></div>
<div class="line"><code class="plain">  LPCVOID lpBuffer,                </code><code class="comments">// data buffer 要写入的数据在哪</code></div>
<div class="line"><code class="plain">  DWORD nNumberOfBytesToWrite,     </code><code class="comments">// number of bytes to write 要写多少字节</code></div>
<div class="line"><code class="plain">  LPDWORD lpNumberOfBytesWritten,  </code><code class="comments">// number of bytes written 真正写多少字节</code></div>
<div class="line"><code class="plain">  LPOVERLAPPED lpOverlapped        </code><code class="comments">// overlapped buffer</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL CopyFile( </code><code class="comments">// 拷贝文件</code></div>
<div class="line"><code class="plain">  LPCTSTR lpExistingFileName, </code><code class="comments">// name of an existing file 已经存在的文件</code></div>
<div class="line"><code class="plain">  LPCTSTR lpNewFileName,      </code><code class="comments">// name of new file 复制的文件</code></div>
<div class="line"><code class="plain">  BOOL bFailIfExists          </code><code class="comments">// operation if file exists FALSE则复制位置的文件已经存在就覆盖，TRUE反之</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL DeleteFile( </code><code class="comments">// 删除文件</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName   </code><code class="comments">// file name 文件名</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#22914;&#19979;&#65288;&#20030;&#19968;&#21453;&#19977;&#65289;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdlib.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HANDLE hFile = CreateFile(TEXT(</code><code class="string">"C:\\A.txt"</code><code class="plain">), GENERIC_READ, </code><code class="value">0</code><code class="plain">, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 读取文件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 分配空间</code></div>
<div class="line"><code class="plain">    DWORD lpFileSizeHigh;</code></div>
<div class="line"><code class="plain">    DWORD fileSize = GetFileSize(hFile, &amp;lpFileSizeHigh);</code></div>
<div class="line"><code class="plain">    LPSTR pszBuffer = (LPSTR)malloc(fileSize);</code></div>
<div class="line"><code class="plain">    ZeroMemory(pszBuffer, fileSize);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 设置当前读取的位置</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 文件句柄、第几个开始读、高32位、从文件最开始的位置</code></div>
<div class="line"><code class="plain">    SetFilePointer(hFile, </code><code class="value">0</code><code class="plain">, NULL, FILE_BEGIN);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 读取数据</code></div>
<div class="line"><code class="plain">    DWORD dwReadLength;</code></div>
<div class="line"><code class="plain">    ReadFile(hFile, pszBuffer, fileSize, &amp;dwReadLength, NULL);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 释放内存</code></div>
<div class="line"><code class="plain">    free(pszBuffer);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 关闭文件</code></div>
<div class="line"><code class="plain">    CloseHandle(hFile);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_1-27-9.png" alt="images/download/attachments/1015833/image2021-6-3_1-27-9.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5p-l5om-5paH5Lu2">
        <h3 class="heading "><span>&#26597;&#25214;&#25991;&#20214;</span></h3>
<p   
>&#20989;&#25968;<strong class=" ">FindFirstFile&#12289;FindNextFile</strong>&#29992;&#20110;&#26597;&#25214;&#25991;&#20214;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE FindFirstFile(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName,               </code><code class="comments">// file name 输入类型，文件名</code></div>
<div class="line"><code class="plain">  LPWIN32_FIND_DATA lpFindFileData  </code><code class="comments">// data buffer 输出类型，WIN32_FIND_DATA结构体指针，找到的文件数据</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL FindNextFile(</code></div>
<div class="line"><code class="plain">  HANDLE hFindFile,                </code><code class="comments">// search handle  输入类型，搜索句柄</code></div>
<div class="line"><code class="plain">  LPWIN32_FIND_DATA lpFindFileData </code><code class="comments">// data buffer 输出类型，WIN32_FIND_DATA结构体指针，存放找到的文件数据</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#31034;&#20363;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">WIN32_FIND_DATA firstFile;</code></div>
<div class="line"><code class="plain">WIN32_FIND_DATA nextFile;</code></div>
<div class="line"><code class="comments">// 在C盘下搜索.txt后缀的文件</code></div>
<div class="line"><code class="plain">HANDLE hFile = FindFirstFile(TEXT(</code><code class="string">"C:\\*.txt"</code><code class="plain">), &amp;firstFile);</code></div>
<div class="line"><code class="plain">printf(</code><code class="string">"第一个文件名: %s 文件大小: %d\n"</code><code class="plain">, firstFile.cFileName, firstFile.nFileSizeLow);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (hFile != INVALID_HANDLE_VALUE) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 有搜索到，就使用FindNextFile寻找下一个文件，FindNextFile函数返回为真则表示搜索到了</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (FindNextFile(hFile, &amp;nextFile)) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"文件名: %s 文件大小: %d\n"</code><code class="plain">, nextFile.cFileName, nextFile.nFileSizeLow);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_1-40-57.png" alt="images/download/attachments/1015833/image2021-6-3_1-40-57.png" width="600"  />
    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5YaF5a2Y5pig5bCE5paH5Lu2">
        <h1 class="heading "><span>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv5YaF5a2Y5pig5bCE5paH5Lu2">
        <h2 class="heading "><span>&#20160;&#20040;&#26159;&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;</span></h2>
<p   
>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#23601;&#22914;&#19979;&#22270;&#65292;&#23558;&#30828;&#30424;&#26576;&#20010;&#25991;&#20214;&#26144;&#23556;&#21040;&#29289;&#29702;&#39029;&#19978;&#65292;&#28982;&#21518;&#20877;&#23558;&#29289;&#29702;&#39029;&#26144;&#23556;&#21040;&#34394;&#25311;&#20869;&#23384;&#20013;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_9-42-45.png" alt="images/download/attachments/1015833/image2021-6-3_9-42-45.png" width="600"  />
    </p>
<p   
><strong class=" ">&#20248;&#28857;</strong>&#65306;</p>
<ol class=" "><li class=" "><p   
>&#35775;&#38382;&#25991;&#20214;&#23601;&#20687;&#35775;&#38382;&#20869;&#23384;&#19968;&#26679;&#31616;&#21333;&#65292;&#24819;&#35835;&#23601;&#35835;&#65292;&#24819;&#24590;&#20040;&#26679;&#23601;&#24590;&#20040;&#26679;&#65292;&#19981;&#29992;&#37027;&#20040;&#32321;&#26434;&#65307;</p>
</li><li class=" "><p   
>&#24403;&#25991;&#20214;&#36807;&#22823;&#26102;&#65292;&#20351;&#29992;&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#30340;&#26041;&#24335;&#65292;&#24615;&#33021;&#30456;&#23545;&#20110;&#26222;&#36890;I/O&#30340;&#35775;&#38382;&#35201;&#22909;&#24456;&#22810;&#12290;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5a2Y5pig5bCE5paH5Lu26K-75YaZ">
        <h2 class="heading "><span>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#35835;&#20889;</span></h2>
<p   
>&#20043;&#21069;&#25105;&#20204;&#23398;&#20064;&#36807;&#29992;CreateFileMapping&#20989;&#25968;&#26469;&#21019;&#24314;&#20849;&#20139;&#20869;&#23384;&#65292;&#36825;&#20010;&#20989;&#25968;&#21516;&#26679;&#20063;&#21487;&#20197;&#23558;&#25991;&#20214;&#26144;&#23556;&#21040;&#29289;&#29702;&#39029;&#65292;&#21482;&#19981;&#36807;&#22312;&#36825;&#20043;&#21069;&#25105;&#20204;&#38656;&#35201;&#20256;&#36882;&#19968;&#20010;&#25991;&#20214;&#21477;&#26564;&#12290;</p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#25105;&#20204;&#20889;&#20102;&#19968;&#20010;&#35835;&#21462;&#25991;&#20214;&#26368;&#24320;&#22987;&#31532;&#19968;&#20010;&#23383;&#33410;&#30340;&#20540;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD MappingFile(LPSTR lpcFile) {</code></div>
<div class="line"><code class="plain">    HANDLE hFile;</code></div>
<div class="line"><code class="plain">    HANDLE hMapFile;</code></div>
<div class="line"><code class="plain">    LPVOID lpAddr;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 创建文件（获取文件句柄）</code></div>
<div class="line"><code class="plain">    hFile = CreateFile(lpcFile, GENERIC_READ|GENERIC_WRITE, </code><code class="value">0</code><code class="plain">, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断CreateFile是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hFile == NULL) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateFile failed: %d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 创建FileMapping对象</code></div>
<div class="line"><code class="plain">    hMapFile = CreateFileMapping(hFile, NULL, PAGE_READWRITE, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断CreateFileMapping是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hMapFile == NULL) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateFileMapping failed: %d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 物理页映射到虚拟内存</code></div>
<div class="line"><code class="plain">    lpAddr = MapViewOfFile(hMapFile, FILE_MAP_COPY, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 读取文件</code></div>
<div class="line"><code class="plain">    DWORD dwTest1 = *(LPDWORD)lpAddr; </code><code class="comments">// 读取最开始的4字节</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"dwTest1: %x \n"</code><code class="plain">, dwTest1);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 写文件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// *(LPDWORD)lpAddr = 0x12345678;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 关闭资源</code></div>
<div class="line"><code class="plain">    UnmapViewOfFile(lpAddr);</code></div>
<div class="line"><code class="plain">    CloseHandle(hFile);</code></div>
<div class="line"><code class="plain">    CloseHandle(hMapFile);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#35843;&#29992;&#20989;&#25968;&#36816;&#34892;&#20043;&#21518;&#25104;&#21151;&#36755;&#20986;&#65292;&#24182;&#33719;&#21462;&#21040;&#23545;&#24212;&#20869;&#23481;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">MappingFile(TEXT(</code><code class="string">"C:\\A.txt"</code><code class="plain">));</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_10-31-18.png" alt="images/download/attachments/1015833/image2021-6-3_10-31-18.png" width="600"  />
    </p>
<p   
><strong class=" ">&#23567;&#25216;&#24039;</strong> &rarr; &#22312;VC6&#20013;&#24819;&#35201;&#20197;HEX&#30340;&#24418;&#24335;&#26597;&#30475;&#26576;&#20010;&#25991;&#20214;&#30340;&#35805;&#21487;&#20197;&#22312;&#25171;&#24320;&#25991;&#20214;&#30340;&#26102;&#20505;&#36825;&#26679;&#35774;&#32622;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_10-35-29.png" alt="images/download/attachments/1015833/image2021-6-3_10-35-29.png" width="600"  />
    </p>
<p   
>&#20030;&#19968;&#21453;&#19977;&#65292;&#20889;&#25991;&#20214;&#20063;&#24456;&#31616;&#21333;&#65292;&#20294;&#26159;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;<strong class=" ">&#20889;&#25991;&#20214;&#19981;&#26159;&#31435;&#21363;&#29983;&#25928;&#30340;</strong>&#65292;&#32780;&#26159;&#20808;&#23558;&#20889;&#20837;&#30340;&#23384;&#25918;&#21040;&#32531;&#23384;&#20013;&#65292;&#21482;&#26377;&#31561;&#21040;&#20320;&#37322;&#25918;&#36164;&#28304;&#20102;&#25165;&#20250;&#25226;&#32531;&#23384;&#37324;&#30340;&#20540;&#30495;&#27491;&#30340;&#20889;&#20837;&#21040;&#25991;&#20214;&#12290;</p>
<p   
>&#22914;&#26524;&#20320;&#24076;&#26395;&#20462;&#25913;&#21487;&#20197;&#31435;&#21363;&#29983;&#25928;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;<strong class=" ">FlushViewOfFile&#20989;&#25968;</strong>&#26469;&#24378;&#21046;&#26356;&#26032;&#32531;&#23384;&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL FlushViewOfFile(</code></div>
<div class="line"><code class="plain">  LPCVOID lpBaseAddress,         </code><code class="comments">// starting address 你要刷新的地址</code></div>
<div class="line"><code class="plain">  SIZE_T dwNumberOfBytesToFlush  </code><code class="comments">// number of bytes in range 要刷新的大小（字节）</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>&#31034;&#20363;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">FlushViewOfFile(((LPDWORD)lpAddr), </code><code class="value">4</code><code class="plain">);</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5a2Y5pig5bCE5paH5Lu25LmL5YWx5Lqr">
        <h2 class="heading "><span>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#20043;&#20849;&#20139;</span></h2>
<p   
>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#21487;&#20197;&#35753;2&#20010;&#36827;&#31243;&#21516;&#26102;&#20849;&#20139;&#19968;&#20010;&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_10-46-18.png" alt="images/download/attachments/1015833/image2021-6-3_10-46-18.png" width="600"  />
    </p>
<p   
>&#20854;&#23454;&#26412;&#36136;&#24456;&#31616;&#21333;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#22312;&#21019;&#24314;FileMapping&#23545;&#35937;&#26102;&#20505;&#32473;&#20854;&#19968;&#20010;&#23545;&#35937;&#21517;&#31216;&#21363;&#21487;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-13-0.png" alt="images/download/attachments/1015833/image2021-6-3_11-13-0.png" width="600"  />
    </p>
<p   
>&#29616;&#22312;&#25105;&#20204;&#26469;A&#36827;&#31243;&#20889;&#20837;&#65292;B&#36827;&#31243;&#35835;&#21462;&#30475;&#30475;&#21040;&#24213;&#33021;&#19981;&#33021;&#36328;&#36827;&#31243;&#24685;&#21916;&#65292;&#20889;&#20837;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#define MAPPINGNAME </code><code class="string">"Share File"</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD MappingFile(LPSTR lpcFile) {</code></div>
<div class="line"><code class="plain">    HANDLE hFile;</code></div>
<div class="line"><code class="plain">    HANDLE hMapFile;</code></div>
<div class="line"><code class="plain">    LPVOID lpAddr;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 创建文件（获取文件句柄）</code></div>
<div class="line"><code class="plain">    hFile = CreateFile(lpcFile, GENERIC_READ|GENERIC_WRITE, </code><code class="value">0</code><code class="plain">, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断CreateFile是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hFile == NULL) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateFile failed: %d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 创建FileMapping对象</code></div>
<div class="line"><code class="plain">    hMapFile = CreateFileMapping(hFile, NULL, PAGE_READWRITE, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, MAPPINGNAME);</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断CreateFileMapping是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hMapFile == NULL) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateFileMapping failed: %d \n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 物理页映射到虚拟内存</code></div>
<div class="line"><code class="plain">    lpAddr = MapViewOfFile(hMapFile, FILE_MAP_ALL_ACCESS, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 读取文件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// DWORD dwTest1 = *(LPDWORD)lpAddr; // 读取最开始的4字节</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// printf("dwTest1: %x \n", dwTest1);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 写文件</code></div>
<div class="line"><code class="plain">    *(LPDWORD)lpAddr = </code><code class="value">0x41414142</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    FlushViewOfFile(((LPDWORD)lpAddr), </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"Process A Write"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 关闭资源</code></div>
<div class="line"><code class="plain">    UnmapViewOfFile(lpAddr);</code></div>
<div class="line"><code class="plain">    CloseHandle(hFile);</code></div>
<div class="line"><code class="plain">    CloseHandle(hMapFile);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#35835;&#21462;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#define MAPPINGNAME </code><code class="string">"Share File"</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD MappingFile(LPSTR lpcFile) {</code></div>
<div class="line"><code class="plain">    HANDLE hMapFile;</code></div>
<div class="line"><code class="plain">    LPVOID lpAddr;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 打开FileMapping对象</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">    OpenFileMapping 函数语法格式：</code></div>
<div class="line"><code class="comments">    HANDLE OpenFileMapping(</code></div>
<div class="line"><code class="comments">        DWORD dwDesiredAccess,  // access mode 访问模式</code></div>
<div class="line"><code class="comments">        BOOL bInheritHandle,    // inherit flag 继承标识，为真则表示这个可以被新进程继承，为假反之</code></div>
<div class="line"><code class="comments">        LPCTSTR lpName          // object name 对象名称</code></div>
<div class="line"><code class="comments">    );</code></div>
<div class="line"><code class="comments">    */</code></div>
<div class="line"><code class="plain">    hMapFile = OpenFileMapping(FILE_MAP_ALL_ACCESS, FALSE, MAPPINGNAME);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 物理页映射到虚拟内存</code></div>
<div class="line"><code class="plain">    lpAddr = MapViewOfFile(hMapFile, FILE_MAP_ALL_ACCESS, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 读取文件</code></div>
<div class="line"><code class="plain">    DWORD dwTest1 = *(LPDWORD)lpAddr; </code><code class="comments">// 读取最开始的4字节</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"dwTest1: %x \n"</code><code class="plain">, dwTest1);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 写文件</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// *(LPDWORD)lpAddr = 0x41414142;</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"Process B Read"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 关闭资源</code></div>
<div class="line"><code class="plain">    UnmapViewOfFile(lpAddr);</code></div>
<div class="line"><code class="plain">    CloseHandle(hMapFile);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#20998;&#21035;&#20351;&#29992;getchar&#20989;&#25968;&#25346;&#20303;&#20102;&#36816;&#34892;&#65292;A&#36827;&#31243;&#20889;&#20837;0x41414142&#65292;B&#36827;&#31243;&#20063;&#25104;&#21151;&#35835;&#21462;&#21040;&#20102;&#36825;&#20010;&#20540;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-15-43.png" alt="images/download/attachments/1015833/image2021-6-3_11-15-43.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5YaF5a2Y5pig5bCE5paH5Lu25LmL5YaZ5ou36LSd">
        <h2 class="heading "><span>&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#20043;&#20889;&#25335;&#36125;</span></h2>
<p   
>&#25105;&#20204;&#30693;&#36947;&#20102;&#20869;&#23384;&#26144;&#23556;&#25991;&#20214;&#21487;&#20197;&#20849;&#20139;&#65292;&#20294;&#26159;&#36825;&#26679;&#20063;&#26377;&#24330;&#31471;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#23454;&#38469;&#19978;&#25105;&#20204;&#31243;&#24207;&#35843;&#29992;&#30340;user32.dll&#36825;&#31867;dll&#25991;&#20214;&#65292;&#20063;&#26159;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#36827;&#34892;&#35843;&#29992;&#30340;&#65292;&#22914;&#26524;&#25105;&#20204;&#36827;&#22330;A&#20462;&#25913;&#20102;&#26576;&#20010;DLL&#65292;&#23601;&#20250;&#23548;&#33268;&#36827;&#31243;B&#20986;&#38382;&#39064;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-30-12.png" alt="images/download/attachments/1015833/image2021-6-3_11-30-12.png" width="600"  />
    </p>
<p   
>&#20026;&#20102;&#35299;&#20915;&#36825;&#31181;&#38544;&#24739;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#20889;&#25335;&#36125;&#30340;&#26041;&#24335;&#26469;&#22788;&#29702;&#12290;</p>
<p   
>&#20889;&#25335;&#36125;&#30340;&#23454;&#29616;&#23601;&#26159;<strong class=" ">MapViewOfFile&#20989;&#25968;</strong>&#20013;&#30340;&#31532;&#20108;&#20010;&#21442;&#25968;&#20540;&#20026;<strong class=" ">FILE_MAP_COPY</strong>&#65292;<strong class=" ">&#23427;&#30340;&#24847;&#24605;&#34920;&#31034;&#24403;&#20320;&#22312;&#20889;&#30340;&#26102;&#20505;&#36827;&#34892;&#25335;&#36125;</strong>&#12290;</p>
<p   
>&#24403;&#25105;&#20204;&#35774;&#32622;&#20026;&#35813;&#29087;&#24713;&#26102;&#65292;&#21017;&#22810;&#36827;&#31243;&#20043;&#38388;&#35835;&#21462;&#30340;&#26159;&#21516;&#19968;&#22359;&#29289;&#29702;&#39029;&#65292;&#20294;&#26159;&#24403;&#36827;&#31243;A&#20889;&#20837;&#30340;&#26102;&#20505;&#21017;&#20250;&#23558;&#36825;&#20221;&#29289;&#29702;&#39029;&#25335;&#36125;&#20026;&#19968;&#20010;&#26032;&#30340;&#29289;&#29702;&#39029;&#36827;&#34892;&#20889;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-34-32.png" alt="images/download/attachments/1015833/image2021-6-3_11-34-32.png" width="600"  />
    </p>
<p   
>&#20889;&#25335;&#36125;&#23646;&#24615;&#26102;&#20505;&#65292;&#20889;&#20837;&#26102;&#24182;<strong class=" ">&#19981;&#20250;&#24433;&#21709;</strong>&#21407;&#26412;&#30340;&#25991;&#20214;&#20869;&#23481;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6Z2Z5oCB6ZO-5o6l5bqT">
        <h1 class="heading "><span>&#38745;&#24577;&#38142;&#25509;&#24211;</span></h1>
<p   
>&#36719;&#20214;&#38543;&#30528;&#26356;&#36845;&#20250;&#36234;&#26469;&#36234;&#22797;&#26434;&#65292;&#21253;&#21547;&#30340;&#21151;&#33021;&#20250;&#24456;&#22810;&#65292;&#19968;&#20010;&#22823;&#22411;&#36719;&#20214;&#21442;&#19982;&#24320;&#21457;&#30340;&#20154;&#20250;&#38750;&#24120;&#22810;&#65292;&#22240;&#20026;&#19981;&#21487;&#33021;&#19968;&#20010;&#25226;&#25152;&#26377;&#20107;&#24773;&#24178;&#20102;&#65292;&#36825;&#26679;&#23601;&#20250;&#25226;&#36719;&#20214;&#20998;&#20026;&#22810;&#20010;&#27169;&#22359;&#65292;&#27599;&#20010;&#27169;&#22359;&#26377;&#23545;&#24212;&#30340;&#20154;&#21435;&#20889;&#65292;&#38745;&#24577;&#38142;&#25509;&#24211;&#23601;&#26159;&#36719;&#20214;&#27169;&#22359;&#21270;&#30340;&#19968;&#31181;&#35299;&#20915;&#26041;&#26696;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt57yW5YaZ6Z2Z5oCB6ZO-5o6l5bqT5paH5Lu2">
        <h2 class="heading "><span>&#32534;&#20889;&#38745;&#24577;&#38142;&#25509;&#24211;&#25991;&#20214;</span></h2>
<p   
>&#22312;VC6&#20013;&#21019;&#24314;&#38745;&#24577;&#38142;&#25509;&#24211;&#39033;&#30446;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-48-16.png" alt="images/download/attachments/1015833/image2021-6-3_11-48-16.png" width="600"  />
    </p>
<p   
>&#21019;&#24314;&#39033;&#30446;A&#65292;&#28982;&#21518;&#26032;&#24314;A.cpp&#21644;A.h&#65292;&#22312;A.h&#20013;&#22768;&#26126;&#19968;&#20010;add&#26041;&#27861;&#65292;&#22312;A.cpp&#20013;&#23454;&#29616;&#35813;&#26041;&#27861;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-53-39.png" alt="images/download/attachments/1015833/image2021-6-3_11-53-39.png" width="600"  />
    </p>
<p   
>&#32534;&#35793;&#19968;&#19979;&#65292;&#22312;<strong class=" ">&#39033;&#30446;&#30446;&#24405;&#30340;Debug&#30446;&#24405;&#19979;&#20250;&#26377;&#19968;&#20010;A.lib&#25991;&#20214;</strong>&#65292;&#36825;&#23601;&#26159;&#25105;&#20204;&#30340;&#38745;&#24577;&#38142;&#25509;&#24211;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_11-54-49.png" alt="images/download/attachments/1015833/image2021-6-3_11-54-49.png" width="600"  />
    </p>
<p   
>&#22914;&#26524;&#25105;&#20204;&#38656;&#35201;&#32473;&#21035;&#20154;&#29992;&#30340;&#35805;&#37027;&#23601;&#38656;&#35201;A.lib + A.h&#36825;&#20010;&#22836;&#25991;&#20214;&#19968;&#36215;&#32473;&#21035;&#20154;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6Z2Z5oCB6ZO-5o6l5bqT55qE5L2_55So">
        <h2 class="heading "><span>&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;&#20351;&#29992;</span></h2>
<p   
>&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;&#20351;&#29992;&#26377;&#20004;&#31181;&#26041;&#27861;&#65306;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt6aG555uu5qC555uu5b2V">
        <h3 class="heading "><span>&#39033;&#30446;&#26681;&#30446;&#24405;</span></h3>
<p   
>&#31532;&#19968;&#31181;&#26041;&#27861;&#65306;&#23558;&#29983;&#25104;&#30340;.h&#19982;.lib&#25991;&#20214;&#22797;&#21046;&#21040;&#39033;&#30446;&#26681;&#30446;&#24405;&#65292;&#28982;&#21518;&#22312;&#20195;&#30721;&#20013;&#24341;&#29992;&#65306;</p>
<p   
><br/></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"xxxx.h"</code></div>
<div class="line"><code class="plain">#pragma comment(lib, </code><code class="string">"xxxx.lib"</code><code class="plain">)</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-4-7.png" alt="images/download/attachments/1015833/image2021-6-3_12-4-7.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItVkM25a6J6KOF55uu5b2V">
        <h3 class="heading "><span>VC6&#23433;&#35013;&#30446;&#24405;</span></h3>
<p   
>&#31532;&#20108;&#31181;&#26041;&#27861;&#65306;&#23558;xxxx.h&#19982;xxxx.lib&#25991;&#20214;&#22797;&#21046;&#21040;VC6&#23433;&#35013;&#30446;&#24405;&#65292;&#19982;&#24211;&#25991;&#20214;&#25918;&#22312;&#19968;&#36215;&#65292;&#28982;&#21518;&#22312;&#24037;&#31243;-&gt;&#35774;&#32622;-&gt;&#36830;&#25509;-&gt;&#23545;&#35937;/&#24211;&#27169;&#22359;&#20013;&#28155;&#21152;xxxx.lib&#65292;&#26368;&#21518;&#23601;&#21487;&#20197;&#20687;&#20351;&#29992;C&#35821;&#35328;&#24211;&#19968;&#26679;&#20351;&#29992;&#23427;&#20102;</p>
<ul class=" "><li class=" "><p   
>&#22836;&#25991;&#20214;&#36335;&#24452;&#65306;C:\Program Files\Microsoft Visual Studio\VC98\Include</p>
</li><li class=" "><p   
>&#38745;&#24577;&#38142;&#25509;&#24211;&#36335;&#24452;&#65306;C:\Program Files\Microsoft Visual Studio\VC98\Lib</p>
</li></ul><p   
><br/></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-5-37.png" alt="images/download/attachments/1015833/image2021-6-3_12-5-37.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-5-51.png" alt="images/download/attachments/1015833/image2021-6-3_12-5-51.png" width="600"  />
    </p>
<p   
>&#22312;&#32534;&#36753;&#26694;&#20013;&#20889;&#20837;A.lib&#65292;&#22810;&#20010;lib&#25991;&#20214;&#20197;&#31354;&#26684;&#38548;&#24320;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-7-6.png" alt="images/download/attachments/1015833/image2021-6-3_12-7-6.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-10-33.png" alt="images/download/attachments/1015833/image2021-6-3_12-10-33.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6Z2Z5oCB6ZO-5o6l5bqT55qE57y654K5">
        <h2 class="heading "><span>&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;&#32570;&#28857;</span></h2>
<p   
><strong class=" ">&#31532;&#19968;&#20010;</strong>&#65306;<strong class=" ">&#20351;&#29992;&#38745;&#24577;&#38142;&#25509;&#29983;&#25104;&#30340;&#21487;&#25191;&#34892;&#25991;&#20214;&#20307;&#31215;&#36739;&#22823;</strong>&#65292;&#20363;&#22914;&#25105;&#20204;&#20174;&#27719;&#32534;&#23618;&#38754;&#26469;&#30475;&#65292;&#26159;&#26681;&#26412;&#26080;&#27861;&#21306;&#20998;&#21738;&#20010;&#26159;&#38745;&#24577;&#24211;&#20013;&#30340;&#20195;&#30721;&#30340;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-11-59.png" alt="images/download/attachments/1015833/image2021-6-3_12-11-59.png" width="600"  />
    </p>
<p   
>&#21516;&#26102;&#25105;&#20204;&#20063;&#20102;&#35299;&#20102;&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;<strong class=" ">&#26412;&#36136;</strong>&#65292;<strong class=" ">&#37027;&#23601;&#26159;&#25226;&#20320;&#24819;&#35201;&#35843;&#29992;&#30340;&#25509;&#21475;&#65288;&#20989;&#25968;&#65289;&#30452;&#25509;&#20889;&#20837;&#21040;&#20320;&#30340;&#31243;&#24207;&#20013;</strong>&#12290;</p>
<p   
><strong class=" ">&#31532;&#20108;&#20010;</strong>&#65306;&#21253;&#21547;&#30456;&#21516;&#30340;&#20844;&#20849;&#20195;&#30721;&#65292;&#36896;&#25104;&#28010;&#36153;&#65292;&#20551;&#35774;&#25105;&#20204;&#22312;&#22810;&#20010;&#39033;&#30446;&#20013;&#20351;&#29992;&#21516;&#19968;&#20010;&#38745;&#24577;&#38142;&#25509;&#24211;&#65292;&#20854;&#23454;&#20063;&#23601;&#34920;&#31034;&#30456;&#21516;&#30340;&#20195;&#30721;&#22797;&#21046;&#22810;&#20221;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5Yqo5oCB6ZO-5o6l5bqT">
        <h1 class="heading "><span>&#21160;&#24577;&#38142;&#25509;&#24211;</span></h1>
<p   
>&#21160;&#24577;&#38142;&#25509;&#24211;&#24357;&#34917;&#20102;&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;&#20004;&#20010;&#32570;&#28857;&#65292;&#21160;&#24577;&#38142;&#25509;&#24211;&#65288;<strong class=" ">Dynamic Link Library&#65292;&#32553;&#20889;&#20026;DLL</strong>&#65289;&#65292;&#26159;&#24494;&#36719;&#20844;&#21496;&#22312;&#24494;&#36719;Windows&#25805;&#20316;&#31995;&#32479;&#20013;&#23545;<strong class=" ">&#20849;&#20139;&#20989;&#25968;&#24211;&#27010;&#24565;</strong>&#30340;&#19968;&#31181;<strong class=" ">&#23454;&#29616;&#26041;&#24335;</strong>&#65292;&#36825;&#20123;&#24211;&#20989;&#25968;&#30340;&#25991;&#20214;&#25193;&#23637;&#21517;&#31216;&#20026;&#65306;.dll&#12289;.ocx&#65288;&#21253;&#21547;ActiveX&#25511;&#21046;&#30340;&#24211;&#65289;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Yib5bu65Yqo5oCB6ZO-5o6l5bqT">
        <h2 class="heading "><span>&#21019;&#24314;&#21160;&#24577;&#38142;&#25509;&#24211;</span></h2>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzItZXh0ZXJu55qE5pa55byP">
        <h3 class="heading "><span>extern&#30340;&#26041;&#24335;</span></h3>
<p   
>VC6&#21019;&#24314;&#39033;&#30446;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-27-35.png" alt="images/download/attachments/1015833/image2021-6-3_12-27-35.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-28-22.png" alt="images/download/attachments/1015833/image2021-6-3_12-28-22.png" width="600"  />
    </p>
<p   
>&#19982;&#38745;&#24577;&#38142;&#25509;&#24211;&#30340;&#21019;&#24314;&#26041;&#24335;&#19968;&#26679;&#65292;&#25105;&#20204;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#31867;MyDLL&#65292;&#36825;&#26679;&#23601;&#20250;&#33258;&#21160;&#21019;&#24314;MyDLL.h&#21644;MyDLL.cpp&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-32-14.png" alt="images/download/attachments/1015833/image2021-6-3_12-32-14.png" width="600"  />
    </p>
<p   
>&#22312;&#22836;&#25991;&#20214;MyDLL.h&#20013;&#25105;&#20204;&#35201;&#22768;&#26126;&#25509;&#21475;&#65288;&#20989;&#25968;&#65289;&#65292;&#38656;&#35201;&#20351;&#29992;&#22266;&#23450;&#26684;&#24335;&#26469;&#22768;&#26126;&#32780;&#19981;&#33021;&#20687;&#38745;&#24577;&#38142;&#25509;&#24211;&#37027;&#26679;&#30452;&#25509;&#20351;&#29992;&#65292;&#26684;&#24335;&#22914;&#19979;&#65288;<strong class=" ">&#27880;&#65306;&#20197;&#19979;&#26684;&#24335;&#20013;&#30340;&#35843;&#29992;&#32422;&#23450;&#21487;&#20197;&#19981;&#29992;&#22635;&#20889;&#65292;&#22914;&#33509;&#22635;&#20889;&#20250;&#23548;&#33268;&#23548;&#20986;&#20989;&#25968;&#21517;&#21457;&#29983;&#21464;&#21270;</strong>&#65289;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">extern </code><code class="string">"C"</code><code class="plain"> _declspec(dllexport) 调用约定 返回类型 函数名 (参数列表);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-35-8.png" alt="images/download/attachments/1015833/image2021-6-3_12-35-8.png" width="600"  />
    </p>
<p   
>&#22312;MyDLL.cpp&#20013;&#23454;&#29616;&#26041;&#27861;&#65292;&#38656;&#35201;&#22312;&#24320;&#22836;&#20889;&#19978;&#19968;&#33268;&#30340;&#35843;&#29992;&#32422;&#23450;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-36-3.png" alt="images/download/attachments/1015833/image2021-6-3_12-36-3.png" width="600"  />
    </p>
<p   
>&#32534;&#35793;&#21518;&#22312;Debug&#30446;&#24405;&#23601;&#20250;&#29983;&#25104;B.dll&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-40-25.png" alt="images/download/attachments/1015833/image2021-6-3_12-40-25.png" width="600"  />
    </p>
<p   
>&#22312;&#36825;&#37324;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;LordPE&#26469;&#26597;&#30475;&#25105;&#20204;&#36825;&#20010;DLL&#25991;&#20214;&#30340;&#23548;&#20986;&#34920;&#65288;<strong class=" ">&#28041;&#21450;&#20013;&#32423;&#29677;&#35838;&#31243;&#26242;&#26102;&#21487;&#20197;&#30053;&#36807;</strong>&#65289;&#65292;&#25105;&#20204;&#21482;&#35201;&#30693;&#36947;&#22312;&#36825;&#20010;&#23548;&#20986;&#34920;&#20013;&#26377;&#36825;&#20010;DLL&#22768;&#26126;&#30340;&#20989;&#25968;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-50-10.png" alt="images/download/attachments/1015833/image2021-6-3_12-50-10.png" width="600"  />
    </p>
<p   
>&#21487;&#20197;&#24456;&#28165;&#26970;&#30340;&#30475;&#35265;&#25105;&#20204;&#30340;&#20989;&#25968;&#21517;&#31216;&#21464;&#25104;&#20102;<strong class=" ">_add@8&#65288;&#27492;&#22788;&#23601;&#26159;&#30001;&#20110;&#20351;&#29992;&#20102;_stdcall&#35843;&#29992;&#32422;&#23450;&#23548;&#33268;&#20989;&#25968;&#21517;&#21457;&#29983;&#20102;&#25913;&#21464;&#65292;&#22914;&#33509;&#23548;&#20837;&#35813;&#20989;&#25968;&#65292;&#21017;&#19981;&#33021;&#30452;&#25509;&#20351;&#29992;add&#65292;&#32780;&#38656;&#35201;&#20351;&#29992;&#27492;&#22788;&#30340;&#21517;&#23383;&#65289;</strong>&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5L2_55SoLkRFRuaWh-S7tg">
        <h3 class="heading "><span>&#20351;&#29992;.DEF&#25991;&#20214;</span></h3>
<p   
>&#25105;&#20204;&#21487;&#20197;&#22312;&#39033;&#30446;&#20013;&#21019;&#24314;&#19968;&#20010;&#25991;&#20214;&#25193;&#23637;&#21517;&#20026;.def&#30340;&#25991;&#20214;&#65292;&#22312;&#35813;&#25991;&#20214;&#20013;&#20351;&#29992;&#22914;&#19979;&#26684;&#24335;&#26469;&#22768;&#26126;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">EXPORTS    </code></div>
<div class="line"><code class="plain">函数名 @编号 </code><code class="comments">// 有编号，也有名称</code></div>
<div class="line"><code class="plain">函数名 @编号     NONAME </code><code class="comments">// 有编号，没有名称</code></div>
</div>
    </div>
<p   
>&#25353;&#29031;&#36825;&#31181;&#26041;&#24335;&#20462;&#25913;&#22914;&#19979;&#65306;</p>
<p   
>&#22836;&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-56-52.png" alt="images/download/attachments/1015833/image2021-6-3_12-56-52.png" width="600"  />
    </p>
<p   
>CPP&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-57-14.png" alt="images/download/attachments/1015833/image2021-6-3_12-57-14.png" width="600"  />
    </p>
<p   
>DEF&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image confluence-thumbnail confluence-external-resource"  src="images/mstwiki.acmesec.cn/download/thumbnails/12714992/image2021-6-3_12-57-32.png" alt="images/mstwiki.acmesec.cn/download/thumbnails/12714992/image2021-6-3_12-57-32.png" width="200"  />
    </p>
<p   
>&#28982;&#21518;&#32534;&#35793;&#65292;&#29992;LordPE&#25171;&#24320;&#26597;&#30475;&#19968;&#19979;&#20989;&#25968;&#21517;&#31216;&#23601;&#20250;&#21457;&#29616;&#20854;&#27809;&#26377;&#20102;@xxx&#36825;&#26679;&#30340;&#26684;&#24335;&#32780;&#26159;&#25105;&#20204;&#23450;&#20041;&#20160;&#20040;&#26679;&#23601;&#26159;&#20160;&#20040;&#26679;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_12-59-57.png" alt="images/download/attachments/1015833/image2021-6-3_12-59-57.png" width="600"  />
    </p>
<p   
>&#36825;&#26679;&#20570;&#30340;&#22909;&#22788;&#23601;&#26159;&#65306;<strong class=" ">&#21487;&#20197;&#24456;&#30452;&#35266;&#30340;&#30475;&#35265;&#20989;&#25968;&#21517;&#65292;&#24182;&#19988;&#22312;&#24212;&#29992;&#23618;&#38754;&#21487;&#20197;&#36798;&#21040;&#38544;&#34255;&#30340;&#30446;&#30340;</strong>&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5L2_55So5Yqo5oCB6ZO-5o6l5bqT">
        <h2 class="heading "><span>&#20351;&#29992;&#21160;&#24577;&#38142;&#25509;&#24211;</span></h2>
<p   
>&#20351;&#29992;&#21160;&#24577;&#38142;&#25509;&#24211;&#30340;&#27493;&#39588;&#27604;&#36739;&#32321;&#29712;&#65292;&#19968;&#20849;&#26377;&#22914;&#19979;&#20960;&#20010;&#27493;&#39588;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 将DLL文件复制到项目目录下</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤1：定义函数指针,如：</code></div>
<div class="line"><code class="plain">typedef </code><code class="keyword">int</code><code class="plain"> (*lpAdd)(</code><code class="keyword">int</code><code class="plain">,</code><code class="keyword">int</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤2：声明函数指针变量,如：</code></div>
<div class="line"><code class="plain">lpAdd myAdd;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤3：动态加载dll到内存中,如：</code></div>
<div class="line"><code class="comments">// LoadLibrary函数会先从当前目录寻找，然后在系统目录寻找</code></div>
<div class="line"><code class="plain">HINSTANCE hModule = LoadLibrary(</code><code class="string">"B.dll"</code><code class="plain">); </code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤4：获取函数地址,如：</code></div>
<div class="line"><code class="plain">myAdd = (lpAdd)GetProcAddress(hModule, </code><code class="string">"add"</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤5：调用函数,如：</code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> a = myAdd(</code><code class="value">10</code><code class="plain">,</code><code class="value">2</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 步骤6：释放动态链接库,如：</code></div>
<div class="line"><code class="plain">FreeLibrary(hModule);</code></div>
</div>
    </div>
<p   
>&#25191;&#34892;&#32467;&#26524;&#22914;&#19979;&#22270;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-11-23.png" alt="images/download/attachments/1015833/image2021-6-3_13-11-23.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6ZqQ5byP6ZO-5o6l">
        <h1 class="heading "><span>&#38544;&#24335;&#38142;&#25509;</span></h1>
<p   
>&#20043;&#21069;&#25105;&#20204;&#35843;&#29992;&#21160;&#24577;&#38142;&#25509;&#24211;&#65288;DLL&#25991;&#20214;&#65289;&#20351;&#29992;&#30340;&#26041;&#24335;&#23454;&#38469;&#19978;&#26159;<strong class=" ">&#26174;&#24335;&#38142;&#25509;</strong>&#65292;&#23427;&#30340;&#20248;&#28857;&#26159;&#38750;&#24120;&#28789;&#27963;&#65292;&#32570;&#28857;&#23601;&#26159;&#20351;&#29992;&#36215;&#26469;&#38750;&#24120;&#40635;&#28902;&#65292;&#27493;&#39588;&#24456;&#32321;&#29712;&#12290;</p>
<p   
>&#26412;&#31456;&#33410;&#25105;&#20204;&#26469;&#23398;&#20064;<strong class=" ">&#38544;&#24335;&#38142;&#25509;</strong>&#65292;&#36890;&#36807;&#38544;&#24335;&#38142;&#25509;&#25105;&#20204;&#21482;&#38656;&#35201;&#19968;&#27425;&#37197;&#32622;&#65292;&#20043;&#21518;&#23601;&#20250;&#38750;&#24120;&#30340;&#26041;&#20415;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6ZqQ5byP6ZO-5o6lLjE">
        <h2 class="heading "><span>&#38544;&#24335;&#38142;&#25509;</span></h2>
<p   
>&#38544;&#24335;&#38142;&#25509;&#26377;&#36825;&#20960;&#20010;&#27493;&#39588;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#23558;<strong class=" ">.dll&#21644;.lib</strong>&#25918;&#21040;&#39033;&#30446;&#30446;&#24405;&#19979;</p>
</li><li class=" "><p   
>&#23558; <u class=" "><strong class=" ">#pragma comment(lib, &quot;DLL&#21517;.lib&quot;)</strong></u> &#28155;&#21152;&#21040;&#35843;&#29992;&#25991;&#20214;</p>
</li><li class=" "><p   
>&#21152;&#20837;&#20989;&#25968;&#22768;&#26126;</p>
</li></ol><p   
>&#20989;&#25968;&#22768;&#26126;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
<p   
>&#27880;&#24847;&#65306;&#22312;&#35838;&#31243;&#20013;&#32473;&#20986;&#30340;_declspec&#26159;&#26377;&#20004;&#20010;&#19979;&#21010;&#32447;&#30340;&#65292;&#32463;&#36807;&#26597;&#35810;&#20043;&#21518;&#23454;&#38469;&#19978;<strong class=" ">&#19968;&#20010;&#19979;&#21010;&#32447;&#21644;&#20004;&#20010;&#19979;&#21010;&#32447;&#26159;&#31561;&#20215;</strong>&#30340;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">_declspec(dllimport) _调用约定 返回值 函数名称 (函数参数列表);</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-23-30.png" alt="images/download/attachments/1015833/image2021-6-3_13-23-30.png" width="600"  />
    </p>
<p  class="auto-cursor-target" 
>&#27880;&#24847;&#65292;&#22914;&#26524;&#20320;&#21019;&#24314;&#21160;&#24577;&#38142;&#25509;&#24211;&#30340;&#26041;&#24335;&#26159;extern&#30340;&#26041;&#24335;&#65292;&#37027;&#20040;&#22312;&#31532;&#19977;&#27493;&#21152;&#20837;&#20989;&#25968;&#22768;&#26126;&#26102;&#23601;&#24212;&#35813;&#25353;&#29031;extern&#30340;&#26684;&#24335;&#26469;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">extern </code><code class="string">"C"</code><code class="plain"> _declspec(dllexport) 调用约定 返回类型 函数名 (参数列表);</code></div>
<div class="line"><code class="plain">extern </code><code class="string">"C"</code><code class="plain"> _declspec(dllimport) 调用约定 返回类型 函数名 (参数列表);</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6ZqQ5byP6ZO-5o6l55qE5a6e546w">
        <h2 class="heading auto-cursor-target"><span>&#38544;&#24335;&#38142;&#25509;&#30340;&#23454;&#29616;</span></h2>
<p  class="auto-cursor-target" 
>&#20351;&#29992;&#38544;&#24335;&#38142;&#25509;&#65292;&#32534;&#35793;&#22120;&#20250;&#23558;&#38142;&#25509;&#30340;DLL&#25991;&#20214;&#23384;&#25918;&#21040;<strong class=" ">&#23548;&#20837;&#34920;</strong>&#20013;&#65306;</p>
<p  class="auto-cursor-target" 
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-33-45.png" alt="images/download/attachments/1015833/image2021-6-3_13-33-45.png" width="600"  />
    </p>
<p  class="auto-cursor-target" 
>&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;LordPE&#26469;&#26597;&#30475;&#19968;&#19979;&#65306;</p>
<p  class="auto-cursor-target" 
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-34-54.png" alt="images/download/attachments/1015833/image2021-6-3_13-34-54.png" width="600"  />
    </p>
<p  class="auto-cursor-target" 
>&#24182;&#19988;&#23427;&#21487;&#20197;&#35814;&#32454;&#30340;&#35760;&#24405;&#20351;&#29992;&#20102;DLL&#20013;&#30340;&#21738;&#20123;&#20989;&#25968;&#65306;</p>
<p  class="auto-cursor-target" 
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-35-44.png" alt="images/download/attachments/1015833/image2021-6-3_13-35-44.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItRExM55qE5LyY54K5">
        <h2 class="heading auto-cursor-target"><span>DLL&#30340;&#20248;&#28857;</span></h2>
<p   
>DLL&#30340;&#20248;&#28857;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;DLL&#21482;&#22312;&#20869;&#23384;&#20013;&#21152;&#36733;&#19968;&#20221;&#65292;&#20462;&#25913;&#30340;&#26102;&#20505;&#23601;&#26159;&#20889;&#25335;&#36125;&#21407;&#29702;&#65292;&#19981;&#20250;&#24433;&#21709;&#21035;&#30340;&#36827;&#31243;&#20351;&#29992;DLL&#20197;&#21450;&#19981;&#20250;&#24433;&#21709;DLL&#26412;&#36523;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_13-37-10.png" alt="images/download/attachments/1015833/image2021-6-3_13-37-10.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzItRGxsTWFpbuWHveaVsA">
        <h2 class="heading "><span>DllMain&#20989;&#25968;</span></h2>
<p   
>&#25105;&#20204;&#30340;&#25511;&#21046;&#21488;&#31243;&#24207;&#20837;&#21475;&#26159;Main&#20989;&#25968;&#65292;&#32780;DLL&#25991;&#20214;&#30340;&#20837;&#21475;&#20989;&#25968;&#26159;<strong class=" ">DllMain&#20989;&#25968;&#65288;D</strong><strong class=" ">llMain&#20989;&#25968;</strong>&#21487;&#33021;&#20250;&#25191;&#34892;&#24456;&#22810;&#27425;&#65292;&#19981;&#20687;&#25105;&#20204;&#30340;Main&#20989;&#25968;&#21482;&#25191;&#34892;&#19968;&#27425;<strong class=" ">&#65289;</strong>&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL WINAPI DllMain(</code></div>
<div class="line"><code class="plain">  HINSTANCE hinstDLL,   </code><code class="comments">// handle to the DLL module DLL模块的句柄，当前DLL被加载到什么位置</code></div>
<div class="line"><code class="plain">  DWORD fdwReason,      </code><code class="comments">// reason for calling function DLL被调用的原因，有4种情况：DLL_PROCESS_ATTACH（当某个进程第一次执行LoadLibrary）、DLL_PROCESS_DETACH（当某个进程释放了DLL）、DLL_THREAD_ATTACH（当某个进程的其他线程再次执行LoadLibrary）、DLL_THREAD_DETACH（当某个进程的其他线程释放了DLL）</code></div>
<div class="line"><code class="plain">  LPVOID lpvReserved    </code><code class="comments">// reserved</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6L-c56iL57q_56iL">
        <h1 class="heading "><span>&#36828;&#31243;&#32447;&#31243;</span></h1>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt57q_56iL55qE5qaC5b-1">
        <h2 class="heading "><span>&#32447;&#31243;&#30340;&#27010;&#24565;</span></h2>
<p   
>&#32447;&#31243;&#26159;&#38468;&#23646;&#22312;&#36827;&#31243;&#19978;&#30340;&#25191;&#34892;&#23454;&#20307;&#65292;&#26159;&#20195;&#30721;&#30340;&#25191;&#34892;&#27969;&#31243;&#65307;&#20195;&#30721;&#24517;&#39035;&#36890;&#36807;&#32447;&#31243;&#25165;&#33021;&#25191;&#34892;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Yib5bu66L-c56iL57q_56iL">
        <h2 class="heading "><span>&#21019;&#24314;&#36828;&#31243;&#32447;&#31243;</span></h2>
<p   
>&#21019;&#24314;&#36828;&#31243;&#32447;&#31243;&#30340;&#20989;&#25968;&#26159;<strong class=" ">CreateRemoteThread</strong>&#65292;&#20854;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateRemoteThread(</code></div>
<div class="line"><code class="plain">  HANDLE hProcess,                          </code><code class="comments">// handle to process 输入类型，进程句柄</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpThreadAttributes, </code><code class="comments">// SD 输入类型，安全属性，包含安全描述符</code></div>
<div class="line"><code class="plain">  SIZE_T dwStackSize,                       </code><code class="comments">// initial stack size 输入类型，堆大小</code></div>
<div class="line"><code class="plain">  LPTHREAD_START_ROUTINE lpStartAddress,    </code><code class="comments">// thread function 输入类型，线程函数，线程函数地址应该是在别的进程中存在的</code></div>
<div class="line"><code class="plain">  LPVOID lpParameter,                       </code><code class="comments">// thread argument　输入类型，线程参数</code></div>
<div class="line"><code class="plain">  DWORD dwCreationFlags,                    </code><code class="comments">// creation option 输入类型，创建设置</code></div>
<div class="line"><code class="plain">  LPDWORD lpThreadId                        </code><code class="comments">// thread identifier 输出类型，线程id</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
><strong class=" ">CreateThread</strong>&#20989;&#25968;&#26159;&#22312;&#24403;&#21069;&#36827;&#31243;&#20013;&#21019;&#24314;&#32447;&#31243;&#65292;&#32780;<strong class=" ">CreateRemoteThread</strong>&#20989;&#25968;&#26159;&#20801;&#35768;&#22312;&#20854;&#20182;&#36827;&#31243;&#20013;&#21019;&#24314;&#32447;&#31243;&#65292;&#25152;&#20197;<strong class=" ">&#36828;&#31243;&#32447;&#31243;&#23601;&#21487;&#20197;&#29702;&#35299;&#20026;&#26159;&#38750;&#26412;&#36827;&#31243;&#20013;&#30340;&#32447;&#31243;</strong>&#12290;</p>
<p   
>&#39318;&#20808;&#21019;&#24314;A&#36827;&#31243;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">void</code><code class="plain"> Fun() {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt;= </code><code class="value">5</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Fun running... \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter) {</code></div>
<div class="line"><code class="plain">    Fun();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[]) {</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    HANDLE hThread = CreateThread(NULL, NULL, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36827;&#31243;B&#20889;&#20102;&#19968;&#20010;&#36828;&#31243;&#32447;&#31243;&#21019;&#24314;&#30340;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL MyCreateRemoteThread(DWORD dwProcessId, DWORD dwProcessAddr) {</code></div>
<div class="line"><code class="plain">    DWORD dwThreadId;</code></div>
<div class="line"><code class="plain">    HANDLE hProcess;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取进程句柄</code></div>
<div class="line"><code class="plain">    hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessId);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断OpenProcess是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hProcess == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"OpenProcess failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 创建远程线程</code></div>
<div class="line"><code class="plain">    hThread = CreateRemoteThread(</code></div>
<div class="line"><code class="plain">        hProcess,                          </code><code class="comments">// handle to process</code></div>
<div class="line"><code class="plain">        NULL, </code><code class="comments">// SD</code></div>
<div class="line"><code class="plain">        </code><code class="value">0</code><code class="plain">,                       </code><code class="comments">// initial stack size</code></div>
<div class="line"><code class="plain">        (LPTHREAD_START_ROUTINE)dwProcessAddr,    </code><code class="comments">// thread function</code></div>
<div class="line"><code class="plain">        NULL,                       </code><code class="comments">// thread argument</code></div>
<div class="line"><code class="plain">        </code><code class="value">0</code><code class="plain">,                    </code><code class="comments">// creation option</code></div>
<div class="line"><code class="plain">        &amp;dwThreadId                        </code><code class="comments">// thread identifier</code></div>
<div class="line"><code class="plain">    );</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 判断CreateRemoteThread是否执行成功</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(hThread == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"CreateRemoteThread failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 关闭</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"><code class="plain">    CloseHandle(hProcess);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 返回</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#20989;&#25968;MyCreateRemoteThread&#20256;&#20837;2&#20010;&#21442;&#25968;&#65292;&#19968;&#20010;&#26159;&#36827;&#31243;ID&#65292;&#19968;&#20010;&#26159;&#32447;&#31243;&#20989;&#25968;&#22320;&#22336;&#12290;</p>
<p   
>&#36827;&#31243;ID&#36890;&#36807;&#20219;&#21153;&#31649;&#29702;&#22120;&#26597;&#30475;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_14-21-36.png" alt="images/download/attachments/1015833/image2021-6-3_14-21-36.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#22312;&#36827;&#31243;A&#30340;&#20195;&#30721;&#19979;&#26029;&#28857;&#25214;&#21040;&#32447;&#31243;&#20989;&#25968;&#22320;&#22336;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_14-22-38.png" alt="images/download/attachments/1015833/image2021-6-3_14-22-38.png" width="600"  />
    </p>
<p   
>&#28982;&#21518;&#23558;&#23545;&#24212;&#20540;&#22635;&#20837;&#21363;&#21487;&#36828;&#31243;&#21019;&#24314;&#32447;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_14-23-58.png" alt="images/download/attachments/1015833/image2021-6-3_14-23-58.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6L-c56iL57q_56iL5rOo5YWl">
        <h1 class="heading "><span>&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;</span></h1>
<p   
>&#20043;&#21069;&#25105;&#20204;&#26159;&#36828;&#31243;&#21019;&#24314;&#32447;&#31243;&#65292;&#35843;&#29992;&#30340;&#20063;&#26159;&#20154;&#23478;&#33258;&#24049;&#30340;&#32447;&#31243;&#20989;&#25968;&#65292;&#32780;&#22914;&#26524;&#25105;&#20204;&#24819;&#35201;&#21019;&#24314;&#36828;&#31243;&#32447;&#31243;&#35843;&#29992;&#33258;&#24049;&#23450;&#20041;&#30340;&#32447;&#31243;&#20989;&#25968;&#23601;&#38656;&#35201;&#20351;&#29992;<strong class=" ">&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;</strong>&#25216;&#26415;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5LuA5LmI5piv5rOo5YWl">
        <h2 class="heading "><span>&#20160;&#20040;&#26159;&#27880;&#20837;</span></h2>
<p   
>&#25152;&#35859;&#27880;&#20837;&#23601;&#26159;&#22312;&#31532;&#19977;&#26041;&#36827;&#31243;&#19981;&#30693;&#36947;&#25110;&#32773;&#19981;&#20801;&#35768;&#30340;&#24773;&#20917;&#19979;&#23558;&#27169;&#22359;&#25110;&#32773;&#20195;&#30721;&#20889;&#20837;&#23545;&#26041;&#36827;&#31243;&#31354;&#38388;&#65292;&#24182;&#35774;&#27861;&#25191;&#34892;&#30340;&#25216;&#26415;&#12290;</p>
<p   
>&#22312;&#23433;&#20840;&#39046;&#22495;&#65292;&ldquo;&#27880;&#20837;&rdquo;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#19968;&#31181;&#25216;&#26415;&#25163;&#27573;&#65292;&#27880;&#20837;&#19982;&#21453;&#27880;&#20837;&#20063;&#19968;&#30452;&#22788;&#20110;&#19981;&#26029;&#21464;&#21270;&#30340;&#65292;&#32780;&#19988;&#20063;&#24840;&#26469;&#24840;&#28608;&#28872;&#30340;&#23545;&#25239;&#24403;&#20013;&#12290;</p>
<p   
><strong class=" ">&#24050;&#30693;&#30340;&#27880;&#20837;&#26041;&#24335;&#65306;</strong></p>
<p   
>&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;&#12289;APC&#27880;&#20837;&#12289;&#28040;&#24687;&#38057;&#23376;&#27880;&#20837;&#12289;&#27880;&#20876;&#34920;&#27880;&#20837;&#12289;&#23548;&#20837;&#34920;&#27880;&#20837;&#12289;&#36755;&#20837;&#27861;&#27880;&#20837;&#31561;&#31561;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt6L-c56iL57q_56iL5rOo5YWl55qE5rWB56iL">
        <h2 class="heading "><span>&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;&#30340;&#27969;&#31243;</span></h2>
<p   
>&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;&#30340;&#24605;&#36335;&#23601;&#26159;&#22312;&#36827;&#31243;A&#20013;&#21019;&#24314;&#32447;&#31243;&#65292;<strong class=" ">&#23558;&#32447;&#31243;&#20989;&#25968;&#25351;&#21521;LoadLibrary&#20989;&#25968;</strong>&#12290;</p>
<p   
>&#37027;&#20040;&#20026;&#20160;&#20040;&#21487;&#20197;&#36825;&#26679;&#21602;&#65311;&#36825;&#26159;&#22240;&#20026;&#25105;&#20204;&#25191;&#34892;&#36828;&#31243;&#32447;&#31243;&#20989;&#25968;&#28385;&#36275;&#36820;&#22238;&#20540;&#26159;4&#23383;&#33410;&#65292;&#19968;&#20010;&#21442;&#25968;&#26159;4&#23383;&#33410;&#21363;&#21487;&#65288;ThreadProc&#23601;&#26159;&#36825;&#26679;&#30340;&#26465;&#20214;&#65289;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_15-6-49.png" alt="images/download/attachments/1015833/image2021-6-3_15-6-49.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#20877;&#26469;&#30475;&#19968;&#19979;<strong class=" ">LoadLibrary&#20989;&#25968;&#30340;&#35821;&#27861;&#26684;&#24335;</strong>&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HMODULE LoadLibrary(</code></div>
<div class="line"><code class="plain">  LPCTSTR lpFileName   </code><code class="comments">// file name of module</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#36319;&#36827;&#65288;F12&#65289;&#19968;&#19979;<strong class=" ">HMODULE&#21644;LPCTSTR&#36825;&#20004;&#20010;&#23439;&#30340;&#23450;&#20041;&#65292;&#23601;&#20250;&#21457;&#29616;&#20854;&#23454;&#37117;&#26159;4&#23383;&#33410;&#23485;&#24230;</strong>&#12290;</p>
<p   
>&#20855;&#20307;&#23454;&#29616;&#27493;&#39588;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_15-11-55.png" alt="images/download/attachments/1015833/image2021-6-3_15-11-55.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5aaC5L2V5omn6KGM5Luj56CB">
        <h2 class="heading "><span>&#22914;&#20309;&#25191;&#34892;&#20195;&#30721;</span></h2>
<p   
>DLL&#25991;&#20214;&#65292;&#22312;DLL&#25991;&#20214;&#20837;&#21475;&#20989;&#25968;&#21028;&#26029;&#24182;&#21019;&#24314;&#32447;&#31243;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// B.cpp : Defines the entry point for the DLL application.</code></div>
<div class="line"><code class="comments">//</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParaneter) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (;;) {</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"DLL RUNNING..."</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL APIENTRY DllMain( HANDLE hModule, </code></div>
<div class="line"><code class="plain">                       DWORD  ul_reason_for_call, </code></div>
<div class="line"><code class="plain">                       LPVOID lpReserved</code></div>
<div class="line"><code class="plain">                     )</code></div>
<div class="line"><code class="plain">{   </code><code class="comments">// 当进程执行LoadLibrary时创建一个线程，执行ThreadProc线程</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">switch</code><code class="plain"> (ul_reason_for_call) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> DLL_PROCESS_ATTACH:</code></div>
<div class="line"><code class="plain">        CreateThread(NULL, </code><code class="value">0</code><code class="plain">, ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25991;&#20214;&#25105;&#20204;&#29992;&#20043;&#21069;&#20889;&#30340;Test1.exe&#21363;&#21487;&#65292;&#23558;&#32534;&#35793;&#22909;&#30340;DLL&#21644;Test1.exe&#25918;&#22312;&#21516;&#19968;&#20010;&#30446;&#24405;&#24182;&#25171;&#24320;Test1.exe&#12290;</p>
<p   
>&#27880;&#20837;&#23454;&#29616;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// Test.cpp : Defines the entry point for the console application.</code></div>
<div class="line"><code class="comments">//</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#include </code><code class="string">"StdAfx.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// LoadDll需要两个参数一个参数是进程ID，一个是DLL文件的路径</code></div>
<div class="line"><code class="plain">BOOL LoadDll(DWORD dwProcessID, </code><code class="keyword">char</code><code class="plain">* szDllPathName) {</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    BOOL bRet;</code></div>
<div class="line"><code class="plain">    HANDLE hProcess;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    DWORD dwLength;</code></div>
<div class="line"><code class="plain">    DWORD dwLoadAddr;</code></div>
<div class="line"><code class="plain">    LPVOID lpAllocAddr;</code></div>
<div class="line"><code class="plain">    DWORD dwThreadID;</code></div>
<div class="line"><code class="plain">    HMODULE hModule;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    bRet = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    dwLoadAddr = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    hProcess = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取进程句柄</code></div>
<div class="line"><code class="plain">    hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hProcess == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"OpenProcess failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 获取DLL文件路径的长度，并在最后+1，因为要加上0结尾的长度</code></div>
<div class="line"><code class="plain">    dwLength = strlen(szDllPathName) + </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 在目标进程分配内存</code></div>
<div class="line"><code class="plain">    lpAllocAddr = VirtualAllocEx(hProcess, NULL, dwLength, MEM_COMMIT, PAGE_READWRITE);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (lpAllocAddr == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"VirtualAllocEx failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 拷贝DLL路径名字到目标进程的内存</code></div>
<div class="line"><code class="plain">    bRet = WriteProcessMemory(hProcess, lpAllocAddr, szDllPathName, dwLength, NULL);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!bRet) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"WriteProcessMemory failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 获取模块句柄</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// LoadLibrary这个函数是在kernel32.dll这个模块中的，所以需要先获取kernel32.dll这个模块的句柄</code></div>
<div class="line"><code class="plain">    hModule = GetModuleHandle(</code><code class="string">"kernel32.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!hModule) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"GetModuleHandle failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 获取LoadLibraryA函数地址</code></div>
<div class="line"><code class="plain">    dwLoadAddr = (DWORD)GetProcAddress(hModule, </code><code class="string">"LoadLibraryA"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!dwLoadAddr){</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"GetProcAddress failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 7. 创建远程线程，加载DLL</code></div>
<div class="line"><code class="plain">    hThread = CreateRemoteThread(hProcess, NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)dwLoadAddr, lpAllocAddr, </code><code class="value">0</code><code class="plain">, &amp;dwThreadID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!hThread){</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"CreateRemoteThread failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 8. 关闭进程句柄</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"><code class="plain">    CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[]) {</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    LoadDll(</code><code class="value">384</code><code class="plain">, </code><code class="string">"C:\\Documents and Settings\\Administrator\\桌面\\test\\B.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#27880;&#20837;&#25104;&#21151;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_15-38-24.png" alt="images/download/attachments/1015833/image2021-6-3_15-38-24.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt6L-b56iL6Ze06YCa5L-h">
        <h1 class="heading "><span>&#36827;&#31243;&#38388;&#36890;&#20449;</span></h1>
<p   
>&#21516;&#19968;&#21488;&#26426;&#22120;&#19978;&#36827;&#31243;&#20043;&#38388;&#30340;&#36890;&#20449;&#34429;&#28982;&#26377;&#24456;&#22810;&#31181;&#26041;&#27861;&#65292;&#20294;&#20854;&#26412;&#36136;&#23601;&#26159;&#20849;&#20139;&#20869;&#23384;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_21-19-13.png" alt="images/download/attachments/1015833/image2021-6-3_21-19-13.png" width="600"  />
    </p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Li-5L6L6K-05piO">
        <h2 class="heading "><span>&#20030;&#20363;&#35828;&#26126;</span></h2>
<p   
>&#20551;&#35774;&#29616;&#22312;&#25105;&#20204;<strong class=" ">&#36827;&#31243;A&#30340;&#20195;&#30721;</strong>&#26159;&#36825;&#26679;&#30340;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">void</code><code class="plain"> Attack()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"**********攻击********** \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> Rest()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"**********打坐********** \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">void</code><code class="plain"> Blood()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"**********加血********** \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[]) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">char</code><code class="plain"> cGetchar;</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"**********GAME BEGIN********** \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain">(</code><code class="value">1</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">        cGetchar = getchar();</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">switch</code><code class="plain">(cGetchar) {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">case</code><code class="plain"> </code><code class="string">'A'</code><code class="plain">:</code></div>
<div class="line"><code class="plain">            {</code></div>
<div class="line"><code class="plain">                Attack();</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">case</code><code class="plain"> </code><code class="string">'R'</code><code class="plain">:</code></div>
<div class="line"><code class="plain">            {</code></div>
<div class="line"><code class="plain">                Rest();</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">case</code><code class="plain"> </code><code class="string">'B'</code><code class="plain">:</code></div>
<div class="line"><code class="plain">            {</code></div>
<div class="line"><code class="plain">                Blood();</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#36825;&#23601;&#26159;&#33719;&#21462;&#36755;&#20837;&#30340;&#23383;&#31526;&#26469;&#25915;&#20987;&#12289;&#25171;&#22352;&#12289;&#21152;&#34880;&#30340;&#23567;&#31243;&#24207;&#65292;&#25105;&#20204;&#24819;&#35201;&#33258;&#21160;&#21270;&#30340;&#25511;&#21046;&#36825;&#20010;&#31243;&#24207;&#32780;&#19981;&#26159;&#33258;&#24049;&#36755;&#20837;&#35813;&#24590;&#20040;&#21150;&#65311;&#36825;&#26102;&#20505;&#23601;&#38656;&#35201;&#20351;&#29992;&#24179;&#26102;&#20013;&#22823;&#23478;&#24120;&#25552;&#30340;&#22806;&#25346;&#25216;&#26415;&#65292;&#22312;&#36825;&#37324;&#23454;&#38469;&#19978;&#23601;&#26159;<strong class=" ">&#36828;&#31243;&#32447;&#31243;&#27880;&#20837;&#65292;&#36890;&#36807;&#36827;&#31243;B&#25511;&#21046;&#36827;&#31243;A&#30340;&#25191;&#34892;&#27969;&#31243;</strong>&#12290;</p>
<p   
>&#22914;&#19979;&#26159;DLL&#25991;&#20214;&#30340;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// B.cpp : Defines the entry point for the DLL application.</code></div>
<div class="line"><code class="comments">//</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#include </code><code class="string">"stdafx.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#define _MAP_ </code><code class="string">"共享内存"</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="comments">// 首先需要获取函数的地址</code></div>
<div class="line"><code class="plain">#define ATTACK </code><code class="value">0x00401030</code></div>
<div class="line"><code class="plain">#define REST </code><code class="value">0x00401080</code></div>
<div class="line"><code class="plain">#define BLOOD </code><code class="value">0x004010D0</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#define BUFSIZE </code><code class="value">256</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HANDLE g_hModule;</code></div>
<div class="line"><code class="plain">HANDLE g_hMapFile;</code></div>
<div class="line"><code class="plain">LPTSTR lpBuffer;</code></div>
<div class="line"><code class="plain">DWORD dwType;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    dwType = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    g_hMapFile = OpenFileMapping(FILE_MAP_ALL_ACCESS, FALSE, _MAP_);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (g_hMapFile == NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"OpenFileMapping failed: %d"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">//映射内存</code></div>
<div class="line"><code class="plain">    lpBuffer = (LPTSTR)MapViewOfFile(g_hMapFile, FILE_MAP_ALL_ACCESS, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, BUFSIZE);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (;;)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (lpBuffer != NULL)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 读取数据</code></div>
<div class="line"><code class="plain">            CopyMemory(&amp;dwType, lpBuffer, </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (dwType == </code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 攻击</code></div>
<div class="line"><code class="plain">            __asm {</code></div>
<div class="line"><code class="plain">                mov eax, ATTACK</code></div>
<div class="line"><code class="plain">                call eax</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">            dwType == </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            CopyMemory(&amp;dwType, lpBuffer, </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (dwType == </code><code class="value">2</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 打坐</code></div>
<div class="line"><code class="plain">            __asm {</code></div>
<div class="line"><code class="plain">                mov eax, REST</code></div>
<div class="line"><code class="plain">                call eax</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">            dwType == </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            CopyMemory(&amp;dwType, lpBuffer, </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (dwType == </code><code class="value">3</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 加血</code></div>
<div class="line"><code class="plain">            __asm {</code></div>
<div class="line"><code class="plain">                mov eax, BLOOD</code></div>
<div class="line"><code class="plain">                call eax</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">            dwType == </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            CopyMemory(&amp;dwType, lpBuffer, </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (dwType == </code><code class="value">4</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">//卸载自身并退出</code></div>
<div class="line"><code class="plain">            FreeLibraryAndExitThread((HMODULE)g_hModule, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">500</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL APIENTRY DllMain( HMODULE hModule,</code></div>
<div class="line"><code class="plain">                      DWORD  ul_reason_for_call,</code></div>
<div class="line"><code class="plain">                      LPVOID lpReserved</code></div>
<div class="line"><code class="plain">                      )</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">switch</code><code class="plain"> (ul_reason_for_call) {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> DLL_PROCESS_ATTACH:</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            CreateThread(NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#25105;&#20204;&#39318;&#20808;&#38656;&#35201;&#33719;&#21462;&#20989;&#25968;&#30340;&#22320;&#22336;&#65292;&#36825;&#20010;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;VC6&#21453;&#27719;&#32534;&#26469;&#23547;&#25214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-6-28.png" alt="images/download/attachments/1015833/image2021-6-3_22-6-28.png" width="600"  />
    </p>
<p   
>&#32534;&#35793;&#22909;DLL&#20043;&#21518;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;&#36827;&#31243;B&#26469;&#25511;&#21046;&#36827;&#31243;A&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;tlhelp32.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdio.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">#define _MAP_ </code><code class="string">"共享内存"</code></div>
<div class="line"><code class="plain">#define BUFSIZE </code><code class="value">256</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">HANDLE g_hMapFile;</code></div>
<div class="line"><code class="plain">LPTSTR lpBuffer;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BOOL LoadDll(DWORD dwProcessID, </code><code class="keyword">char</code><code class="plain">* szDllPathName) {</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    BOOL bRet;</code></div>
<div class="line"><code class="plain">    HANDLE hProcess;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    DWORD dwLength;</code></div>
<div class="line"><code class="plain">    DWORD dwLoadAddr;</code></div>
<div class="line"><code class="plain">    LPVOID lpAllocAddr;</code></div>
<div class="line"><code class="plain">    DWORD dwThreadID;</code></div>
<div class="line"><code class="plain">    HMODULE hModule;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    bRet = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    dwLoadAddr = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    hProcess = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取进程句柄</code></div>
<div class="line"><code class="plain">    hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hProcess == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"OpenProcess failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 获取DLL文件路径的长度，并在最后+1，因为要加上0结尾的长度</code></div>
<div class="line"><code class="plain">    dwLength = strlen(szDllPathName) + </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 在目标进程分配内存</code></div>
<div class="line"><code class="plain">    lpAllocAddr = VirtualAllocEx(hProcess, NULL, dwLength, MEM_COMMIT, PAGE_READWRITE);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (lpAllocAddr == NULL) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"VirtualAllocEx failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 拷贝DLL路径名字到目标进程的内存</code></div>
<div class="line"><code class="plain">    bRet = WriteProcessMemory(hProcess, lpAllocAddr, szDllPathName, dwLength, NULL);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!bRet) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"WriteProcessMemory failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 获取模块句柄</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// LoadLibrary这个函数是在kernel32.dll这个模块中的，所以需要先获取kernel32.dll这个模块的句柄</code></div>
<div class="line"><code class="plain">    hModule = GetModuleHandle(</code><code class="string">"kernel32.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!hModule) {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"GetModuleHandle failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 获取LoadLibraryA函数地址</code></div>
<div class="line"><code class="plain">    dwLoadAddr = (DWORD)GetProcAddress(hModule, </code><code class="string">"LoadLibraryA"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!dwLoadAddr){</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"GetProcAddress failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 7. 创建远程线程，加载DLL</code></div>
<div class="line"><code class="plain">    hThread = CreateRemoteThread(hProcess, NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)dwLoadAddr, lpAllocAddr, </code><code class="value">0</code><code class="plain">, &amp;dwThreadID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!hThread){</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"CreateRemoteThread failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 8. 关闭进程句柄</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"><code class="plain">    CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">BOOL Init()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建共享内存</code></div>
<div class="line"><code class="plain">    g_hMapFile = CreateFileMapping(INVALID_HANDLE_VALUE, NULL, PAGE_READWRITE, </code><code class="value">0</code><code class="plain">, </code><code class="value">0x1000</code><code class="plain">, _MAP_);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (g_hMapFile == NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateFileMapping failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 映射内存</code></div>
<div class="line"><code class="plain">    lpBuffer = (LPTSTR)MapViewOfFile(g_hMapFile, FILE_MAP_ALL_ACCESS, </code><code class="value">0</code><code class="plain">, </code><code class="value">0</code><code class="plain">, BUFSIZE);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (lpBuffer == NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"MapViewOfFile failed! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 根据进程名称获取进程ID</code></div>
<div class="line"><code class="plain">DWORD GetPID(</code><code class="keyword">char</code><code class="plain"> *szName)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HANDLE hProcessSnapShot = NULL;</code></div>
<div class="line"><code class="plain">    PROCESSENTRY32 pe32 = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    hProcessSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hProcessSnapShot == (HANDLE)-</code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    pe32.dwSize = sizeof(PROCESSENTRY32);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (Process32First(hProcessSnapShot, &amp;pe32))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">do</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">if</code><code class="plain"> (!strcmp(szName, pe32.szExeFile)) {</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">return</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain">)pe32.th32ProcessID;</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">while</code><code class="plain"> (Process32Next(hProcessSnapShot, &amp;pe32));</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcessSnapShot);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="keyword">int</code><code class="plain"> main()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    DWORD dwCtrlCode = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 指令队列</code></div>
<div class="line"><code class="plain">    DWORD dwOrderList[</code><code class="value">10</code><code class="plain">] = {</code><code class="value">1</code><code class="plain">, </code><code class="value">1</code><code class="plain">, </code><code class="value">2</code><code class="plain">, </code><code class="value">3</code><code class="plain">, </code><code class="value">3</code><code class="plain">, </code><code class="value">1</code><code class="plain">, </code><code class="value">2</code><code class="plain">, </code><code class="value">1</code><code class="plain">, </code><code class="value">3</code><code class="plain">, </code><code class="value">4</code><code class="plain">};</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    printf(</code><code class="string">"Are you ready? \n"</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (Init()) {</code></div>
<div class="line"><code class="plain">        LoadDll(GetPID(</code><code class="string">"Test.exe"</code><code class="plain">), (</code><code class="keyword">char</code><code class="plain">*)</code><code class="string">"C:\\Documents and Settings\\Administrator\\桌面\\test\\B.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">for</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain"> i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">10</code><code class="plain">; i++)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        dwCtrlCode = dwOrderList[i];</code></div>
<div class="line"><code class="plain">        CopyMemory(lpBuffer, &amp;dwCtrlCode, </code><code class="value">4</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        Sleep(</code><code class="value">2000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25104;&#21151;&#25191;&#34892;&#24182;&#25511;&#21046;&#20102;&#36827;&#31243;A&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-20-26.png" alt="images/download/attachments/1015833/image2021-6-3_22-20-26.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5qih5Z2X6ZqQ6JeP">
        <h1 class="heading "><span>&#27169;&#22359;&#38544;&#34255;</span></h1>
<p   
>&#20043;&#21069;&#25105;&#20204;&#20102;&#35299;&#20102;&#30452;&#25509;&#27880;&#20837;&#19968;&#20010;DLL&#21040;&#36827;&#31243;&#20013;&#65292;&#20294;&#26159;&#36825;&#26679;&#23454;&#38469;&#19978;&#26159;&#24456;&#38590;&#23384;&#27963;&#30340;&#65292;&#22240;&#20026;&#31243;&#24207;&#24456;&#23481;&#26131;&#23601;&#21487;&#20197;&#36890;&#36807;API&#26469;&#33719;&#21462;&#24403;&#21069;&#21152;&#36733;&#30340;DLL&#27169;&#22359;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#20351;&#29992;&#27169;&#22359;&#38544;&#34255;&#25216;&#26415;&#26469;&#38544;&#34255;&#33258;&#24049;&#38656;&#35201;&#27880;&#20837;&#30340;DLL&#27169;&#22359;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5qih5Z2X6ZqQ6JeP5LmL5pat6ZO-">
        <h2 class="heading "><span>&#27169;&#22359;&#38544;&#34255;&#20043;&#26029;&#38142;</span></h2>
<p   
>API&#26159;&#36890;&#36807;&#20160;&#20040;&#23558;&#27169;&#22359;&#26597;&#35810;&#20986;&#26469;&#30340;&#65311;&#20854;&#23454;API&#37117;&#26159;&#20174;&#36825;&#20960;&#20010;&#32467;&#26500;&#20307;&#65288;<strong class=" ">&#32467;&#26500;&#20307;&#23646;&#20110;3&#29615;&#24212;&#29992;&#23618;</strong>&#65289;&#20013;&#26597;&#35810;&#20986;&#26469;&#30340;&#65306;</p>
<ol class=" "><li class=" "><p   
>TEB(Thread Environment Block&#65292;&#32447;&#31243;&#29615;&#22659;&#22359;)&#65292;&#23427;&#23384;&#25918;&#32447;&#31243;&#30340;&#30456;&#20851;&#20449;&#24687;&#65292;&#27599;&#19968;&#20010;&#32447;&#31243;&#37117;&#26377;&#33258;&#24049;&#30340;TEB&#20449;&#24687;&#65292;FS:[0]&#21363;&#26159;&#24403;&#21069;&#32447;&#31243;&#30340;TEB&#12290;</p>
</li><li class=" "><p   
>PEB(Process Environment Block&#65292;&#36827;&#31243;&#29615;&#22659;&#22359;)&#65292;&#23427;&#23384;&#25918;&#36827;&#31243;&#30340;&#30456;&#20851;&#20449;&#24687;&#65292;&#27599;&#20010;&#36827;&#31243;&#37117;&#26377;&#33258;&#24049;&#30340;PEB&#20449;&#24687;&#65292;FS:[0x30]&#21363;&#24403;&#21069;&#36827;&#31243;&#30340;PEB&#12290;</p>
</li></ol><p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65288;&#21482;&#20171;&#32461;&#19982;&#26412;&#31456;&#33410;&#30456;&#20851;&#30340;&#20449;&#24687;&#65289;</p>
<ol class=" "><li class=" "><p   
>TEB&#31532;&#19968;&#20010;&#25104;&#21592;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#36825;&#20010;&#32467;&#26500;&#20307;&#21253;&#21547;&#20102;&#24403;&#21069;&#32447;&#31243;&#26632;&#26632;&#24213;&#21644;&#24403;&#21069;&#32447;&#31243;&#26632;&#30340;&#30028;&#38480;&#65307;TEB&#30340;<strong class=" ">020</strong>&#20559;&#31227;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#20854;&#21253;&#21547;&#20102;&#20004;&#20010;&#25104;&#21592;&#65292;&#19968;&#20010;&#26159;&#24403;&#21069;&#32447;&#31243;&#25152;&#22312;&#36827;&#31243;&#30340;PID&#21644;&#24403;&#21069;&#32447;&#31243;&#33258;&#24049;&#30340;&#32447;&#31243;ID&#65307;</p>
</li><li class=" "><p   
>PEB&#30340;<strong class=" ">00c</strong>&#20559;&#31227;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#36825;&#20010;&#32467;&#26500;&#20307;&#21253;&#25324;<strong class=" ">&#27169;&#22359;&#38142;&#34920;</strong>&#65292;API&#20989;&#25968;&#36941;&#21382;&#27169;&#22359;&#23601;&#26159;&#26597;&#30475;&#36825;&#20010;&#38142;&#34920;&#12290;</p>
</li></ol><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-31-12.png" alt="images/download/attachments/1015833/image2021-6-3_22-31-12.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#22914;&#20309;&#21435;&#33719;&#21462;&#36825;&#20010;<strong class=" ">TEB&#32467;&#26500;&#20307;</strong>&#21602;&#65311;&#25105;&#20204;&#21487;&#20197;&#38543;&#20415;&#25214;&#19968;&#20010;EXE&#25302;&#36827;DTDebug&#65292;&#28982;&#21518;&#26469;&#30475;&#19968;&#19979;<strong class=" ">FS&#23492;&#23384;&#22120;</strong>&#65288;&#30446;&#21069;&#20320;&#21482;&#38656;&#35201;&#30693;&#36947;TEB&#30340;&#22320;&#22336;&#23601;&#23384;&#20648;&#22312;FS&#23492;&#23384;&#22120;&#20013;&#21363;&#21487;&#65292;&#20855;&#20307;&#32454;&#33410;&#22312;&#20013;&#32423;&#35838;&#31243;&#20013;&#65289;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-41-14.png" alt="images/download/attachments/1015833/image2021-6-3_22-41-14.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#21487;&#20197;&#22312;&#24038;&#19979;&#35282;&#20351;&#29992;<strong class=" ">dd 7FFDF000</strong>&#21629;&#20196;&#26469;&#26597;&#30475;TEB&#32467;&#26500;&#20307;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-44-58.png" alt="images/download/attachments/1015833/image2021-6-3_22-44-58.png" width="600"  />
    </p>
<p   
>FS&#23492;&#23384;&#22120;&#20013;&#23384;&#20648;&#30340;&#23601;&#26159;&#24403;&#21069;&#27491;&#22312;&#20351;&#29992;&#30340;&#32447;&#31243;&#30340;TEB&#32467;&#26500;&#20307;&#30340;&#22320;&#22336;&#12290;</p>
<p   
>PEB&#32467;&#26500;&#20307;&#21516;&#29702;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#25214;&#21040;FS&#23492;&#23384;&#22120;&#20013;&#23384;&#20648;&#22320;&#22336;&#30340;0x30&#20559;&#31227;&#28982;&#21518;&#36319;&#36827;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-51-48.png" alt="images/download/attachments/1015833/image2021-6-3_22-51-48.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-52-17.png" alt="images/download/attachments/1015833/image2021-6-3_22-52-17.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_22-52-21.png" alt="images/download/attachments/1015833/image2021-6-3_22-52-21.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#20043;&#21069;&#24050;&#32463;&#20102;&#35299;&#21040;&#20102;API&#20989;&#25968;&#36941;&#21382;&#27169;&#22359;&#23601;&#26159;&#26597;&#30475;PEB&#37027;&#20010;&#38142;&#34920;&#65292;&#25152;&#20197;&#25105;&#20204;&#35201;&#24819;&#21150;&#27861;&#35753;&#23427;<strong class=" ">&#22312;&#26597;&#35810;&#30340;&#26102;&#20505;&#26029;&#38142;</strong>&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5pat6ZO-5a6e546w5Luj56CB">
        <h3 class="heading "><span>&#26029;&#38142;&#23454;&#29616;&#20195;&#30721;</span></h3>
<p   
>&#22914;&#19979;&#25105;&#20204;&#36890;&#36807;&#26029;&#38142;&#30340;&#26041;&#24335;&#23454;&#29616;&#20102;&#19968;&#20010;&#38544;&#34255;&#27169;&#22359;&#30340;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">void</code><code class="plain"> HideModule(</code><code class="keyword">char</code><code class="plain">* szModuleName) {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 获取模块的句柄</code></div>
<div class="line"><code class="plain">    HMODULE hMod = GetModuleHandle(szModuleName);</code></div>
<div class="line"><code class="plain">    PLIST_ENTRY Head, Cur;</code></div>
<div class="line"><code class="plain">    PPEB_LDR_DATA ldr;</code></div>
<div class="line"><code class="plain">    PLDR_MODULE ldmod;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    __asm {</code></div>
<div class="line"><code class="plain">        mov eax, fs:[</code><code class="value">0x30</code><code class="plain">] </code><code class="comments">// 取PEB结构体</code></div>
<div class="line"><code class="plain">        mov ecx, [eax + </code><code class="value">0x0c</code><code class="plain">] </code><code class="comments">// 取PEB结构体的00c偏移的结构体，就是PEB_LDR_DATA</code></div>
<div class="line"><code class="plain">        mov ldr, ecx </code><code class="comments">// 将ecx给到ldr</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 获取正在加载的模块列表</code></div>
<div class="line"><code class="plain">    Head = &amp;(ldr-&gt;InLoadOrderModuleList);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// </code></div>
<div class="line"><code class="plain">    Cur = Head-&gt;Flink;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">do</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 宏CONTAINING_RECORD根据结构体中某成员的地址来推算出该结构体整体的地址</code></div>
<div class="line"><code class="plain">        ldmod = CONTAINING_RECORD(Cur, LDR_MODULE, InLoadOrderModuleList);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 循环遍历，如果地址一致则表示找到对应模块来，就进行断链</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain">(hMod == ldmod-&gt;BaseAddress) {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 断链原理很简单就是将属性交错替换</code></div>
<div class="line"><code class="plain">            ldmod-&gt;InLoadOrderModuleList.Blink-&gt;Flink = ldmod-&gt;InLoadOrderModuleList.Flink;</code></div>
<div class="line"><code class="plain">            ldmod-&gt;InLoadOrderModuleList.Flink-&gt;Blink = ldmod-&gt;InLoadOrderModuleList.Blink;</code></div>
<div class="line"><code class="plain">            </code></div>
<div class="line"><code class="plain">            ldmod-&gt;InInitializationOrderModuleList.Blink-&gt;Flink = ldmod-&gt;InInitializationOrderModuleList.Flink;</code></div>
<div class="line"><code class="plain">            ldmod-&gt;InInitializationOrderModuleList.Flink-&gt;Blink = ldmod-&gt;InInitializationOrderModuleList.Blink;</code></div>
<div class="line"><code class="plain">            </code></div>
<div class="line"><code class="plain">            ldmod-&gt;InMemoryOrderModuleList.Blink-&gt;Flink = ldmod-&gt;InMemoryOrderModuleList.Flink;</code></div>
<div class="line"><code class="plain">            ldmod-&gt;InMemoryOrderModuleList.Flink-&gt;Blink = ldmod-&gt;InMemoryOrderModuleList.Blink;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        Cur = Cur-&gt;Flink;</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">while</code><code class="plain"> (Head != Cur);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#35843;&#29992;&#38544;&#34255;kernel32.dll&#36825;&#20010;&#27169;&#22359;&#65292;&#28982;&#21518;&#29992;DTDebug&#26469;&#26597;&#30475;&#19968;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[]) {</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    HideModule(</code><code class="string">"kernel32.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#32534;&#35793;&#25171;&#24320;&#65288;&#19981;&#20351;&#29992;VC6&#25171;&#24320;&#65289;Test.exe&#28982;&#21518;&#20351;&#29992;DTDebug&#26469;Attach&#36827;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-28-46.png" alt="images/download/attachments/1015833/image2021-6-3_23-28-46.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-29-2.png" alt="images/download/attachments/1015833/image2021-6-3_23-29-2.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-28-54.png" alt="images/download/attachments/1015833/image2021-6-3_23-28-54.png" width="600"  />
    </p>
<p   
>&#27492;&#21051;&#25105;&#20204;&#26159;&#21487;&#20197;&#30475;&#35265;kernel32.dll&#27169;&#22359;&#30340;&#65292;&#20294;&#26159;&#24403;&#25105;&#20204;&#22238;&#36710;&#19968;&#19979;&#20877;&#26469;&#30475;&#23601;&#28040;&#22833;&#20102;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-30-17.png" alt="images/download/attachments/1015833/image2021-6-3_23-30-17.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5qih5Z2X6ZqQ6JeP5LmLUEXmjIfnurk">
        <h2 class="heading "><span>&#27169;&#22359;&#38544;&#34255;&#20043;PE&#25351;&#32441;</span></h2>
<p   
>&#39318;&#20808;&#25105;&#20204;&#26469;&#30475;&#26576;&#19968;&#20010;&#27169;&#22359;&#30340;PE&#25351;&#32441;&#65292;&#36825;&#37324;&#23601;&#29992;ntdll.dll&#20030;&#20363;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-30-17.png" alt="images/download/attachments/1015833/image2021-6-3_23-30-17.png" width="600"  />
    </p>
<p   
>&#20854;&#22320;&#22336;&#26159;7c920000&#65292;&#25105;&#20204;&#22312;DTDebug&#20013;&#20351;&#29992;&#21629;&#20196;db 7c920000&#21363;&#21487;&#30475;&#21040;&#35813;&#27169;&#22359;&#30340;&#20449;&#24687;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-39-28.png" alt="images/download/attachments/1015833/image2021-6-3_23-39-28.png" width="600"  />
    </p>
<p   
>&#35813;&#27169;&#22359;&#24320;&#22836;&#20004;&#20010;&#23383;&#33410;&#26159;4D 5A&#65292;<strong class=" ">&#20063;&#23601;&#26159;MZ</strong>&#65292;&#24403;&#30475;&#35265;&#36825;&#20004;&#20010;&#23383;&#33410;&#21518;&#65292;&#22312;&#20854;&#20301;&#32622;&#21521;&#21518;&#25214;&#31532;64&#23383;&#33410;&#65292;&#21457;&#29616;&#26159;E0&#65292;&#37027;&#20040;&#23601;&#20174;&#27169;&#22359;&#36215;&#22987;&#20301;&#32622;0x7c920000&#21152;0xE0&#65292;&#36825;&#26679;&#23601;&#25104;&#20102;<strong class=" ">0x7c9200E0</strong>&#65292;&#28982;&#21518;&#25105;&#20204;&#25214;&#21040;&#23545;&#24212;&#22320;&#22336;&#30340;&#20004;&#20010;&#23383;&#33410;&#20026;50 45&#65292;<strong class=" ">&#20063;&#23601;&#26159;PE</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-39-4.png" alt="images/download/attachments/1015833/image2021-6-3_23-39-4.png" width="600"  />
    </p>
<p   
>&#36825;&#23601;&#26159;&#19968;&#20010;PE&#25351;&#32441;&#65292;&#22914;&#26524;&#33021;&#28385;&#36275;&#36825;&#19968;&#22871;&#27969;&#31243;&#21017;&#34920;&#31034;&#36825;&#26159;&#19968;&#20010;&#27169;&#22359;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5qih5Z2X6ZqQ6JeP5LmLVkFE5qCR">
        <h2 class="heading "><span>&#27169;&#22359;&#38544;&#34255;&#20043;VAD&#26641;</span></h2>
<p   
>&#36825;&#37324;&#28041;&#21450;&#20869;&#26680;&#30693;&#35782;&#65292;&#24314;&#35758;&#35266;&#30475;&#35270;&#39057;&#31616;&#21333;&#35762;&#35299;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015833_safe-id-V2luMzIt5rOo5YWl5Luj56CB">
        <h1 class="heading "><span>&#27880;&#20837;&#20195;&#30721;</span></h1>
<p   
>&#26368;&#22909;&#30340;&#38544;&#34255;&#26159;&#26080;&#27169;&#22359;&#27880;&#20837;&#65292;&#20063;&#23601;&#26159;&#20195;&#30721;&#27880;&#20837;&#65292;&#23558;&#25105;&#20204;&#24819;&#35201;&#25191;&#34892;&#30340;&#20195;&#30721;&#27880;&#20837;&#36827;&#21435;&#12290;</p>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5rOo5YWl5Luj56CB55qE5oCd6Lev">
        <h2 class="heading "><span>&#27880;&#20837;&#20195;&#30721;&#30340;&#24605;&#36335;</span></h2>
<p   
>&#25105;&#20204;&#21487;&#20197;&#23558;&#33258;&#23450;&#20041;&#20989;&#25968;&#22797;&#21046;&#21040;&#30446;&#26631;&#36827;&#31243;&#20013;&#65292;&#36825;&#26679;&#30446;&#26631;&#36827;&#31243;&#23601;&#21487;&#20197;&#25191;&#34892;&#25105;&#20204;&#24819;&#35201;&#25191;&#34892;&#30340;&#20195;&#30721;&#20102;&#65292;&#36825;&#23601;&#26159;&#27880;&#20837;&#20195;&#30721;&#30340;&#24605;&#36335;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-49-55.png" alt="images/download/attachments/1015833/image2021-6-3_23-49-55.png" width="600"  />
    </p>
<p   
>&#21548;&#36215;&#26469;&#24456;&#31616;&#21333;&#65292;&#20294;&#26159;&#20854;&#20013;&#26377;&#24456;&#22810;&#38382;&#39064;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#20320;&#35201;&#23558;&#33258;&#23450;&#20041;&#20989;&#25968;&#22797;&#21046;&#21040;&#30446;&#26631;&#36827;&#31243;&#20013;&#65292;&#20320;&#22797;&#21046;&#30340;&#19996;&#35199;&#26412;&#36136;&#26159;&#20160;&#20040;&#65311;</p>
</li><li class=" "><p   
>&#20320;&#22797;&#21046;&#36807;&#21435;&#23601;&#19968;&#23450;&#21487;&#20197;&#25191;&#34892;&#21527;&#65311;&#21069;&#25552;&#26465;&#20214;&#26159;&#20160;&#20040;&#65311;</p>
</li></ol>    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5py65Zmo56CB">
        <h3 class="heading "><span>&#26426;&#22120;&#30721;</span></h3>
<p   
>&#39318;&#20808;&#25105;&#20204;&#26469;&#35299;&#20915;&#19968;&#19979;&#31532;&#19968;&#20010;&#38382;&#39064;&#65292;&#25105;&#20204;&#20043;&#21069;&#36890;&#36807;VC6&#26159;&#21487;&#20197;&#26597;&#30475;&#21453;&#27719;&#32534;&#20195;&#30721;&#30340;&#65292;&#32780;&#23454;&#38469;&#19978;&#19968;&#20010;&#31243;&#24207;&#33021;&#30475;&#35265;&#20855;&#20307;&#30340;&#27719;&#32534;&#20195;&#30721;&#21527;&#65311;&#20854;&#23454;&#19981;&#21487;&#20197;&#65292;&#20854;&#34920;&#29616;&#24418;&#24335;&#24212;&#35813;&#26159;&#26426;&#22120;&#30721;&#65292;<strong class=" ">&#22914;&#19979;&#22270;&#25152;&#31034;&#24038;&#36793;&#26159;&#26426;&#22120;&#30721;&#65292;&#21491;&#36793;&#26159;&#26426;&#22120;&#30721;&#23545;&#24212;&#30340;&#27719;&#32534;&#20195;&#30721;&#65292;&#25105;&#20204;&#33021;&#30475;&#35265;&#27719;&#32534;&#20195;&#30721;&#26159;&#22240;&#20026;VC6&#30340;&#21453;&#27719;&#32534;&#24341;&#25806;&#23558;&#26426;&#22120;&#30721;&#36716;&#20026;&#27719;&#32534;&#20195;&#30721;</strong>&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-3_23-54-59.png" alt="images/download/attachments/1015833/image2021-6-3_23-54-59.png" width="600"  />
    </p>
<p   
>&#25152;&#20197;&#25105;&#20204;<strong class=" ">&#25335;&#36125;&#36807;&#21435;&#30340;&#24212;&#35813;&#26159;&#26426;&#22120;&#30721;</strong>&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5YmN5o-Q5p2h5Lu2">
        <h3 class="heading "><span>&#21069;&#25552;&#26465;&#20214;</span></h3>
<p   
>&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#20043;&#38388;&#36890;&#36807;<strong class=" ">&#30828;&#32534;&#30721;&#22320;&#22336;&#35843;&#29992;</strong>&#30340;&#26426;&#22120;&#30721;&#23601;<strong class=" ">&#27809;&#27861;&#27880;&#20837;</strong>&#25191;&#34892;&#65292;&#22240;&#20026;&#30446;&#26631;&#36827;&#31243;&#19981;&#21487;&#33021;&#20250;&#26377;&#30446;&#26631;&#22320;&#22336;&#20869;&#23384;&#32473;&#20320;&#36827;&#34892;&#20351;&#29992;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-4_0-0-15.png" alt="images/download/attachments/1015833/image2021-6-4_0-0-15.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5aSN5Yi25Luj56CB55qE57yW5YaZ5Y6f5YiZ">
        <h2 class="heading "><span>&#22797;&#21046;&#20195;&#30721;&#30340;&#32534;&#20889;&#21407;&#21017;</span></h2>
<ol class=" "><li class=" "><p   
>&#19981;&#33021;&#26377;&#20840;&#23616;&#21464;&#37327;</p>
</li><li class=" "><p   
>&#19981;&#33021;&#20351;&#29992;&#24120;&#37327;&#23383;&#31526;&#20018;</p>
</li><li class=" "><p   
>&#19981;&#33021;&#20351;&#29992;&#31995;&#32479;&#35843;&#29992;</p>
</li><li class=" "><p   
>&#19981;&#33021;&#23884;&#22871;&#35843;&#29992;&#20854;&#20182;&#20989;&#25968;</p>
</li></ol>    </div>
    <div class="section section-2" id="src-1015833_safe-id-V2luMzIt5Lyg6YCS5Y-C5pWw">
        <h2 class="heading "><span>&#20256;&#36882;&#21442;&#25968;</span></h2>
<p   
>&#26377;&#36825;&#20040;&#22810;&#38480;&#21046;&#35813;&#24590;&#20040;&#21150;&#65311;&#20551;&#35774;&#25105;&#20204;&#35201;&#23558;&#20195;&#30721;&#36827;&#31243;&#30340;&#20195;&#30721;&#25335;&#36125;&#36807;&#21435;&#65292;&#36825;&#27573;&#20195;&#30721;&#30340;&#20316;&#29992;&#23601;&#26159;&#21019;&#24314;&#25991;&#20214;&#65292;&#37027;&#20040;&#23427;&#24471;&#27969;&#31243;&#21487;&#20197;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015833/image2021-6-4_0-7-56.png" alt="images/download/attachments/1015833/image2021-6-4_0-7-56.png" width="600"  />
    </p>
<p   
>&#39318;&#20808;&#23558;&#20195;&#30721;&#36827;&#31243;&#30340;ThreadProc&#22797;&#21046;&#36807;&#21435;&#65292;&#28982;&#21518;&#23558;&#22797;&#21046;&#36807;&#21435;&#20043;&#21518;&#30446;&#26631;&#36827;&#31243;&#30340;&#22320;&#22336;&#32473;&#21040;<strong class=" ">CreateRemoteThread</strong>&#20989;&#25968;&#65292;&#36825;&#26679;&#23601;&#35299;&#20915;&#20102;&#33258;&#23450;&#20041;&#20989;&#25968;&#30340;&#38382;&#39064;&#65307;</p>
<p   
>&#20854;&#27425;&#25105;&#20204;&#35201;&#21019;&#24314;&#25991;&#20214;&#30340;&#35805;&#23601;&#24517;&#39035;&#35201;&#20351;&#29992;<strong class=" ">CreateFile</strong>&#20989;&#25968;&#65292;&#25105;&#20204;&#19981;&#33021;&#30452;&#25509;&#36825;&#26679;&#20889;&#65292;&#22240;&#20026;&#23427;&#20381;&#36182;&#24403;&#21069;&#36827;&#31243;&#30340;&#23548;&#20837;&#34920;&#65292;&#24403;&#21069;&#36827;&#31243;&#21644;&#30446;&#26631;&#36827;&#31243;&#23548;&#20837;&#34920;&#30340;&#22320;&#22336;&#32943;&#23450;&#26159;&#19981;&#19968;&#26679;&#30340;&#65292;<strong class=" ">&#25152;&#20197;&#19981;&#31526;&#21512;&#22797;&#21046;&#20195;&#30721;&#30340;&#32534;&#20889;&#21407;&#21017;</strong>&#65307;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#32447;&#31243;&#20989;&#25968;&#30340;&#21442;&#25968;&#26469;&#35299;&#20915;&#65292;&#25105;&#20204;&#20808;&#23558;&#25152;&#26377;&#29992;&#21040;&#30340;&#30446;&#26631;&#21442;&#25968;&#20889;&#21040;&#19968;&#20010;&#32467;&#26500;&#20307;&#20013;&#22797;&#21046;&#21040;&#30446;&#26631;&#36827;&#31243;&#65292;&#28982;&#21518;&#23558;&#30446;&#26631;&#36827;&#31243;&#32467;&#26500;&#20307;&#30340;&#22320;&#22336;&#20316;&#20026;&#32447;&#31243;&#20989;&#25968;&#30340;&#21442;&#25968;&#12290;</p>
    <div class="section section-3" id="src-1015833_safe-id-V2luMzIt5Luj56CB5a6e546w">
        <h3 class="heading "><span>&#20195;&#30721;&#23454;&#29616;</span></h3>
<p   
>&#22914;&#19979;&#26159;&#20256;&#36882;&#21442;&#25968;&#36827;&#34892;&#36828;&#31243;&#27880;&#20837;&#20195;&#30721;&#30340;&#23454;&#29616;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;tlhelp32.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdio.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">typedef struct {</code></div>
<div class="line"><code class="plain">    DWORD dwCreateAPIAddr;                </code><code class="comments">// Createfile函数的地址</code></div>
<div class="line"><code class="plain">    LPCTSTR lpFileName;                    </code><code class="comments">// 下面都是CreateFile所需要用到的参数</code></div>
<div class="line"><code class="plain">    DWORD dwDesiredAccess;</code></div>
<div class="line"><code class="plain">    DWORD dwShareMode;</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpSecurityAttributes;</code></div>
<div class="line"><code class="plain">    DWORD dwCreationDisposition;</code></div>
<div class="line"><code class="plain">    DWORD dwFlagsAndAttributes;</code></div>
<div class="line"><code class="plain">    HANDLE hTemplateFile;</code></div>
<div class="line"><code class="plain">} CREATEFILE_PARAM;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 定义一个函数指针</code></div>
<div class="line"><code class="plain">typedef HANDLE(WINAPI* PFN_CreateFile) (</code></div>
<div class="line"><code class="plain">    LPCTSTR lpFileName,</code></div>
<div class="line"><code class="plain">    DWORD dwDesiredAccess,</code></div>
<div class="line"><code class="plain">    DWORD dwShareMode,</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpSecurityAttributes,</code></div>
<div class="line"><code class="plain">    DWORD dwCreationDisposition,</code></div>
<div class="line"><code class="plain">    DWORD dwFlagsAndAttributes,</code></div>
<div class="line"><code class="plain">    HANDLE hTemplateFile</code></div>
<div class="line"><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 编写要复制到目标进程的函数</code></div>
<div class="line"><code class="plain">DWORD _stdcall CreateFileThreadProc(LPVOID lparam)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    CREATEFILE_PARAM* Gcreate = (CREATEFILE_PARAM*)lparam;</code></div>
<div class="line"><code class="plain">    PFN_CreateFile pfnCreateFile;</code></div>
<div class="line"><code class="plain">    pfnCreateFile = (PFN_CreateFile)Gcreate-&gt;dwCreateAPIAddr;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// creatFile结构体全部参数</code></div>
<div class="line"><code class="plain">    pfnCreateFile(</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;lpFileName,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;dwDesiredAccess,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;dwShareMode,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;lpSecurityAttributes,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;dwCreationDisposition,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;dwFlagsAndAttributes,</code></div>
<div class="line"><code class="plain">        Gcreate-&gt;hTemplateFile</code></div>
<div class="line"><code class="plain">    );</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 远程创建文件</code></div>
<div class="line"><code class="plain">BOOL RemotCreateFile(DWORD dwProcessID, </code><code class="keyword">char</code><code class="plain">* szFilePathName)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    BOOL bRet;</code></div>
<div class="line"><code class="plain">    DWORD dwThread;</code></div>
<div class="line"><code class="plain">    HANDLE hProcess;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    DWORD dwThreadFunSize;</code></div>
<div class="line"><code class="plain">    CREATEFILE_PARAM GCreateFile;</code></div>
<div class="line"><code class="plain">    LPVOID lpFilePathName;</code></div>
<div class="line"><code class="plain">    LPVOID lpRemotThreadAddr;</code></div>
<div class="line"><code class="plain">    LPVOID lpFileParamAddr;</code></div>
<div class="line"><code class="plain">    DWORD dwFunAddr;</code></div>
<div class="line"><code class="plain">    HMODULE hModule;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    bRet = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    hProcess = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    dwThreadFunSize = </code><code class="value">0x400</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取进程的句柄</code></div>
<div class="line"><code class="plain">    hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hProcess == NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"OpenProcessError! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 分配3段内存：存储参数，线程函数，文件名</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2.1 用来存储文件名 +1是要计算到结尾处</code></div>
<div class="line"><code class="plain">    lpFilePathName = VirtualAllocEx(hProcess, NULL, strlen(szFilePathName)+</code><code class="value">1</code><code class="plain">, MEM_COMMIT, PAGE_READWRITE); </code><code class="comments">// 在指定的进程中分配内存</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2.2 用来存储线程函数</code></div>
<div class="line"><code class="plain">    lpRemotThreadAddr = VirtualAllocEx(hProcess, NULL, dwThreadFunSize, MEM_COMMIT, PAGE_READWRITE); </code><code class="comments">// 在指定的进程中分配内存</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 2.3 用来存储文件参数</code></div>
<div class="line"><code class="plain">    lpFileParamAddr = VirtualAllocEx(hProcess, NULL, sizeof(CREATEFILE_PARAM), MEM_COMMIT, PAGE_READWRITE); </code><code class="comments">// 在指定的进程中分配内存</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 初始化CreateFile参数</code></div>
<div class="line"><code class="plain">    GCreateFile.dwDesiredAccess = GENERIC_READ | GENERIC_WRITE;</code></div>
<div class="line"><code class="plain">    GCreateFile.dwShareMode = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    GCreateFile.lpSecurityAttributes = NULL;</code></div>
<div class="line"><code class="plain">    GCreateFile.dwCreationDisposition = OPEN_ALWAYS;</code></div>
<div class="line"><code class="plain">    GCreateFile.dwFlagsAndAttributes = FILE_ATTRIBUTE_NORMAL;</code></div>
<div class="line"><code class="plain">    GCreateFile.hTemplateFile = NULL;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 获取CreateFile的地址</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 因为每个进程中的LoadLibrary函数都在Kernel32.dll中，而且此dll的物理页是共享的，所以我们进程中获得的LoadLibrary地址和别的进程都是一样的</code></div>
<div class="line"><code class="plain">    hModule = GetModuleHandle(</code><code class="string">"kernel32.dll"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    GCreateFile.dwCreateAPIAddr = (DWORD)GetProcAddress(hModule, </code><code class="string">"CreateFileA"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    FreeLibrary(hModule);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 初始化CreatFile文件名</code></div>
<div class="line"><code class="plain">    GCreateFile.lpFileName = (LPCTSTR)lpFilePathName;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 修改线程函数起始地址</code></div>
<div class="line"><code class="plain">    dwFunAddr = (DWORD)CreateFileThreadProc;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 间接跳</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (*((BYTE*)dwFunAddr) == </code><code class="value">0xE9</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        dwFunAddr = dwFunAddr + </code><code class="value">5</code><code class="plain"> + *(DWORD*)(dwFunAddr + </code><code class="value">1</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 7. 开始复制</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 7.1 拷贝文件名</code></div>
<div class="line"><code class="plain">    WriteProcessMemory(hProcess, lpFilePathName, szFilePathName, strlen(szFilePathName) + </code><code class="value">1</code><code class="plain">, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 7.2 拷贝线程函数</code></div>
<div class="line"><code class="plain">    WriteProcessMemory(hProcess, lpRemotThreadAddr, (LPVOID)dwFunAddr, dwThreadFunSize, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 7.3 拷贝参数</code></div>
<div class="line"><code class="plain">    WriteProcessMemory(hProcess, lpFileParamAddr, &amp;GCreateFile, sizeof(CREATEFILE_PARAM), </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 8. 创建远程线程</code></div>
<div class="line"><code class="plain">    hThread = CreateRemoteThread(hProcess, NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)lpRemotThreadAddr, lpFileParamAddr, </code><code class="value">0</code><code class="plain">, &amp;dwThread);</code><code class="comments">// lpAllocAddr传给线程函数的参数.因为dll名字分配在内存中</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hThread == NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        OutputDebugString(</code><code class="string">"CreateRemoteThread Error! \n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">        CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 9. 关闭资源</code></div>
<div class="line"><code class="plain">    CloseHandle(hProcess);</code></div>
<div class="line"><code class="plain">    CloseHandle(hThread);</code></div>
<div class="line"><code class="plain">    CloseHandle(hModule);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 根据进程名称获取进程ID</code></div>
<div class="line"><code class="plain">DWORD GetPID(</code><code class="keyword">char</code><code class="plain"> *szName)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HANDLE hProcessSnapShot = NULL;</code></div>
<div class="line"><code class="plain">    PROCESSENTRY32 pe32 = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    hProcessSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, </code><code class="value">0</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (hProcessSnapShot == (HANDLE)-</code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    pe32.dwSize = sizeof(PROCESSENTRY32);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (Process32First(hProcessSnapShot, &amp;pe32))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">do</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">if</code><code class="plain"> (!strcmp(szName, pe32.szExeFile)) {</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">return</code><code class="plain"> (</code><code class="keyword">int</code><code class="plain">)pe32.th32ProcessID;</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">while</code><code class="plain"> (Process32Next(hProcessSnapShot, &amp;pe32));</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        CloseHandle(hProcessSnapShot);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    RemotCreateFile(GetPID(</code><code class="string">"进程名"</code><code class="plain">), </code><code class="string">"文件名"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="C%2B%2B%E8%AF%AD%E8%A8%80.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>C++&#35821;&#35328;</span>
        </a>
                <a href="MFC.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>MFC</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
