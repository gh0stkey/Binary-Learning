<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>COM&#32452;&#20214; - &#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="1015827">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">BinaryLearning</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Binary-Learning.html" class="ht-space-link">
                    <h2>&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</h2>
                </a>
                <p><br><a href="https://github.com/gh0stkey/Binary-Learning" target="_blank">ᴀᴜᴛʜᴏʀ: ᴋᴇʏ</a><br><br>不积跬步，无以至千里；<br>不积小流，无以成江海。</p>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=1015823"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Binary-Learning.html">&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</a></li>
                                                                                     <li><a href="%E5%88%9D%E7%BA%A7%E7%AF%87.html">&#21021;&#32423;&#31687;</a></li>
                                                            </ul>
</div>            <h1 id="src-1015823"> <span>COM&#32452;&#20214;</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTee7hOS7tuamgui_sA">
        <h1 class="heading "><span>COM&#32452;&#20214;&#27010;&#36848;</span></h1>
<p   
><strong class=" ">COM&#19982;&#32452;&#20214;&#20998;&#24320;&#29702;&#35299;</strong>&#65292;COM&#26159;&#24320;&#21457;&#36719;&#20214;&#32452;&#20214;&#30340;&#19968;&#31181;&#26041;&#27861;&#65292;&#32452;&#20214;&#23454;&#38469;&#19978;&#26159;&#19968;&#20123;&#23567;&#30340;&#20108;&#36827;&#21046;&#21487;&#25191;&#34892;&#31243;&#24207;&#65292;&#23427;&#20204;&#21487;&#20197;&#32473;&#24212;&#29992;&#31243;&#24207;&#65292;&#25805;&#20316;&#31995;&#32479;&#20197;&#21450;&#20854;&#20182;&#32452;&#20214;&#25552;&#20379;&#26381;&#21153;&#12290;</p>
<p   
>COM&#26368;&#26089;&#30340;&#35774;&#35745;&#24847;&#22270;&#26159;&#65292;&#36328;&#35821;&#35328;&#23454;&#29616;&#31243;&#24207;&#32452;&#20214;&#30340;&#37325;&#29992;&#65292;&#27604;&#22914;&#35828;VC++&#24320;&#21457;&#19968;&#20010;&#25511;&#20214;&#65292;&#22312;VB&#20013;&#35843;&#29992;&#65292;&#25110;&#32773;&#22312;VB&#20013;&#24320;&#21457;&#19968;&#20010;&#32452;&#20214;&#24211;&#65292;&#32473;VC++&#35843;&#29992;&#12290;</p>
<p   
>COM&#26368;&#24191;&#27867;&#30340;&#24212;&#29992;&#26159;ActiveX&#25511;&#20214;&#65292;&#26102;&#33267;&#20170;&#26085;&#65292;&#33021;&#22312;&#24456;&#22810;&#32593;&#31449;&#19978;&#30475;&#21040;&#23427;&#65292;&#27604;&#22914;&#28120;&#23453;&#23433;&#20840;&#30331;&#24405;&#25511;&#20214;&#65292;&#32593;&#38134;&#25511;&#20214;&#65292;&#29978;&#33267;&#22823;&#21517;&#40718;&#40718;&#30340;Flash Player&#25511;&#20214;&#31561;&#65292;&#25972;&#20010;Visual Basic&#37117;&#22522;&#20110;COM&#20197;&#21450;ActiveX&#25511;&#20214;&#12290;</p>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LeS7jkMgIOWIsENPTQ">
        <h1 class="heading "><span>&#20174;C++&#21040;COM</span></h1>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUMgIOWuouaIt-mHjeeUqEMgIOWvueixoQ">
        <h2 class="heading "><span>C++&#23458;&#25143;&#37325;&#29992;C++&#23545;&#35937;</span></h2>
<p   
>C++&#23458;&#25143;&#37325;&#29992;C++&#23545;&#35937;&#65292;&#36825;&#20010;&#26041;&#27861;&#24456;&#31616;&#21333;&#23601;&#26159;&#23558;C++&#31867;&#30340;&#25509;&#21475;&#25991;&#20214;(.h)&#21644;&#23454;&#29616;&#25991;&#20214;(.cpp)&#25552;&#20379;&#32473;&#23458;&#25143;&#21363;&#21487;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-6_14-52-54.png" alt="images/download/attachments/1015823/image2021-10-6_14-52-54.png" width="600"  />
    </p>
<p   
>&#22914;&#19978;&#25152;&#31034;&#26159;&#19968;&#20010;&#31616;&#21333;&#30340;C++&#31867;&#65292; &#22914;&#26524;&#23458;&#25143;&#35201;&#20351;&#29992;&#30340;&#35805;&#65292;&#25105;&#20204;&#38656;&#35201;&#23558;&#36825;&#20010;&#25991;&#20214;&#25552;&#20379;&#32473;&#20182;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-6_14-57-39.png" alt="images/download/attachments/1015823/image2021-10-6_14-57-39.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#36825;&#26679;&#23601;&#20250;&#23384;&#22312;&#19968;&#20010;&#32570;&#28857;&#65292;<strong class=" ">&#23601;&#26159;&#20320;&#30340;&#20195;&#30721;&#37117;&#20250;&#34987;&#23458;&#25143;&#30475;&#35265;</strong>&#65292;&#20026;&#20102;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#25105;&#20204;&#21487;&#20197;&#23558;C++&#23545;&#35937;&#25171;&#21253;&#21040;DLL&#20013;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWwhkMgIOWvueixoeaJk-WMheWIsERMTOS4rQ">
        <h2 class="heading "><span>&#23558;C++&#23545;&#35937;&#25171;&#21253;&#21040;DLL&#20013;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeS7o-eggeaUuemAoA">
        <h3 class="heading "><span>&#20195;&#30721;&#25913;&#36896;</span></h3>
<p   
>&#23558;C++&#23545;&#35937;&#25171;&#21253;&#21040;DLL&#20013;&#65292;&#20351;&#29992;&#30340;&#36824;&#26159;&#20043;&#21069;&#30340;&#20195;&#30721;&#65292;&#19981;&#36807;&#25105;&#20204;&#38656;&#35201;&#25913;&#36896;&#19968;&#19979;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65288;<strong class=" ">&#21019;&#24314;Win32&#39033;&#30446;&#30340;&#26102;&#20505;&#36873;&#25321;DLL&#39033;&#30446;</strong>&#65289;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-6_20-4-22.png" alt="images/download/attachments/1015823/image2021-10-6_20-4-22.png" width="600"  />
    </p>
<p   
>&#34429;&#28982;&#36825;&#26679;&#25105;&#20204;&#23601;&#23436;&#25104;&#20102;&#25913;&#36896;&#65292;&#20294;&#26159;&#20026;&#20102;&#20415;&#20110;&#23458;&#25143;&#20391;&#20351;&#29992;&#65292;&#19981;&#35753;&#23458;&#25143;&#21435;&#25805;&#24515;&#20869;&#23384;&#30340;&#31649;&#29702;&#65292;&#25105;&#20204;&#38656;&#35201;&#22312;&#20195;&#30721;&#20013;&#20889;&#22909;&#30003;&#35831;&#12289;&#37322;&#25918;&#65292;&#36825;&#23601;&#38656;&#35201;&#23454;&#29616;&#19968;&#20010;&#31867;&#24037;&#21378;&#26469;&#36827;&#34892;&#20869;&#23384;&#30340;&#31649;&#29702;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 声明类工厂 </code></div>
<div class="line"><code class="keyword">class</code><code class="plain"> CDBSrvFactory {</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    HRESULT DEF_DLL_PORT CreateDB(CDB** ppObject); </code><code class="comments">// 申请CDB对象</code></div>
<div class="line"><code class="plain">    ULONG DEF_DLL_PORT Release(); </code><code class="comments">// 释放类工厂对象</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 声明返回类工厂对象的引出函数</code></div>
<div class="line"><code class="plain">HRESULT DEF_DLL_PORT DllGetClassFactoryObject(CDBSrvFactory** ppObject);</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>&#20195;&#30721;&#23454;&#29616;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HRESULT CDBSrvFactory::CreateDB(CDB** ppObject) {</code></div>
<div class="line"><code class="plain">    *ppObject = </code><code class="keyword">new</code><code class="plain"> CDB();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ULONG CDBSrvFactory::Release() {</code></div>
<div class="line"><code class="plain">    delete </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT DllGetClassFactoryObject(CDBSrvFactory** ppObject) {</code></div>
<div class="line"><code class="plain">    *ppObject = </code><code class="keyword">new</code><code class="plain"> CDBSrvFactory();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#23436;&#25104;&#20102;&#36825;&#20123;&#20043;&#21518;&#21035;&#24536;&#35760;&#36824;&#26377;&#19968;&#20010;CDB&#23545;&#35937;&#26412;&#36523;&#20063;&#38656;&#35201;&#37322;&#25918;&#65292;&#25152;&#20197;&#38656;&#35201;&#22686;&#21152;&#19968;&#20010;&#26041;&#27861;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">class</code><code class="plain"> CDB {</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    HRESULT DEF_DLL_PORT Open();</code></div>
<div class="line"><code class="plain">    HRESULT DEF_DLL_PORT ExecSQL();</code></div>
<div class="line"><code class="plain">    HRESULT DEF_DLL_PORT Close();</code></div>
<div class="line"><code class="plain">    HRESULT DEF_DLL_PORT Release();</code></div>
<div class="line"><code class="keyword">private</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> m_nState;</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    CDB(</code><code class="keyword">void</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    ~CDB(</code><code class="keyword">void</code><code class="plain">);</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
<p   
>Release&#26041;&#27861;&#23454;&#29616;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HRESULT CDB::Release(){</code></div>
<div class="line"><code class="plain">    delete </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#26368;&#21518;&#25105;&#20204;&#32534;&#35793;&#19968;&#19979;&#21363;&#21487;&#29983;&#25104;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-6_22-12-12.png" alt="images/download/attachments/1015823/image2021-10-6_22-12-12.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2Leiwg-eUqOaWh-S7tg">
        <h3 class="heading "><span>&#35843;&#29992;&#25991;&#20214;</span></h3>
<p   
>&#22312;&#23458;&#25143;&#20391;&#21435;&#20351;&#29992;&#65292;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#20320;&#35201;&#32473;&#21040;&#22836;&#25991;&#20214;&#12289;lib&#25991;&#20214;&#21644;dll&#25991;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"DB.h"</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-6_23-2-7.png" alt="images/download/attachments/1015823/image2021-10-6_23-2-7.png" width="600"  />
    </p>
<p   
>&#21516;&#26679;&#36825;&#37324;&#30340;&#32570;&#28857;&#23601;&#24456;&#23481;&#26131;&#26292;&#38706;&#20986;&#26469;&#20102;&#65292;&#25105;&#20204;&#30340;&#23545;&#35937;&#30340;&#25152;&#26377;&#31169;&#26377;&#25104;&#21592;&#20250;&#34987;&#23458;&#25143;&#30475;&#24471;&#19968;&#28165;&#20108;&#26970;&#65292;&#21363;&#20415;&#23458;&#25143;&#19981;&#33021;&#35775;&#38382;&#23427;&#20204;&#65292;&#22914;&#26524;&#25913;&#21464;&#20102;&#25968;&#25454;&#25104;&#21592;&#30340;&#22823;&#23567;&#65292;&#25152;&#26377;&#23458;&#25143;&#31243;&#24207;&#24517;&#39035;&#37325;&#26032;&#32534;&#35793;&#65292;&#21516;&#26679;&#20026;&#20102;&#36991;&#20813;&#36825;&#31181;&#24773;&#20917;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#25277;&#35937;&#22522;&#31867;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUMgIOWvueixoeS9v-eUqOaKveixoeWfuuexuw">
        <h2 class="heading "><span>C++&#23545;&#35937;&#20351;&#29992;&#25277;&#35937;&#22522;&#31867;</span></h2>
<p   
>&#21033;&#29992;C++&#30340;&#25277;&#35937;&#22522;&#31867;&#24314;&#31435;&#19968;&#20010;&#21482;&#21253;&#21547;&#25152;&#26377;&#23548;&#20986;&#25104;&#21592;&#20989;&#25968;&#30340;&#22320;&#22336;&#25351;&#38024;&#34920;&#65292;&#23458;&#25143;&#35843;&#29992;&#20989;&#25968;&#26102;&#21482;&#38656;&#31616;&#21333;&#30340;&#26597;&#25214;&#36825;&#20010;&#34920;&#33719;&#21462;&#20989;&#25968;&#22320;&#22336;&#21363;&#21487;&#35843;&#29992;&#12290;</p>
<p   
>&#25277;&#35937;&#22522;&#31867;&#24456;&#22909;&#29702;&#35299;&#65292;&#23601;&#26159;&#23558;&#25104;&#21592;&#26041;&#27861;&#21464;&#25104;&#32431;&#34394;&#20989;&#25968;&#21363;&#21487;&#65292;&#28982;&#21518;&#23376;&#31867;&#32487;&#25215;&#36825;&#20010;&#25277;&#35937;&#31867;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-7_0-9-12.png" alt="images/download/attachments/1015823/image2021-10-7_0-9-12.png" width="600"  />
    </p>
<p   
>&#31616;&#21333;&#25913;&#36896;&#19968;&#30058;&#20043;&#21518;&#23558;lib&#12289;dll&#25991;&#20214;&#21644;&#25277;&#35937;&#22522;&#31867;&#22836;&#25991;&#20214;&#25171;&#21253;&#32473;&#23458;&#25143;&#65292;&#36825;&#26679;&#23458;&#25143;&#23601;&#21482;&#33021;&#30475;&#35265;&#25277;&#35937;&#22522;&#31867;&#23450;&#20041;&#30340;&#20869;&#23481;&#65292;&#32780;&#26080;&#27861;&#30475;&#35265;&#23376;&#31867;&#30340;&#31169;&#26377;&#25104;&#21592;&#20102;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-7_0-27-42.png" alt="images/download/attachments/1015823/image2021-10-7_0-27-42.png" width="600"  />
    </p>
<p   
>&#21516;&#26679;&#36825;&#20010;&#20063;&#26377;&#32570;&#28857;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#23458;&#25143;&#19982;&#25152;&#26377;&#30340;&#32452;&#20214;&#20132;&#20114;&#26041;&#24335;&#19981;&#32479;&#19968;&#65288;&#22914;&#26524;&#32452;&#20214;&#36827;&#34892;&#20102;&#26356;&#26032;&#65292;&#23601;&#38656;&#35201;&#25913;&#20195;&#30721;&#65289;&#65307;</p>
</li><li class=" "><p   
>&#20250;&#37325;&#22797;&#32534;&#20889;&#22823;&#37327;&#23458;&#25143;&#19982;&#32452;&#20214;&#36890;&#20449;&#30340;&#22522;&#30784;&#24615;&#20195;&#30721;&#65288;&#27604;&#22914;&#25105;&#20204;&#20889;&#20102;&#19968;&#20010;&#31867;<strong class=" ">&#23601;&#20889;&#20102;&#19968;&#20010;&#31867;&#24037;&#21378;&#21644;DllGetClassFactoryObject&#20989;&#25968;</strong>&#65289;&#12290;</p>
</li></ol><p   
>&#32780;&#35299;&#20915;&#36825;&#19968;&#32570;&#38519;&#30340;&#25163;&#27573;&#23601;&#26159;&#23558;C++&#23545;&#35937;&#25913;&#20026;COM&#23545;&#35937;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWwhkMgIOWvueixoeWPmOaIkENPTeWvueixoQ">
        <h2 class="heading "><span>&#23558;C++&#23545;&#35937;&#21464;&#25104;COM&#23545;&#35937;</span></h2>
<p   
>&#23558;C++&#23545;&#35937;&#25913;&#20026;COM&#23545;&#35937;&#65292;&#38656;&#35201;&#35843;&#29992;COM&#24211;&#21019;&#24314;&#23545;&#35937;&#65292;&#23454;&#29616;&#25509;&#21475;&#30340;&#24341;&#29992;&#35745;&#25968;&#65292;&#31867;&#24037;&#21378;&#38656;&#35201;&#20351;&#29992;&#26631;&#20934;&#30340;<strong class=" ">IClassFactory&#25509;&#21475;</strong>&#26469;&#23454;&#29616;DLL&#30340;&#21160;&#24577;&#21368;&#36733;&#21644;&#23545;&#35937;&#33258;&#27880;&#20876;&#12290;</p>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#22312;&#25913;&#36896;&#36807;&#31243;&#20013;&#25152;&#26377;&#25104;&#21592;&#20989;&#25968;&#37117;&#38656;&#35201;&#28155;&#21152;_stdcall&#35843;&#29992;&#32422;&#23450;&#65292;&#22240;&#20026;COM&#23545;&#35937;&#22312;Win32&#19979;&#37319;&#29992;&#26631;&#20934;&#35843;&#29992;&#32422;&#23450;&#12290;</p>
<p   
><strong class=" ">&#27880;&#65306;</strong>&#22312;&#36825;&#37324;&#20250;&#24341;&#20986;&#21040;&#24456;&#22810;&#19981;&#20102;&#35299;&#30340;&#27010;&#24565;&#21644;&#24847;&#20041;&#65292;&#19981;&#29992;&#28145;&#31350;&#65292;&#21518;&#32493;&#31456;&#33410;&#20250;&#21435;&#35814;&#32454;&#35762;&#35299;&#12290;</p>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeS_ruaUueaOpeWPo-aWh-S7tg">
        <h3 class="heading "><span>&#20462;&#25913;&#25509;&#21475;&#25991;&#20214;</span></h3>
<p   
>1.&#23558;IDB&#31867;&#25913;&#20026;&#30001;IUnknown&#31867;&#27966;&#29983;&#65292;&#21024;&#38500;Release&#25104;&#21592;&#20989;&#25968;&#22768;&#26126;&#65288;&#21253;&#25324;CDB&#31867;&#65289;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">class</code><code class="plain"> IDB : </code><code class="keyword">public</code><code class="plain"> IUnknown {</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    virtual HRESULT _stdcall Open() = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    virtual HRESULT _stdcall ExecSQL() = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    virtual HRESULT _stdcall Close() = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
<p   
>2.&#21024;&#38500;&#31867;&#24037;&#21378;IDBSrvFactory&#22768;&#26126;&#65292;&#22240;&#20026;&#25105;&#20204;&#29616;&#22312;&#35201;&#20351;&#29992;&#26631;&#20934;&#31867;&#24037;&#21378;&#25509;&#21475;IClassFactory&#12290;</p>
<p   
>3.&#21024;&#38500;DllGetClassFactoryObject&#20989;&#25968;&#30340;&#22768;&#26126;&#21644;&#23450;&#20041;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeS_ruaUueWvueixoeeoi-W6jw">
        <h3 class="heading "><span>&#20462;&#25913;&#23545;&#35937;&#31243;&#24207;</span></h3>
<p   
>1.&#23558;CDBSrvFactory&#31867;&#30001;IDBSrvFactory&#31867;&#27966;&#29983;&#25913;&#20026;&#30001;IClassFactory&#31867;&#27966;&#29983;&#65292;&#23558;CreateDB&#25104;&#21592;&#20989;&#25968;&#25913;&#20026;CreateInstance&#65292;&#21516;&#26102;&#21024;&#38500;&#35813;&#25104;&#21592;&#20989;&#25968;&#30340;&#23450;&#20041;&#65292;&#24182;&#28155;&#21152;&#19968;&#20010;&#25104;&#21592;&#20989;&#25968;LockServer&#65307;&#20026;CDB&#31867;&#21644;CDBSrvFactory&#31867;&#37117;&#28155;&#21152;&#19968;&#20010;&#24341;&#29992;&#35745;&#25968;&#21464;&#37327;m_dwRefCount&#65307;&#20026;CDB&#31867;&#21644;CDBSrvFactory&#31867;&#21152;&#19978;QueryInterface&#12289;AddRef&#21644;Release&#19977;&#20010;&#25104;&#21592;&#20989;&#25968;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">class</code><code class="plain"> CDB : </code><code class="keyword">public</code><code class="plain"> IDB {</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall Open();</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall ExecSQL();</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall Close();</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall QueryInterface(REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject);</code></div>
<div class="line"><code class="plain">    ULONG _stdcall AddRef();</code></div>
<div class="line"><code class="plain">    ULONG _stdcall Release();</code></div>
<div class="line"><code class="keyword">private</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    ULONG m_dwRefCount;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> m_nState;</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    CDB(</code><code class="keyword">void</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    ~CDB(</code><code class="keyword">void</code><code class="plain">);</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 声明类工厂 </code></div>
<div class="line"><code class="keyword">class</code><code class="plain"> CDBSrvFactory : </code><code class="keyword">public</code><code class="plain"> IClassFactory {</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall CreateInstance(IUnknown *pUnkOuter, REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject);</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall LockServer(BOOL fLock);</code></div>
<div class="line"><code class="plain">    HRESULT _stdcall QueryInterface(REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject);</code></div>
<div class="line"><code class="plain">    ULONG _stdcall AddRef();</code></div>
<div class="line"><code class="plain">    ULONG _stdcall Release();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    CDBSrvFactory(</code><code class="keyword">void</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">private</code><code class="plain">:</code></div>
<div class="line"><code class="plain">    ULONG m_dwRefCount;</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
<p   
>&#22312;&#23454;&#29616;&#20013;&#22768;&#26126;&#19968;&#20010;&#22806;&#37096;&#21464;&#37327;g_dwRefCount&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">extern ULONG g_dwRefCount;</code></div>
</div>
    </div>
<p   
>2.&#22312;CDB&#26500;&#36896;&#20989;&#25968;&#20013;&#23558;m_dwRefCount&#21021;&#22987;&#21270;&#20026;0&#65292;&#23454;&#29616;CDB&#31867;&#30340;QueryInterface&#65292;AddRef&#65292;Release&#19977;&#20010;&#25104;&#21592;&#20989;&#25968;&#12290;<br/></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">CDB::CDB(</code><code class="keyword">void</code><code class="plain">){</code></div>
<div class="line"><code class="plain">    m_nState = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    m_dwRefCount = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT CDB::QueryInterface(REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (riid == IID_IUnknown || riid == IID_IDB)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        *ppObject = (IDB*) </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_NOINTERFACE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    AddRef();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ULONG CDB::AddRef()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    g_dwRefCount++;</code></div>
<div class="line"><code class="plain">    m_dwRefCount++;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> m_dwRefCount;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ULONG CDB::Release()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    g_dwRefCount--;</code></div>
<div class="line"><code class="plain">    m_dwRefCount--;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (m_dwRefCount == </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        delete </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> m_dwRefCount;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#22312;QueryInterface&#25104;&#21592;&#20989;&#25968;&#20013;&#26377;&#19968;&#20010;<strong class=" ">IID_IDB</strong>&#21464;&#37327;&#65292;&#36825;&#20010;&#26159;&#25105;&#20204;&#33258;&#23450;&#20041;&#30340;&#20869;&#23481;&#65292;&#20854;&#34920;&#31034;&#24403;&#21069;COM&#25509;&#21475;&#30340;ID&#65292;&#36825;&#20010;&#38656;&#35201;&#25105;&#20204;&#33258;&#24049;&#21435;&#33258;&#23450;&#20041;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// {30DF3432-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID IID_IDB =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3432</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#36825;&#20010;&#21464;&#37327;&#23454;&#38469;&#19978;&#26159;&#19968;&#20010;<strong class=" ">&#32467;&#26500;&#20307;GUID</strong>&#65292;&#27880;&#37322;&#23601;&#26159;&#23427;&#26356;&#21152;&#30452;&#35266;&#30340;&#34920;&#29616;&#24418;&#24335;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _GUID {</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">long</code><code class="plain">  Data1;</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">short</code><code class="plain"> Data2;</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">short</code><code class="plain"> Data3;</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">char</code><code class="plain">  Data4[ </code><code class="value">8</code><code class="plain"> ];</code></div>
<div class="line"><code class="plain">} GUID;</code></div>
</div>
    </div>
<p   
>&#22312;&#20195;&#30721;&#20013;&#30340;IID_IUnknown&#26159;COM&#24211;&#30340;&#19996;&#35199;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#21253;&#21547;&#19968;&#20010;&#22836;&#25991;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;ole2.h&gt;</code></div>
</div>
    </div>
<p   
>3.&#23450;&#20041;&#20840;&#23616;&#21464;&#37327;g_dwRefCount&#65307;&#22312;&#26500;&#36896;&#20989;&#25968;&#20013;&#23558;m_dwRefCount&#21021;&#22987;&#21270;&#20026;0&#65307;&#23454;&#29616;CDBSrvFactory&#31867;&#30340;QueryInterface&#65292;AddRef&#65292;Release&#19977;&#20010;&#25104;&#21592;&#20989;&#25968;&#65307;&#23558;CDBSrvFactory&#31867;&#30340;CreateDB&#25104;&#21592;&#20989;&#25968;&#20462;&#25913;&#20026;CreateInstance&#65307;&#23454;&#29616;LockServer&#25104;&#21592;&#20989;&#25968;&#65307;&#28155;&#21152;DllGetClassObject&#12289;DllCanUnloadNow&#12289;DllUnregisterServer&#12289;DllRegisterServer&#22235;&#20010;&#25104;&#21592;&#20989;&#25968;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">ULONG g_dwRefCount = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// {30DF3430-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID CLSID_DBSAMPLE =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3430</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT CDBSrvFactory::CreateInstance(IUnknown *pUnkOuter, REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (pUnkOuter != NULL)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> CLASS_E_NOAGGREGATION;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    CDB* pDB = </code><code class="keyword">new</code><code class="plain"> CDB;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (FAILED(pDB-&gt;QueryInterface(riid, ppObject)))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        delete pDB;</code></div>
<div class="line"><code class="plain">        *ppObject = NULL;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_NOINTERFACE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT CDBSrvFactory::LockServer(BOOL fLock)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (fLock)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        g_dwRefCount++;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        g_dwRefCount--;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">CDBSrvFactory::CDBSrvFactory()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    m_dwRefCount = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT CDBSrvFactory::QueryInterface(REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (riid == IID_IUnknown || riid == IID_IClassFactory)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        *ppObject = (IDB*) </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_NOINTERFACE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    AddRef();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ULONG CDBSrvFactory::AddRef()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    g_dwRefCount++;</code></div>
<div class="line"><code class="plain">    m_dwRefCount++;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> m_dwRefCount;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">ULONG CDBSrvFactory::Release()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    g_dwRefCount--;</code></div>
<div class="line"><code class="plain">    m_dwRefCount--;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (m_dwRefCount == </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        delete </code><code class="keyword">this</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> m_dwRefCount;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">STDAPI DllGetClassObject(REFCLSID rclsid, REFIID riid, </code><code class="keyword">void</code><code class="plain">** ppObject)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (rclsid == CLSID_DBSAMPLE)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        CDBSrvFactory *pFactory = </code><code class="keyword">new</code><code class="plain"> CDBSrvFactory;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (FAILED(pFactory-&gt;QueryInterface(riid, ppObject)))</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            delete pFactory;</code></div>
<div class="line"><code class="plain">            *ppObject = NULL;</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> E_INVALIDARG;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// here you could check for additional CLSID's you DLL may provide</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> CLASS_E_CLASSNOTAVAILABLE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NO_ERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT _stdcall DllCanUnloadNow()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (g_dwRefCount)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> S_FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> S_OK;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">STDAPI DllRegisterServer(</code><code class="keyword">void</code><code class="plain">)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    HKEY hKeyCLSID, hKeyInproc32;</code></div>
<div class="line"><code class="plain">    DWORD dwDisposition;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegCreateKeyEx(HKEY_CLASSES_ROOT, _T(</code><code class="string">"CLSID\\{30DF3430-0266-11cf-BAA6-00AA003E0EED}"</code><code class="plain">), NULL, _T(</code><code class="string">""</code><code class="plain">), REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, &amp;hKeyCLSID, &amp;dwDisposition) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegSetValueEx(hKeyCLSID, _T(</code><code class="string">""</code><code class="plain">), NULL, REG_SZ, (BYTE*)_T(</code><code class="string">"DB Sample Server"</code><code class="plain">), sizeof(_T(</code><code class="string">"DB Sample Server"</code><code class="plain">))) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegCreateKeyEx(hKeyCLSID, _T(</code><code class="string">"InprocServer32"</code><code class="plain">), NULL, _T(</code><code class="string">""</code><code class="plain">), REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, &amp;hKeyInproc32, &amp;dwDisposition) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    HMODULE hModule = GetModuleHandle(_T(</code><code class="string">"DB_DLL.DLL"</code><code class="plain">));</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!hModule)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyInproc32);</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    TCHAR szName[MAX_PATH + </code><code class="value">1</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (GetModuleFileName(hModule, szName, sizeof(szName)) == </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyInproc32);</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegSetValueEx(hKeyInproc32, _T(</code><code class="string">""</code><code class="plain">), NULL, REG_SZ, (BYTE*)szName, sizeof(TCHAR)*(lstrlen(szName) + </code><code class="value">1</code><code class="plain">)) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyInproc32);</code></div>
<div class="line"><code class="plain">        RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    RegCloseKey(hKeyInproc32);</code></div>
<div class="line"><code class="plain">    RegCloseKey(hKeyCLSID);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NOERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">STDAPI DllUnregisterServer(</code><code class="keyword">void</code><code class="plain">)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegDeleteKey(HKEY_CLASSES_ROOT, _T(</code><code class="string">"CLSID\\{30DF3430-0266-11cf-BAA6-00AA003E0EED}\\InprocServer32"</code><code class="plain">)) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (RegDeleteKey(HKEY_CLASSES_ROOT, _T(</code><code class="string">"CLSID\\{30DF3430-0266-11cf-BAA6-00AA003E0EED}"</code><code class="plain">)) != ERROR_SUCCESS)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> E_UNEXPECTED;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> NOERROR;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#19978;&#20195;&#30721;&#20013;&#30340;<strong class=" ">{30DF3430-0266-11cf-BAA6-00AA003E0EED}&#65292;&#20854;&#23454;&#23601;&#26159;COM&#23545;&#35937;&#30340;ID</strong>&#65292;&#36825;&#20123;&#37117;&#26159;&#35201;&#22312;&#27880;&#20876;&#34920;&#20013;&#21435;&#27880;&#20876;&#30340;&#65292;&#20854;&#20063;&#26159;&#19968;&#27573;GUID&#30340;&#26684;&#24335;&#65292;&#20063;&#23601;&#26159;&#21464;&#37327;<strong class=" ">CLSID_DBSAMPLE</strong>&#25152;&#34920;&#31034;&#30340;&#20869;&#23481;&#65307;&#22312;&#20195;&#30721;&#20013;&#30340;<strong class=" ">DB_DLL.DLL</strong>&#65292;&#36825;&#20010;&#20026;&#24403;&#21069;COM&#32452;&#20214;&#30340;&#25991;&#20214;&#21517;&#65292;&#33258;&#24049;&#38656;&#35201;&#27880;&#24847;&#20462;&#25913;&#19968;&#19979;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LURFRuWvvOWHug">
        <h3 class="heading "><span>DEF&#23548;&#20986;</span></h3>
<p   
>&#25105;&#20204;&#21019;&#24314;DEF&#25991;&#20214;&#23558;&#25509;&#21475;&#23548;&#20986;&#65292;&#20197;&#20415;&#22806;&#37096;&#24341;&#29992;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">EXPORTS</code></div>
<div class="line"><code class="plain">          ;WEP </code><code class="color1">@1</code><code class="plain"> RESIDENTNAME</code></div>
<div class="line"><code class="plain">                    DllGetClassObject</code></div>
<div class="line"><code class="plain">                    DllCanUnloadNow</code></div>
<div class="line"><code class="plain">                    DllRegisterServer</code></div>
<div class="line"><code class="plain">                    DllUnregisterServer</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWuouaIt-S9v-eUqA">
        <h3 class="heading "><span>&#23458;&#25143;&#20351;&#29992;</span></h3>
<p   
>&#25509;&#19979;&#26469;&#32473;&#21482;&#38656;&#35201;&#23558;DLL&#25991;&#20214;&#12289;&#25509;&#21475;&#22836;&#25991;&#20214;&#12289;&#20197;&#21450;&#23545;&#24212;&#30340;COM&#23545;&#35937;&#21644;COM&#25509;&#21475;&#30340;GUID&#65306;<br/></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// {30DF3430-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID CLSID_DBSAMPLE =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3430</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
<div class="line"><code class="comments">// {30DF3432-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID IID_IDB =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3432</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
</div>
    </div>
<p   
>&#28982;&#21518;&#35753;&#23458;&#25143;&#36890;&#36807;regsvr32&#21629;&#20196;&#27880;&#20876;&#32452;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">regsvr32 DLL文件路径</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_15-24-35.png" alt="images/download/attachments/1015823/image2021-10-8_15-24-35.png" width="600"  />
    </p>
<p   
>&#22914;&#26524;&#27880;&#20876;&#22833;&#36133;&#20102;&#65292;&#26377;&#21487;&#33021;&#26159;&#38750;&#31649;&#29702;&#21592;&#26435;&#38480;&#30340;&#21407;&#22240;&#65292;&#21487;&#20197;&#20351;&#29992;&#31649;&#29702;&#21592;&#26435;&#38480;&#25171;&#24320;&#19968;&#20010;cmd&#28982;&#21518;&#36816;&#34892;&#21629;&#20196;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_15-44-3.png" alt="images/download/attachments/1015823/image2021-10-8_15-44-3.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#23458;&#25143;&#31471;&#25353;&#22914;&#19979;&#31034;&#20363;&#20195;&#30721;&#36827;&#34892;&#32534;&#20889;&#35843;&#29992;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"DBInterface.h"</code></div>
<div class="line"><code class="plain">#include &lt;iostream&gt;</code></div>
<div class="line"><code class="plain">using namespace std;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// {30DF3430-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID CLSID_DBSAMPLE =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3430</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
<div class="line"><code class="comments">// {30DF3432-0266-11cf-BAA6-00AA003E0EED}</code></div>
<div class="line"><code class="keyword">static</code><code class="plain"> </code><code class="keyword">const</code><code class="plain"> GUID IID_IDB =</code></div>
<div class="line"><code class="plain">{ </code><code class="value">0x30df3432</code><code class="plain">, </code><code class="value">0x266</code><code class="plain">, </code><code class="value">0x11cf</code><code class="plain">, { </code><code class="value">0xba</code><code class="plain">, </code><code class="value">0xa6</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0xaa</code><code class="plain">, </code><code class="value">0x0</code><code class="plain">, </code><code class="value">0x3e</code><code class="plain">, </code><code class="value">0xe</code><code class="plain">, </code><code class="value">0xed</code><code class="plain"> } };</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">IDB* g_gDB = NULL;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> _tmain(</code><code class="keyword">int</code><code class="plain"> argc, _TCHAR* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    IClassFactory *pDBFactory = NULL;</code></div>
<div class="line"><code class="plain">    HRESULT hRes;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 初始化</code></div>
<div class="line"><code class="plain">    hRes = ::CoInitialize(NULL);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        cout &lt;&lt; </code><code class="string">"Error "</code><code class="plain"> &lt;&lt; hRes &lt;&lt; </code><code class="string">" CoInitialize!"</code><code class="plain"> &lt;&lt; endl;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 连接COM组件</code></div>
<div class="line"><code class="plain">    hRes = CoGetClassObject(CLSID_DBSAMPLE, CLSCTX_SERVER, NULL, IID_IClassFactory, (</code><code class="keyword">void</code><code class="plain">**)&amp;pDBFactory);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        cout &lt;&lt; </code><code class="string">"Error "</code><code class="plain"> &lt;&lt; hRes &lt;&lt; </code><code class="string">" obtaining class factory for DB Object!"</code><code class="plain"> &lt;&lt; endl;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 得到对象ID对应的接口</code></div>
<div class="line"><code class="plain">    hRes = pDBFactory-&gt;CreateInstance(NULL, IID_IDB, (</code><code class="keyword">void</code><code class="plain">**)&amp;g_gDB);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        cout &lt;&lt; </code><code class="string">"Error "</code><code class="plain"> &lt;&lt; hRes &lt;&lt; </code><code class="string">" creating DB Object!"</code><code class="plain"> &lt;&lt; endl;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> FALSE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 释放类工厂</code></div>
<div class="line"><code class="plain">    pDBFactory-&gt;Release();</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 调用接口方法</code></div>
<div class="line"><code class="plain">    g_gDB-&gt;Open();</code></div>
<div class="line"><code class="plain">    g_gDB-&gt;ExecSQL();</code></div>
<div class="line"><code class="plain">    g_gDB-&gt;Close();</code></div>
<div class="line"><code class="plain">    g_gDB-&gt;Release();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#19978;&#20195;&#30721;&#20013;&#65292;&#24403;&#23458;&#25143;&#35843;&#29992;CoGetClassObject&#20989;&#25968;&#21152;&#36733;COM&#32452;&#20214;&#21518;&#65292;&#23601;&#20250;&#33258;&#21160;&#21435;&#35843;&#29992;DllGetClassObject&#20989;&#25968;&#29983;&#25104;&#31867;&#24037;&#21378;&#25351;&#38024;&#65292;&#28982;&#21518;&#25105;&#20204;&#36890;&#36807;&#31867;&#24037;&#21378;&#25351;&#38024;&#20877;&#35843;&#29992;CreateInstance&#20989;&#25968;&#29983;&#25104;&#31867;&#23454;&#20363;&#65292;&#36820;&#22238;&#25509;&#21475;&#25351;&#38024;&#12290;</p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeWfuuehgOefpeivhg">
        <h1 class="heading "><span>COM&#22522;&#30784;&#30693;&#35782;</span></h1>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeWvueixoQ">
        <h2 class="heading "><span>COM&#23545;&#35937;</span></h2>
<p   
>COM&#23545;&#35937;&#20854;&#23454;&#23601;&#31867;&#20284;&#20110;C++&#20013;&#30340;&#23545;&#35937;&#65292;&#20063;&#23601;&#26159;&#35828;&#26576;&#20010;&#31867;&#30340;&#23454;&#20363;&#65292;&#21253;&#21547;&#20102;&#19968;&#32452;&#25968;&#25454;&#21644;&#25805;&#20316;&#12290;</p>
<p   
>&#22312;COM&#27169;&#22411;&#20013;&#65292;COM&#23545;&#35937;&#30340;&#20301;&#32622;&#23545;&#20110;&#23458;&#25143;&#26469;&#35828;&#26159;&#36879;&#26126;&#30340;&#65292;&#21363;&#23458;&#25143;&#20195;&#30721;&#19981;&#38656;&#35201;&#30452;&#25509;&#21021;&#22987;&#21270;&#19968;&#20010;COM&#23545;&#35937;&#65292;&#32780;&#26159;COM&#24211;&#36890;&#36807;&#19968;&#20010;&#20840;&#23616;&#26631;&#35782;&#30721;GUID&#21435;&#23545;&#20854;&#36827;&#34892;&#21021;&#22987;&#21270;&#24037;&#20316;&#12290;</p>
<p   
>GUID&#26159;&#19968;&#20010;128&#20301;&#30340;&#26631;&#35782;&#31526;&#65292;&#22522;&#26412;&#20445;&#35777;&#20102;COM&#23545;&#35937;&#30340;&#21807;&#19968;&#24615;&#65292;&#21478;&#22806;COM&#25509;&#21475;&#20063;&#26159;&#29992;GUID&#26469;&#26631;&#35782;&#30340;&#12290;</p>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUdVSUQ">
        <h3 class="heading "><span>GUID</span></h3>
<p   
>GUID&#65292;&#21448;&#31216;&#20043;&#20026;&#20840;&#23616;&#21807;&#19968;&#26631;&#35782;&#31526;&#65292;&#26377;16&#20010;&#23383;&#33410;&#65292;&#20849;128&#20301;&#20108;&#36827;&#21046;&#25968;&#65292;&#21487;&#20197;&#20445;&#35777;&#20840;&#29699;&#33539;&#22260;&#20869;&#19981;&#20250;&#37325;&#22797;&#65292;&#26631;&#35782;COM&#23545;&#35937;&#30340;GUID&#31216;&#20026;&#65306;CLSID&#12290;</p>
<p   
>COM&#32452;&#20214;&#20013;&#65292;GUID&#30340;&#32467;&#26500;&#23450;&#20041;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _GUID {</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">long</code><code class="plain">  Data1; </code><code class="comments">// 随机数</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">short</code><code class="plain"> Data2; </code><code class="comments">// 和时间有关</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">short</code><code class="plain"> Data3; </code><code class="comments">// 和时间有关</code></div>
<div class="line"><code class="plain">    unsigned </code><code class="keyword">char</code><code class="plain">  Data4[ </code><code class="value">8</code><code class="plain"> ]; </code><code class="comments">// 和网卡MAC有关</code></div>
<div class="line"><code class="plain">} GUID;</code></div>
</div>
    </div>
<p   
>&#21487;&#20197;&#30475;&#21040;&#36825;&#20010;&#32467;&#26500;&#36824;&#26159;&#25402;&#22797;&#26434;&#30340;&#65292;&#22914;&#26524;&#25105;&#20204;&#24819;&#35201;&#25163;&#21160;&#29983;&#25104;&#65292;&#36825;&#23558;&#20250;&#26159;&#19968;&#20214;&#38750;&#24120;&#40635;&#28902;&#30340;&#20107;&#24773;&#65292;&#19981;&#36807;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;VS&#33258;&#24102;&#30340;&#21151;&#33021;&#21435;&#29983;&#25104;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_17-10-0.png" alt="images/download/attachments/1015823/image2021-10-8_17-10-0.png" width="600"  />
    </p>
<p   
>&#19968;&#33324;&#26469;&#35828;&#25105;&#20204;&#36873;&#25321;&#31532;&#19977;&#20010;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_17-10-37.png" alt="images/download/attachments/1015823/image2021-10-8_17-10-37.png" width="600"  />
    </p>
<p   
>&#21021;&#27425;&#20043;&#22806;&#25105;&#20204;&#23475;&#21487;&#20197;&#20511;&#21161;CoCreateGuid&#20989;&#25968;&#26469;&#29983;&#25104;&#36825;&#20010;GUID&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">GUID guid;</code></div>
<div class="line"><code class="plain">CoCreateGuid(&amp;guid);</code></div>
</div>
    </div>
<p   
>&#20174;&#29702;&#35770;&#19978;&#35762;&#65292;&#23427;&#26159;&#19981;&#33021;&#20445;&#35777;&#21807;&#19968;&#65292;<strong class=" ">&#20294;&#37325;&#22797;&#30340;&#21487;&#33021;&#24615;&#38750;&#24120;&#38750;&#24120;&#23567;</strong>&#12290;&#26377;&#21477;&#22840;&#24352;&#30340;&#35828;&#27861;&#26159;&#65306;&ldquo;&#22312;&#27599;&#31186;&#38047;&#20135;&#29983;&#19968;&#19975;&#20159;&#20010;GUID&#30340;&#24773;&#20917;&#19979;&#65292;&#21363;&#20351;&#22826;&#38451;&#21464;&#25104;&#30333;&#30702;&#26143;&#30340;&#26102;&#20505;&#65292;&#23427;&#20173;&#26159;&#21807;&#19968;&#30340;&rdquo;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeaOpeWPow">
        <h2 class="heading "><span>COM&#25509;&#21475;</span></h2>
<p   
>COM&#25509;&#21475;&#36890;&#24120;&#26159;&#19968;&#32452;&#20989;&#25968;&#30340;&#36923;&#36753;&#38598;&#21512;&#65292;&#20854;&#21629;&#21517;&#19968;&#33324;&#20197;&quot;I&quot;&#65288;<strong class=" ">&#22823;&#20889;&#30340;i</strong>&#65289;&#20026;&#21069;&#32512;&#65292;&#24182;&#19988;&#32487;&#25215;IUnKnown&#25509;&#21475;&#65307;COM&#23545;&#35937;&#21487;&#20197;&#25552;&#20379;&#22810;&#20010;COM&#25509;&#21475;&#65292;&#27599;&#20010;&#25509;&#21475;&#25552;&#20379;&#19981;&#21516;&#30340;&#26381;&#21153;&#65292;&#22240;&#27492;COM&#25509;&#21475;&#19982;COM&#23545;&#35937;&#19968;&#26679;&#65292;&#37117;&#26159;&#29992;GUID&#26469;&#26631;&#35782;&#30340;&#65292;&#23458;&#25143;&#36890;&#36807;GUID&#26469;&#33719;&#21462;&#25509;&#21475;&#25351;&#38024;&#65292;&#20877;&#36890;&#36807;&#25509;&#21475;&#25351;&#38024;&#33719;&#21462;&#23545;&#24212;&#30340;&#26381;&#21153;&#65307;<strong class=" ">&#26631;&#35782;COM&#25509;&#21475;&#30340;GUID&#31216;&#20026;&#65306;IID</strong>&#12290;</p>
<p   
>&#20320;&#21487;&#20197;&#29702;&#35299;&#20026;<strong class=" ">&#27809;&#26377;&#21435;&#20855;&#20307;&#22768;&#26126;&#21644;&#23454;&#29616;AddRef&#12289;Release&#12289;QueryInterface&#36825;&#19977;&#20010;&#25509;&#21475;&#20989;&#25968;</strong><strong class=" ">&#30340;&#31867;</strong>&#23601;&#26159;&#25105;&#20204;&#30340;COM&#25509;&#21475;&#65292;&#22312;&#22914;&#19978;&#20195;&#30721;&#20013;&#20063;&#23601;&#26159;IDB&#36825;&#20010;&#31867;&#20026;COM&#25509;&#21475;&#12290;</p>
<p   
>IUnknown&#25509;&#21475;&#26159;COM&#30340;&#26680;&#24515;&#65292;&#22240;&#20026;&#25152;&#26377;&#20854;&#20182;&#30340;COM&#25509;&#21475;&#37117;&#24517;&#39035;&#20174;IUnknown&#32487;&#25215;&#65307;&#23427;&#21253;&#21547;&#19977;&#20010;&#25509;&#21475;&#20989;&#25968;&#65306;QueryInterface&#12289;AddRef&#21644;Release&#65292;&#20854;&#20013;<strong class=" ">QueryInterface&#29992;&#20110;&#25509;&#21475;&#26597;&#35810;</strong>&#65292;&#20174;COM&#23545;&#35937;&#30340;&#19968;&#20010;&#25509;&#21475;&#33719;&#24471;&#21478;&#19968;&#20010;&#25509;&#21475;&#65292;&#19968;&#20010;&#23545;&#35937;&#21487;&#33021;&#23454;&#29616;&#20102;&#22810;&#20010;&#25509;&#21475;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#36890;&#36807;QueryInterface&#22312;&#23545;&#35937;&#22810;&#20010;&#25509;&#21475;&#20043;&#38388;&#36339;&#36716;&#20174;&#32780;&#33719;&#24471;&#22810;&#20010;&#25509;&#21475;&#25552;&#20379;&#30340;&#26381;&#21153;&#65307;<strong class=" ">AddRef&#19982;Release&#21017;&#29992;&#20110;&#31649;&#29702;COM&#23545;&#35937;&#30340;&#29983;&#21629;&#21608;&#26399;</strong>&#65292;&#24403;COM&#23545;&#35937;&#19981;&#20877;&#20351;&#29992;&#26102;&#38656;&#35201;&#37322;&#25918;&#65292;&#22240;&#27492;COM&#20351;&#29992;&#20102;&#24341;&#29992;&#35745;&#25968;&#30340;&#26041;&#27861;&#26469;&#23545;&#23545;&#35937;&#36827;&#34892;&#31649;&#29702;&#65292;&#24403;&#26377;&#19968;&#20010;&#29992;&#25143;&#33719;&#24471;&#25509;&#21475;&#25351;&#38024;&#21518;&#35843;&#29992;AddRef&#23558;&#24341;&#29992;&#35745;&#25968;&#21152;1&#65292;&#30456;&#21453;&#65292;&#24403;&#19968;&#20010;&#29992;&#25143;&#29992;&#23436;&#25509;&#21475;&#25351;&#38024;&#21518;&#23601;&#35843;&#29992;Release&#26469;&#20351;&#24341;&#29992;&#35745;&#25968;&#20943;1&#65292;&#36825;&#26679;&#24403;&#24341;&#29992;&#35745;&#25968;&#20026;0&#26102;&#65292;COM&#23545;&#35937;&#23601;&#21487;&#20197;&#20174;&#20869;&#23384;&#20013;&#37322;&#25918;&#65307;<strong class=" ">&#30001;&#20110;IUnknown&#25552;&#20379;&#20102;&#25509;&#21475;&#26597;&#35810;&#19982;&#29983;&#21629;&#21608;&#26399;&#25511;&#21046;&#20004;&#20010;&#21151;&#33021;&#65292;&#22240;&#27492;COM&#30340;&#27599;&#20010;&#25509;&#21475;&#37117;&#24212;&#35813;&#32487;&#25215;&#20110;&#23427;</strong>&#12290;</p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#26159;IUnknown&#30340;&#23450;&#20041;&#65292;&#30001;&#27492;&#25105;&#20204;&#21487;&#20197;&#28165;&#26970;&#20854;&#26412;&#36136;&#19978;&#23601;&#26159;&#19968;&#20010;&#21547;&#26377;&#32431;&#34394;&#20989;&#25968;&#30340;&#25277;&#35937;&#31867;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">class</code><code class="plain"> IUnknown</code></div>
<div class="line"><code class="plain">{  </code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:  </code></div>
<div class="line"><code class="plain">     virtual HRESULT __stdcall QueryInterface(</code><code class="keyword">const</code><code class="plain"> IID&amp; iid, </code><code class="keyword">void</code><code class="plain">** ppv) = </code><code class="value">0</code><code class="plain">;  </code></div>
<div class="line"><code class="plain">     virtual ULONG __stdcall AddRef() = </code><code class="value">0</code><code class="plain">;  </code></div>
<div class="line"><code class="plain">     virtual ULONG __stdcall Release() = </code><code class="value">0</code><code class="plain">;  </code></div>
<div class="line"><code class="plain">}; </code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeW6lOeUqOaooeWeiw">
        <h2 class="heading "><span>COM&#24212;&#29992;&#27169;&#22411;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWuouaIty_mnI3liqHmqKHlnos">
        <h3 class="heading "><span>&#23458;&#25143;/&#26381;&#21153;&#27169;&#22411;</span></h3>
<p   
>&#22914;&#19979;&#22270;&#23601;&#26159;&#23458;&#25143;/&#26381;&#21153;&#27169;&#22411;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_17-57-43.png" alt="images/download/attachments/1015823/image2021-10-8_17-57-43.png" width="600"  />
    </p>
<p   
>&#23458;&#25143;&#36890;&#36807;COM&#21019;&#24314;&#20989;&#25968;&#33719;&#21462;&#21040;COM&#24211;&#65292;COM&#24211;&#20877;&#36890;&#36807;DllGetClassObject&#33719;&#21462;&#32452;&#20214;&#65292;&#20877;&#36890;&#36807;&#32452;&#20214;&#33719;&#21462;&#31867;&#24037;&#21378;&#23545;&#35937;&#25509;&#21475;&#25351;&#38024;&#65292;&#24182;&#29992;&#36825;&#20010;&#25351;&#38024;&#26469;&#35843;&#29992;&#21508;&#20010;&#26041;&#27861;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeW6kw">
        <h3 class="heading "><span>COM&#24211;</span></h3>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LeWIneWni-WMluWHveaVsA">
        <h4 class="heading "><span>&#21021;&#22987;&#21270;&#20989;&#25968;</span></h4>
<p   
>1.CoBuildVersion&#65306;&#33719;&#21462;COM&#24211;&#30340;&#29256;&#26412;&#21495;<br/>2.CoInitialize&#65306;&#21021;&#22987;&#21270;COM&#24211;<br/>3.CoUnInitialize&#65306;&#32456;&#27490;CO&#26381;&#21153;<br/>4.CoFreeUnsedLibraries&#65306;&#37322;&#25918;&#36827;&#31243;&#20013;&#25152;&#26377;&#19981;&#22312;&#20351;&#29992;&#30340;&#32452;&#20214;&#31243;&#24207;</p>
    </div>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LUdVSUTlh73mlbA">
        <h4 class="heading "><span>GUID&#20989;&#25968;</span></h4>
<p   
>1.IsEquaIGUID&#65306;&#21028;&#26029;&#20004;&#20010;GUID&#26159;&#21542;&#30456;&#31561;<br/>2.IsEquaIIID&#65306;&#21028;&#26029;&#20004;&#20010;IID&#26159;&#21542;&#30456;&#31561;<br/>3.ISEquaICLSID&#65306;&#21028;&#26029;&#20004;&#20010;CLSID&#26159;&#21542;&#30456;&#31561;<br/>4.CLSIDFromProgID&#65306;&#25226;&#23383;&#31526;&#20018;&#24418;&#24335;&#30340;&#23545;&#20687;&#26631;&#35782;&#36716;&#25442;&#20026;CLSID&#32467;&#26500;&#24418;&#24335;<br/>5.StringFromCLSID&#65306;&#25226;CLSID&#32467;&#26500;&#24418;&#24335;&#36716;&#21270;&#20026;&#23383;&#31526;&#20018;&#24418;&#24335;<br/>6.IIDFromString&#65306;&#25226;&#23383;&#31526;&#20018;&#24418;&#24335;&#30340;&#25509;&#21475;&#26631;&#35782;&#36716;&#25442;&#20026;IID&#32467;&#26500;&#24418;&#24335;<br/>7.StringFromIID&#65306;&#25226;IID&#32467;&#26500;&#24418;&#24335;&#36716;&#25442;&#20026;&#23383;&#31526;&#20018;&#24418;&#24335;<br/>8.StringFromGUID2&#65306;&#25226;GUID&#32467;&#26500;&#24418;&#24335;&#36716;&#25442;&#20026;&#23383;&#31526;&#20018;&#24418;&#24335;<br/>9.ProgIDFromCLSID&#65306;&#20174;CLSID&#33719;&#21462;&#23545;&#35937;&#26631;&#35782;</p>
    </div>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWvueixoeWIm-W7uuWHveaVsA">
        <h3 class="heading "><span>&#23545;&#35937;&#21019;&#24314;&#20989;&#25968;</span></h3>
<p   
>1.CoGetClassObiject&#65306;&#33719;&#21462;&#23545;&#35937;&#30340;&#31867;&#24037;&#21378;<br/>2.CoCreateInstance&#65306;&#21019;&#24314;COM&#23545;&#35937;<br/>3.CoCreateInstanceEx&#65306;&#21019;&#24314;COM&#23545;&#35937;&#65292;&#21487;&#25351;&#23450;&#22810;&#20010;&#25509;&#21475;&#25110;&#36828;&#31243;&#23545;&#35937;<br/>4.CoRegisterClassObject&#65306;&#30331;&#35760;&#19968;&#20010;&#23545;&#35937;&#65292;&#20197;&#20415;&#20854;&#23427;&#24212;&#29992;&#31243;&#24207;&#21487;&#20197;&#36830;&#25509;&#21040;&#35813;&#23545;&#35937;<br/>5.CoRevokeClassObject&#65306;&#21462;&#28040;&#23545;&#35937;&#30340;&#30331;&#35760;&#25805;&#20316;<br/>6.CoDisconnectObject&#65306;&#26029;&#24320;&#20854;&#20182;&#24212;&#29992;&#31243;&#24207;&#19982;&#23545;&#35937;&#30340;&#36830;&#25509;</p>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LeWGheWtmOeuoeeQhuWHveaVsA">
        <h4 class="heading "><span>&#20869;&#23384;&#31649;&#29702;&#20989;&#25968;</span></h4>
<p   
>1.CoTaskMemAlloc&#65306;&#20869;&#23384;&#20998;&#37197;&#20989;&#25968;<br/>2.CoTaskMemRealloc: &#20839;&#23384;&#37325;&#26032;&#20998;&#37197;&#20989;&#25968;<br/>3.CoTaskMemFree&#65306;&#20869;&#23384;&#37322;&#25918;&#20989;&#25968;<br/>4.CoGetMallo&#65306;&#33719;&#21462;COM&#24211;&#30340;&#20869;&#23384;&#31649;&#29702;&#22120;&#25509;&#21475;</p>
    </div>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUhSRVNVTFTov5Tlm57lgLw">
        <h3 class="heading "><span>HRESULT&#36820;&#22238;&#20540;</span></h3>
<p   
>COM&#35201;&#27714;&#25152;&#26377;&#30340;&#26041;&#27861;&#37117;&#20250;&#36820;&#22238;&#19968;&#20010;HRESULT&#31867;&#22411;&#30340;&#38169;&#35823;&#21495;&#65292;&#20854;&#23601;&#26159;&#19968;&#20010;&#31867;&#22411;&#23450;&#20041;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef LONG HRESULT;</code></div>
</div>
    </div>
<p   
>HRESULT&#31867;&#22411;&#30340;&#36820;&#22238;&#20540;&#21453;&#26144;&#20102;&#20989;&#25968;&#20013;&#30340;&#19968;&#20123;&#24773;&#20917;&#65292;&#20854;&#31867;&#22411;&#23450;&#20041;&#35268;&#33539;&#22914;&#19979;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_18-3-47.png" alt="images/download/attachments/1015823/image2021-10-8_18-3-47.png" width="600"  />
    </p>
<p   
>&#33258;&#23450;&#20041;&#26631;&#35760;(29&#20301;)&#21453;&#26144;&#32467;&#26524;&#26159;&#21542;&#20026;&#33258;&#23450;&#20041;&#26631;&#35782;&#65292;1 &#20026;&#26159;&#65292;0 &#21017;&#19981;&#26159;&#65307;&#25805;&#20316;&#30721;(16-28&#20301;)&#34920;&#31034;&#32467;&#26524;&#25805;&#20316;&#26469;&#28304;&#65292;&#22312;Windows&#24179;&#21488;&#19978;&#65292;&#20854;&#23450;&#20041;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#define FACILITY_WINDOWS         </code><code class="value">8</code></div>
<div class="line"><code class="plain">#define FACILITY_STORAGE         </code><code class="value">3</code></div>
<div class="line"><code class="plain">#define FACILITY_RPC             </code><code class="value">1</code></div>
<div class="line"><code class="plain">#define FACILITY_SSPI            </code><code class="value">9</code></div>
<div class="line"><code class="plain">#define FACILITY_WIN32           </code><code class="value">7</code></div>
<div class="line"><code class="plain">#define FACILITY_CONTROL         </code><code class="value">10</code></div>
<div class="line"><code class="plain">#define FACILITY_NULL            </code><code class="value">0</code></div>
<div class="line"><code class="plain">#define FACILITY_INTERNET        </code><code class="value">12</code></div>
<div class="line"><code class="plain">#define FACILITY_ITF             </code><code class="value">4</code></div>
<div class="line"><code class="plain">#define FACILITY_DISPATCH        </code><code class="value">2</code></div>
<div class="line"><code class="plain">#define FACILITY_CERT            </code><code class="value">11</code></div>
</div>
    </div>
<p   
>&#25805;&#20316;&#32467;&#26524;&#30721;(0-15&#20301;)&#21453;&#26144;&#25805;&#20316;&#30340;&#29366;&#24577;&#65292;WinError.h&#23450;&#20041;&#20102;Win32&#20989;&#25968;&#25152;&#26377;&#21487;&#33021;&#36820;&#22238;&#32467;&#26524;&#12290;</p>
<p   
>&#20197;&#19979;&#26159;&#19968;&#20123;&#32463;&#24120;&#29992;&#21040;&#30340;&#36820;&#22238;&#20540;&#21644;&#23439;&#23450;&#20041;&#65306;</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#36820;&#22238;&#20540;</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#21547;&#20041;</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>S_OK</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#25104;&#21151;&#65292;&#20854;&#20540;&#20026;0(&#27880;&#24847;&#65292;&#20854;&#20540;&#19982;TRUE&#30456;&#21453;)</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>S_FALSE</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#25104;&#21151;&#65292;&#20854;&#20540;&#20026;1</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>S_FAIL</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#22833;&#36133;&#65292;&#22833;&#36133;&#21407;&#22240;&#19981;&#30830;&#23450;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>E_OUTOFMEMORY</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#22833;&#36133;&#65292;&#22833;&#36133;&#21407;&#22240;&#20026;&#20869;&#23384;&#20998;&#37197;&#19981;&#25104;&#21151;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>E_NOTIMPL</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#22833;&#36133;&#65292;&#25104;&#21592;&#20989;&#25968;&#27809;&#26377;&#34987;&#23454;&#29616;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>E_NOTINTERFACE</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#25191;&#34892;&#22833;&#36133;&#65292;&#32452;&#20214;&#27809;&#26377;&#23454;&#29616;&#25351;&#23450;&#30340;&#25509;&#21475;</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>&#38656;&#35201;&#27880;&#24847;&#65292;&#25105;&#20204;&#19981;&#33021;&#31616;&#21333;&#22320;&#25226;&#36820;&#22238;&#20540;&#19982;S_OK&#21644;S_FALSE&#27604;&#36739;&#65292;&#32780;&#35201;&#29992;<strong class=" ">SECCEEDED&#21644;FAILED&#23439;</strong>&#36827;&#34892;&#21028;&#26029;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#define SUCCEEDED(hr) (((HRESULT)(hr)) &gt;= </code><code class="value">0</code><code class="plain">)</code></div>
<div class="line"><code class="plain">#define FAILED(hr) (((HRESULT)(hr)) &lt; </code><code class="value">0</code><code class="plain">)</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeS4juazqOWGjOihqA">
        <h3 class="heading "><span>COM&#19982;&#27880;&#20876;&#34920;</span></h3>
<p   
>COM&#23458;&#25143;&#21644;COM&#32452;&#20214;&#26159;&#30456;&#20114;&#29420;&#31435;&#30340;&#65292;COM&#32452;&#20214;&#30340;&#37325;&#35201;&#24615;&#36136;&#20043;&#19968;&#26159;&#20301;&#32622;&#36879;&#26126;&#24615;&#65307;&#24403;&#23458;&#25143;&#31243;&#24207;&#35843;&#29992;COM&#23545;&#35937;&#26102;&#19981;&#38656;&#35201;&#32771;&#34385;COM&#32452;&#20214;&#25152;&#22788;&#30340;&#20301;&#32622;&#65292;&#36825;&#23601;&#26159;&#20301;&#32622;&#26080;&#20851;&#24615;&#65307;COM&#20301;&#32622;&#26080;&#20851;&#24615;&#30340;&#23454;&#29616;&#26426;&#21046;&#24182;&#19981;&#28145;&#22885;&#65292;&#23427;&#20027;&#35201;&#20381;&#36182;&#20110;&#27880;&#20876;&#34920;&#65292;&#36825;&#20063;&#23601;&#26159;&#20026;&#20160;&#20040;&#19968;&#23450;&#35201;&#22312;&#20351;&#29992;&#20043;&#21069;&#23545;COM&#32452;&#20214;&#36827;&#34892;&#27880;&#20876;&#30340;&#21407;&#22240;&#65307;COM&#24211;&#22312;&#25509;&#21040;&#23458;&#25143;&#31243;&#24207;&#30340;&#35831;&#27714;&#21518;&#65292;&#20250;&#26681;&#25454;&#32473;&#23450;&#30340;GUID&#21040;&#27880;&#20876;&#34920;&#20013;&#26816;&#32034;COM&#23545;&#35937;&#30340;&#27880;&#20876;&#26465;&#30446;&#65292;&#24182;&#20197;&#27492;&#26469;&#23450;&#20301;COM&#23545;&#35937;&#12290;</p>
<p   
>COM&#32452;&#20214;&#23545;&#24212;&#20108;&#36827;&#21046;&#25991;&#20214;&#30340;&#23384;&#25918;&#36335;&#24452;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HKEY_CLASSES_ROOT\CLSID\COM组件的CLSID\InprocServer32</code></div>
<div class="line"><code class="plain">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\COM组件的CLSID\InprocServer32</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HKEY_CLASSES_ROOT\Wow6432Node\CLSID\COM组件的CLSID\InprocServer32</code></div>
<div class="line"><code class="plain">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Wow6432Node\CLSID\COM组件的CLSID\InprocServer32</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_18-15-1.png" alt="images/download/attachments/1015823/image2021-10-8_18-15-1.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTee7hOS7tg">
        <h2 class="heading "><span>COM&#32452;&#20214;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWunueOsOexu-W3peWOguWvueixoQ">
        <h3 class="heading "><span>&#23454;&#29616;&#31867;&#24037;&#21378;&#23545;&#35937;</span></h3>
<p   
>COM&#23545;&#35937;&#30340;&#21019;&#24314;&#26159;&#36890;&#36807;&#31867;&#24037;&#21378;&#26469;&#23436;&#25104;&#30340;&#65292;&#31867;&#24037;&#21378;&#26159;COM&#23545;&#35937;&#30340;&#29983;&#20135;&#22522;&#22320;&#65292;&#23545;&#24212;&#27599;&#19968;&#20010;COM&#31867;&#65292;&#37117;&#26377;&#19968;&#20010;&#31867;&#24037;&#21378;&#19987;&#38376;&#29992;&#20110;&#35813;COM&#31867;&#30340;&#23545;&#35937;&#21019;&#24314;&#25805;&#20316;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_18-45-58.png" alt="images/download/attachments/1015823/image2021-10-8_18-45-58.png" width="600"  />
    </p>
<p   
>&#31867;&#21378;&#26412;&#36523;&#20063;&#26159;&#19968;&#20010;COM&#23545;&#35937;&#65292;&#23427;&#25903;&#25345;&#19968;&#20010;&#29305;&#27530;&#30340;&#25509;&#21475;IClassFactory&#65292;&#36825;&#20010;&#25509;&#21475;&#30340;&#23450;&#20041;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">IClassFactory : </code><code class="keyword">public</code><code class="plain"> IUnknown</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain"> virtual </code><code class="comments">/* [local] */</code><code class="plain"> HRESULT STDMETHODCALLTYPE CreateInstance( </code></div>
<div class="line"><code class="plain">     </code><code class="comments">/* [unique][in] */</code><code class="plain"> IUnknown *pUnkOuter,</code></div>
<div class="line"><code class="plain">     </code><code class="comments">/* [in] */</code><code class="plain"> REFIID riid,</code></div>
<div class="line"><code class="plain">     </code><code class="comments">/* [iid_is][out] */</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> **ppvObject) = </code><code class="value">0</code><code class="plain">;  </code></div>
<div class="line"><code class="plain"> virtual </code><code class="comments">/* [local] */</code><code class="plain"> HRESULT STDMETHODCALLTYPE LockServer( </code></div>
<div class="line"><code class="plain">     </code><code class="comments">/* [in] */</code><code class="plain"> BOOL fLock) = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23427;&#32487;&#25215;&#20102;IUnknown&#25509;&#21475;&#65292;&#24182;&#19988;&#22810;&#20102;&#20004;&#20010;&#25104;&#21592;&#20989;&#25968;&#65306;CreateInstance&#12289;LockServer&#12290;</p>
<p   
>CreateInstance&#20989;&#25968;&#26159;IClassFactory&#25509;&#21475;&#20013;&#26368;&#37325;&#35201;&#30340;&#20989;&#25968;&#65292;<strong class=" ">&#23427;&#29992;&#20110;&#21019;&#24314;&#30456;&#24212;&#30340;COM&#23545;&#35937;</strong>&#65292;&#22240;&#20026;&#27599;&#20010;&#31867;&#21378;&#21482;&#38024;&#23545;&#29305;&#23450;&#30340;COM&#23545;&#35937;&#65292;&#25152;&#20197;CreateInstance&#25104;&#21592;&#20989;&#25968;&#30693;&#36947;&#35813;&#21019;&#24314;&#20160;&#20040;&#26679;&#30340;COM&#23545;&#35937;&#12290;</p>
<p   
>LockServer&#29992;&#20110;&#25511;&#21046;&#32452;&#20214;&#30340;&#29983;&#23384;&#21608;&#26399;&#65292;<strong class=" ">&#29992;&#20110;&#22312;&#22810;&#23458;&#25143;&#35843;&#29992;COM&#26102;&#65292;&#38145;&#23450;COM&#65292;&#20197;&#20813;&#19968;&#20010;&#23458;&#25143;&#36864;&#20986;&#26102;&#38144;&#27585;&#20102;COM</strong>&#65292;&#37027;&#20040;&#20854;&#20182;&#23458;&#25143;&#30340;&#35843;&#29992;&#23558;&#21457;&#29983;&#38169;&#35823;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWunueOsOiHquWKqOazqOWGjA">
        <h3 class="heading "><span>&#23454;&#29616;&#33258;&#21160;&#27880;&#20876;</span></h3>
<p   
>&#32452;&#20214;&#31243;&#24207;&#21019;&#24314;&#23436;&#25104;&#20043;&#21518;&#65292;&#24517;&#39035;&#35201;&#36890;&#36807;&#26576;&#31181;&#36884;&#24452;&#25226;&#23427;&#30340;&#20449;&#24687;&#27880;&#20876;&#21040;&#27880;&#20876;&#34920;&#20013;&#65292;&#28982;&#21518;&#23458;&#25143;&#31243;&#24207;&#25165;&#33021;&#26681;&#25454;&#27880;&#20876;&#34920;&#20013;&#30340;&#20449;&#24687;&#23545;&#32452;&#20214;&#31243;&#24207;&#36827;&#34892;&#25805;&#20316;&#12290;</p>
<p   
>&#23454;&#29616;&#33258;&#27880;&#20876;&#32452;&#20214;&#24517;&#39035;&#25552;&#20379;&#20004;&#20010;&#23548;&#20986;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">STDAPI DllRegisterServer(</code><code class="keyword">void</code><code class="plain">) </code></div>
<div class="line"><code class="plain">STDAPI DllUnregisterServer(</code><code class="keyword">void</code><code class="plain">) </code></div>
</div>
    </div>
<p   
><u class=" "><strong class=" ">regsvr32 com&#32452;&#20214;&#36335;&#24452;</strong></u>&#21629;&#20196;&#23454;&#38469;&#26159;regsvr32.exe&#35843;&#29992;&#32452;&#20214;&#30340;DllRegisterServer&#20989;&#25968;&#65292;&#23454;&#38469;<strong class=" ">&#27880;&#20876;&#30340;&#25805;&#20316;&#26159;&#22312;&#32452;&#20214;&#30340;DllRegisterServer&#20989;&#25968;</strong>&#37324;&#23436;&#25104;&#30340;&#65292;&#21516;&#26679;&#25191;&#34892;<u class=" "><strong class=" ">regsvr32 /u com&#32452;&#20214;&#36335;&#24452;</strong></u>&#21629;&#20196;&#21487;&#20197;&#36827;&#34892;&#21453;&#27880;&#20876;&#65292;&#23454;&#38469;&#36827;&#34892;<strong class=" ">&#21453;&#27880;&#20876;&#30340;&#25805;&#20316;&#26159;&#22312;&#32452;&#20214;&#30340;DllUnregisterServer&#20989;&#25968;</strong>&#37324;&#23436;&#25104;&#30340;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWunueOsOiHquWKqOWNuOi9vQ">
        <h3 class="heading "><span>&#23454;&#29616;&#33258;&#21160;&#21368;&#36733;</span></h3>
<p   
>&#21482;&#26377;&#24403;&#32452;&#20214;&#28385;&#36275;&#20197;&#19979;&#20004;&#20010;&#26465;&#20214;&#25165;&#33021;&#34987;&#21368;&#36733;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#32452;&#20214;&#20013;&#23545;&#35937;&#25968;&#20026;0&#65307;</p>
</li><li class=" "><p   
>&#31867;&#21378;&#30340;&#38145;&#35745;&#25968;&#20026;0&#12290;</p>
</li></ol><p   
>COM&#20013;&#30340;<strong class=" ">CoFreeAllLibraries</strong>&#20989;&#25968;&#21487;&#20197;&#26816;&#27979;&#24403;&#21069;&#36827;&#31243;&#20013;&#30340;&#25152;&#26377;&#32452;&#20214;&#31243;&#24207;&#65292;&#24403;&#21457;&#29616;&#26576;&#20010;&#32452;&#20214;&#28385;&#36275;&#19978;&#38754;&#20004;&#20010;&#26465;&#20214;&#26102;&#65292;&#23601;&#35843;&#29992;FreeLibrary&#20989;&#25968;&#25226;&#35813;&#32452;&#20214;&#20174;&#20869;&#23384;&#20013;&#37322;&#25918;&#65292;&#26377;&#20004;&#20010;&#38382;&#39064;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#35841;&#26469;&#35843;&#29992;<strong class=" ">CoFreeAllLibraries</strong>&#20989;&#25968;&#65311;&#26159;<strong class=" ">&#30001;&#23458;&#25143;&#26469;&#35843;&#29992;</strong>&#65292;&#19968;&#33324;&#22312;&#31243;&#24207;&#31354;&#38386;&#30340;&#26102;&#20505;&#35843;&#29992;&#12290;</p>
</li><li class=" "><p   
>CoFreeAllLibraries&#20989;&#25968;&#24590;&#20040;&#30693;&#36947;&#28385;&#36275;&#20102;&#19978;&#38754;&#35828;&#30340;&#21487;&#20197;&#21368;&#36733;&#30340;&#26465;&#20214;&#65311;&#38656;&#35201;<strong class=" ">&#32452;&#20214;&#23548;&#20986;&#19968;&#20010;DllCanUnloadNow&#20989;&#25968;</strong>&#65292;&#22914;&#26524;DllCanUnloadNow&#20989;&#25968;&#36820;&#22238;<strong class=" ">S_OK&#34920;&#31034;&#23545;&#35937;&#21487;&#20197;&#34987;&#21368;&#36733;</strong>&#12290;</p>
</li></ol>    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeWuouaItw">
        <h2 class="heading "><span>COM&#23458;&#25143;</span></h2>
<p   
>COM&#23458;&#25143;&#20174;&#21482;&#30693;&#36947;CLSID&#21040;&#33719;&#21462;&#21040;&#25509;&#21475;&#25351;&#38024;&#24517;&#39035;&#32463;&#36807;&#20004;&#27493;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#24471;&#21040;&#35813;CLSID&#30340;&#31867;&#21378;&#23545;&#35937;&#65307;</p>
</li><li class=" "><p   
>&#30001;&#31867;&#21378;&#23545;&#35937;&#21019;&#24314;COM&#23545;&#35937;&#65292;&#36820;&#22238;&#25509;&#21475;&#25351;&#38024;&#32473;&#23458;&#25143;&#12290;</p>
</li></ol><p   
>&#23458;&#25143;&#24471;&#21040;&#23545;&#35937;&#25509;&#21475;&#25351;&#38024;&#21518;&#65292;&#21487;&#20197;&#29992;&#25351;&#38024;&#35843;&#29992;&#25509;&#21475;&#30340;&#25104;&#21592;&#20989;&#25968;&#65292;&#36824;&#21487;&#20197;&#33719;&#24471;&#20854;&#20182;&#25509;&#21475;&#30340;&#25351;&#38024;&#65292;&#20174;&#32780;&#24471;&#21040;COM&#23545;&#35937;&#30340;&#25152;&#26377;&#26381;&#21153;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeaVsOaNruexu-Weiw">
        <h2 class="heading "><span>COM&#25968;&#25454;&#31867;&#22411;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUNPTeW4uOingeaVsOaNruexu-Weiw">
        <h3 class="heading "><span>COM&#24120;&#35265;&#25968;&#25454;&#31867;&#22411;</span></h3>
<p   
>COM&#24120;&#35265;&#30340;&#25968;&#25454;&#31867;&#22411;&#22914;&#19979;&#25152;&#31034;&#65292;&#20854;&#20013;&#23383;&#20307;&#21152;&#31895;&#37096;&#20998;&#26159;&#25105;&#20204;&#26242;&#26102;&#19981;&#20102;&#35299;&#30340;&#65306;</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>CHAR, CHAR*, BYTE, BYTE*, SHORT, SHORT*, USHORT, USHORT*, INT, INT*, UINT, UINT*, LONG, LONG*, ULONG, ULONG*, FLOAT, FLOAT*, DOUBLE, DOUBLE*, <strong class=" ">VARIANT_BOOL, VARIANT_BOOL*, BSTR, BSTR*</strong>, IUnknown*, IUnknown**, <strong class=" ">VARIANT, VARIANT*</strong></p>
        </div>
    </div>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LVZBUklBTlRfQk9PTA">
        <h4 class="heading "><span>VARIANT_BOOL</span></h4>
<p   
>&#25968;&#25454;&#31867;&#22411;VARIANT_BOOL&#30340;&#23450;&#20041;&#22914;&#19979;&#65292;&#20854;&#26412;&#36136;&#23601;&#26159;&#19968;&#20010;short&#31867;&#22411;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef </code><code class="keyword">short</code><code class="plain"> VARIANT_BOOL;</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#24819;&#35201;&#20351;&#29992;&#36825;&#20010;&#31867;&#22411;&#30340;&#35805;&#38656;&#35201;&#21253;&#21547;&#19968;&#20010;&#22836;&#25991;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;oaidl.h&gt;</code></div>
</div>
    </div>
    </div>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LUJTVFI">
        <h4 class="heading "><span>BSTR</span></h4>
<p   
>&#25968;&#25454;&#31867;&#22411;BSTR&#26159;COM&#20013;&#30340;&#23383;&#31526;&#20018;&#31867;&#22411;&#65292;BSTR*&#20063;&#23601;&#26159;&#20854;&#30340;&#25351;&#38024;&#65307;BSTR&#26159;&#25351;&#21521;&#30340;&#26159;&#23485;&#23383;&#31526;&#20018;&#30340;&#25351;&#38024;&#65292;&#26159;&#19968;&#20010;&#24102;&#26377;&#23383;&#31526;&#35745;&#25968;&#20540;&#30340;&#23383;&#31526;&#20018;&#65292;&#19988;&#36825;&#20010;&#35745;&#25968;&#20540;&#26159;&#20445;&#23384;&#22312;&#23383;&#31526;&#25968;&#32452;&#30340;&#24320;&#22836;&#30340;4&#23383;&#33410;&#20013;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_19-2-34.png" alt="images/download/attachments/1015823/image2021-10-8_19-2-34.png" width="600"  />
    </p>
<p   
>&#22312;&#20351;&#29992;&#20043;&#21069;&#38656;&#35201;&#21253;&#21547;&#22836;&#25991;&#20214;&#65288;&#23450;&#20041;&#30340;&#25991;&#20214;&#65289;&#65292;&#22914;&#26524;&#20320;&#21253;&#21547;&#20102;windows.h&#25110;&#32773;atlbase.h&#25991;&#20214;&#20063;&#21487;&#20197;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;atlconv.h&gt;</code></div>
</div>
    </div>
<p   
>&#20351;&#29992;BSTR&#19981;&#33021;&#30452;&#25509;&#36171;&#20540;&#65292;&#38656;&#35201;&#20511;&#21161;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BSTR bstrA = SysAllocString(L</code><code class="string">"Hello BSTR"</code><code class="plain">); </code><code class="comments">// 赋值</code></div>
<div class="line"><code class="plain">BSTR bstrB = SysAllocStringLen(bstrA, SysStringLen(bstrA)); </code><code class="comments">// 指定长度赋值</code></div>
<div class="line"><code class="plain">SysFreeString(bstrA); </code><code class="comments">// 释放</code></div>
<div class="line"><code class="plain">SysFreeString(bstrB); </code><code class="comments">// 释放</code></div>
</div>
    </div>
<p   
>&#25105;&#20204;&#21487;&#20197;&#22312;VS&#20013;&#35843;&#35797;&#19968;&#19979;&#35266;&#23519;&#20869;&#23384;&#65292;&#21487;&#20197;&#24456;&#28165;&#26970;&#30340;&#30475;&#35265;&#22312;Hello&#21069;&#38754;&#35760;&#24405;&#20102;&#23383;&#31526;&#20018;&#30340;&#38271;&#24230;0x14&#65292;&#20063;&#23601;&#26159;20&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_19-11-54.png" alt="images/download/attachments/1015823/image2021-10-8_19-11-54.png" width="600"  />
    </p>
<p   
>&#22914;&#19978;&#31034;&#20363;&#20013;&#20063;&#30452;&#25509;&#23558;BSTR&#26377;&#20851;&#30340;&#20989;&#25968;&#32473;&#21015;&#20986;&#26469;&#20102;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BSTR SysAllocString(</code><code class="keyword">const</code><code class="plain"> OLECHAR *); </code><code class="comments">// 是COM中申请BSTR字符串的方法。</code></div>
<div class="line"><code class="plain">BSTR SysAllocStringLen(</code><code class="keyword">const</code><code class="plain"> OLECHAR *, UINT); </code><code class="comments">// 根据字符串指针与字符个数构造BSTR字符串。</code></div>
<div class="line"><code class="plain">UINT SysStringLen(BSTR); </code><code class="comments">// 获取字符串前面的计数值。</code></div>
<div class="line"><code class="keyword">void</code><code class="plain"> SysFreeString(BSTR); </code><code class="comments">// 释放字符串，当COM中的字符串（BSTR）不再使用时，调用该函数。</code></div>
</div>
    </div>
    </div>
    <div class="section section-4" id="src-1015823_safe-id-Q09N57uE5Lu2LVZBUklBTlQ">
        <h4 class="heading "><span>VARIANT</span></h4>
<p   
>&#35745;&#31639;&#26426;&#35821;&#35328;&#22810;&#31181;&#22810;&#26679;&#65292;COM&#20135;&#29983;&#30340;&#30446;&#30340;&#20043;&#19968;&#23601;&#26159;&#35201;&#36328;&#35821;&#35328;&#65292;&#32780;VARIANT&#25968;&#25454;&#31867;&#22411;&#23601;&#20855;&#26377;&#20102;&#36328;&#35821;&#35328;&#30340;&#29305;&#24615;&#65292;&#21516;&#26102;&#23427;&#21487;&#33021;&#23384;&#20648;&#20219;&#20309;&#30340;&#25968;&#25454;&#31867;&#22411;&#65292;<strong class=" ">&#35828;&#22840;&#24352;&#19968;&#28857;&#65292;&#23427;&#26159;&#19975;&#33021;&#25968;&#25454;&#31867;&#22411;</strong>&#12290;</p>
<p   
>&#20026;&#23454;&#29616;&#19975;&#33021;&#31867;&#22411;&#30340;&#21151;&#33021;&#65292;&#22312;C++&#20013;&#65292;VARIANT&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#35813;&#32467;&#26500;&#20307;&#20869;&#37096;&#21448;&#26377;&#32852;&#21512;&#20307;&#65288;&#32852;&#21512;&#20102;&#22810;&#31181;&#22522;&#26412;&#30340;&#25968;&#25454;&#31867;&#22411;&#65289;&#65292;<u class=" "><strong class=" ">&#21448;&#26377;&#21464;&#37327;&#31867;&#22411;&#26631;&#24535;VARTYPE vt</strong></u>&#65292;&#21487;&#35265;VARIANT&#34987;&#35774;&#32622;&#24471;&#22810;&#20040;&#24039;&#22937;&#12289;&#21512;&#29702;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef </code><code class="comments">/* [wire_marshal] */</code><code class="plain"> struct tagVARIANT VARIANT;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">struct tagVARIANT</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">    union </code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">        struct __tagVARIANT</code></div>
<div class="line"><code class="plain">            {</code></div>
<div class="line"><code class="plain">            VARTYPE vt;</code></div>
<div class="line"><code class="plain">            WORD wReserved1;</code></div>
<div class="line"><code class="plain">            WORD wReserved2;</code></div>
<div class="line"><code class="plain">            WORD wReserved3;</code></div>
<div class="line"><code class="plain">            union </code></div>
<div class="line"><code class="plain">                {</code></div>
<div class="line"><code class="plain">                LONGLONG llVal;</code></div>
<div class="line"><code class="plain">                LONG lVal;</code></div>
<div class="line"><code class="plain">                BYTE bVal;</code></div>
<div class="line"><code class="plain">                SHORT iVal;</code></div>
<div class="line"><code class="plain">                FLOAT fltVal;</code></div>
<div class="line"><code class="plain">                DOUBLE dblVal;</code></div>
<div class="line"><code class="plain">                VARIANT_BOOL boolVal;</code></div>
<div class="line"><code class="plain">                _VARIANT_BOOL bool;</code></div>
<div class="line"><code class="plain">                SCODE scode;</code></div>
<div class="line"><code class="plain">                CY cyVal;</code></div>
<div class="line"><code class="plain">                DATE date;</code></div>
<div class="line"><code class="plain">                BSTR bstrVal;</code></div>
<div class="line"><code class="plain">                IUnknown *punkVal;</code></div>
<div class="line"><code class="plain">                IDispatch *pdispVal;</code></div>
<div class="line"><code class="plain">                SAFEARRAY *parray;</code></div>
<div class="line"><code class="plain">                BYTE *pbVal;</code></div>
<div class="line"><code class="plain">                SHORT *piVal;</code></div>
<div class="line"><code class="plain">                LONG *plVal;</code></div>
<div class="line"><code class="plain">                LONGLONG *pllVal;</code></div>
<div class="line"><code class="plain">                FLOAT *pfltVal;</code></div>
<div class="line"><code class="plain">                DOUBLE *pdblVal;</code></div>
<div class="line"><code class="plain">                VARIANT_BOOL *pboolVal;</code></div>
<div class="line"><code class="plain">                _VARIANT_BOOL *pbool;</code></div>
<div class="line"><code class="plain">                SCODE *pscode;</code></div>
<div class="line"><code class="plain">                CY *pcyVal;</code></div>
<div class="line"><code class="plain">                DATE *pdate;</code></div>
<div class="line"><code class="plain">                BSTR *pbstrVal;</code></div>
<div class="line"><code class="plain">                IUnknown **ppunkVal;</code></div>
<div class="line"><code class="plain">                IDispatch **ppdispVal;</code></div>
<div class="line"><code class="plain">                SAFEARRAY **pparray;</code></div>
<div class="line"><code class="plain">                VARIANT *pvarVal;</code></div>
<div class="line"><code class="plain">                PVOID byref;</code></div>
<div class="line"><code class="plain">                CHAR cVal;</code></div>
<div class="line"><code class="plain">                USHORT uiVal;</code></div>
<div class="line"><code class="plain">                ULONG ulVal;</code></div>
<div class="line"><code class="plain">                ULONGLONG ullVal;</code></div>
<div class="line"><code class="plain">                INT intVal;</code></div>
<div class="line"><code class="plain">                UINT uintVal;</code></div>
<div class="line"><code class="plain">                DECIMAL *pdecVal;</code></div>
<div class="line"><code class="plain">                CHAR *pcVal;</code></div>
<div class="line"><code class="plain">                USHORT *puiVal;</code></div>
<div class="line"><code class="plain">                ULONG *pulVal;</code></div>
<div class="line"><code class="plain">                ULONGLONG *pullVal;</code></div>
<div class="line"><code class="plain">                INT *pintVal;</code></div>
<div class="line"><code class="plain">                UINT *puintVal;</code></div>
<div class="line"><code class="plain">                struct __tagBRECORD</code></div>
<div class="line"><code class="plain">                    {</code></div>
<div class="line"><code class="plain">                    PVOID pvRecord;</code></div>
<div class="line"><code class="plain">                    IRecordInfo *pRecInfo;</code></div>
<div class="line"><code class="plain">                    }   __VARIANT_NAME_4;</code></div>
<div class="line"><code class="plain">                }   __VARIANT_NAME_3;</code></div>
<div class="line"><code class="plain">            }   __VARIANT_NAME_2;</code></div>
<div class="line"><code class="plain">        DECIMAL decVal;</code></div>
<div class="line"><code class="plain">        }   __VARIANT_NAME_1;</code></div>
<div class="line"><code class="plain">    } ;</code></div>
</div>
    </div>
<p   
><strong class=" ">&#21464;&#37327;&#31867;&#22411;&#26631;&#24535;VARTYPE vt</strong>&#65292;&#20854;&#26377;&#23545;&#24212;&#30340;&#20540;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">/* VARIANT STRUCTURE</code></div>
<div class="line"><code class="comments"> *</code></div>
<div class="line"><code class="comments"> *  VARTYPE vt;</code></div>
<div class="line"><code class="comments"> *  WORD wReserved1;</code></div>
<div class="line"><code class="comments"> *  WORD wReserved2;</code></div>
<div class="line"><code class="comments"> *  WORD wReserved3;</code></div>
<div class="line"><code class="comments"> *  union {</code></div>
<div class="line"><code class="comments"> *    LONGLONG       VT_I8</code></div>
<div class="line"><code class="comments"> *    LONG           VT_I4</code></div>
<div class="line"><code class="comments"> *    BYTE           VT_UI1</code></div>
<div class="line"><code class="comments"> *    SHORT          VT_I2</code></div>
<div class="line"><code class="comments"> *    FLOAT          VT_R4</code></div>
<div class="line"><code class="comments"> *    DOUBLE         VT_R8</code></div>
<div class="line"><code class="comments"> *    VARIANT_BOOL   VT_BOOL</code></div>
<div class="line"><code class="comments"> *    SCODE          VT_ERROR</code></div>
<div class="line"><code class="comments"> *    CY             VT_CY</code></div>
<div class="line"><code class="comments"> *    DATE           VT_DATE</code></div>
<div class="line"><code class="comments"> *    BSTR           VT_BSTR</code></div>
<div class="line"><code class="comments"> *    IUnknown *     VT_UNKNOWN</code></div>
<div class="line"><code class="comments"> *    IDispatch *    VT_DISPATCH</code></div>
<div class="line"><code class="comments"> *    SAFEARRAY *    VT_ARRAY</code></div>
<div class="line"><code class="comments"> *    BYTE *         VT_BYREF|VT_UI1</code></div>
<div class="line"><code class="comments"> *    SHORT *        VT_BYREF|VT_I2</code></div>
<div class="line"><code class="comments"> *    LONG *         VT_BYREF|VT_I4</code></div>
<div class="line"><code class="comments"> *    LONGLONG *     VT_BYREF|VT_I8</code></div>
<div class="line"><code class="comments"> *    FLOAT *        VT_BYREF|VT_R4</code></div>
<div class="line"><code class="comments"> *    DOUBLE *       VT_BYREF|VT_R8</code></div>
<div class="line"><code class="comments"> *    VARIANT_BOOL * VT_BYREF|VT_BOOL</code></div>
<div class="line"><code class="comments"> *    SCODE *        VT_BYREF|VT_ERROR</code></div>
<div class="line"><code class="comments"> *    CY *           VT_BYREF|VT_CY</code></div>
<div class="line"><code class="comments"> *    DATE *         VT_BYREF|VT_DATE</code></div>
<div class="line"><code class="comments"> *    BSTR *         VT_BYREF|VT_BSTR</code></div>
<div class="line"><code class="comments"> *    IUnknown **    VT_BYREF|VT_UNKNOWN</code></div>
<div class="line"><code class="comments"> *    IDispatch **   VT_BYREF|VT_DISPATCH</code></div>
<div class="line"><code class="comments"> *    SAFEARRAY **   VT_BYREF|VT_ARRAY</code></div>
<div class="line"><code class="comments"> *    VARIANT *      VT_BYREF|VT_VARIANT</code></div>
<div class="line"><code class="comments"> *    PVOID          VT_BYREF (Generic ByRef)</code></div>
<div class="line"><code class="comments"> *    CHAR           VT_I1</code></div>
<div class="line"><code class="comments"> *    USHORT         VT_UI2</code></div>
<div class="line"><code class="comments"> *    ULONG          VT_UI4</code></div>
<div class="line"><code class="comments"> *    ULONGLONG      VT_UI8</code></div>
<div class="line"><code class="comments"> *    INT            VT_INT</code></div>
<div class="line"><code class="comments"> *    UINT           VT_UINT</code></div>
<div class="line"><code class="comments"> *    DECIMAL *      VT_BYREF|VT_DECIMAL</code></div>
<div class="line"><code class="comments"> *    CHAR *         VT_BYREF|VT_I1</code></div>
<div class="line"><code class="comments"> *    USHORT *       VT_BYREF|VT_UI2</code></div>
<div class="line"><code class="comments"> *    ULONG *        VT_BYREF|VT_UI4</code></div>
<div class="line"><code class="comments"> *    ULONGLONG *    VT_BYREF|VT_UI8</code></div>
<div class="line"><code class="comments"> *    INT *          VT_BYREF|VT_INT</code></div>
<div class="line"><code class="comments"> *    UINT *         VT_BYREF|VT_UINT</code></div>
<div class="line"><code class="comments"> *  }</code></div>
<div class="line"><code class="comments"> */</code></div>
</div>
    </div>
<p   
>&#24403;&#25105;&#20204;&#24819;&#29992;VARIANT&#26469;&#20445;&#23384;LONG&#31867;&#22411;&#30340;&#26102;&#20505;&#21487;&#20197;&#36825;&#26679;&#20889;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VARIANT var;</code></div>
<div class="line"><code class="plain">VariantInit(&amp;var); </code><code class="comments">// 初始化</code></div>
<div class="line"><code class="plain">var.vt = VT_I4; </code><code class="comments">// 变量类型标志，如上所示VT_I4对应LONG类型</code></div>
<div class="line"><code class="plain">var.lVal = </code><code class="value">100</code><code class="plain">; </code><code class="comments">// 这里的成员lVal就表示着LONG，这个可以在VARIANT结构体的定义中找到</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VariantClear(&amp;var); </code><code class="comments">// 清空</code></div>
</div>
    </div>
<p   
>&#23384;&#20648;&#23398;&#20250;&#20102;&#65292;&#25509;&#19979;&#26469;&#23601;&#35201;&#20174;VARIANT&#20013;&#35835;&#21462;&#23384;&#20648;&#30340;&#20540;&#20102;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VARIANT var;</code></div>
<div class="line"><code class="plain">VariantInit(&amp;var); </code><code class="comments">// 初始化</code></div>
<div class="line"><code class="plain">var.vt = VT_I4; </code><code class="comments">// 变量类型标志，如上所示VT_I4对应LONG类型</code></div>
<div class="line"><code class="plain">var.lVal = </code><code class="value">100</code><code class="plain">; </code><code class="comments">// 这里的成员lVal就表示着LONG，这个可以在VARIANT结构体的定义中找到</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">if</code><code class="plain"> (var.vt == VT_I4) </code><code class="comments">// 判断</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    LONG lVar = var.lVal; </code><code class="comments">// 获取</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VariantClear(&amp;var); </code><code class="comments">// 清空</code></div>
</div>
    </div>
<p   
>&#22914;&#26524;&#20320;&#24819;&#35201;&#23558;VARIANT&#36827;&#34892;&#25968;&#25454;&#31867;&#22411;&#30340;&#36716;&#25442;&#21487;&#20197;&#20351;&#29992;&#20989;&#25968;VariantChangeType&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">WINOLEAUTAPI VariantChangeType(</code></div>
<div class="line"><code class="plain">    _Inout_ VARIANTARG * pvargDest, </code><code class="comments">// 目标VARIANT的指针</code></div>
<div class="line"><code class="plain">    _In_ </code><code class="keyword">const</code><code class="plain"> VARIANTARG * pvarSrc, </code><code class="comments">// 源VARIANT的指针</code></div>
<div class="line"><code class="plain">    _In_ USHORT wFlags, </code><code class="comments">// 强制转化的控制符</code></div>
<div class="line"><code class="plain">    _In_ VARTYPE vt </code><code class="comments">// 需要强制转化的类型</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#20363;&#22914;&#25105;&#29616;&#22312;&#24819;&#23558;LONG&#31867;&#22411;&#36716;&#20026;FLOAT&#31867;&#22411;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VARIANT var;</code></div>
<div class="line"><code class="plain">VariantInit(&amp;var); </code><code class="comments">// 初始化</code></div>
<div class="line"><code class="plain">var.vt = VT_I4; </code><code class="comments">// 变量类型标志，如上所示VT_I4对应LONG类型</code></div>
<div class="line"><code class="plain">var.lVal = </code><code class="value">100</code><code class="plain">; </code><code class="comments">// 这里的成员lVal就表示着LONG，这个可以在VARIANT结构体的定义中找到</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VariantChangeType(&amp;var, &amp;var, </code><code class="value">0</code><code class="plain">, VT_R4);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">VariantClear(&amp;var); </code><code class="comments">// 清空</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_21-0-52.png" alt="images/download/attachments/1015823/image2021-10-8_21-0-52.png" width="600"  />
    </p>
<p   
><br/></p>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LUFUTA">
        <h1 class="heading "><span>ATL</span></h1>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeeugOS7iw">
        <h2 class="heading "><span>&#31616;&#20171;</span></h2>
<p   
>ATL&#26159;&#27963;&#21160;(&#21160;&#24577;)&#27169;&#26495;&#24211;(ActiveX Template Library)&#30340;&#32553;&#20889;&#65292;&#23427;&#26159;&#19968;&#22871;C++&#27169;&#29256;&#65307;ATL&#30340;&#22522;&#26412;&#30446;&#26631;&#65306;<strong class=" ">&#20351;COM&#24320;&#21457;&#23613;&#21487;&#33021;&#33258;&#21160;&#21270;</strong>&#65292;&#36825;&#20010;&#22522;&#26412;&#30446;&#26631;&#20915;&#23450;&#20102;ATL&#21482;&#38754;&#21521;COM&#24320;&#21457;&#25552;&#20379;&#25903;&#25345;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeeUqEFUTOWItuS9nOeugOWNleWvueixoQ">
        <h2 class="heading "><span>&#29992;ATL&#21046;&#20316;&#31616;&#21333;&#23545;&#35937;</span></h2>
<p   
>&#21019;&#24314;ATL&#24037;&#31243;&#65306;&#30452;&#25509;&#20351;&#29992;VS&#21019;&#24314;&#40664;&#35748;&#30340;&#21363;&#21487;&#12290;</p>
<p   
>&#28155;&#21152;&#31616;&#21333;&#23545;&#35937;&#65306;&#36890;&#36807;&#21487;&#35270;&#21270;&#25805;&#20316;&#30452;&#25509;&#21435;&#21019;&#24314;&#65292;&#30456;&#24403;&#20110;&#32473;&#20320;&#21019;&#24314;&#20102;&#22836;&#25991;&#20214;&#65288;h&#65289;&#21644;&#23454;&#29616;&#25991;&#20214;&#65288;cpp&#65289;&#65292;&#20197;&#21450;&#22312;idl&#25991;&#20214;&#20013;&#28155;&#21152;&#20102;&#20869;&#23481;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_22-45-10.png" alt="images/download/attachments/1015823/image2021-10-8_22-45-10.png" width="600"  />
    </p>
<p   
>&#28155;&#21152;&#25509;&#21475;&#65306;&#22312;&#36825;&#37324;&#21019;&#24314;&#23436;&#25104;&#20043;&#21518;&#22312;&#22836;&#25991;&#20214;&#20013;&#21152;&#20837;&#20102;&#25509;&#21475;&#30340;&#22768;&#26126;&#65292;&#22312;&#23450;&#20041;&#25991;&#20214;&#20013;&#28155;&#21152;&#20102;&#25509;&#21475;&#30340;&#23450;&#20041;&#65292;&#24182;&#19988;&#22312;idl&#25991;&#20214;&#20013;&#20063;&#28155;&#21152;&#20102;&#23545;&#24212;&#30340;&#25509;&#21475;&#20449;&#24687;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_22-47-11.png" alt="images/download/attachments/1015823/image2021-10-8_22-47-11.png" width="600"  />
    </p>
<p   
>&#22312;&#28155;&#21152;&#25509;&#21475;&#30340;&#26102;&#20505;&#21487;&#20197;&#36873;&#25321;&#25509;&#21475;&#30340;&#21442;&#25968;&#31867;&#22411;&#65292;&#26681;&#25454;&#36825;&#20010;&#25509;&#21475;&#30340;&#20316;&#29992;&#21435;&#36873;&#25321;&#12290;</p>
<p   
>&#33267;&#27492;&#25972;&#20010;&#27493;&#39588;&#20102;&#35299;&#20043;&#21518;&#23601;&#20250;&#20135;&#29983;&#30340;&#19968;&#20123;&#30097;&#38382;&#65306;</p>
<ol class=" "><li class=" "><p   
>ProgID&#26159;&#20160;&#20040;&#65306;<strong class=" ">ProgID&#31561;&#20215;&#20110;CLSID</strong></p>
</li><li class=" "><p   
>&#25214;&#19981;&#21040;COM&#31867;&#30340;AddRef&#12289;Release&#12289;QueryInterface&#20989;&#25968;&#30340;&#23454;&#29616;</p>
</li><li class=" "><p   
>&#25214;&#19981;&#21040;&#31867;&#21378;&#30340;&#23450;&#20041;&#21644;&#23454;&#29616;</p>
<ol class=" "><li class=" "><p   
>&#38382;&#39064;2&#12289;3&#22312;ATL&#20013;&#23454;&#38469;&#19978;&#26159;&#25442;&#20102;&#19968;&#20010;&#24418;&#24335;&#20986;&#29616;&#20102;&#65292;&#21487;&#20197;&#22312;&#22836;&#25991;&#20214;&#20013;&#25214;&#21040;&#65292;&#35265;&#22914;&#19979;&#22270;&#27880;&#37322;&#65306;</p>
</li><li class=" "><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_22-50-58.png" alt="images/download/attachments/1015823/image2021-10-8_22-50-58.png" width="600"  />
    </li></ol></li><li class=" "><p   
>&#27880;&#20876;&#34920;&#33050;&#26412;&#25991;&#20214;&#26377;&#20160;&#20040;&#20316;&#29992;&#65306;&#27880;&#20876;&#34920;&#33050;&#26412;&#25991;&#20214;&#23601;&#26159;&#36164;&#28304;&#25991;&#20214;&#20013;&#30340;rgs&#21518;&#32512;&#21517;&#25991;&#20214;&#65292;&#36825;&#37324;&#20854;&#23454;&#26159;&#35201;&#20889;&#20837;&#27880;&#20876;&#34920;&#37324;&#30340;&#20449;&#24687;&#65292;&#24403;&#35843;&#29992;&#27880;&#20876;&#20989;&#25968;&#30340;&#26102;&#20505;&#23601;&#20250;&#20351;&#29992;&#36825;&#37324;&#30340;&#20449;&#24687;&#20889;&#20837;&#21040;&#27880;&#20876;&#34920;&#20013;<br/></p>
<ol class=" "><li class=" "><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_22-54-49.png" alt="images/download/attachments/1015823/image2021-10-8_22-54-49.png" width="600"  />
    </li></ol></li><li class=" "><p   
>&#21518;&#32512;&#20026;idl&#30340;&#25991;&#20214;&#26159;&#20160;&#20040;&#25991;&#20214;&#65306;IDL&#20840;&#31216;Interface Description Language&#65292;&#20013;&#25991;&#20026;&#25509;&#21475;&#25551;&#36848;&#35821;&#35328;&#65307;IDL&#30340;&#20027;&#35201;&#20316;&#29992;&#26159;&#29992;&#26469;&#20197;&#19968;&#31181;&#19982;&#35821;&#35328;&#26080;&#20851;&#30340;&#26041;&#27861;&#26469;&#23450;&#20041;&#19968;&#20010;&#32452;&#20214;&#30340;&#25509;&#21475;&#65288;&#23427;&#30340;&#26041;&#27861;&#21644;&#21442;&#25968;&#65289;&#65292;&#20351;&#32452;&#20214;&#30340;&#25509;&#21475;&#25551;&#36848;&#22312;&#20219;&#20309;&#35821;&#35328;&#29615;&#22659;&#20013;&#37117;&#35748;&#35782;&#65307;IDL&#26159;&#19968;&#20010;&#25991;&#26412;&#25991;&#20214;&#65292;&#23427;&#30340;&#35821;&#35328;&#35821;&#27861;&#27604;&#36739;&#31616;&#21333;&#65292;&#24456;&#20687;C&#35821;&#35328;&#65307;&#22312;ATL&#20013;IDL&#25991;&#20214;&#30001;MIDL&#32534;&#35793;&#65292;&#32534;&#35793;&#21518;&#29983;&#25104;TLB&#25991;&#20214;&#65292;&#31867;&#22411;&#24211;&#20197;TLB&#25991;&#20214;&#24418;&#24335;&#21333;&#29420;&#23384;&#22312;&#65292;&#21516;&#26102;&#20063;&#20445;&#23384;&#22312;&#30446;&#26631;&#25991;&#20214;&#30340;&#36164;&#28304;&#20013;&#65292;&#22240;&#27492;&#25105;&#20204;&#22312;&#24341;&#20837;&#31867;&#22411;&#24211;&#30340;&#26102;&#20505;&#65292;&#21363;&#21487;&#20197;&#25351;&#23450;TLB&#25991;&#20214;&#65292;&#20063;&#21487;&#20197;&#25351;&#23450;&#30446;&#26631;&#25991;&#20214;&#12290;</p>
<ol class=" "><li class=" "><p   
>&#25105;&#20204;&#21487;&#20197;&#30475;&#19968;&#19979;&#36825;&#20010;idl&#25991;&#20214;&#65292;&#20854;&#20855;&#20307;&#21547;&#20041;&#21487;&#20197;&#35265;&#22914;&#19979;&#22270;&#27880;&#37322;&#65306;</p>
</li><li class=" "><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_23-5-27.png" alt="images/download/attachments/1015823/image2021-10-8_23-5-27.png" width="600"  />
    </li></ol></li><li class=" "><p   
>&#32452;&#20214;&#30340;CLSID&#22312;&#21738;&#37324;&#65306;&#22914;&#19978;&#22270;&#27880;&#37322;&#25152;&#31034;&#12290;</p>
</li></ol><p   
>&#26368;&#21518;&#20320;&#21482;&#38656;&#35201;&#32534;&#35793;&#19968;&#19979;&#65292;&#22312;&#39033;&#30446;Debug&#30446;&#24405;&#21487;&#20197;&#25214;&#21040;TLB&#25991;&#20214;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_23-35-51.png" alt="images/download/attachments/1015823/image2021-10-8_23-35-51.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LU1GQ-iwg-eUqENPTee7hOS7tg">
        <h2 class="heading "><span>MFC&#35843;&#29992;COM&#32452;&#20214;</span></h2>
<p   
>&#39318;&#20808;&#20320;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;MFC&#39033;&#30446;&#65292;&#36873;&#25321;&#22522;&#20110;&#23545;&#35805;&#26694;Dialog&#21019;&#24314;&#21363;&#21487;&#65292;&#32780;&#21518;&#23558;&#20854;&#20182;&#30340;&#25511;&#20214;&#21024;&#38500;&#30041;&#19968;&#20010;&#25353;&#38062;&#20415;&#20110;&#21518;&#32493;&#35843;&#29992;&#65292;&#25509;&#30528;&#20320;&#38656;&#35201;&#24341;&#20837;&#31867;&#22411;&#24211;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_23-45-27.png" alt="images/download/attachments/1015823/image2021-10-8_23-45-27.png" width="600"  />
    </p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#</code><code class="keyword">import</code><code class="plain"> </code><code class="string">"C:\\Users\\chen\\Documents\\Visual Studio 2013\\Projects\\DBTest\\DBTest\\Debug\\DBTest.tlb"</code><code class="plain"> no_namespace</code></div>
</div>
    </div>
<p   
>&#28982;&#21518;&#65292;&#20320;&#38656;&#35201;&#22312;&#22836;&#25991;&#20214;&#20013;&#23450;&#20041;&#22909;&#36825;&#20010;&#25509;&#21475;&#25351;&#38024;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_0-0-12.png" alt="images/download/attachments/1015823/image2021-10-9_0-0-12.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#22312;OnInitDialog&#21021;&#22987;&#21270;&#30340;&#26102;&#20505;&#21435;&#21021;&#22987;&#21270;COM&#65292;&#26681;&#25454;ProgId&#21019;&#24314;COM&#23545;&#35937;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HRESULT hRes;</code></div>
<div class="line"><code class="plain">CoInitialize(NULL);</code></div>
<div class="line"><code class="plain">hRes = m_pDB.CreateInstance(L</code><code class="string">"TESTDBConnect.Ado.1"</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">       ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#26368;&#21518;&#65292;&#25105;&#20204;&#22312;&#25353;&#38062;&#24038;&#38190;&#21333;&#20987;&#20107;&#20214;&#20013;&#21435;&#35843;&#29992;&#25509;&#21475;&#20989;&#25968;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_0-4-30.png" alt="images/download/attachments/1015823/image2021-10-9_0-4-30.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_0-4-49.png" alt="images/download/attachments/1015823/image2021-10-9_0-4-49.png" width="600"  />
    </p>
<p   
>&#22312;&#36825;&#37324;&#20043;&#25152;&#20197;&#33021;&#25104;&#21151;&#65292;&#26159;&#22240;&#20026;&#25105;&#20204;&#22312;&#32534;&#35793;ATL&#39033;&#30446;&#30340;&#26102;&#20505;&#23601;&#33258;&#21160;&#27880;&#20876;&#20102;&#36825;&#20010;COM&#32452;&#20214;&#65288;&#22914;&#26524;&#20320;&#32534;&#35793;&#39033;&#30446;&#22833;&#36133;&#65292;&#21487;&#20197;&#23581;&#35797;&#20351;&#29992;&#31649;&#29702;&#21592;&#26435;&#38480;&#25171;&#24320;VS&#65289;&#12290;</p>
    </div>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LeaLk-WxleaTjeS9nA">
        <h1 class="heading "><span>&#25299;&#23637;&#25805;&#20316;</span></h1>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWKoOWxnuaApw">
        <h2 class="heading "><span>&#21152;&#23646;&#24615;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2Lea3u-WKoOe7hOS7tuWxnuaApw">
        <h3 class="heading "><span>&#28155;&#21152;&#32452;&#20214;&#23646;&#24615;</span></h3>
<p   
>&#25105;&#20204;&#29616;&#22312;&#25152;&#27169;&#25311;&#30340;&#26159;&#19968;&#20010;DB&#30340;COM&#32452;&#20214;&#65292;&#32780;&#29616;&#22312;&#25105;&#20204;&#35201;&#28155;&#21152;&#19968;&#20010;DB&#36830;&#25509;&#30340;&#29366;&#24577;&#65292;&#36825;&#26102;&#20505;&#23601;&#38656;&#35201;&#36890;&#36807;ATL&#26469;&#28155;&#21152;&#23646;&#24615;&#20102;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#25805;&#20316;&#65292;&#24403;&#20320;&#28155;&#21152;&#19968;&#20010;&#23646;&#24615;&#20043;&#21518;&#22312;&#22836;&#25991;&#20214;&#20013;&#23601;&#20250;&#22810;&#20986;&#20004;&#20010;&#25104;&#21592;&#20989;&#25968;&#30340;&#22768;&#26126;&#20197;&#21450;&#22312;&#23454;&#29616;&#25991;&#20214;&#20013;&#22810;&#20986;&#23545;&#24212;&#30340;&#20195;&#30721;&#23454;&#29616;&#65292;&#26368;&#21518;&#22312;idl&#25991;&#20214;&#20013;&#20063;&#21487;&#20197;&#30475;&#35265;&#25509;&#21475;&#20989;&#25968;&#21015;&#34920;&#20063;&#22810;&#20986;&#20102;&#36825;&#20123;&#20869;&#23481;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_18-46-4.png" alt="images/download/attachments/1015823/image2021-10-9_18-46-4.png" width="600"  />
    </p>
<p   
>&#36890;&#36807;&#22810;&#20986;&#30340;&#20195;&#30721;&#25105;&#20204;&#21487;&#20197;&#30693;&#36947;&#65292;&#21407;&#26469;&#36825;&#37324;&#36890;&#36807;ATL&#28155;&#21152;&#30340;State&#23646;&#24615;&#38656;&#35201;&#20351;&#29992;get_State&#26469;&#33719;&#21462;&#20540;&#65292;&#20197;&#21450;&#36890;&#36807;put_State&#26469;&#20462;&#25913;&#20540;&#65292;&#20294;&#26159;&#36825;&#37324;&#30340;&#26368;&#20851;&#38190;&#30340;&#20540;&#25105;&#20204;&#21364;&#27809;&#26377;&#30475;&#35265;&#65292;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#36873;&#25321;&#22312;&#31867;&#20013;&#21435;&#22768;&#26126;&#19968;&#20010;&#25104;&#21592;&#21464;&#37327;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_18-50-16.png" alt="images/download/attachments/1015823/image2021-10-9_18-50-16.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#25105;&#20204;&#21435;&#23454;&#29616;&#36825;&#20004;&#20010;&#26041;&#27861;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">STDMETHODIMP CDBConnect::get_State(LONG* pVal)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// TODO:  在此添加实现代码</code></div>
<div class="line"><code class="plain">    *pVal = m_iState;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> S_OK;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">STDMETHODIMP CDBConnect::put_State(LONG newVal)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// TODO:  在此添加实现代码</code></div>
<div class="line"><code class="plain">    m_iState = newVal;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> S_OK;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25509;&#30528;&#35201;&#22312;&#23545;&#35937;&#21019;&#24314;&#30340;&#26102;&#20505;&#21435;&#21021;&#22987;&#21270;&#36825;&#20010;&#20540;&#65292;&#22312;ATL&#20013;&#21021;&#22987;&#21270;&#30340;&#35805;&#65292;&#20320;&#21487;&#20197;&#22312;&#22836;&#25991;&#20214;&#20013;&#25214;&#21040;<strong class=" ">FinalConstruct</strong>&#26041;&#27861;&#65292;&#24182;&#22312;&#35813;&#26041;&#27861;&#20307;&#20013;&#21435;&#21021;&#22987;&#21270;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_18-55-36.png" alt="images/download/attachments/1015823/image2021-10-9_18-55-36.png" width="600"  />
    </p>
<p   
><br/></p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWuouaIt-S9v-eUqOWxnuaApw">
        <h3 class="heading "><span>&#23458;&#25143;&#20351;&#29992;&#23646;&#24615;</span></h3>
<p   
>&#22312;&#23458;&#25143;&#20391;&#21435;&#20351;&#29992;&#36825;&#20123;&#23646;&#24615;&#21313;&#20998;&#31616;&#21333;&#65292;&#30452;&#25509;&#35775;&#38382;&#20854;&#23545;&#24212;&#30340;&#20989;&#25968;&#65292;&#25110;&#30452;&#25509;&#35775;&#38382;&#36825;&#20010;&#23646;&#24615;&#21363;&#21487;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_19-34-49.png" alt="images/download/attachments/1015823/image2021-10-9_19-34-49.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWkmuaOpeWPow">
        <h2 class="heading "><span>&#22810;&#25509;&#21475;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWunueOsOWkmuaOpeWPow">
        <h3 class="heading "><span>&#23454;&#29616;&#22810;&#25509;&#21475;</span></h3>
<p   
>&#25105;&#20204;&#20043;&#21069;&#20889;&#30340;COM&#32452;&#20214;&#65292;&#21482;&#26377;&#19968;&#20010;&#31867;&#24182;&#19988;&#21482;&#26377;&#19968;&#20010;&#25509;&#21475;&#65292;&#20294;&#26159;&#25105;&#20204;&#23436;&#20840;&#21487;&#20197;&#35753;&#19968;&#20010;COM&#31867;&#25552;&#20379;&#22810;&#20010;&#25509;&#21475;&#12290;</p>
<p   
>&#23454;&#29616;&#22810;&#25509;&#21475;&#38656;&#35201;&#25163;&#21160;&#21435;&#20570;&#19968;&#20123;&#25913;&#36896;&#65292;&#39318;&#20808;&#25105;&#20204;&#38656;&#35201;&#22312;idl&#25991;&#20214;&#20013;&#21152;&#20837;&#25509;&#21475;&#30456;&#20851;&#30340;&#20449;&#24687;&#65292;&#20363;&#22914;&#36825;&#37324;&#25105;&#21152;&#20837;&#19968;&#20010;&#26816;&#27979;&#30340;&#25509;&#21475;&#65292;&#24182;&#19988;&#25509;&#21475;&#20989;&#25968;&#21482;&#26377;&#19968;&#20010;&#26816;&#27979;&#21151;&#33021;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-24-31.png" alt="images/download/attachments/1015823/image2021-10-9_22-24-31.png" width="600"  />
    </p>
<p   
>&#19981;&#35201;&#24536;&#35760;&#22312;&#25509;&#21475;&#21015;&#34920;&#20013;&#20063;&#23558;&#25509;&#21475;&#28155;&#21152;&#19978;&#21435;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-38-50.png" alt="images/download/attachments/1015823/image2021-10-9_22-38-50.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#25105;&#20204;&#38656;&#35201;&#22312;DBConnect&#22836;&#25991;&#20214;&#20013;&#22768;&#26126;&#25509;&#21475;&#21644;&#25509;&#21475;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">class</code><code class="plain"> ATL_NO_VTABLE CDBConnect :</code></div>
<div class="line"><code class="plain">       </code><code class="keyword">public</code><code class="plain"> CComObjectRootEx&lt;CComSingleThreadModel&gt;, </code><code class="comments">// 这里实现了IUnknow的三个函数</code></div>
<div class="line"><code class="plain">       </code><code class="keyword">public</code><code class="plain"> CComCoClass&lt;CDBConnect, &amp;CLSID_DBConnect&gt;, </code><code class="comments">// 这里生成了类工厂</code></div>
<div class="line"><code class="plain">       </code><code class="keyword">public</code><code class="plain"> IDBConnect,</code></div>
<div class="line"><code class="plain">       </code><code class="keyword">public</code><code class="plain"> IDBConnectChk</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">BEGIN_COM_MAP(CDBConnect)</code></div>
<div class="line"><code class="plain">       COM_INTERFACE_ENTRY(IDBConnect)</code></div>
<div class="line"><code class="plain">       COM_INTERFACE_ENTRY(IDBConnectChk)</code></div>
<div class="line"><code class="plain">END_COM_MAP()</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">public</code><code class="plain">:</code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">       STDMETHOD(CheckSQL)(BSTR sql);</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
<p   
>&#28982;&#21518;&#36824;&#35201;&#21435;&#23454;&#29616;&#36825;&#20010;&#25509;&#21475;&#20989;&#25968;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">STDMETHODIMP CDBConnect::CheckSQL(BSTR sql)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// TODO:  在此添加实现代码</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"CheckSQL"</code><code class="plain">), _T(</code><code class="string">"Alert"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> S_OK;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22914;&#26524;&#20320;&#24819;&#35753;&#33258;&#24049;&#30340;&#24037;&#31243;&#30475;&#36215;&#26469;&#35268;&#33539;&#21270;&#65292;&#21487;&#20197;&#26367;&#25442;&#19968;&#19979;ProgID&#12289;Version&#65292;&#24403;&#21069;&#26159;1.0&#29256;&#26412;&#65292;&#21487;&#20197;&#21464;&#25104;2.0&#29256;&#26412;&#65292;ProgID&#30340;&#26368;&#21518;&#37027;&#20010;&ldquo;.1&rdquo;&#23601;&#34920;&#31034;&#29256;&#26412;&#21495;&#20063;&#21487;&#20197;&#26367;&#25442;&#19968;&#19979;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-36-26.png" alt="images/download/attachments/1015823/image2021-10-9_22-36-26.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-38-4.png" alt="images/download/attachments/1015823/image2021-10-9_22-38-4.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWuouaIt-S9v-eUqOWkmuaOpeWPow">
        <h3 class="heading "><span>&#23458;&#25143;&#20351;&#29992;&#22810;&#25509;&#21475;</span></h3>
<p   
>&#22312;&#23458;&#25143;&#20391;&#21435;&#20351;&#29992;&#22810;&#25509;&#21475;&#20063;&#24456;&#31616;&#21333;&#65292;&#39318;&#20808;&#24341;&#20837;&#31867;&#22411;&#25991;&#20214;&#65292;&#20854;&#27425;&#23450;&#20041;&#25509;&#21475;&#25351;&#38024;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-48-20.png" alt="images/download/attachments/1015823/image2021-10-9_22-48-20.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#20320;&#38656;&#35201;&#22312;OnInitDialog&#20989;&#25968;&#20869;&#21435;&#20999;&#25442;&#25509;&#21475;&#65292;&#36825;&#38656;&#35201;&#20351;&#29992;&#21040;QueryInterface&#26041;&#27861;&#65292;&#20320;&#38656;&#35201;&#20256;&#36882;&#20004;&#20010;&#21442;&#25968;&#65292;&#19968;&#20010;&#26159;&#25509;&#21475;&#30340;IID&#65292;&#19968;&#20010;&#26159;&#25509;&#21475;&#25351;&#38024;&#30340;&#22320;&#22336;&#65307;&#25509;&#21475;&#30340;IID&#21487;&#20197;&#36890;&#36807;COM&#32452;&#20214;&#39033;&#30446;&#30340;<strong class=" ">&ldquo;xxx_i.c&rdquo;</strong>&#25991;&#20214;&#25214;&#21040;&#65292;&#36825;&#26159;idl&#29983;&#25104;&#30340;&#65292;&#25152;&#20197;&#38656;&#35201;&#20320;&#32534;&#35793;&#20043;&#21518;&#25165;&#26377;&#20869;&#23481;&#65292;&#25509;&#30528;<strong class=" ">&#23558;MIDL_DEFINE_GUID&#30340;&#23439;&#23450;&#20041;&#20197;&#21450;&#23545;&#24212;&#25509;&#21475;&#30340;&#23439;&#35843;&#29992;&#22797;&#21046;&#36807;&#26469;</strong>&#65292;IID_IDBConnectChk&#23601;&#26159;&#26368;&#32456;&#30340;&#25509;&#21475;&#23545;&#24212;&#30340;IID&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-51-4.png" alt="images/download/attachments/1015823/image2021-10-9_22-51-4.png" width="600"  />
    </p>
<p   
>&#20877;&#25509;&#30528;&#25105;&#20204;&#23545;&#24212;&#22635;&#20805;&#21442;&#25968;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">hRes = m_pDB.QueryInterface(IID_IDBConnectChk, &amp;m_pDBChk);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-54-12.png" alt="images/download/attachments/1015823/image2021-10-9_22-54-12.png" width="600"  />
    </p>
<p   
>&#26368;&#21518;&#25105;&#20204;&#21482;&#38656;&#35201;&#35843;&#29992;&#25509;&#21475;&#20989;&#25968;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">void</code><code class="plain"> CDB_ClientDlg::OnBnClickedButton1()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// TODO:  在此添加控件通知处理程序代码</code></div>
<div class="line"><code class="plain">    m_pDBChk-&gt;CheckSQL(L</code><code class="string">""</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_22-56-15.png" alt="images/download/attachments/1015823/image2021-10-9_22-56-15.png" width="600"  />
    </p>
<p   
>&#26368;&#21518;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;idl&#29983;&#25104;&#30340;&#20004;&#20010;&#25991;&#20214;<strong class=" ">&#21487;&#20197;&#30452;&#25509;&#34987;&#24341;&#29992;</strong>&#65292;&#36825;&#26679;&#20320;&#23601;&#21487;&#20197;<strong class=" ">&#19981;&#29992;&#21435;&#24341;&#20837;&#31867;&#22411;&#24211;&#25991;&#20214;</strong>&#65288;tlb&#25991;&#20214;&#65289;&#20102;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-1-38.png" alt="images/download/attachments/1015823/image2021-10-9_23-1-38.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWkmkNPTeexuw">
        <h2 class="heading "><span>&#22810;COM&#31867;</span></h2>
<p   
>&#26082;&#28982;COM&#21487;&#20197;&#22810;&#25509;&#21475;&#65292;&#37027;&#20063;&#21516;&#26679;&#21487;&#20197;&#22810;&#20010;COM&#31867;&#65292;&#36825;&#20010;&#30340;&#25805;&#20316;&#27493;&#39588;&#22312;ATL&#20013;&#37117;&#24050;&#32463;&#20102;&#35299;&#36807;&#20102;&#65292;&#19981;&#36807;&#22810;&#36184;&#36848;&#12290;<br/><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-8_22-45-10.png" alt="images/download/attachments/1015823/image2021-10-8_22-45-10.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LeiHquWKqOWMlg">
        <h1 class="heading "><span>&#33258;&#21160;&#21270;</span></h1>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeeugOS7iy4x">
        <h2 class="heading "><span>&#31616;&#20171;</span></h2>
<p   
>&#32534;&#35793;&#22411;&#35821;&#35328;&#22312;&#32534;&#35793;&#20043;&#21069;&#24341;&#20837;&#31867;&#22411;&#24211;(tlb&#25991;&#20214;)&#65292;&#32534;&#35793;&#22120;&#32534;&#35793;&#30340;&#26102;&#20505;&#23601;&#30693;&#36947;&#22914;&#20309;&#32534;&#35793;&#25509;&#21475;&#20989;&#25968;&#30340;&#35843;&#29992;&#20102;&#65292;&#36825;&#31181;&#26041;&#24335;&#25105;&#20204;&#31216;&#20026;&#21069;&#32465;&#23450;&#65307;&#32780;&#33050;&#26412;&#35821;&#35328;&#26159;&#35299;&#37322;&#25191;&#34892;&#30340;&#65292;&#23427;&#25191;&#34892;&#30340;&#26102;&#20505;&#19981;&#20250;&#30693;&#36947;&#20855;&#20307;&#30340;&#20989;&#25968;&#22320;&#22336;&#65292;&#33258;&#21160;&#21270;&#20026;&#27492;&#35806;&#29983;&#20102;&#21518;&#32465;&#23450;&#65307;<strong class=" ">&#33258;&#21160;&#21270;&#32452;&#20214;&#20854;&#23454;&#23601;&#26159;&#23454;&#29616;&#20102;IDispatch&#65288;&#33258;&#21160;&#21270;&#65289;&#25509;&#21475;&#30340;&#32452;&#20214;</strong>&#65307;&#35299;&#37322;&#24615;&#35821;&#35328;&#36319;&#23439;&#35821;&#35328;&#65292;&#35201;&#35843;&#29992;COM&#32452;&#20214;&#30340;&#33258;&#23450;&#20041;&#25509;&#21475;&#26102;&#65292;&#37117;&#26159;&#36890;&#36807;&#33258;&#21160;&#21270;&#25511;&#21046;&#31243;&#24207;&#25226;&#33258;&#23450;&#20041;&#25509;&#21475;&#20013;&#30340;&#20989;&#25968;&#21517;&#31216;&#30340;&#23383;&#31526;&#20018;&#36319;&#20989;&#25968;&#21442;&#25968;&#20256;&#36882;&#32473;IDispatch&#65292;&#35753;IDispatch&#38388;&#25509;&#22320;&#21435;&#25191;&#34892;&#33258;&#23450;&#20041;&#25509;&#21475;&#20013;&#30340;&#20989;&#25968;&#65307;&#25152;&#20197;&#26412;&#33410;&#35838;&#25152;&#38656;&#35201;&#23398;&#20064;&#30340;&#23601;&#26159;<strong class=" ">IDispatch&#65288;&#33258;&#21160;&#21270;&#65289;&#25509;&#21475;</strong>&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUlEaXNwYXRjaO-8iOiHquWKqOWMlu-8ieaOpeWPow">
        <h2 class="heading "><span>IDispatch&#65288;&#33258;&#21160;&#21270;&#65289;&#25509;&#21475;</span></h2>
<p   
>IDispatch&#25509;&#21475;&#35201;&#23454;&#29616;&#22235;&#20010;&#20989;&#25968;&#65306;</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#20989;&#25968;&#21517;</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#20316;&#29992;</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>HRESULT GetTypeInfoCount()</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#33719;&#21462;&#32452;&#20214;&#20013;&#25552;&#20379;&#20960;&#20010;&#31867;&#22411;&#24211;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>HRESULT GetTypeInfo()</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#35843;&#29992;&#32773;&#36890;&#36807;&#35813;&#20989;&#25968;&#21462;&#24471;&#20182;&#24819;&#35201;&#30340;&#31867;&#22411;&#24211;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>HRESULT GetIDsOfNames()</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#26681;&#25454;&#20989;&#25968;&#21517;&#31216;&#21462;&#24471;&#20989;&#25968;&#24207;&#21495;&#65292;&#20026;&#35843;&#29992; Invoke() &#20570;&#20934;&#22791;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>HRESULT Invoke()</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#26681;&#25454;&#24207;&#21495;&#65292;&#25191;&#34892;&#20989;&#25968;</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-11-25.png" alt="images/download/attachments/1015823/image2021-10-9_23-11-25.png" width="600"  />
    </p>
<p   
>&#22914;&#19978;&#22270;&#25152;&#31034;&#21463;&#38480;&#25105;&#20204;&#38656;&#35201;&#20351;&#29992;IDispatch&#25509;&#21475;&#30340;GetIDsOfNames&#20989;&#25968;&#21435;&#33719;&#21462;&#20989;&#25968;&#24207;&#21495;&#65292;&#25509;&#30528;&#20877;&#20351;&#29992;Invoke&#20989;&#25968;&#26681;&#25454;&#24207;&#21495;&#33719;&#21462;&#20989;&#25968;&#30340;&#22320;&#22336;&#28982;&#21518;&#25191;&#34892;&#65292;&#36825;&#26679;&#19979;&#26469;&#25191;&#34892;&#25928;&#29575;&#26159;&#27604;&#36739;&#20302;&#30340;&#65292;&#25152;&#20197;ATL&#20174;&#25928;&#29575;&#20986;&#21457;&#65292;&#23454;&#29616;&#20102;&#19968;&#31181;&#21483;<strong class=" ">&#21452;&#25509;&#21475;(dual)</strong>&#30340;&#25509;&#21475;&#27169;&#24335;&#65292;&#25105;&#20204;&#26469;&#20102;&#35299;&#19968;&#19979;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeWPjOaOpeWPow">
        <h2 class="heading "><span>&#21452;&#25509;&#21475;</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeekuuaEj-Wbvg">
        <h3 class="heading "><span>&#31034;&#24847;&#22270;</span></h3>
<p   
>&#22914;&#19979;&#26159;&#21452;&#25509;&#21475;&#31034;&#24847;&#22270;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#20182;&#26377;&#19977;&#20010;&#37096;&#20998;&#65292;&#20998;&#21035;&#26159;IUnknow&#12289;IDispatch&#12289;&#33258;&#23450;&#20041;&#25509;&#21475;&#65292;&#25152;&#35859;&#21452;&#25509;&#21475;&#65292;&#20854;&#23454;&#26159;&#22312;&#19968;&#20010;VTAB&#30340;&#34394;&#20989;&#25968;&#34920;&#20013;&#23481;&#32435;&#20102;&#19977;&#20010;&#25509;&#21475;&#65292;&#22240;&#20026;&#20219;&#20309;&#25509;&#21475;&#37117;&#26159;&#20174;IUnknown&#27966;&#29983;&#30340;&#65292;&#25152;&#20197;&#23601;&#19981;&#24378;&#35843;IUnknown&#20102;&#65292;&#23601;&#31216;&#20043;&#20026;&#21452;&#25509;&#21475;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-13-7.png" alt="images/download/attachments/1015823/image2021-10-9_23-13-7.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeWcuuaZr-S4juS8mOeCuQ">
        <h3 class="heading "><span>&#22330;&#26223;&#19982;&#20248;&#28857;</span></h3>
<p   
>&#22914;&#19979;&#34920;&#25152;&#31034;&#26159;&#22312;&#19981;&#21516;&#22330;&#26223;&#19979;&#20351;&#29992;&#21452;&#25509;&#21475;&#12289;&#21407;&#22240;&#19982;&#20351;&#29992;&#32467;&#26524;&#65306;</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#20351;&#29992;&#26041;&#24335;</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#21407;&#22240;</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>&#32467;&#26524;</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#33050;&#26412;&#35821;&#35328;&#20351;&#29992;&#32452;&#20214;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#35299;&#37322;&#22120;&#21482;&#35748;&#35782;IDispatch&#25509;&#21475;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#21487;&#20197;&#35843;&#29992;&#65292;&#20294;&#25191;&#34892;&#25928;&#29575;&#26368;&#20302;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#32534;&#35793;&#22411;&#35821;&#35328;&#20351;&#29992;&#32452;&#20214;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#23427;&#35748;&#35782;IDispatch&#25509;&#21475;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#21487;&#20197;&#35843;&#29992;&#65292;&#25191;&#34892;&#25928;&#29575;&#27604;&#36739;&#20302;</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#32534;&#35793;&#22411;&#35821;&#35328;&#20351;&#29992;&#32452;&#20214;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#23427;&#35013;&#36733;&#31867;&#22411;&#24211;&#23601;&#35748;&#35782;&#20102;Ixxx&#25509;&#21475;</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>&#21487;&#20197;&#30452;&#25509;&#35843;&#29992;Ixxx&#20989;&#25968;&#65292;&#25928;&#29575;&#26368;&#39640;</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
>&#26368;&#32456;&#25105;&#20204;&#24471;&#21040;&#19968;&#20010;&#32467;&#35770;&#65292;&#37027;&#23601;&#26159;&#21452;&#25509;&#21475;&#21363;&#28385;&#36275;&#33050;&#26412;&#35821;&#35328;&#30340;&#20351;&#29992;&#26041;&#20415;&#65292;&#21448;&#28385;&#36275;&#32534;&#35793;&#35821;&#35328;&#30340;&#20351;&#29992;&#39640;&#25928;&#24615;&#65292;&#36825;&#23601;&#26159;&#23427;&#30340;&#20248;&#28857;&#12290;</p>
<p   
><strong class=" ">&#27880;&#65306;</strong>&#22914;&#26524;&#19981;&#38656;&#35201;&#25903;&#25345;&#33050;&#26412;&#35821;&#35328;&#26368;&#22909;&#19981;&#35201;&#29992;&#21452;&#25509;&#21475;&#65292;&#22240;&#20026;&#21452;&#25509;&#21475;&#12289;IDispatch&#25509;&#21475;&#21482;&#25903;&#25345;&#33258;&#21160;&#21270;&#30340;&#21442;&#25968;&#31867;&#22411;&#65292;&#20351;&#29992;&#21463;&#21040;&#38480;&#21046;&#65292;&#26576;&#20123;&#24773;&#20917;&#19979;&#24456;&#19981;&#26041;&#20415;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LeS9v-eUqOiHquWKqOWMlue7hOS7tg">
        <h2 class="heading "><span>&#20351;&#29992;&#33258;&#21160;&#21270;&#32452;&#20214;</span></h2>
<p   
>&#20351;&#29992;&#33258;&#21160;&#21270;&#32452;&#20214;&#24182;&#19981;&#38590;&#65292;&#36319;&#20043;&#21069;&#19968;&#26679;&#21019;&#24314;ATL&#39033;&#30446;&#20197;&#21450;&#31616;&#21333;&#23545;&#35937;&#65292;&#21482;&#19981;&#36807;&#22312;&#21019;&#24314;&#23545;&#35937;&#30340;&#26102;&#20505;&#38656;&#35201;&#36873;&#25321;&#25509;&#21475;&#31867;&#22411;&#20026;&#21452;&#37325;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-37-7.png" alt="images/download/attachments/1015823/image2021-10-9_23-37-7.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#28155;&#21152;&#26041;&#27861;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-39-50.png" alt="images/download/attachments/1015823/image2021-10-9_23-39-50.png" width="600"  />
    </p>
<p   
>&#24403;&#20320;&#28155;&#21152;&#30340;&#26102;&#20505;&#20320;&#23601;&#20250;&#21457;&#21457;&#22411;&#65292;&#36825;&#20010;&#26041;&#27861;&#21517;&#20250;&#33258;&#21160;&#36171;&#20104;ID&#65292;&#36825;&#20010;&#20320;&#21487;&#20197;&#33258;&#23450;&#20041;&#65292;&#20063;&#21487;&#20197;&#19981;&#29992;&#31649;&#23427;&#12290;</p>
<p   
>&#23454;&#29616;&#22909;&#25509;&#21475;&#20989;&#25968;&#20043;&#21518;&#20320;&#21482;&#38656;&#35201;&#32534;&#35793;&#21363;&#21487;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-41-43.png" alt="images/download/attachments/1015823/image2021-10-9_23-41-43.png" width="600"  />
    </p>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LUphdmFTY3JpcHTosIPnlKg">
        <h3 class="heading "><span>JavaScript&#35843;&#29992;</span></h3>
<p   
>&#25509;&#30528;&#25105;&#20204;&#24819;&#35201;&#22312;JavaScript&#20013;&#21435;&#35843;&#29992;&#36825;&#20010;COM&#32452;&#20214;&#65292;&#32534;&#20889;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">&lt;script type=</code><code class="string">"text/javascript"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    var myCom = </code><code class="keyword">new</code><code class="plain"> ActiveXObject(</code><code class="string">"DualDBConnect.Ado.1"</code><code class="plain">); </code><code class="comments">// ProgID</code></div>
<div class="line"><code class="plain">    function OpenTest() {</code></div>
<div class="line"><code class="plain">        myCom.Open();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">&lt;/script&gt;</code></div>
<div class="line"><code class="plain">&lt;input type=</code><code class="string">"button"</code><code class="plain"> value=</code><code class="string">"Open"</code><code class="plain"> onclick=</code><code class="string">"OpenTest()"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p   
>&#25509;&#30528;&#22312;IE&#27983;&#35272;&#22120;&#20013;&#25171;&#24320;&#36825;&#20010;HTML&#39029;&#38754;&#65292;&#24182;&#20801;&#35768;&#38459;&#27490;&#30340;&#20869;&#23481;&#65292;&#21333;&#20987;&#21363;&#21487;&#35843;&#29992;&#25509;&#21475;&#20989;&#25968;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-47-8.png" alt="images/download/attachments/1015823/image2021-10-9_23-47-8.png" width="600"  />
    </p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-9_23-46-20.png" alt="images/download/attachments/1015823/image2021-10-9_23-46-20.png" width="600"  />
    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-1015823_safe-id-Q09N57uE5Lu2LeaZuuiDveexu-Weiw">
        <h1 class="heading "><span>&#26234;&#33021;&#31867;&#22411;</span></h1>
<p   
>&#20043;&#21069;&#25105;&#20204;&#25152;&#20102;&#35299;&#36807;VARIANT&#31867;&#22411;&#65292;&#35813;&#31867;&#22411;&#30340;&#20248;&#28857;&#25105;&#20204;&#37117;&#30693;&#36947;&#26159;&#20854;<strong class=" ">&#21487;&#20197;&#20860;&#23481;&#25152;&#26377;&#30340;&#25968;&#25454;&#31867;&#22411;</strong>&#65292;&#20294;&#21516;&#26102;&#65292;&#25105;&#20204;&#20102;&#35299;VARIANT&#31867;&#22411;&#21021;&#22987;&#21270;&#36171;&#20540;&#21313;&#20998;&#32321;&#29712;&#12290;</p>
<p   
>&#20026;&#20102;&#20351;&#29992;VARIANT&#31867;&#22411;&#26356;&#21152;&#26041;&#20415;&#65292;ATL&#23545;VARIANT&#25968;&#25454;&#31867;&#22411;&#20570;&#20102;&#23553;&#35013;&#65292;&#23553;&#35013;&#20102;&#19968;&#20010;CComVariant&#31867;&#22411;&#65292;&#23427;&#20869;&#37096;&#32500;&#25252;&#20102;&#19968;&#20010;VARIANT&#30340;&#25968;&#25454;&#32467;&#26500;&#65292;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#24456;&#26041;&#20415;&#30340;&#22312;&#22823;&#22810;&#23569;&#24773;&#20917;&#19979;<strong class=" ">&#29992;CComVariant&#26469;&#26367;&#20195;VARIANT</strong>&#12290;</p>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNDb21WYXJpYW50">
        <h2 class="heading "><span>CComVariant</span></h2>
<p   
>CComVariant&#30340;&#25968;&#25454;&#32467;&#26500;&#23450;&#20041;&#21487;&#20197;&#33258;&#34892;&#21435;&#26597;&#30475;&#65292;&#30001;&#20110;&#20195;&#30721;&#36807;&#38271;&#36825;&#37324;&#19981;&#36807;&#22810;&#23637;&#31034;&#65292;&#20174;&#23450;&#20041;&#20013;&#25105;&#20204;&#21487;&#20197;&#30475;&#20986;&#65292;&#20854;&#25552;&#20379;&#20102;&#20960;&#20046;&#25152;&#26377;&#25968;&#25454;&#31867;&#22411;&#30340;&#26500;&#36896;&#65292;&#36825;&#23601;&#24847;&#21619;&#30528;&#25105;&#20204;&#21021;&#22987;&#21270;CComVaiant&#23545;&#35937;&#26102;&#21487;&#20197;&#31616;&#21333;&#30340;&#37319;&#29992;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">CComVaiant comVar(</code><code class="string">"ABC"</code><code class="plain">);</code></div>
</div>
    </div>
<p   
>&#24182;&#20854;&#25552;&#20379;&#20102;&#25152;&#26377;&#31867;&#22411;&#36171;&#20540;&#36816;&#31639;&#31526;&#30340;&#37325;&#36733;&#65292;&#21487;&#20197;&#37319;&#29992;&#19979;&#38754;&#26041;&#24335;&#30452;&#25509;&#36171;&#20540;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">comVar = </code><code class="string">"XYZ"</code><code class="plain">;</code></div>
</div>
    </div>
<p   
>&#30001;&#20110;&#23427;&#20869;&#37096;&#32500;&#25252;&#20102;&#19968;&#20010;VARIANT&#30340;&#25968;&#25454;&#32467;&#26500;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#20351;&#29992;VARIANT&#31867;&#22411;&#30340;&#26041;&#24335;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">CComVaiant comVar(</code><code class="value">123</code><code class="plain">, VT_I4);</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>&#20854;&#20182;&#30340;&#20351;&#29992;&#26041;&#27861;&#37117;&#22914;&#20986;&#19968;&#36761;&#65292;&#21516;&#26679;&#65292;&#20063;&#19981;&#36807;&#22810;&#36184;&#36848;&#20102;&#12290;</p>
    </div>
    <div class="section section-2" id="src-1015823_safe-id-Q09N57uE5Lu2LUNDb21QdHLjgIFDQ29tUUlQdHI">
        <h2 class="heading "><span>CComPtr&#12289;CComQIPtr</span></h2>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeeugOS7iy4y">
        <h3 class="heading "><span>&#31616;&#20171;</span></h3>
<p   
>C++&#22312;&#35843;&#29992;COM&#25509;&#21475;&#25351;&#38024;&#26102;&#26159;&#24456;&#21361;&#38505;&#30340;&#65292;&#22240;&#20026;&#20351;&#29992;&#36807;&#31243;&#38656;&#35201;&#27599;&#19968;&#20010;&#20351;&#29992;&#37117;&#20005;&#26684;&#24182;&#19988;&#27491;&#30830;&#22320;&#35843;&#29992;AddRef&#19982;Release&#26041;&#27861;&#12290;&#19968;&#26086;&#20986;&#29616;&#38382;&#39064;&#65292;&#23601;&#20250;&#36896;&#25104;&#23545;&#35937;&#19981;&#33021;&#34987;&#27491;&#24120;&#37322;&#25918;&#25110;&#32773;&#23545;&#35937;&#34987;&#37325;&#22797;&#21024;&#38500;&#12290;</p>
<p   
>CComPtr&#12289;CComQIPtr&#26159;ATL&#20026;&#20102;&#35299;&#20915;COM&#24341;&#29992;&#35745;&#25968;&#38382;&#39064;&#25552;&#20379;&#30340;&#19968;&#20010;&#31867;&#27169;&#29256;&#65292;&#22240;&#20026;&#23427;&#30340;&#20351;&#29992;&#21644;&#34892;&#20026;&#19978;&#31867;&#20284;&#19982;&#19968;&#20010;&#25509;&#21475;&#25351;&#38024;&#65292;&#25152;&#20197;&#26377;&#19968;&#20010;&#36890;&#20439;&#26131;&#25026;&#30340;&#21517;&#23383;&#65306;&#26234;&#33021;&#25351;&#38024;&#12290;</p>
<p   
>&#36825;&#20004;&#20010;&#27169;&#29256;&#31867;&#37117;&#32487;&#25215;&#33258;CComPtrBase&#65292;&#19981;&#21516;&#20043;&#22788;&#22312;&#20110;CComQIPtr&#33021;&#22312;&#24517;&#35201;&#30340;&#26102;&#20505;&#33258;&#21160;&#30340;&#23545;&#25152;&#38656;&#25509;&#21475;&#36827;&#34892;&#26597;&#35810;&#65288;&#22914;&#65306;&#23545;&#19982;&#27492;&#26234;&#33021;&#25351;&#38024;&#21442;&#25968;&#21270;&#31867;&#22411;&#19981;&#21516;&#30340;&#25351;&#38024;&#36171;&#20540;&#26102;&#65292;&#20250;&#33258;&#21160;&#26597;&#35810;&#26159;&#21542;&#26377;&#25152;&#38656;&#30340;&#25509;&#21475;&#65289;&#12290;</p>
<p   
><strong class=" ">CComPtrBase&#31867;&#23553;&#35013;&#20102;CComPtr&#21644;CComQIPtr&#20013;&#20844;&#20849;&#30340;&#22823;&#22810;&#25968;&#20989;&#25968;</strong>&#65292;&#20174;&#32780;&#23454;&#29616;&#20195;&#30721;&#30340;&#22797;&#29992;&#12290;</p>
    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeavlOi-gw">
        <h3 class="heading "><span>&#27604;&#36739;</span></h3>
<p   
>&#26234;&#33021;&#25351;&#38024;&#19982;&#25509;&#21475;&#25351;&#38024;&#30340;&#27604;&#36739;&#22914;&#19979;&#65306;</p>
<ol class=" "><li class=" "><p   
><strong class=" ">CComPtr&lt;IDBConnect&gt; spDBConn;</strong>&#21019;&#24314;&#20102;&#19968;&#20010;&#26234;&#33021;&#25351;&#38024;&#65292;&#20854;&#23454;&#23427;&#26159;&#19968;&#20010;&#31867;&#23545;&#35937;&#65292;&#23545;&#35937;&#20869;&#37096;&#26377;&#19968;&#20010;IDBConnect*&#30340;&#25351;&#38024;&#21464;&#37327;&#65292;&#32780;IDBConnect* pDBConn&#23601;&#26159;&#19968;&#20010;&#25351;&#38024;&#65307;</p>
</li><li class=" "><p   
>&#20108;&#32773;&#25805;&#20316;&#30340;&#29992;&#27861;&#21644;&#24847;&#20041;&#19968;&#26679;&#65307;</p>
</li><li class=" "><p   
>&#26234;&#33021;&#25351;&#38024;&#19981;&#33021;&#25191;&#34892;AddRef&#19982;Release&#25805;&#20316;&#65292;&#22240;&#20026;&#26234;&#33021;&#25351;&#38024;&#23553;&#35013;&#20102;COM&#25509;&#21475;&#25351;&#38024;&#30340;AddRef&#19982;Release&#25805;&#20316;&#65292;&#20250;&#26234;&#33021;&#21028;&#26029;&#20309;&#26102;&#20869;&#37096;&#35843;&#29992;COM&#25509;&#21475;&#30340;AddRef&#65292;&#20309;&#26102;&#35843;&#29992;COM&#25509;&#21475;&#30340;Release&#12290;</p>
</li></ol>    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeazqOaEjw">
        <h3 class="heading "><span>&#27880;&#24847;</span></h3>
<p   
>&#26234;&#33021;&#25351;&#38024;&#20351;&#29992;&#30340;&#27880;&#24847;&#28857;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#26234;&#33021;&#25351;&#38024;&#24050;&#32463;&#20445;&#35777;&#20102;AddRef&#21644;Release&#30340;&#27491;&#30830;&#35843;&#29992;&#65292;&#25152;&#20197;&#19981;&#38656;&#35201;&#65292;&#20063;&#19981;&#33021;&#22815;&#20877;&#35843;&#29992;AddRef&#21644;Release&#65307;</p>
</li><li class=" "><p   
>&#22914;&#26524;&#35201;&#37322;&#25918;&#19968;&#20010;&#26234;&#33021;&#25351;&#38024;&#65292;&#30452;&#25509;&#32473;&#23427;&#36171;NULL,&#36825;&#26679;&#20869;&#37096;&#25165;COM&#25509;&#21475;&#25351;&#38024;&#20250;&#33258;&#21160;&#25191;&#34892;Release&#25805;&#20316;&#65292;&#26469;&#20943;&#23569;&#24212;&#29992;&#35745;&#25968;&#65307;</p>
</li><li class=" "><p   
>&#24403;&#23545;&#26234;&#33021;&#25351;&#38024;&#21462;&#22320;&#22336;&#26102;(&amp;&#36816;&#31639;&#31526;&#25805;&#20316;)&#65292;&#35201;&#30830;&#20445;&#26234;&#33021;&#25351;&#38024;&#20026;NULL&#65292;&#22240;&#20026;&amp;&#26159;&#35201;&#36820;&#22238;&#20869;&#37096;&#30340;COM&#25509;&#21475;&#25351;&#38024;&#30340;&#65292;&#22914;&#26524;&#19981;&#20026;NULL&#65292;&#21017;&#26087;&#30340;COM&#25509;&#21475;&#25351;&#38024;&#23558;&#27809;&#26377;&#25191;&#34892;Release&#32780;&#30452;&#25509;&#36171;&#20540;&#20102;&#19968;&#20010;&#26087;&#30340;COM&#25509;&#21475;&#25351;&#38024;&#12290;</p>
</li></ol>    </div>
    <div class="section section-3" id="src-1015823_safe-id-Q09N57uE5Lu2LeS9v-eUqA">
        <h3 class="heading "><span>&#20351;&#29992;</span></h3>
<p   
>&#22312;&#20351;&#29992;&#21482;&#33021;&#26234;&#33021;&#25351;&#38024;&#38656;&#35201;&#21253;&#21547;&#19968;&#20010;&#22836;&#25991;&#20214;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;atlbase.h&gt;</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-10_0-21-23.png" alt="images/download/attachments/1015823/image2021-10-10_0-21-23.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#35843;&#29992;&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HRESULT hRes;</code></div>
<div class="line"><code class="plain">CComPtr&lt;IUnknown&gt; spUnk;</code></div>
<div class="line"><code class="plain">CComPtr&lt;IDualDBConnect&gt; spDBConn;</code></div>
<div class="line"><code class="plain">hRes = spUnk.CoCreateInstance(L</code><code class="string">"DualDBConnect.Ado.1"</code><code class="plain">); </code><code class="comments">// 创建IUnknown</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">hRes = spUnk-&gt;QueryInterface(&amp;spDBConn); </code><code class="comments">// 寻找IDualDBConnect</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">spDBConn-&gt;Open(); </code><code class="comments">// 调用</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/1015823/image2021-10-10_0-27-15.png" alt="images/download/attachments/1015823/image2021-10-10_0-27-15.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#20063;&#21487;&#20197;&#20351;&#29992;CComQIPtr&#65292;&#36825;&#20010;&#26234;&#33021;&#25351;&#38024;&#21487;&#20197;&#30452;&#25509;&#36171;&#20540;&#32780;&#19981;&#38656;&#35201;&#20351;&#29992;QueryInterface&#26041;&#27861;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HRESULT hRes;</code></div>
<div class="line"><code class="plain">CComPtr&lt;IUnknown&gt; spUnk;</code></div>
<div class="line"><code class="plain">CComQIPtr&lt;IDualDBConnect&gt; spDBConn;</code></div>
<div class="line"><code class="plain">hRes = spUnk.CoCreateInstance(L</code><code class="string">"DualDBConnect.Ado.1"</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">spDBConn = spUnk;</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (!spDBConn)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">spDBConn-&gt;Open();</code></div>
</div>
    </div>
<p   
>&#38656;&#35201;&#27880;&#24847;CComQIPtr&#19981;&#33021;&#23450;&#20041;IUnknown&#25351;&#38024;&#65292;&#25152;&#20197;&#21482;&#38656;&#35201;&#20462;&#25913;spDBConn&#20026;CComQIPtr&#21363;&#21487;&#12290;</p>
<p   
>&#21516;&#26679;&#20320;&#21487;&#20197;&#31616;&#21270;&#36825;&#31181;&#20889;&#27861;&#65292;&#30452;&#25509;&#20351;&#29992;&#25509;&#21475;&#30340;IID&#21363;&#21487;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// MIDL_DEFINE_GUID(IID, IID_IDualDBConnect,0x8D7C23E2,0xEDE3,0x4E10,0x96,0x6F,0x2D,0x56,0x2C,0x93,0xD1,0xFA);</code></div>
<div class="line"><code class="comments">// 将这个转为IID格式即可</code></div>
<div class="line"><code class="plain">IID IID_IDualDBConnect = { </code><code class="value">0x8D7C23E2</code><code class="plain">, </code><code class="value">0xEDE3</code><code class="plain">, </code><code class="value">0x4E10</code><code class="plain">, { </code><code class="value">0x96</code><code class="plain">, </code><code class="value">0x6F</code><code class="plain">, </code><code class="value">0x2D</code><code class="plain">, </code><code class="value">0x56</code><code class="plain">, </code><code class="value">0x2C</code><code class="plain">, </code><code class="value">0x93</code><code class="plain">, </code><code class="value">0xD1</code><code class="plain">, </code><code class="value">0xFA</code><code class="plain"> } };</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HRESULT hRes;</code></div>
<div class="line"><code class="plain">CComQIPtr&lt;IDualDBConnect, &amp;IID_IDualDBConnect&gt; spDBConn;</code></div>
<div class="line"><code class="plain">hRes = spDBConn.CoCreateInstance(L</code><code class="string">"DualDBConnect.Ado.1"</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (FAILED(hRes))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::MessageBox(NULL, _T(</code><code class="string">"Error"</code><code class="plain">), _T(</code><code class="string">"Title"</code><code class="plain">), MB_OK);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">spDBConn-&gt;Open();</code></div>
</div>
    </div>
    </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="STL.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>STL</span>
        </a>
                <a href="QT%E5%9F%BA%E7%A1%80.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>QT&#22522;&#30784;</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
