<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>&#36719;&#20214;&#35843;&#35797; - &#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="1015827">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">BinaryLearning</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Binary-Learning.html" class="ht-space-link">
                    <h2>&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</h2>
                </a>
                <p><br><a href="https://github.com/gh0stkey/Binary-Learning" target="_blank">ᴀᴜᴛʜᴏʀ: ᴋᴇʏ</a><br><br>不积跬步，无以至千里；<br>不积小流，无以成江海。</p>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=3440657"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Binary-Learning.html">&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</a></li>
                                                                                     <li><a href="%E4%B8%AD%E7%BA%A7%E7%AF%87.html">&#20013;&#32423;&#31687;</a></li>
                                                            </ul>
</div>            <h1 id="src-3440657"> <span>&#36719;&#20214;&#35843;&#35797;</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>&#36719;&#20214;&#35843;&#35797;&#23454;&#38469;&#19978;&#28041;&#21450;&#30340;&#20869;&#23481;&#24182;&#19981;&#22810;&#12290;&#22914;&#26524;&#20320;&#24819;&#24320;&#21457;&#19968;&#20010;&#35843;&#35797;&#22120;&#65292;&#25484;&#25569;&#21313;&#20960;&#20010;API&#30340;&#20351;&#29992;&#23601;&#36275;&#22815;&#20102;&#12290;&#28982;&#32780;&#65292;&#22914;&#26524;&#20320;&#24076;&#26395;&#22312;&#35843;&#35797;&#19982;&#21453;&#35843;&#35797;&#30340;&#23545;&#25239;&#20013;&#20445;&#25345;&#20027;&#21160;&#22320;&#20301;&#65292;&#23545;&#32454;&#33410;&#30340;&#20102;&#35299;&#23601;&#21464;&#24471;&#23588;&#20026;&#37325;&#35201;&#12290;</p>
<p   
>&#36719;&#20214;&#35843;&#35797;&#30340;&#23398;&#20064;&#20027;&#35201;&#28041;&#21450;&#21040;&#30340;&#25991;&#20214;&#26377;kernel32.dll&#12289;ntdll.dll&#21644;ntoskrnl.exe&#12290;&#23545;&#20110;&#19968;&#20123;&#26410;&#20844;&#24320;&#30340;&#20449;&#24687;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;ReactOS&#65288;<a  class="external-link" href="https://master.dl.sourceforge.net/project/reactos/ReactOS/0.3.15/ReactOS-0.3.15-REL-src.zip?viasf=1">https://master.dl.sourceforge.net/project/reactos/ReactOS/0.3.15/ReactOS-0.3.15-REL-src.zip?viasf=1</a>&#65289;&#26469;&#24110;&#21161;&#25105;&#20204;&#23545;&#20195;&#30721;&#36827;&#34892;&#20998;&#26512;&#12290;</p>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleWvueixoQ">
        <h1 class="heading "><span>&#35843;&#35797;&#23545;&#35937;</span></h1>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleWZqOS4juiiq-iwg-ivleeoi-W6jw">
        <h2 class="heading "><span>&#35843;&#35797;&#22120;&#19982;&#34987;&#35843;&#35797;&#31243;&#24207;</span></h2>
<p   
>&#35843;&#35797;&#22120;&#19982;&#34987;&#35843;&#35797;&#31243;&#24207;&#22312;&#29992;&#25143;&#23618;&#37117;&#26159;&#29420;&#31435;&#30340;&#36827;&#31243;&#65292;&#25105;&#20204;&#35201;&#24819;&#23558;&#20004;&#32773;&#20043;&#38388;&#30456;&#20114;&#20851;&#32852;&#65292;&#23601;&#38656;&#35201;&#36890;&#36807;&#19968;&#20010;&#23186;&#20171;&#65292;&#21363;&#36827;&#31243;&#31354;&#38388;&#30340;&#39640;2G&#65292;&#20063;&#23601;&#26159;&#25105;&#20204;&#24120;&#35828;&#30340;&#20869;&#26680;&#23618;&#65292;&#27599;&#20010;&#36827;&#31243;&#30340;&#39640;2G&#37117;&#26159;&#20849;&#20139;&#30340;&#65292;&#22240;&#27492;&#35843;&#35797;&#22120;&#21487;&#20197;&#36890;&#36807;&#23427;&#26469;&#19982;&#34987;&#35843;&#35797;&#22120;&#36827;&#34892;&#36890;&#20449;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_17-0-26.png" alt="images/download/attachments/3440657/image2023-10-11_17-0-26.png" width="400"  />
    </p>
<p   
>&#36890;&#36807;&#35843;&#35797;&#22120;&#21435;&#35843;&#35797;&#19968;&#20010;&#31243;&#24207;&#26377;&#20004;&#20010;&#21150;&#27861;&#65292;&#31532;&#19968;&#31181;&#26041;&#27861;&#26159;&#36890;&#36807;<strong class=" ">CreateProcess&#20989;&#25968;&#25171;&#24320;&#19968;&#20010;&#26410;&#36816;&#34892;&#30340;&#31243;&#24207;</strong>&#65292;&#31532;&#20108;&#31181;&#26041;&#27861;&#26159;<strong class=" ">&#38468;&#21152;&#36827;&#31243;&#30340;&#26041;&#24335;</strong>&#65292;<strong class=" ">&#36890;&#36807;DebugActiveProcess&#20989;&#25968;&#38468;&#21152;&#19968;&#20010;&#27491;&#22312;&#36816;&#34892;&#30340;&#36827;&#31243;</strong>&#12290;</p>
<p   
>&#36825;&#20004;&#31181;&#26041;&#27861;&#20854;&#23454;&#22312;&#24314;&#31435;&#36827;&#31243;&#38388;&#32852;&#31995;&#30340;&#26041;&#24335;&#26159;&#19968;&#26679;&#30340;&#65292;&#21807;&#19968;&#19981;&#21516;&#30340;&#26159;CreateProcess&#20989;&#25968;&#22810;&#20102;&#19968;&#20010;&#27493;&#39588;&#65292;&#21363;&#21019;&#24314;&#36827;&#31243;&#65292;&#22240;&#27492;&#25105;&#20204;<strong class=" ">&#21482;&#38656;&#35201;&#26469;&#20998;&#26512;DebugActiveProcess&#20989;&#25968;&#23601;&#33021;&#30693;&#36947;&#24314;&#31435;&#32852;&#31995;&#30340;&#26041;&#27861;</strong>&#12290;</p>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLURlYnVnQWN0aXZlUHJvY2Vzc-aJp-ihjOa1geeoiw">
        <h2 class="heading "><span>DebugActiveProcess&#25191;&#34892;&#27969;&#31243;</span></h2>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWFs-iBlOiwg-ivleWvueixoeS4juiwg-ivleWZqA">
        <h3 class="heading "><span>&#20851;&#32852;&#35843;&#35797;&#23545;&#35937;&#19982;&#35843;&#35797;&#22120;</span></h3>
<p   
>&#25105;&#20204;&#36890;&#36807;IDA&#26469;&#20998;&#26512;DebugActiveProcess&#20989;&#25968;&#30340;&#25191;&#34892;&#27969;&#31243;&#65292;&#39318;&#20808;&#65292;&#25105;&#20204;&#36827;&#20837;kernel32.dll&#20013;&#30340;DebugActiveProcess&#20989;&#25968;&#65292;&#22312;&#20989;&#25968;&#30340;&#26368;&#21069;&#38754;&#65292;&#25105;&#20204;&#21487;&#20197;&#27880;&#24847;&#21040;&#19968;&#20010;&#20540;&#24471;&#20851;&#27880;&#30340;&#20989;&#25968;&#65292;&#21517;&#20026;<strong class=" ">DbgUiConnectToDbg</strong>&#12290;</p>
<p   
>&#24403;&#25105;&#20204;&#36827;&#20837;&#36825;&#20010;&#20989;&#25968;&#21518;&#65292;&#25105;&#20204;&#21457;&#29616;&#23427;&#35843;&#29992;&#20102;&#21478;&#19968;&#20010;&#21516;&#21517;&#20989;&#25968;&#65292;&#20301;&#20110;ntdll.dll&#27169;&#22359;&#20013;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_18-16-3.png" alt="images/download/attachments/3440657/image2023-10-11_18-16-3.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#32487;&#32493;&#36319;&#36827;&#23601;&#20250;&#21457;&#29616;ntdll.dll&#27169;&#22359;&#20013;&#30340;DbgUiConnectToDbg&#20989;&#25968;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23427;&#20808;&#33719;&#21462;FS:[0x18]&#65292;&#20063;&#23601;&#26159;_TEB.NtTib.Self&#65292;&#20854;&#23454;&#23601;&#26159;_TEB&#30340;&#22320;&#22336;&#26412;&#36523;&#65292;&#28982;&#21518;&#36890;&#36807;&#23427;&#26469;&#33719;&#21462;FS:[0xF24]&#65292;&#21363;_TEB.DbgSSReserved[1]&#65288;<strong class=" ">&#35813;&#25104;&#21592;&#26159;&#19968;&#20010;&#25351;&#38024;&#25968;&#32452;&#65292;&#21487;&#20197;&#23384;&#20648;2&#20010;&#65292;&#23427;&#26159;&#19968;&#20010;&#20445;&#30041;&#25104;&#21592;&#65292;&#19987;&#38376;&#32473;&#35843;&#35797;&#22120;&#20351;&#29992;&#65292;&#35843;&#35797;&#22120;&#21487;&#20197;&#20351;&#29992;&#35813;&#23383;&#27573;&#26469;&#23384;&#20648;&#33258;&#24049;</strong>&#65289;&#65292;&#29992;&#23427;&#20316;&#20026;&#21442;&#25968;&#32473;&#21040;&#20102;_ZwCreateDebugObject&#20989;&#25968;&#65292;&#26368;&#32456;&#35813;&#20989;&#25968;&#25191;&#34892;&#30340;&#36820;&#22238;&#32467;&#26524;&#23601;&#26159;EAX&#65292;&#20063;&#23601;&#34920;&#31034;&#23558;&#36820;&#22238;&#20449;&#24687;&#23384;&#20648;&#21040;&#20102;_TEB.DbgSSReserved[1]&#20013;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_18-37-12.png" alt="images/download/attachments/3440657/image2023-10-11_18-37-12.png" width="600"  />
    </p>
<p   
>_ZwCreateDebugObject&#20989;&#25968;&#20854;&#23454;&#20160;&#20040;&#20063;&#27809;&#24178;&#65292;&#23601;&#26159;&#36890;&#36807;&#31995;&#32479;&#35843;&#29992;&#21495;&#36827;&#20837;0&#29615;&#25191;&#34892;&#23545;&#24212;&#30340;0&#29615;&#20989;&#25968;&#26469;&#20570;&#20855;&#20307;&#30340;&#20107;&#24773;&#65292;&#26681;&#25454;&#20989;&#25968;&#30340;&#21629;&#21517;&#65292;&#25105;&#20204;&#21487;&#20197;&#25512;&#26029;&#65292;<strong class=" ">&#36825;&#20010;&#20989;&#25968;&#30340;&#20316;&#29992;&#26159;&#29992;&#20110;&#21019;&#24314;&#35843;&#35797;&#23545;&#35937;_DEBUG_OBJECT&#65288;&#20197;&#19979;&#31616;&#31216;&#20026;&#35843;&#35797;&#23545;&#35937;&#65289;</strong>&#12290;<strong class=" ">&#35843;&#35797;&#23545;&#35937;&#20805;&#24403;&#20102;&#25105;&#20204;&#20043;&#21069;&#25552;&#21040;&#30340;&#23186;&#20171;</strong>&#65292;&#30446;&#21069;&#35843;&#35797;&#22120;&#19982;&#35843;&#35797;&#23545;&#35937;&#24050;&#32463;&#20851;&#32852;&#36215;&#26469;&#20102;&#12290;</p>
<p   
>&#22240;&#27492;&#65292;&#36825;&#24847;&#21619;&#30528;&#35813;&#20989;&#25968;&#30340;&#36820;&#22238;&#32467;&#26524;&#21363;&#20026;&#35843;&#35797;&#23545;&#35937;&#65292;&#23427;&#19981;&#20250;&#30452;&#25509;&#36820;&#22238;&#35843;&#35797;&#23545;&#35937;&#22312;0&#29615;&#30340;&#22320;&#22336;&#12290;<strong class=" ">&#25152;&#20197;&#22312;3&#29615;_TEB.DbgSSReserved[1]&#20013;&#23384;&#20648;&#20102;&#35813;&#35843;&#35797;&#23545;&#35937;&#30340;&#21477;&#26564;&#12290;</strong>&#36825;&#20010;&#21477;&#26564;&#29992;&#20110;&#22312;3&#29615;&#20013;&#24341;&#29992;&#21644;&#25805;&#20316;&#35843;&#35797;&#23545;&#35937;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_18-42-25.png" alt="images/download/attachments/3440657/image2023-10-11_18-42-25.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWFs-iBlOiwg-ivleWvueixoeS4juiiq-iwg-ivlei_m-eoiw">
        <h3 class="heading "><span>&#20851;&#32852;&#35843;&#35797;&#23545;&#35937;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;</span></h3>
<p   
>&#22312;&#20197;&#19978;&#27969;&#31243;&#37117;&#32467;&#26463;&#20043;&#21518;&#65292;&#20877;&#22238;&#21040;kernel32.dll&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#20250;&#27604;&#36739;&#36820;&#22238;&#32467;&#26524;&#65292;&#22914;&#26524;&#35843;&#35797;&#23545;&#35937;&#21019;&#24314;&#25104;&#21151;&#23601;&#36827;&#34892;&#36339;&#36716;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_19-37-58.png" alt="images/download/attachments/3440657/image2023-10-11_19-37-58.png" width="600"  />
    </p>
<p   
>&#32487;&#32493;&#36319;&#36827;&#20195;&#30721;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#39318;&#20808;&#36890;&#36807;_ProcessIdToHandle&#20989;&#25968;&#65292;&#26681;&#25454;&#36827;&#31243;ID&#33719;&#21462;&#34987;&#35843;&#35797;&#36827;&#31243;&#30340;&#21477;&#26564;&#65288;&#36820;&#22238;&#32467;&#26524;EAX&#32473;&#21040;ESI&#65289;&#65292;&#20854;&#27425;&#23558;&#34987;&#35843;&#35797;&#36827;&#31243;&#21477;&#26564;&#20316;&#20026;&#21442;&#25968;&#24102;&#20837;&#21040;_DbgUiDebugActiveProcess&#20989;&#25968;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_19-44-58.png" alt="images/download/attachments/3440657/image2023-10-11_19-44-58.png" width="600"  />
    </p>
<p   
>_DbgUiDebugActiveProcess&#20989;&#25968;&#20301;&#20110;ntdll.dll&#27169;&#22359;&#20013;&#65292;&#25152;&#20197;&#38656;&#35201;&#20999;&#36807;&#21435;&#36827;&#34892;&#26597;&#30475;&#12290;&#22312;&#35813;&#20989;&#25968;&#20869;&#20808;&#33719;&#21462;&#24403;&#21069;&#32447;&#31243;&#30340;_TEB&#65292;&#28982;&#21518;&#33719;&#21462;_TEB&#30340;0xF24&#20559;&#31227;&#20301;&#25104;&#21592;&#65292;&#21363;&#35843;&#35797;&#23545;&#35937;&#65292;&#23558;&#20854;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#21477;&#26564;&#19968;&#24182;&#20316;&#20026;&#21442;&#25968;&#24102;&#20837;&#21040;_NtDebugActiveProcess&#20989;&#25968;&#12290;&#32780;&#36825;&#20010;&#20989;&#25968;&#20173;&#28982;&#26159;&#19968;&#20010;&#31995;&#32479;&#35843;&#29992;&#65292;&#26368;&#32456;&#36827;&#20837;0&#29615;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_19-47-36.png" alt="images/download/attachments/3440657/image2023-10-11_19-47-36.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#35201;&#32487;&#32493;&#36319;&#36827;0&#29615;&#65292;&#20063;&#23601;&#26159;ntoskrnl.exe&#27169;&#22359;&#65292;&#25214;&#21516;&#21517;&#20989;&#25968;_NtDebugActiveProcess&#21363;&#21487;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#26368;&#24320;&#22987;&#37096;&#20998;&#23601;&#26159;&#35843;&#29992;&#20102;_ObReferenceObjectByHandle&#20989;&#25968;&#65292;<strong class=" ">&#35813;&#20989;&#25968;&#30340;&#20316;&#29992;&#23601;&#26159;&#36890;&#36807;&#21477;&#26564;&#26469;&#33719;&#21462;&#23545;&#35937;</strong>&#65292;&#23427;&#26377;6&#20010;&#21442;&#25968;&#65292;&#31532;5&#20010;&#21442;&#25968;&#23601;&#26159;&#29992;&#20110;&#23384;&#20648;&#20989;&#25968;&#33719;&#21462;&#30340;&#36827;&#31243;&#23545;&#35937;&#22320;&#22336;&#65292;&#22312;&#36825;&#37324;&#26159;&#36890;&#36807;&#34987;&#35843;&#35797;&#36827;&#31243;&#30340;&#21477;&#26564;&#65288;&#21442;&#25968;1&#65289;&#33719;&#21462;_PsProcessType&#65288;&#21442;&#25968;3&#65289;&#31867;&#22411;&#30340;&#23545;&#35937;&#65292;&#20063;&#23601;&#26159;_EPROCESS&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_21-53-29.png" alt="images/download/attachments/3440657/image2023-10-11_21-53-29.png" width="600"  />
    </p>
<p   
>&#24448;&#19979;&#32487;&#32493;&#30475;&#65292;&#36825;&#37324;&#23601;&#26159;&#33719;&#21462;&#24403;&#21069;&#36827;&#31243;&#32467;&#26500;&#20307;&#22320;&#22336;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#32467;&#26500;&#20307;&#22320;&#22336;&#36827;&#34892;&#23545;&#27604;&#65292;&#21363;&#21028;&#26029;&#26159;&#21542;&#23384;&#22312;&#33258;&#24049;&#35843;&#35797;&#33258;&#24049;&#30340;&#24773;&#20917;&#65292;&#22914;&#26524;&#23384;&#22312;&#21017;&#36339;&#36716;&#36208;&#12290;&#20197;&#21450;&#21028;&#26029;&#20102;&#34987;&#35843;&#35797;&#36827;&#31243;&#26159;&#21542;&#26159;&#21021;&#22987;&#21270;&#31995;&#32479;&#36827;&#31243;&#65292;&#22914;&#26524;&#26159;&#30340;&#35805;&#20063;&#36339;&#36716;&#36208;&#12290;<strong class=" ">&#36825;&#37324;&#20854;&#23454;&#20063;&#23601;&#35828;&#26126;&#20102;&#20004;&#31181;&#26080;&#27861;&#32487;&#32493;&#35843;&#35797;&#30340;&#26465;&#20214;&#12290;</strong></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_21-54-57.png" alt="images/download/attachments/3440657/image2023-10-11_21-54-57.png" width="600"  />
    </p>
<p   
>&#28982;&#21518;<strong class=" ">&#21448;&#26469;&#21040;&#20102;&#36890;&#36807;&#21477;&#26564;&#33719;&#21462;&#23545;&#35937;&#30340;&#29615;&#33410;</strong>&#65292;&#36825;&#27425;&#26159;&#36890;&#36807;&#35843;&#35797;&#23545;&#35937;&#30340;&#21477;&#26564;&#26469;&#33719;&#21462;&#35843;&#35797;&#23545;&#35937;&#30340;&#22320;&#22336;&#65292;&#24182;&#19988;&#23558;&#35843;&#35797;&#23545;&#35937;&#30340;&#22320;&#22336;&#21644;&#34987;&#35843;&#35797;&#36827;&#31243;&#30340;_EPROCESS&#32467;&#26500;&#20307;&#22320;&#22336;&#20316;&#20026;&#21442;&#25968;&#24102;&#20837;_DbgkpSetProcessDebugObject&#20989;&#25968;&#25191;&#34892;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_22-6-26.png" alt="images/download/attachments/3440657/image2023-10-11_22-6-26.png" width="600"  />
    </p>
<p   
><strong class=" ">_DbgkpSetProcessDebugObject&#20989;&#25968;&#30340;&#20316;&#29992;&#23601;&#26159;&#23558;&#35843;&#35797;&#23545;&#35937;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#20851;&#32852;</strong>&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#22312;&#33719;&#21462;&#20102;&#34987;&#35843;&#35797;&#36827;&#31243;&#32467;&#26500;&#20307;&#22320;&#22336;&#20043;&#21518;&#21028;&#26029;&#34987;&#35843;&#35797;&#36827;&#31243;&#26159;&#21542;&#24050;&#32463;&#23646;&#20110;&#34987;&#35843;&#35797;&#29366;&#24577;&#65292;&#21363;_EPROCESS&#30340;0xBC&#20559;&#31227;&#20301;&#25104;&#21592;DebugPort&#26159;&#21542;&#38750;0&#65292;&#22914;&#26524;&#20026;0&#21017;&#34920;&#31034;&#27809;&#26377;&#34987;&#35843;&#35797;&#32487;&#32493;&#21521;&#19979;&#25191;&#34892;&#12290;&#25509;&#30528;&#23601;&#26159;&#26368;&#20851;&#38190;&#30340;&#65292;<strong class=" ">&#23558;&#35843;&#35797;&#23545;&#35937;&#25918;&#36827;&#34987;&#35843;&#35797;&#36827;&#31243;&#32467;&#26500;&#20307;&#30340;DebugPort&#25104;&#21592;&#24403;&#20013;&#65292;&#33267;&#27492;&#23601;&#23558;&#20004;&#32773;&#25104;&#21151;&#20851;&#32852;&#36215;&#26469;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_22-13-26.png" alt="images/download/attachments/3440657/image2023-10-11_22-13-26.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLV9ERUJVR19PQkpFQ1Tnu5PmnoTkvZM">
        <h2 class="heading "><span>_DEBUG_OBJECT&#32467;&#26500;&#20307;</span></h2>
<p   
>&#36890;&#36807;&#19978;&#36848;&#30340;&#23398;&#20064;&#65292;&#25105;&#20204;&#20102;&#35299;&#21040;&#20102;&#35843;&#35797;&#22120;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#65292;&#36890;&#36807;&#35843;&#35797;&#23545;&#35937;&#32467;&#26500;&#20307;_DEBUG_OBJECT&#25104;&#21151;&#30340;&#20851;&#32852;&#36215;&#26469;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_22-20-7.png" alt="images/download/attachments/3440657/image2023-10-11_22-20-7.png" width="600"  />
    </p>
<p   
>&#20197;&#19979;&#20026;_DEBUG_OBJECT&#32467;&#26500;&#20307;&#30340;&#32452;&#25104;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _DEBUG_OBJECT {</code></div>
<div class="line"><code class="plain">     KEVENT EventsPresent;</code></div>
<div class="line"><code class="plain">     FAST_MUTEX Mutex;</code></div>
<div class="line"><code class="plain">     LIST_ENTRY EventList;</code></div>
<div class="line"><code class="plain">     ULONG Flags;</code></div>
<div class="line"><code class="plain">} DEBUG_OBJECT, *PDEBUG_OBJECT;</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleWvueaKlw">
        <h2 class="heading "><span>&#35843;&#35797;&#23545;&#25239;</span></h2>
<p   
>&#22312;&#20102;&#35299;&#20102;&#35843;&#35797;&#21407;&#29702;&#20043;&#21518;&#65292;&#25105;&#20204;&#21487;&#20197;&#24635;&#32467;&#20986;&#19968;&#20123;<strong class=" ">&#21453;&#35843;&#35797;&#30340;&#26041;&#27861;</strong>&#65306;</p>
<ol class=" "><li class=" "><p   
><strong class=" ">DebugPort&#26816;&#26597;&#19982;&#32622;0&#65306;</strong>&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#65292;&#19981;&#26029;&#26816;&#26597;&#24403;&#21069;&#36827;&#31243;&#30340;DebugPort&#20540;&#65292;&#19968;&#26086;&#26377;&#20540;&#23601;&#36864;&#20986;&#31243;&#24207;&#25110;&#23558;&#20854;&#32622;0&#65292;&#20013;&#26029;&#35843;&#35797;&#23545;&#35937;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#20043;&#38388;&#30340;&#32852;&#31995;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#36941;&#21382;&#25152;&#26377;&#36827;&#31243;&#30340;TEB+0xF24&#22788;&#65306;</strong>&#26816;&#26597;&#35813;&#20301;&#32622;&#26159;&#21542;&#26377;&#20540;&#65292;&#22914;&#26524;&#26377;&#20540;&#65292;&#35828;&#26126;&#23384;&#22312;&#35843;&#35797;&#22120;&#65292;&#21487;&#20197;&#36873;&#25321;&#36864;&#20986;&#31243;&#24207;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">Hook NtCreateDebugObject&#65306;</strong>&#38459;&#27490;NtCreateDebugObject&#20989;&#25968;&#21019;&#24314;&#35843;&#35797;&#23545;&#35937;&#65292;&#20174;&#32780;&#38450;&#27490;&#35843;&#35797;&#22120;&#30340;&#38468;&#21152;&#12290;</p>
</li></ol><p   
><strong class=" ">&#21453;&#21453;&#35843;&#35797;&#30340;&#26041;&#27861;&#65306;</strong></p>
<ol class=" "><li class=" "><p   
><strong class=" ">&#38024;&#23545;DebugPort&#26816;&#26597;&#19982;&#32622;0</strong>&#65306;&#19981;&#20351;&#29992;DebugPort&#65292;&#32780;&#26159;&#22312;&#36827;&#31243;&#32467;&#26500;&#20307;&#20013;&#21478;&#22806;&#36873;&#25321;&#19968;&#20010;&#31354;&#38386;&#25104;&#21592;&#26469;&#23384;&#25918;_DEBUG_OBJECT&#30340;&#22320;&#22336;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#38024;&#23545;Hook NtCreateDebugObject</strong>&#65306;&#33258;&#34892;&#20998;&#37197;&#20869;&#23384;&#32473;_DEBUG_OBJECT&#32467;&#26500;&#20307;&#65292;&#24182;&#20026;&#20854;&#25104;&#21592;&#36171;&#20540;&#65292;&#32469;&#36807;&#21407;&#26377;&#30340;Hook&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#37325;&#20889;DebugActiveProcess&#20989;&#25968;</strong>&#65306;&#37325;&#26032;&#23454;&#29616;DebugActiveProcess&#20989;&#25968;&#65292;&#20197;&#22686;&#21152;&#23545;&#21453;&#35843;&#35797;&#25216;&#26415;&#32469;&#36807;&#33021;&#21147;&#12290;</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleS6i-S7tueahOmHh-mbhg">
        <h1 class="heading "><span>&#35843;&#35797;&#20107;&#20214;&#30340;&#37319;&#38598;</span></h1>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleS6i-S7tg">
        <h2 class="heading "><span>&#35843;&#35797;&#20107;&#20214;</span></h2>
<p   
>&#35843;&#35797;&#22120;&#19982;&#34987;&#35843;&#35797;&#36827;&#31243;&#20043;&#38388;&#36890;&#36807;_DEBUG_OBJECT&#65288;&#35843;&#35797;&#23545;&#35937;&#65289;&#26469;&#24314;&#31435;&#36215;&#32852;&#31995;&#65292;&#35843;&#35797;&#22120;&#36890;&#36807;&#35843;&#35797;&#23545;&#35937;&#30340;EventList&#25104;&#21592;&#26469;&#25351;&#23548;&#34987;&#35843;&#35797;&#36827;&#31243;&#21040;&#24213;&#21457;&#29983;&#20102;&#20160;&#20040;&#20107;&#24773;&#65292;<strong class=" ">&#35813;&#25104;&#21592;&#26159;&#19968;&#20010;&#38142;&#34920;&#65292;&#20854;&#20013;&#23384;&#20648;&#30340;&#26159;&#20174;&#34987;&#35843;&#35797;&#36827;&#31243;&#21457;&#36865;&#36807;&#26469;&#30340;&#21508;&#31181;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;</strong>&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _DEBUG_OBJECT {</code></div>
<div class="line"><code class="plain">     KEVENT EventsPresent; </code><code class="comments">// 用于指示有调试事件发生的事件对象</code></div>
<div class="line"><code class="plain">     FAST_MUTEX Mutex; </code><code class="comments">// 用于同步的互斥对象</code></div>
<div class="line"><code class="plain">     LIST_ENTRY EventList; </code><code class="comments">// 保存调试事件的链表</code></div>
<div class="line"><code class="plain">     ULONG Flags; </code><code class="comments">// 标志位，调试消息是否已读取</code></div>
<div class="line"><code class="plain">} DEBUG_OBJECT, *PDEBUG_OBJECT;</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-10-11_22-20-7.png" alt="images/download/attachments/3440657/image2023-10-11_22-20-7.png" width="600"  />
    </p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeenjeexuw">
        <h3 class="heading "><span>&#31181;&#31867;</span></h3>
<p   
>&#19981;&#26159;&#25152;&#26377;&#30340;&#36827;&#31243;&#34892;&#20026;&#37117;&#20250;&#20135;&#29983;&#35843;&#35797;&#20107;&#20214;&#30340;&#65292;&#35843;&#35797;&#20107;&#20214;&#20063;&#20998;&#31181;&#31867;&#65292;&#22914;&#19979;&#25152;&#31034;&#19968;&#20849;&#26377;8&#31181;&#65292;&#20294;&#26377;&#19968;&#20010;&#24050;&#32463;&#24223;&#24323;&#65292;<strong class=" ">&#22240;&#27492;&#23454;&#38469;&#19978;&#21482;&#26377;7&#31181;&#35843;&#35797;&#20107;&#20214;</strong>&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef </code><code class="keyword">enum</code><code class="plain"> _DBGKM_APINUMBER</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    DbgKmExceptionApi = </code><code class="value">0</code><code class="plain">, </code><code class="comments">// 异常</code></div>
<div class="line"><code class="plain">    DbgKmCreateThreadApi = </code><code class="value">1</code><code class="plain">, </code><code class="comments">// 创建线程</code></div>
<div class="line"><code class="plain">    DbgKmCreateProcessApi = </code><code class="value">2</code><code class="plain">, </code><code class="comments">// 创建进程</code></div>
<div class="line"><code class="plain">    DbgKmExitThreadApi = </code><code class="value">3</code><code class="plain">, </code><code class="comments">// 线程退出</code></div>
<div class="line"><code class="plain">    DbgKmExitProcessApi = </code><code class="value">4</code><code class="plain">, </code><code class="comments">// 进程退出</code></div>
<div class="line"><code class="plain">    DbgKmLoadDllApi = </code><code class="value">5</code><code class="plain">,  </code><code class="comments">// 加载DLL</code></div>
<div class="line"><code class="plain">    DbgKmUnloadDllApi = </code><code class="value">6</code><code class="plain">, </code><code class="comments">// 卸载DLL</code></div>
<div class="line"><code class="plain">    DbgKmErrorReportApi = </code><code class="value">7</code><code class="plain">, </code><code class="comments">// 已废弃</code></div>
<div class="line"><code class="plain">    DbgKmMaxApiNumber = </code><code class="value">8</code><code class="plain">, </code><code class="comments">// 最大值</code></div>
<div class="line"><code class="plain">} DBGKM_APINUMBER; </code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLemHh-mbhuWHveaVsA">
        <h3 class="heading "><span>&#37319;&#38598;&#20989;&#25968;</span></h3>
<p   
>    <span style="color: #000000;">
&#22312;Windows&#31995;&#32479;&#20013;&#25552;&#20379;&#20102;&#19968;&#20123;&#20197;Dbgk&#24320;&#22836;&#30340;&#20989;&#25968;&#65292;&#21487;&#29992;&#20110;<strong class=" ">&#37319;&#38598;&#35843;&#35797;&#20107;&#20214;</strong>&#65292;&#24182;&#29983;&#25104;&#30456;&#24212;&#20107;&#20214;&#30340;&#32467;&#26500;&#20307;&#65292;<strong class=" ">&#25105;&#20204;&#31216;&#20043;&#20026;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;</strong>&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;<strong class=" ">&#36825;&#20123;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;&#37117;&#26159;&#22312;API&#35843;&#29992;&#30340;&#24517;&#32463;&#20043;&#36335;&#19978;&#21152;&#20837;&#30340;</strong>&#12290;&#22270;&#20013;&#40657;&#33394;&#23383;&#20307;&#30340;&#20989;&#25968;&#23601;&#26159;&#27599;&#20010;&#20107;&#20214;API&#26368;&#32456;&#37117;&#20250;&#32463;&#36807;&#30340;&#22320;&#26041;&#65292;&#32043;&#33394;&#23383;&#20307;&#30340;&#20989;&#25968;&#29992;&#20110;&#37319;&#38598;&#35843;&#35797;&#20107;&#20214;&#65292;&#32418;&#33394;&#23383;&#20307;&#30340;&#20989;&#25968;&#29992;&#20110;&#21457;&#36865;&#65288;&#20889;&#20837;&#65289;&#35843;&#35797;&#20107;&#20214;.    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_21-43-53.png" alt="images/download/attachments/3440657/image2023-11-15_21-43-53.png" width="500"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLemHh-mbhua1geeoiw">
        <h2 class="heading "><span>&#37319;&#38598;&#27969;&#31243;</span></h2>
<p   
>&#25105;&#20204;&#35201;&#24819;&#30693;&#36947;&#37319;&#38598;&#20989;&#25968;&#20570;&#20102;&#20160;&#20040;&#23601;&#38656;&#35201;&#36319;&#36827;&#27969;&#31243;&#65292;&#26469;&#30475;&#23427;&#30340;&#20195;&#30721;&#36923;&#36753;&#12290;&#36825;&#37324;&#25105;&#20204;&#20197;&#21019;&#24314;&#36827;&#31243;&#12289;&#32447;&#31243;&#65292;&#21644;&#36864;&#20986;&#32447;&#31243;&#12289;&#36827;&#31243;&#20026;&#20363;&#26469;&#36319;&#36827;&#20998;&#26512;&#19968;&#19979;&#12290;</p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWIm-W7uui_m-eoi-OAgee6v-eoi-S6i-S7tumHh-mbhg">
        <h3 class="heading "><span>&#21019;&#24314;&#36827;&#31243;&#12289;&#32447;&#31243;&#20107;&#20214;&#37319;&#38598;</span></h3>
<p   
>&#21019;&#24314;&#36827;&#31243;&#30340;&#26412;&#36136;&#23601;&#26159;&#21019;&#24314;&#32447;&#31243;&#65292;&#20854;&#20013;&#31532;&#19968;&#27425;&#21019;&#24314;&#32447;&#31243;&#26102;&#21363;&#20026;&#21019;&#24314;&#36827;&#31243;&#12290;&#22240;&#27492;&#65292;&#26080;&#35770;&#26159;&#21019;&#24314;&#36827;&#31243;&#36824;&#26159;&#32447;&#31243;&#65292;&#24213;&#23618;&#35843;&#29992;&#30340;&#20989;&#25968;&#26159;&#30456;&#21516;&#30340;&#65292;&#37117;&#26159;PspUserThreadStartup&#20989;&#25968;&#12290;</p>
<p   
>&#22312;PspUserThreadStartup&#20989;&#25968;&#20869;&#65292;&#25105;&#20204;&#21487;&#20197;&#24456;&#24555;&#21040;&#30340;&#25214;&#21040;&#23545;&#24212;&#30340;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;_DbgkCreateThread&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_22-19-7.png" alt="images/download/attachments/3440657/image2023-11-15_22-19-7.png" width="600"  />
    </p>
<p   
>&#32487;&#32493;&#36319;&#36827;_DbgkCreateThread&#20989;&#25968;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#23427;&#21028;&#26029;&#20102;&#24403;&#21069;&#36827;&#31243;&#30340;DebugPort&#30340;&#20540;&#26159;&#21542;&#20026;&#31354;&#65292;&#36825;&#20010;&#21028;&#26029;&#26159;&#27599;&#20010;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;&#37117;&#20250;&#36208;&#30340;&#36923;&#36753;&#65292;&#22914;&#26524;&#21028;&#26029;&#20540;&#19981;&#20026;&#31354;&#21017;&#34920;&#31034;&#24403;&#21069;&#36827;&#31243;&#27491;&#22312;&#34987;&#35843;&#35797;&#23601;&#36339;&#36716;&#36827;&#21435;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_22-23-10.png" alt="images/download/attachments/3440657/image2023-11-15_22-23-10.png" width="600"  />
    </p>
<p   
>&#36319;&#36827;&#36339;&#36716;&#30340;&#29255;&#27573;&#20195;&#30721;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23427;&#19968;&#24320;&#22987;&#23601;&#20570;&#20102;&#19968;&#20214;&#20107;&#24773;&#65292;&#21363;&#21028;&#26029;&#24403;&#21069;&#32447;&#31243;&#26159;&#21542;&#20026;&#31532;&#19968;&#20010;&#32447;&#31243;&#65292;&#20197;&#27492;&#26469;&#21028;&#26029;&#29983;&#25104;&#30340;&#35843;&#35797;&#20107;&#20214;&#26159;&#21019;&#24314;&#36827;&#31243;&#36824;&#26159;&#21019;&#24314;&#32447;&#31243;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_22-44-11.png" alt="images/download/attachments/3440657/image2023-11-15_22-44-11.png" width="500"  />
    </p>
<p   
>&#25509;&#30528;&#23427;&#20570;&#20102;&#31532;&#20108;&#20214;&#20107;&#24773;&#65292;&#23558;&#23545;&#24212;&#30340;&#35843;&#35797;&#20107;&#20214;&#25171;&#21253;&#25104;&#19968;&#20010;&#32467;&#26500;&#20307;&#65292;&#36339;&#36716;&#21040;&#22914;&#19979;&#29255;&#27573;&#20195;&#30721;&#65292;&#26368;&#32456;&#20250;&#35843;&#29992;_DbgkpSendApiMessage&#20989;&#25968;&#12290;&#36825;&#20010;&#20989;&#25968;&#30340;&#31532;&#19968;&#20010;&#21442;&#25968;&#23601;&#26159;&#20043;&#21069;&#25171;&#21253;&#22909;&#30340;&#35843;&#35797;&#20107;&#20214;&#30340;&#32467;&#26500;&#20307;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_22-45-49.png" alt="images/download/attachments/3440657/image2023-11-15_22-45-49.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLemAgOWHuue6v-eoi-OAgei_m-eoi-S6i-S7tumHh-mbhg">
        <h3 class="heading "><span>&#36864;&#20986;&#32447;&#31243;&#12289;&#36827;&#31243;&#20107;&#20214;&#37319;&#38598;</span></h3>
<p   
>&#36864;&#20986;&#36827;&#31243;&#30340;&#26412;&#36136;&#20063;&#26159;&#36864;&#20986;&#32447;&#31243;&#65292;&#20854;&#20013;&#36864;&#20986;&#32447;&#31243;&#20026;&#26368;&#21518;&#19968;&#20010;&#26102;&#21363;&#20026;&#36864;&#20986;&#36827;&#31243;&#12290;&#22240;&#27492;&#65292;&#26080;&#35770;&#26159;&#36864;&#20986;&#36827;&#31243;&#36824;&#26159;&#32447;&#31243;&#65292;&#24213;&#23618;&#35843;&#29992;&#30340;&#20989;&#25968;&#26159;&#30456;&#21516;&#30340;&#65292;&#37117;&#26159;PspExitThread&#20989;&#25968;&#12290;</p>
<p   
>&#22312;PspExitThread&#20989;&#25968;&#20869;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23427;&#21028;&#26029;&#20102;DebugPort&#26159;&#21542;&#20026;0&#65292;&#22914;&#26524;&#19981;&#20026;0&#34920;&#31034;&#24403;&#21069;&#27491;&#22312;&#35843;&#35797;&#65292;&#23601;&#36827;&#34892;&#36339;&#36716;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_23-0-58.png" alt="images/download/attachments/3440657/image2023-11-15_23-0-58.png" width="600"  />
    </p>
<p   
>&#36319;&#36827;&#36339;&#36716;&#30340;&#29255;&#27573;&#20195;&#30721;&#65292;&#36825;&#37324;&#21028;&#26029;&#20102;&#24403;&#21069;&#36864;&#20986;&#30340;&#32447;&#31243;&#26159;&#19981;&#26159;&#26368;&#21518;&#19968;&#20010;&#65292;&#20063;&#23601;&#34920;&#31034;&#21028;&#26029;&#26159;&#21542;&#26159;&#36864;&#20986;&#30340;&#36827;&#31243;&#65292;&#22914;&#26524;&#26159;&#21017;&#35843;&#29992;&#20989;&#25968;_DbgkExitProcess&#65292;&#21453;&#20043;&#22914;&#26524;&#19981;&#26159;&#21017;&#34920;&#31034;&#24403;&#21069;&#36864;&#20986;&#30340;&#26159;&#32447;&#31243;&#65292;&#21017;&#35843;&#29992;&#20989;&#25968;_DbgkExitThread&#12290;<strong class=" ">&#36825;&#37324;&#26159;&#26681;&#25454;&#36864;&#20986;&#20107;&#20214;&#36873;&#25321;&#23545;&#24212;&#30340;&#37319;&#38598;&#20989;&#25968;&#12290;</strong></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_23-2-4.png" alt="images/download/attachments/3440657/image2023-11-15_23-2-4.png" width="600"  />
    </p>
<p   
>&#32780;&#25105;&#20204;&#27599;&#20010;&#37117;&#36319;&#36827;&#21435;&#30475;&#65292;&#20250;&#21457;&#29616;<strong class=" ">&#26368;&#24320;&#22987;&#37117;&#22312;&#22635;&#20805;&#23545;&#24212;&#30340;&#35843;&#35797;&#20107;&#20214;&#32467;&#26500;&#20307;</strong>&#65292;&#26368;&#32456;&#35843;&#29992;_DbgkpSendApiMessage&#20989;&#25968;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_23-7-10.png" alt="images/download/attachments/3440657/image2023-11-15_23-7-10.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLURiZ2twU2VuZEFwaU1lc3NhZ2Xlh73mlbA">
        <h2 class="heading "><span>DbgkpSendApiMessage&#20989;&#25968;</span></h2>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeaJp-ihjOa1geeoiw">
        <h3 class="heading "><span>&#25191;&#34892;&#27969;&#31243;</span></h3>
<p   
>&#36890;&#36807;&#19978;&#38754;&#20960;&#20010;&#26696;&#20363;&#30340;&#20998;&#26512;&#65292;&#25105;&#20204;&#30693;&#36947;DbgkpSendApiMessage&#20989;&#25968;&#30340;&#20316;&#29992;&#26159;&#23558;&#24050;&#21019;&#24314;&#30340;&#35843;&#35797;&#20107;&#20214;&#21457;&#36865;&#21040;&#35843;&#35797;&#23545;&#35937;&#30340;&#20107;&#20214;&#38142;&#34920;&#20013;&#12290;</p>
<p   
>&#36827;&#20837;&#20989;&#25968;&#20869;&#65292;&#21457;&#29616;&#23427;&#35843;&#29992;&#20102;_DbgkpQueueMessage&#20989;&#25968;&#65292;&#35813;&#20989;&#25968;&#26377;&#20004;&#20010;&#21442;&#25968;&#65292;&#19968;&#20010;&#26159;Event&#65292;&#23427;&#26159;&#30001;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;&#21019;&#24314;&#30340;&#32467;&#26500;&#20307;&#65292;&#21478;&#19968;&#20010;&#26159;FastMutex&#65292;&#36825;&#26159;&#19968;&#20010;&#19968;&#20010;&#20114;&#26021;&#20307;&#21442;&#25968;&#65292;&#19982;&#35843;&#35797;&#23545;&#35937;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;&#30456;&#21516;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_23-22-57.png" alt="images/download/attachments/3440657/image2023-11-15_23-22-57.png" width="600"  />
    </p>
<p   
>&#25105;&#20204;&#36319;&#36827;_DbgkpQueueMessage&#20989;&#25968;&#65292;&#22312;&#35813;&#20989;&#25968;&#20869;&#37096;&#21457;&#29616;&#20195;&#30721;&#36923;&#36753;&#25191;&#34892;&#21040;&#19968;&#21322;&#26102;&#65292;&#23427;&#20808;&#20174;&#33258;&#36523;&#36827;&#31243;&#30340;_EPROCESS&#32467;&#26500;&#20307;&#20013;&#33719;&#21462;&#35843;&#35797;&#23545;&#35937;&#65288;&#35843;&#35797;&#23545;&#35937;&#19981;&#20026;&#31354;&#65289;&#12290;&#28982;&#21518;&#20174;&#35843;&#35797;&#23545;&#35937;&#20013;&#21462;&#20986;EventList&#25104;&#21592;&#30340;&#39318;&#22320;&#22336;&#65288;0x30&#20559;&#31227;&#20301;&#65289;&#65292;&#24182;&#23558;&#20445;&#23384;&#22312;EBX&#20013;&#30340;&#33410;&#28857;&#25554;&#20837;&#21040;EventList&#30340;&#31532;&#19968;&#20010;&#20301;&#32622;&#65292;&#20063;&#23601;&#34920;&#31034;&#36825;&#37324;&#30340;EBX&#20026;&#22788;&#29702;&#22909;&#30340;&#35843;&#35797;&#20107;&#20214;&#12290;&#33267;&#27492;&#65292;&#25105;&#20204;&#30340;&#35843;&#35797;&#20107;&#20214;&#23601;&#25346;&#20837;&#20102;&#38142;&#34920;&#20013;&#65292;&#21487;&#20197;&#20351;&#24471;&#35843;&#35797;&#22120;&#36827;&#34892;&#22788;&#29702;&#20102;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-15_23-28-51.png" alt="images/download/attachments/3440657/image2023-11-15_23-28-51.png" width="700"  />
    </p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWHveaVsOWPguaVsA">
        <h3 class="heading "><span>&#20989;&#25968;&#21442;&#25968;</span></h3>
<p   
>&#35813;&#20989;&#25968;&#26377;&#20004;&#20010;&#21442;&#25968;&#65292;&#36825;&#37324;&#31616;&#35201;&#35828;&#26126;&#19968;&#19979;&#65306;</p>
<p   
><strong class=" ">&#21442;&#25968;1&#65306;</strong>&#28040;&#24687;&#32467;&#26500;&#12290;&#24635;&#20849;&#26377;7&#31181;&#31867;&#22411;&#30340;&#28040;&#24687;&#32467;&#26500;&#65292;&#27599;&#31181;&#28040;&#24687;&#37117;&#26377;&#33258;&#24049;&#30340;&#28040;&#24687;&#32467;&#26500;&#65292;&#36825;&#20123;&#32467;&#26500;&#26159;&#30001;&#19981;&#21516;&#30340;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;&#21019;&#24314;&#30340;&#12290;<br/><strong class=" ">&#21442;&#25968;2&#65306;</strong>&#25346;&#36215;&#32447;&#31243;&#26631;&#24535;&#12290;&#36825;&#20010;&#21442;&#25968;&#29992;&#20110;&#25351;&#31034;&#26159;&#21542;&#38656;&#35201;&#25346;&#36215;&#38500;&#20102;&#24403;&#21069;&#36827;&#31243;&#20043;&#22806;&#30340;&#20854;&#20182;&#32447;&#31243;&#12290;&#26377;&#20123;&#35843;&#35797;&#20107;&#20214;&#38656;&#35201;&#25346;&#36215;&#20854;&#20182;&#32447;&#31243;&#65292;&#27604;&#22914;&#38024;&#23545;int3&#26029;&#28857;&#30340;&#20107;&#20214;&#65307;&#32780;&#26377;&#20123;&#35843;&#35797;&#20107;&#20214;&#21017;&#19981;&#38656;&#35201;&#25346;&#36215;&#32447;&#31243;&#65292;&#27604;&#22914;&#27169;&#22359;&#21152;&#36733;&#20107;&#20214;&#12290;</p>
<p   
>DbgkpSendApiMessage&#20989;&#25968;&#26159;&#25972;&#20010;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#30340;&#20027;&#35201;&#20837;&#21475;&#12290;&#22914;&#26524;&#22312;&#36825;&#20010;&#20989;&#25968;&#20013;&#35774;&#32622;&#20102;&#38057;&#23376;&#65292;&#35843;&#35797;&#22120;&#23558;&#26080;&#27861;&#27491;&#24120;&#36827;&#34892;&#35843;&#35797;&#25805;&#20316;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWGjeeci19ERUJVR19PQkpFQ1Q">
        <h2 class="heading "><span>&#20877;&#30475;_DEBUG_OBJECT</span></h2>
<p   
>&#25105;&#20204;&#29616;&#22312;&#20877;&#30475;&#19968;&#19979;&#35843;&#35797;&#23545;&#35937;&#30340;&#27599;&#20010;&#25104;&#21592;&#65292;&#24212;&#35813;&#33021;&#26356;&#22909;&#29702;&#35299;&#19968;&#20123;&#65292;&#22312;&#35843;&#29992;DbgkpQueueMessage&#20989;&#25968;&#23558;&#35843;&#35797;&#20107;&#20214;&#28155;&#21152;&#21040;&#38142;&#34920;&#21518;&#65292;<strong class=" ">_DEBUG_OBJECT.EventsPresent&#29366;&#24577;&#20250;&#34987;&#20462;&#25913;</strong>&#65292;&#35843;&#35797;&#22120;&#20250;&#21028;&#26029;&#36825;&#20010;&#29366;&#24577;&#65292;&#24403;&#29366;&#24577;&#25913;&#21464;&#21518;&#20174;EventList&#38142;&#34920;&#20013;&#25552;&#21462;&#35843;&#35797;&#20107;&#20214;&#12290;</p>
<p   
>&#20026;&#20102;&#36991;&#20813;&#24182;&#21457;&#20462;&#25913;EventList&#38142;&#34920;&#65292;<strong class=" ">&#38656;&#35201;&#20351;&#29992;&#19968;&#20010;Mutex&#36827;&#34892;&#20114;&#26021;&#25805;&#20316;</strong>&#12290;&#36825;&#26679;&#65292;&#24403;&#35843;&#35797;&#22120;&#20174;EventList&#38142;&#34920;&#20013;&#25552;&#21462;&#35843;&#35797;&#20107;&#20214;&#26102;&#65292;&#21516;&#26102;DbgkpSendApiMessage&#20989;&#25968;&#21521;EventList&#38142;&#34920;&#20889;&#20837;&#25968;&#25454;&#26102;&#20063;&#20250;&#34987;&#27491;&#30830;&#22320;&#20114;&#26021;&#12290;&#21478;&#22806;&#65292;<strong class=" ">Flags&#21442;&#25968;&#29992;&#20110;&#26631;&#35782;&#35813;&#20107;&#20214;&#26159;&#21542;&#24050;&#34987;&#35843;&#35797;&#22120;&#35835;&#21462;&#12290;</strong></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _DEBUG_OBJECT {</code></div>
<div class="line"><code class="plain">     KEVENT EventsPresent; </code><code class="comments">// 用于指示有调试事件发生的事件对象</code></div>
<div class="line"><code class="plain">     FAST_MUTEX Mutex; </code><code class="comments">// 用于同步的互斥对象</code></div>
<div class="line"><code class="plain">     LIST_ENTRY EventList; </code><code class="comments">// 保存调试事件的链表</code></div>
<div class="line"><code class="plain">     ULONG Flags; </code><code class="comments">// 标志位，调试消息是否已读取</code></div>
<div class="line"><code class="plain">} DEBUG_OBJECT, *PDEBUG_OBJECT;</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleS6i-S7tueahOWkhOeQhg">
        <h1 class="heading "><span>&#35843;&#35797;&#20107;&#20214;&#30340;&#22788;&#29702;</span></h1>
<p   
>&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20043;&#21518;&#23601;&#38656;&#35201;&#23545;&#19981;&#21516;&#30340;&#20107;&#20214;&#36827;&#34892;&#22788;&#29702;&#65292;&#25509;&#19979;&#26469;&#25105;&#20204;&#36890;&#36807;&#31243;&#24207;&#27169;&#25311;&#20004;&#31181;&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#30340;&#26041;&#24335;&#65288;&#21363;&#21019;&#24314;&#36827;&#31243;&#12289;&#38468;&#21152;&#36827;&#31243;&#65289;&#65292;&#20998;&#26512;&#35843;&#35797;&#20107;&#20214;&#30340;&#22788;&#29702;&#36807;&#31243;&#21644;&#19981;&#21516;&#35843;&#35797;&#20107;&#20214;&#30340;&#32467;&#26500;&#32454;&#33410;&#12290;</p>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeW7uueri-iwg-ivleWFs-ezu--8muWIm-W7uui_m-eoiw">
        <h2 class="heading "><span>&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#65306;&#21019;&#24314;&#36827;&#31243;</span></h2>
<p   
>&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#65292;<strong class=" ">&#25105;&#20204;&#21019;&#24314;&#20102;&#19968;&#20010;&#31616;&#26131;&#35843;&#35797;&#22120;</strong>&#65292;&#39318;&#20808;&#21019;&#24314;&#19968;&#20010;&#35843;&#35797;&#36827;&#31243;&#65288;CreateProcess&#20989;&#25968;&#31532;6&#20010;&#21442;&#25968;&#34920;&#31034;&#21019;&#24314;&#36827;&#31243;&#30340;&#26631;&#24535;&#65292;&#29992;&#20110;&#25351;&#23450;&#21019;&#24314;&#36827;&#31243;&#30340;&#34892;&#20026;&#21644;&#23646;&#24615;&#65292;&#36825;&#37324;&#30340;&#20540;&#20026;DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS&#65292;<strong class=" ">&#34920;&#31034;&#21019;&#24314;&#19968;&#20010;&#35843;&#35797;&#36827;&#31243;&#65292;&#24182;&#38480;&#21046;&#21482;&#26377;&#24403;&#21069;&#35843;&#35797;&#22120;&#21487;&#20197;&#38468;&#21152;&#21040;&#35813;&#36827;&#31243;&#36827;&#34892;&#35843;&#35797;&#65292;&#30830;&#20445;&#35843;&#35797;&#36807;&#31243;&#30340;&#29420;&#21344;&#24615;&#21644;&#23433;&#20840;&#24615;</strong>&#65289;&#65292;&#25509;&#30528;&#36827;&#20837;&#19968;&#20010;&#35843;&#35797;&#24490;&#29615;&#12290;</p>
<p   
>&#22312;&#24490;&#29615;&#20013;&#65292;&#31561;&#24453;&#35843;&#35797;&#20107;&#20214;&#30340;&#21457;&#29983;&#65292;&#22914;&#24322;&#24120;&#12289;&#32447;&#31243;&#21019;&#24314;&#12289;&#36827;&#31243;&#21019;&#24314;&#31561;&#65292;&#28982;&#21518;&#26681;&#25454;&#20855;&#20307;&#30340;&#35843;&#35797;&#20107;&#20214;&#31867;&#22411;&#36827;&#34892;&#30456;&#24212;&#30340;&#22788;&#29702;&#12290;&#22788;&#29702;&#23436;&#20107;&#20214;&#21518;&#65292;&#21578;&#35785;&#34987;&#35843;&#35797;&#31243;&#24207;&#32487;&#32493;&#25191;&#34892;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"windows.h"</code></div>
<div class="line"><code class="plain">#include </code><code class="string">"stdio.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 定义调试进程路径</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">const</code><code class="plain"> </code><code class="keyword">char</code><code class="plain">* dbgProcessName = </code><code class="string">"C:\\notepad.exe"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 创建调试进程</code></div>
<div class="line"><code class="plain">    STARTUPINFO startupInfo = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    PROCESS_INFORMATION processInfo = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">    GetStartupInfo(&amp;startupInfo);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    BOOL createProcessSuccess = CreateProcess(</code></div>
<div class="line"><code class="plain">        dbgProcessName, NULL, NULL, NULL, TRUE,</code></div>
<div class="line"><code class="plain">        DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS,</code></div>
<div class="line"><code class="plain">        NULL, NULL, &amp;startupInfo, &amp;processInfo</code></div>
<div class="line"><code class="plain">    );</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (!createProcessSuccess)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"CreateProcess error: %d\n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">        getchar();</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 调试循环</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (TRUE)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 等待调试事件</code></div>
<div class="line"><code class="plain">        DEBUG_EVENT debugEvent = {</code><code class="value">0</code><code class="plain">};</code></div>
<div class="line"><code class="plain">        BOOL waitForDebugEventSuccess = WaitForDebugEvent(&amp;debugEvent, INFINITE);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (!waitForDebugEventSuccess)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            printf(</code><code class="string">"WaitForDebugEvent error: %d\n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">        </code><code class="comments">// 处理调试事件</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">switch</code><code class="plain"> (debugEvent.dwDebugEventCode)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> EXCEPTION_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"发生异常调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> CREATE_THREAD_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"创建线程调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> CREATE_PROCESS_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"创建进程调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> EXIT_THREAD_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"退出线程调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> EXIT_PROCESS_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"退出进程调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> LOAD_DLL_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"加载DLL调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">case</code><code class="plain"> UNLOAD_DLL_DEBUG_EVENT:</code></div>
<div class="line"><code class="plain">                printf(</code><code class="string">"卸载DLL调试事件\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">            </code><code class="keyword">default</code><code class="plain">:</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">        </code><code class="comments">// 告诉被调试程序让其继续执行</code></div>
<div class="line"><code class="plain">        </code><code class="comments">/*</code></div>
<div class="line"><code class="comments">            第三个参数可以有两个值：</code></div>
<div class="line"><code class="comments">            1. DBG_CONTINUE：表示调试器已处理该异常</code></div>
<div class="line"><code class="comments">            2. DBG_EXCEPTION_NOT_HANDLED：表示调试器没有处理该异常，转回到用户态中执行，寻找可以处理该异常的异常处理器</code></div>
<div class="line"><code class="comments">        */</code></div>
<div class="line"><code class="plain">        ContinueDebugEvent(debugEvent.dwProcessId, debugEvent.dwThreadId, DBG_CONTINUE);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_21-37-57.png" alt="images/download/attachments/3440657/image2023-11-22_21-37-57.png" width="600"  />
    </p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleS6i-S7tue7k-aehA">
        <h3 class="heading "><span>&#35843;&#35797;&#20107;&#20214;&#32467;&#26500;</span></h3>
<p   
>&#22312;&#35843;&#35797;&#24490;&#29615;&#20107;&#20214;&#31561;&#24453;&#20013;&#65292;&#25105;&#20204;&#26159;&#36890;&#36807;&#32467;&#26500;&#20307;DEBUG_EVENT&#22312;WaitForDebugEvent&#20989;&#25968;&#20013;&#33719;&#21462;&#35843;&#35797;&#20107;&#20214;&#30340;&#65292;&#35813;&#32467;&#26500;&#20307;&#30340;&#23450;&#20041;&#22914;&#19979;&#12290;</p>
<p   
>&#21069;&#19977;&#20010;&#25104;&#21592;&#24456;&#22909;&#29702;&#35299;&#65292;&#26368;&#21518;&#19968;&#20010;&#25104;&#21592;&#26159;&#19968;&#20010;&#32852;&#21512;&#20307;&#65292;&#37324;&#38754;&#21253;&#21547;&#20102;&#21508;&#31181;&#32467;&#26500;&#20307;&#65292;&#36825;&#26159;&#22240;&#20026;&#35843;&#35797;&#20107;&#20214;&#31867;&#22411;&#30340;&#22810;&#26679;&#24615;&#65292;&#25152;&#20197;&#23545;&#24212;&#30340;&#32467;&#26500;&#20063;&#19981;&#21516;&#65292;&#36890;&#36807;&#36825;&#26679;&#30340;&#26041;&#24335;&#23601;&#21487;&#20197;&#26681;&#25454;&#19981;&#21516;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;&#23384;&#25918;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#20449;&#24687;&#65288;<strong class=" ">&#36825;&#20063;&#26159;&#20026;&#20160;&#20040;&#19981;&#21516;&#30340;&#35843;&#35797;&#20107;&#20214;&#26377;&#19981;&#21516;&#30340;&#35843;&#35797;&#37319;&#38598;&#20989;&#25968;</strong>&#65289;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _DEBUG_EVENT {</code></div>
<div class="line"><code class="plain">    DWORD dwDebugEventCode; </code><code class="comments">// 调试事件类型</code></div>
<div class="line"><code class="plain">    DWORD dwProcessId; </code><code class="comments">// 触发调试事件的进程ID</code></div>
<div class="line"><code class="plain">    DWORD dwThreadId; </code><code class="comments">// 触发调试事件的线程ID</code></div>
<div class="line"><code class="plain">    union { </code><code class="comments">// 联合体</code></div>
<div class="line"><code class="plain">        EXCEPTION_DEBUG_INFO Exception;</code></div>
<div class="line"><code class="plain">        CREATE_THREAD_DEBUG_INFO CreateThread;</code></div>
<div class="line"><code class="plain">        CREATE_PROCESS_DEBUG_INFO CreateProcessInfo;</code></div>
<div class="line"><code class="plain">        EXIT_THREAD_DEBUG_INFO ExitThread;</code></div>
<div class="line"><code class="plain">        EXIT_PROCESS_DEBUG_INFO ExitProcess;</code></div>
<div class="line"><code class="plain">        LOAD_DLL_DEBUG_INFO LoadDll;</code></div>
<div class="line"><code class="plain">        UNLOAD_DLL_DEBUG_INFO UnloadDll;</code></div>
<div class="line"><code class="plain">        OUTPUT_DEBUG_STRING_INFO DebugString;</code></div>
<div class="line"><code class="plain">        RIP_INFO RipInfo;</code></div>
<div class="line"><code class="plain">    } u;</code></div>
<div class="line"><code class="plain">} DEBUG_EVENT, *LPDEBUG_EVENT;</code></div>
</div>
    </div>
<p   
>&#21508;&#31867;&#35843;&#35797;&#20107;&#20214;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">// 异常类型信息</code></div>
<div class="line"><code class="plain">typedef struct _EXCEPTION_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    EXCEPTION_RECORD ExceptionRecord;</code></div>
<div class="line"><code class="plain">    DWORD dwFirstChance;</code></div>
<div class="line"><code class="plain">} EXCEPTION_DEBUG_INFO, *LPEXCEPTION_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 线程创建类型信息</code></div>
<div class="line"><code class="plain">typedef struct _CREATE_THREAD_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    LPVOID lpThreadLocalBase;</code></div>
<div class="line"><code class="plain">    LPTHREAD_START_ROUTINE lpStartAddress;</code></div>
<div class="line"><code class="plain">} CREATE_THREAD_DEBUG_INFO, *LPCREATE_THREAD_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 进程创建类型信息</code></div>
<div class="line"><code class="plain">typedef struct _CREATE_PROCESS_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    HANDLE hFile;</code></div>
<div class="line"><code class="plain">    HANDLE hProcess;</code></div>
<div class="line"><code class="plain">    HANDLE hThread;</code></div>
<div class="line"><code class="plain">    LPVOID lpBaseOfImage;</code></div>
<div class="line"><code class="plain">    DWORD dwDebugInfoFileOffset;</code></div>
<div class="line"><code class="plain">    DWORD nDebugInfoSize;</code></div>
<div class="line"><code class="plain">    LPVOID lpThreadLocalBase;</code></div>
<div class="line"><code class="plain">    LPTHREAD_START_ROUTINE lpStartAddress;</code></div>
<div class="line"><code class="plain">    LPVOID lpImageName;</code></div>
<div class="line"><code class="plain">    WORD fUnicode;</code></div>
<div class="line"><code class="plain">} CREATE_PROCESS_DEBUG_INFO, *LPCREATE_PROCESS_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 线程退出类型信息</code></div>
<div class="line"><code class="plain">typedef struct _EXIT_THREAD_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    DWORD dwExitCode;</code></div>
<div class="line"><code class="plain">} EXIT_THREAD_DEBUG_INFO, *LPEXIT_THREAD_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">//进程退出类型信息</code></div>
<div class="line"><code class="plain">typedef struct _EXIT_PROCESS_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    DWORD dwExitCode;</code></div>
<div class="line"><code class="plain">} EXIT_PROCESS_DEBUG_INFO, *LPEXIT_PROCESS_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">//模块加载类型信息</code></div>
<div class="line"><code class="plain">typedef struct _LOAD_DLL_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    HANDLE hFile;</code></div>
<div class="line"><code class="plain">    LPVOID lpBaseOfDll;</code></div>
<div class="line"><code class="plain">    DWORD dwDebugInfoFileOffset;</code></div>
<div class="line"><code class="plain">    DWORD nDebugInfoSize;</code></div>
<div class="line"><code class="plain">    LPVOID lpImageName;</code></div>
<div class="line"><code class="plain">    WORD fUnicode;</code></div>
<div class="line"><code class="plain">} LOAD_DLL_DEBUG_INFO, *LPLOAD_DLL_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// 模块卸载类型信息</code></div>
<div class="line"><code class="plain">typedef struct _UNLOAD_DLL_DEBUG_INFO {</code></div>
<div class="line"><code class="plain">    LPVOID lpBaseOfDll;</code></div>
<div class="line"><code class="plain">} UNLOAD_DLL_DEBUG_INFO, *LPUNLOAD_DLL_DEBUG_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">typedef struct _OUTPUT_DEBUG_STRING_INFO {</code></div>
<div class="line"><code class="plain">    LPSTR lpDebugStringData;</code></div>
<div class="line"><code class="plain">    WORD fUnicode;</code></div>
<div class="line"><code class="plain">    WORD nDebugStringLength;</code></div>
<div class="line"><code class="plain">} OUTPUT_DEBUG_STRING_INFO, *LPOUTPUT_DEBUG_STRING_INFO;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">typedef struct _RIP_INFO {</code></div>
<div class="line"><code class="plain">    DWORD dwError;</code></div>
<div class="line"><code class="plain">    DWORD dwType;</code></div>
<div class="line"><code class="plain">} RIP_INFO, *LPRIP_INFO;</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLemineWklueahOW8guW4uOiwg-ivleS6i-S7tg">
        <h3 class="heading "><span>&#39069;&#22806;&#30340;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;</span></h3>
<p   
>&#25105;&#20204;&#21487;&#20197;&#22312;&#19978;&#36848;&#30340;&#31616;&#26131;&#35843;&#35797;&#22120;&#35843;&#35797;&#24490;&#29615;&#21028;&#26029;&#24322;&#24120;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;&#65292;&#23558;&#24322;&#24120;&#21457;&#29983;&#30340;&#22320;&#22336;&#25171;&#21360;&#65292;&#28982;&#21518;&#36816;&#34892;&#20195;&#30721;&#65292;&#23601;&#20250;&#21457;&#29616;&#19968;&#20010;&#34987;&#35843;&#35797;&#36827;&#31243;&#19968;&#20999;&#37117;&#27491;&#24120;&#36816;&#34892;&#65292;&#20294;&#26159;&#20135;&#29983;&#20102;&#19968;&#20010;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">printf(</code><code class="string">"发生异常调试事件: %x\n"</code><code class="plain">, debugEvent.u.Exception.ExceptionRecord.ExceptionAddress);</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-49-45.png" alt="images/download/attachments/3440657/image2023-11-22_22-49-45.png" width="400"  />
    </p>
<p   
>&#24819;&#35201;&#30693;&#36947;&#36825;&#26159;&#20026;&#20160;&#20040;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;OD&#26469;&#25171;&#24320;&#34987;&#35843;&#35797;&#36827;&#31243;&#65292;&#22312;&#36825;&#20043;&#21069;&#25105;&#20204;&#21487;&#20197;&#20808;&#35774;&#32622;&#19968;&#19979;&#25171;&#24320;&#26102;&#30340;&#26242;&#20572;&#26029;&#28857;&#65292;&#30001;WinMain&#21464;&#25104;System breakpoint&#65292;&#36825;&#26679;&#23601;&#19981;&#20250;&#22312;&#36827;&#31243;&#19968;&#25171;&#24320;&#26102;&#23601;&#26029;&#19979;&#26469;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-6-29.png" alt="images/download/attachments/3440657/image2023-11-22_22-6-29.png" width="400"  />
    </p>
<p   
>&#28982;&#21518;&#25105;&#20204;&#20877;&#37325;&#26032;&#25171;&#24320;&#34987;&#35843;&#35797;&#36827;&#31243;&#65292;&#23601;&#20250;&#21457;&#29616;&#31243;&#24207;&#22312;&#25105;&#20204;&#20043;&#21069;&#32534;&#20889;&#30340;&#31616;&#26131;&#35843;&#35797;&#22120;&#25152;&#36755;&#20986;&#30340;&#21457;&#29983;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;&#22320;&#22336;&#21152;&#19968;&#30340;&#22320;&#22336;&#65288;0x7c921231&#65289;&#36827;&#34892;&#20102;&#26029;&#28857;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-7-55.png" alt="images/download/attachments/3440657/image2023-11-22_22-7-55.png" width="600"  />
    </p>
<p   
>&#31616;&#26131;&#35843;&#35797;&#22120;&#36755;&#20986;&#30340;&#22320;&#22336;&#22788;&#30340;&#25351;&#20196;&#21018;&#22909;&#26159;INT 3&#65292;&#20063;&#35777;&#26126;&#20102;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;&#26159;&#26469;&#28304;&#20110;&#27492;&#12290;&#33267;&#20110;&#20026;&#20160;&#20040;&#20250;&#31361;&#28982;&#20986;&#29616;&#36825;&#20010;&#26029;&#28857;&#65292;&#25105;&#20204;&#38656;&#35201;&#22238;&#39038;&#19968;&#19979;&#36827;&#31243;&#30340;&#21019;&#24314;&#36807;&#31243;&#65306;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-12-0.png" alt="images/download/attachments/3440657/image2023-11-22_22-12-0.png" width="400"  />
    </p>
<p   
>&#22312;&#31532;5&#27493;&#65292;&#31995;&#32479;&#21551;&#21160;&#32447;&#31243;&#36827;&#34892;DLL&#30340;&#26144;&#23556;&#26102;&#20250;&#35843;&#29992;ntdll&#27169;&#22359;&#20013;&#30340;LdrInitializeThunk&#20989;&#25968;&#65292;&#25105;&#20204;&#36319;&#36827;&#35813;&#20989;&#25968;&#30475;&#19968;&#19979;&#65292;&#22312;LdrInitializeThunk&#20989;&#25968;&#20869;&#37096;&#20250;&#35843;&#29992;_LdrpInitialize&#20989;&#25968;&#65292;<strong class=" ">&#22312;_LdrpInitialize&#20989;&#25968;&#20869;&#37096;&#20250;&#21028;&#26029;&#24403;&#21069;&#21019;&#24314;&#30340;&#26159;&#21542;&#20026;&#31532;&#19968;&#20010;&#32447;&#31243;&#65292;&#22914;&#26524;&#26159;&#23601;&#20250;&#35843;&#29992;_LdrpInitializeProcess&#20989;&#25968;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-20-13.png" alt="images/download/attachments/3440657/image2023-11-22_22-20-13.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#25105;&#20204;&#36827;&#20837;_LdrpInitializeProcess&#20989;&#25968;&#65292;&#36825;&#20010;&#20989;&#25968;&#30340;&#20869;&#23481;&#22826;&#22810;&#65292;&#25105;&#20204;&#21482;&#30475;&#20851;&#38190;&#30340;&#28857;&#12290;&#39318;&#20808;&#65292;&#36890;&#36807;&#23558;PEB&#30340;&#22320;&#22336;&#23384;&#20648;&#21040;EBX&#23492;&#23384;&#22120;&#20013;&#12290;&#25509;&#19979;&#26469;&#26816;&#26597;PEB&#32467;&#26500;&#20307;&#20013;&#20559;&#31227;&#20026;0x2&#30340;&#20301;&#32622;&#65292;&#21363;BeingDebugged&#30340;&#20540;&#26159;&#21542;&#20026;0&#12290;&#22914;&#26524;&#19981;&#31561;&#20110;0&#65292;&#23558;&#36339;&#36716;&#24182;&#35843;&#29992;&#20989;&#25968;DbgBreakPoint&#12290;<strong class=" ">DbgBreakPoint&#20989;&#25968;&#23601;&#26159;&#25191;&#34892;&#20102;INT 3&#26029;&#28857;&#12290;</strong></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-31-4.png" alt="images/download/attachments/3440657/image2023-11-22_22-31-4.png" width="600"  />
    </p>
<p   
>&#37027;&#20040;&#25105;&#20204;&#20063;&#23601;&#24471;&#20986;&#32467;&#35770;&#65292;&#22312;&#21021;&#22987;&#21270;&#36827;&#31243;&#26102;&#65292;&#20250;&#36890;&#36807;&#26816;&#26597;PEB&#20013;&#30340;BeingDebugged&#23383;&#27573;&#26469;&#21028;&#26029;&#24403;&#21069;&#36827;&#31243;&#26159;&#21542;&#27491;&#22312;&#34987;&#35843;&#35797;&#12290;&#22914;&#26524;&#24403;&#21069;&#36827;&#31243;&#27491;&#22312;&#34987;&#35843;&#35797;&#65292;&#23601;&#20250;&#20026;&#23427;&#28155;&#21152;&#19968;&#20010;INT 3&#26029;&#28857;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeW7uueri-iwg-ivleWFs-ezu--8mumZhOWKoOi_m-eoiw">
        <h2 class="heading "><span>&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#65306;&#38468;&#21152;&#36827;&#31243;</span></h2>
<p   
>&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#20462;&#25913;&#24314;&#35758;&#35843;&#35797;&#22120;&#20195;&#30721;&#20013;&#30340;&#37096;&#20998;&#20195;&#30721;&#65292;&#21363;CreateProcess&#20989;&#25968;&#30340;&#36923;&#36753;&#20462;&#25913;&#20026;DebugActiveProcess&#20989;&#25968;&#30340;&#36923;&#36753;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#23454;&#29616;&#20197;&#38468;&#21152;&#36827;&#31243;&#30340;&#26041;&#24335;&#26469;&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD PID;</code></div>
<div class="line"><code class="plain">scanf(</code><code class="string">"%d"</code><code class="plain">, &amp;PID);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (!DebugActiveProcess(PID))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"AttachProcess error:%d\n"</code><code class="plain">, GetLastError());</code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#22312;&#36825;&#36793;&#25105;&#20204;&#38656;&#35201;&#36890;&#36807;&#25163;&#21160;&#26597;&#30475;&#20219;&#21153;&#31649;&#29702;&#22120;&#30340;&#26041;&#24335;&#25214;&#21040;&#36827;&#31243;ID&#65292;&#28982;&#21518;&#22312;&#35843;&#35797;&#22120;&#20013;&#36755;&#20837;&#65292;&#20197;&#36798;&#21040;&#38468;&#21152;&#36827;&#31243;&#35843;&#35797;&#30340;&#30446;&#30340;&#12290;</p>
<p   
>&#36825;&#37324;&#25105;&#20204;&#20173;&#28982;&#20197;notepad.exe&#20026;&#20363;&#36827;&#34892;&#38468;&#21152;&#35843;&#35797;&#65292;&#20174;&#31616;&#26131;&#35843;&#35797;&#22120;&#30340;&#36755;&#20986;&#32467;&#26524;&#26469;&#30475;&#65292;&#20351;&#29992;&#38468;&#21152;&#36827;&#31243;&#26041;&#24335;&#19982;&#21019;&#24314;&#36827;&#31243;&#26041;&#24335;&#24182;&#27809;&#26377;&#20160;&#20040;&#21306;&#21035;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_22-50-13.png" alt="images/download/attachments/3440657/image2023-11-22_22-50-13.png" width="400"  />
    </p>
<p   
>&#20294;&#26159;&#25105;&#20204;&#20250;&#21457;&#29616;&#20351;&#29992;&#21019;&#24314;&#36827;&#31243;&#35843;&#35797;&#26102;&#65292;&#35302;&#21457;DLL&#21152;&#36733;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;&#12290;&#20351;&#29992;&#38468;&#21152;&#36827;&#31243;&#35843;&#35797;&#26102;&#65292;<strong class=" ">&#20063;&#21516;&#26679;&#30340;&#20250;&#20986;&#29616;DLL&#21152;&#36733;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;</strong>&#12290;</p>
<p   
>&#25353;&#29031;&#25105;&#20204;&#27491;&#24120;&#23545;&#20110;&#36827;&#31243;&#21019;&#24314;&#30340;&#29702;&#35299;&#65292;&#22312;&#21019;&#24314;&#36827;&#31243;&#21518;&#23601;&#24050;&#32463;&#23436;&#25104;&#20102;DLL&#21152;&#36733;&#65292;&#20026;&#20160;&#20040;&#22312;&#38468;&#21152;&#26102;&#21448;&#36827;&#34892;&#20102;DLL&#30340;&#21152;&#36733;&#21602;&#65311;&#20026;&#20102;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;&#25105;&#20204;&#38656;&#35201;&#26469;&#30475;&#19968;&#19979;ntoskrnl&#27169;&#22359;&#20013;&#30340;NtDebugActiveProcess&#20989;&#25968;&#12290;</p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiZmuaehOeahOWBh-a2iOaBrw">
        <h3 class="heading "><span>&#34394;&#26500;&#30340;&#20551;&#28040;&#24687;</span></h3>
<p   
>&#24403;&#25105;&#20204;&#36827;&#20837;NtDebugActiveProcess&#20989;&#25968;&#26102;&#65292;&#25105;&#20204;&#21487;&#20197;&#35266;&#23519;&#21040;&#22312;&#23558;&#34987;&#35843;&#35797;&#36827;&#31243;&#19982;&#35843;&#35797;&#23545;&#35937;&#20851;&#32852;&#20043;&#21069;&#65292;&#20250;&#35843;&#29992;&#19968;&#20010;&#21517;&#20026;_DbgkpPostFakeProcessCreateMessages&#30340;&#20989;&#25968;&#12290;</p>
<p   
>&#20174;&#23383;&#38754;&#24847;&#24605;&#29702;&#35299;&#65292;&#36825;&#20010;&#20989;&#25968;&#30340;&#30446;&#30340;&#24456;&#26126;&#26174;&#65292;&#23601;&#26159;&#21521;&#35843;&#35797;&#22120;&#21457;&#36865;&#19968;&#20123;&#34394;&#26500;&#30340;&#20551;&#28040;&#24687;&#12290;&#24182;&#19988;&#27492;&#26102;&#65292;&#34987;&#35843;&#35797;&#36827;&#31243;&#36824;&#26410;&#19982;&#35843;&#35797;&#23545;&#35937;&#20851;&#32852;&#65292;&#22240;&#27492;&#35843;&#35797;&#22120;&#26080;&#27861;&#25509;&#25910;&#26469;&#33258;&#34987;&#35843;&#35797;&#32447;&#31243;&#30340;&#20219;&#20309;&#28040;&#24687;&#12290;</p>
<p   
>&#36827;&#20837;_DbgkpPostFakeProcessCreateMessages&#20989;&#25968;&#21518;&#65292;&#25105;&#20204;&#21487;&#20197;&#21457;&#29616;&#19982;&#32447;&#31243;&#30456;&#20851;&#30340;&#34394;&#20551;&#28040;&#24687;&#20197;&#21450;&#19982;&#27169;&#22359;&#30456;&#20851;&#30340;&#34394;&#20551;&#28040;&#24687;&#37117;&#20250;&#34987;&#21457;&#36865;&#32473;&#35843;&#35797;&#22120;&#12290;&#26174;&#28982;&#65292;&#24403;&#25105;&#20204;&#36890;&#36807;&#38468;&#21152;&#36827;&#31243;&#30340;&#26041;&#24335;&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#26102;&#65292;<strong class=" ">&#30475;&#21040;&#30340;DLL&#21152;&#36733;&#35843;&#35797;&#20107;&#20214;&#30340;&#24773;&#20917;&#23454;&#38469;&#19978;&#26159;&#30001;_NtDebugActiveProcess&#20989;&#25968;&#21457;&#36865;&#32473;&#35843;&#35797;&#22120;&#30340;&#34394;&#26500;&#30340;&#20551;&#28040;&#24687;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_23-3-42.png" alt="images/download/attachments/3440657/image2023-11-22_23-3-42.png" width="600"  />
    </p>
<p   
>&#35843;&#35797;&#22120;&#20043;&#25152;&#20197;&#33021;&#22815;&#35266;&#23519;&#21040;&#34987;&#35843;&#35797;&#36827;&#31243;&#21152;&#36733;&#30340;DLL&#27169;&#22359;&#65292;&#20027;&#35201;&#26159;&#22240;&#20026;&#22312;&#27599;&#20010;&#27169;&#22359;&#21152;&#36733;&#26102;&#65292;&#35843;&#35797;&#20107;&#20214;&#37319;&#38598;&#20989;&#25968;&#20250;&#20808;&#37319;&#38598;&#36825;&#20123;&#20107;&#20214;&#65292;&#24182;&#23558;&#20854;&#21457;&#36865;&#32473;&#35843;&#35797;&#22120;&#12290;</p>
<p   
>&#36890;&#36807;&#38468;&#21152;&#36827;&#31243;&#30340;&#26041;&#24335;&#24314;&#31435;&#35843;&#35797;&#20851;&#31995;&#26102;&#65292;&#30001;&#20110;&#26080;&#27861;&#35266;&#23519;&#21040;&#36827;&#31243;&#21021;&#22987;&#21270;&#26102;&#21152;&#36733;&#30340;DLL&#27169;&#22359;&#12290;&#22240;&#27492;&#65292;&#22312;&#25191;&#34892;NtDebugActiveProcess&#20989;&#25968;&#26102;&#65292;&#21152;&#20837;&#20102;&#36825;&#20123;&#34394;&#20551;&#28040;&#24687;&#65292;&#24076;&#26395;&#20026;&#35843;&#35797;&#22120;&#25552;&#20379;&#24517;&#35201;&#30340;&#20449;&#24687;&#12290;</p>
<p   
>&#20294;&#24456;&#26174;&#28982;&#36825;&#20123;&#34394;&#20551;&#28040;&#24687;&#24182;&#19981;&#21487;&#38752;&#65292;&#22240;&#20026;&#23427;&#20204;&#20027;&#35201;&#20381;&#36182;&#20110;PEB.Ldr&#20013;&#30340;&#19977;&#20010;&#38142;&#34920;&#65288;&#24456;&#23481;&#26131;&#34987;&#20462;&#25913;&#65289;&#65292;&#36825;&#20123;&#38142;&#34920;&#20197;&#19981;&#21516;&#30340;&#39034;&#24207;&#23384;&#20648;&#20102;&#35813;&#36827;&#31243;&#21152;&#36733;&#30340;&#25152;&#26377;&#27169;&#22359;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-22_23-9-3.png" alt="images/download/attachments/3440657/image2023-11-22_23-9-3.png" width="600"  />
    </p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeW8guW4uOeahOWkhOeQhua1geeoiw">
        <h1 class="heading "><span>&#24322;&#24120;&#30340;&#22788;&#29702;&#27969;&#31243;</span></h1>
<p   
>&#22312;&#20043;&#21069;&#24322;&#24120;&#65288;&#29992;&#25143;&#24322;&#24120;&#30340;&#20998;&#21457;&#19982;&#20869;&#26680;&#24322;&#24120;&#30340;&#20998;&#21457;&#36807;&#31243;&#65289;&#31456;&#33410;&#30340;&#23398;&#20064;&#20013;&#65292;&#25105;&#20204;&#20998;&#26512;&#20102;KiDispatchException&#20989;&#25968;&#30340;&#25191;&#34892;&#27969;&#31243;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#30693;&#36947;&#22312;&#24322;&#24120;&#20998;&#21457;&#26102;&#65292;&#39318;&#20808;&#20250;&#26816;&#26597;&#35843;&#35797;&#22120;&#26159;&#21542;&#23384;&#12290;&#37027;&#20040;&#26412;&#25991;&#23558;&#22312;&#23384;&#22312;&#35843;&#35797;&#22120;&#21644;&#19981;&#23384;&#22312;&#35843;&#35797;&#22120;&#30340;&#24773;&#20917;&#19979;&#65292;&#39564;&#35777;&#24322;&#24120;&#20998;&#21457;&#30340;&#27969;&#31243;&#12290;</p>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeiwg-ivleWZqOS4i-eahOW8guW4uOWIhuWPkQ">
        <h2 class="heading "><span>&#35843;&#35797;&#22120;&#19979;&#30340;&#24322;&#24120;&#20998;&#21457;</span></h2>
<p   
>&#22312;&#24322;&#24120;&#31456;&#33410;&#30340;&#23398;&#20064;&#20013;&#65292;&#25105;&#20204;&#36890;&#36807;&#20998;&#26512;KiDispatchException&#20989;&#25968;&#30693;&#36947;&#22312;&#24322;&#24120;&#20998;&#21457;&#26102;&#20250;&#26816;&#26597;&#19968;&#19979;&#26159;&#21542;&#26377;&#20869;&#26680;&#35843;&#35797;&#22120;&#65292;&#20294;&#22312;&#24403;&#26102;&#25105;&#20204;&#24182;&#27809;&#26377;&#23398;&#20064;&#36719;&#20214;&#35843;&#35797;&#30340;&#65292;&#22240;&#27492;&#22312;&#36825;&#37324;&#25105;&#20204;&#21487;&#20197;&#21152;&#20837;&#35843;&#35797;&#26469;&#20998;&#26512;&#19968;&#19979;&#26377;&#26080;&#35843;&#35797;&#22120;&#26102;&#24322;&#24120;&#30340;&#20998;&#21457;&#27969;&#31243;&#12290;</p>
<p   
>&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#25105;&#20204;&#26500;&#24314;&#19968;&#20010;&#38500;&#38646;&#24322;&#24120;&#65292;&#30452;&#25509;&#25191;&#34892;&#30340;&#35805;&#65292;&#27491;&#24120;&#27969;&#31243;&#23601;&#20250;&#36827;&#20837;_except&#20998;&#25903;&#25191;&#34892;&#20195;&#30721;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include </code><code class="string">"stdio.h"</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> x = </code><code class="value">100</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">int</code><code class="plain"> y = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    _try</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">int</code><code class="plain"> a = x / y;</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Error"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    _except(</code><code class="value">1</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"Except"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-16-58.png" alt="images/download/attachments/3440657/image2023-11-29_22-16-58.png" width="600"  />
    </p>
<p   
>&#25509;&#30528;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;OD&#26469;&#35843;&#35797;&#35813;&#21487;&#25191;&#34892;&#25991;&#20214;&#65292;&#36825;&#37324;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#25105;&#20204;&#38656;&#35201;&#23558;OD&#35774;&#32622;&#20013;&#30340;&#24573;&#30053;&#38500;&#38646;&#24322;&#24120;&#32473;&#21462;&#28040;&#21246;&#36873;&#65292;&#22914;&#26524;&#21246;&#36873;&#19978;&#65292;OD&#35843;&#35797;&#22120;&#23601;&#20250;&#22312;&#36935;&#21040;&#38500;&#38646;&#24322;&#24120;&#26102;&#25191;&#34892;ContinueDebugEvent&#65292;&#20351;&#24471;&#34987;&#35843;&#35797;&#36827;&#31243;&#32487;&#32493;&#25191;&#34892;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-22-47.png" alt="images/download/attachments/3440657/image2023-11-29_22-22-47.png" width="400"  />
    </p>
<p   
>&#25509;&#30528;&#25105;&#20204;&#26469;&#35843;&#35797;&#65292;&#24403;&#35843;&#35797;&#22120;&#26029;&#28857;&#21040;&#38500;&#38646;&#24322;&#24120;&#26102;&#65292;&#23601;&#20250;&#21457;&#29616;&#26080;&#35770;&#25105;&#20204;&#24590;&#20040;F9&#65292;&#26029;&#28857;&#20381;&#28982;&#20572;&#30041;&#22312;&#36825;&#37324;&#65292;&#36825;&#26159;&#22240;&#20026;&#35843;&#35797;&#22120;&#24182;&#27809;&#26377;&#22788;&#29702;&#36825;&#20010;&#24322;&#24120;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-27-33.png" alt="images/download/attachments/3440657/image2023-11-29_22-27-33.png" width="600"  />
    </p>
<p   
>&#37027;&#25105;&#20204;&#23601;&#38656;&#35201;&#22312;&#36825;&#37324;&#25163;&#21160;&#20462;&#25913;&#34987;&#38500;&#25968;0&#20026;1&#65292;&#28982;&#21518;&#20877;&#27425;F9&#65292;&#23601;&#20250;&#39034;&#21033;&#30340;&#25191;&#34892;_try&#20998;&#25903;&#20869;&#30340;&#20195;&#30721;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-41-40.png" alt="images/download/attachments/3440657/image2023-11-29_22-41-40.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeacgOWQjuS4gOmBk-mYsue6v-S4juS6jOasoeWIhuWPkQ">
        <h2 class="heading "><span>&#26368;&#21518;&#19968;&#36947;&#38450;&#32447;&#19982;&#20108;&#27425;&#20998;&#21457;</span></h2>
<p   
>&#25105;&#20204;&#30693;&#36947;&#26080;&#35770;&#26159;&#36827;&#31243;&#30340;&#20837;&#21475;&#32447;&#31243;&#36824;&#26159;&#21478;&#36215;&#30340;&#32447;&#31243;&#65292;&#37117;&#20250;&#34987;&#28155;&#21152;&#30340;&#24322;&#24120;&#22788;&#29702;&#20989;&#25968;&#32473;&#22788;&#29702;&#25481;&#65292;&#36825;&#26159;&#22240;&#20026;&#25805;&#20316;&#31995;&#32479;&#28155;&#21152;&#20102;&#19968;&#36947;&#26368;&#21518;&#30340;&#38450;&#32447;&#65292;&#20854;&#20266;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">__try</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">__except(UnhandledExceptionFilter(GetExceptionInformation())</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">//终止线程</code></div>
<div class="line"><code class="plain">    </code><code class="comments">//终止进程</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>    <span style="color: #172b4d;">
&#22914;&#26524;UnhandledExceptionFilter&#20989;&#25968;&#36820;&#22238;&#20026;0&#65292;&#21363;EXCEPTION_CONTINUE_SEARCH&#65292;&#37027;&#23601;&#30495;&#30340;&#26159;&#25214;&#19981;&#21040;&#23545;&#24212;&#30340;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#20102;&#65292;&#36825;&#31181;&#24773;&#20917;&#19979;&#21482;&#26377;&#22312;&#31243;&#24207;&#34987;&#35843;&#35797;&#26102;&#25165;&#20250;&#23384;&#22312;&#12290;    </span>
</p>
<p   
>    <span style="color: #172b4d;">
&#22240;&#27492;&#25105;&#21487;&#20197;&#23558;&#38500;&#38646;&#24322;&#24120;&#20195;&#30721;&#20013;&#30340;_except(1)&#20462;&#25913;&#20026;_except(0)&#65292;&#34920;&#31034;&#27809;&#26377;&#23545;&#24212;&#30340;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#65292;&#20063;&#19981;&#21435;&#27880;&#20876;&#12290;    </span>
    <span style="color: #172b4d;">
&#25105;&#20204;&#20877;&#36890;&#36807;OD&#26469;&#35843;&#35797;&#20250;&#21457;&#29616;&#65292;<strong class=" ">&#21363;&#20351;&#25105;&#20204;&#24573;&#30053;&#20102;&#38500;&#38646;&#24322;&#24120;&#65292;&#20063;&#20173;&#28982;&#20250;&#22312;&#24322;&#24120;&#22788;&#26029;&#28857;</strong>&#12290;&#36825;&#26159;&#22240;&#20026;&#22312;&#31532;&#19968;&#27425;&#30340;&#24322;&#24120;&#20998;&#21457;&#26102;VEH&#12289;SEH&#12289;&#35843;&#35797;&#22120;&#37117;&#27809;&#26377;&#22788;&#29702;&#24322;&#24120;&#65292;&#26368;&#21518;&#19968;&#36947;&#38450;&#32447;&#20013;&#36827;&#20837;UnhandledExceptionFilter&#20989;&#25968;&#65292;&#22312;&#35813;&#20989;&#25968;&#20869;&#26816;&#27979;&#21040;&#27492;&#26102;&#23384;&#22312;&#35843;&#35797;&#22120;&#65292;&#23601;&#20250;&#36827;&#34892;&#31532;&#20108;&#27425;&#30340;&#24322;&#24120;&#20998;&#21457;&#65292;&#20063;&#23601;&#26159;&#32473;&#21040;&#35843;&#35797;&#22120;&#12290;    </span>
</p>
<p   
>    <span style="color: #172b4d;">
<img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-53-11.png" alt="images/download/attachments/3440657/image2023-11-29_22-53-11.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #172b4d;">
&#32780;&#22914;&#26524;&#27809;&#26377;&#35843;&#35797;&#22120;&#65292;&#27491;&#24120;&#25171;&#24320;&#35813;&#31243;&#24207;&#26102;&#65292;&#30001;&#20110;&#27809;&#26377;&#34987;&#35843;&#35797;&#65292;<strong class=" ">&#26368;&#21518;&#19968;&#36947;&#38450;&#32447;&#20250;&#26597;&#35810;&#24403;&#21069;&#26159;&#21542;&#26377;&#36890;&#36807;SetUnhandledExceptionFilter&#20989;&#25968;&#21435;&#27880;&#20876;&#24322;&#24120;&#22788;&#29702;&#20989;&#25968;&#65292;&#22914;&#26524;&#26377;&#23601;&#35843;&#29992;&#65292;&#27809;&#26377;&#30340;&#35805;Windows&#23601;&#20250;&#24377;&#20986;&#31383;&#21475;&#35753;&#29992;&#25143;&#36873;&#25321;&#32456;&#27490;&#31243;&#24207;&#36824;&#26159;&#21551;&#21160;&#21363;&#26102;&#35843;&#35797;&#22120;&#12290;</strong>    </span>
</p>
<p   
>    <span style="color: #172b4d;">
<img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_22-53-54.png" alt="images/download/attachments/3440657/image2023-11-29_22-53-54.png" width="400"  />
    </span>
</p>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeaAu-e7kw">
        <h2 class="heading "><span>&#24635;&#32467;</span></h2>
<p   
>    <span style="color: #172b4d;">
&#19968;&#24352;&#22270;&#26469;&#24635;&#32467;&#21253;&#21547;&#20102;&#35843;&#35797;&#22120;&#30340;&#24322;&#24120;&#22788;&#29702;&#27969;&#31243;&#12290;    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-29_23-37-8.png" alt="images/download/attachments/3440657/image2023-11-29_23-37-8.png" width="600"  />
    </p>
    </div>
    </div>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeS4ieWkp-aWreeCuQ">
        <h1 class="heading "><span>&#19977;&#22823;&#26029;&#28857;</span></h1>
<p   
>&#25152;&#35859;&#35843;&#35797;&#65292;&#20854;&#23454;&#23601;&#26159;&#22312;&#34987;&#35843;&#35797;&#36827;&#31243;&#20013;&#24819;&#27861;&#35774;&#27861;&#30340;&#21435;&#35302;&#21457;&#24322;&#24120;&#65292;&#24403;&#24322;&#24120;&#20135;&#29983;&#21518;&#65292;&#30001;&#35843;&#35797;&#22120;&#26469;&#25509;&#31649;&#24322;&#24120;&#12290;<strong class=" ">&#26377;&#19977;&#31181;&#35302;&#21457;&#24322;&#24120;&#30340;&#26041;&#27861;&#65306;&#36719;&#20214;&#26029;&#28857;&#12289;&#20869;&#23384;&#26029;&#28857;&#12289;&#30828;&#20214;&#26029;&#28857;</strong>&#12290;</p>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLei9r-S7tuaWreeCuQ">
        <h2 class="heading "><span>&#36719;&#20214;&#26029;&#28857;</span></h2>
<p   
>&#36719;&#20214;&#26029;&#28857;&#23601;&#26159;&#25105;&#20204;&#25152;&#29087;&#24713;&#30340;INT 3&#25351;&#20196;&#65292;&#36719;&#20214;&#26029;&#28857;&#30340;&#23454;&#29616;&#23601;&#26159;&#23558;&#19979;&#26029;&#28857;&#30340;&#22320;&#22336;&#22788;&#30828;&#32534;&#30721;&#25351;&#20196;&#20462;&#25913;&#20026;0xCC&#12290;</p>
<p   
>&#36825;&#37324;&#25105;&#20204;&#21487;&#20197;&#20808;&#20351;&#29992;OD&#38543;&#20415;&#19968;&#22788;&#19979;&#26029;&#28857;&#65292;&#28982;&#21518;&#31561;&#31243;&#24207;&#20572;&#22312;&#23545;&#24212;&#20301;&#32622;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#25351;&#20196;&#24182;&#27809;&#26377;&#34987;&#20462;&#25913;&#20026;INT 3&#65292;&#36825;&#26159;&#22240;&#20026;OD&#20026;&#20102;&#26356;&#22909;&#30340;&#29992;&#25143;&#20307;&#39564;&#23637;&#31034;&#30340;&#26102;&#20505;&#20445;&#30041;&#20102;&#21407;&#25351;&#20196;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-6-44.png" alt="images/download/attachments/3440657/image2023-11-30_20-6-44.png" width="600"  />
    </p>
<p   
>&#23454;&#38469;&#19978;&#25105;&#20204;&#36890;&#36807;&#20854;&#20182;&#26681;&#25454;&#26469;&#30475;&#65292;&#20363;&#22914;&#19979;&#22270;&#25152;&#31034;&#30340;CE&#65292;&#23545;&#24212;&#22320;&#22336;&#22788;&#30340;&#25351;&#20196;&#30830;&#23454;&#21464;&#25104;&#20102;INT 3&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-8-25.png" alt="images/download/attachments/3440657/image2023-11-30_20-8-25.png" width="600"  />
    </p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeaJp-ihjOa1geeoiy4x">
        <h3 class="heading "><span>&#25191;&#34892;&#27969;&#31243;</span></h3>
<p   
>&#35302;&#21457;&#36719;&#20214;&#26029;&#28857;&#30340;&#36807;&#31243;&#65292;&#23454;&#38469;&#19978;&#23601;&#26159;CPU&#24322;&#24120;&#20998;&#21457;&#30340;&#36807;&#31243;&#65306;CPU&#26816;&#27979;&#21040;&#24322;&#24120;&#65288;INT 3&#25351;&#20196;&#65289;&#65292;&#26597;&#35810;&#20013;&#26029;&#25551;&#36848;&#31526;&#34920;&#65292;&#25214;&#21040;&#23545;&#24212;&#30340;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#65288;3&#21495;&#65289;&#65292;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#20869;&#37096;&#20250;&#35843;&#29992;CommonDispatchException&#20989;&#25968;&#65292;&#22312;CommonDispatchException&#20989;&#25968;&#20869;&#37096;&#21448;&#20250;&#35843;&#29992;KiDispatchException&#20989;&#25968;&#12290;</p>
<p   
>&#36825;&#20010;&#27969;&#31243;&#25105;&#20204;&#22312;&#24322;&#24120;&#31456;&#33410;&#30340;&#23398;&#20064;&#20013;&#23601;&#24050;&#32463;&#20102;&#35299;&#20102;&#65292;&#37027;&#29616;&#22312;&#25105;&#20204;&#36827;&#20837;KiDispatchException&#20989;&#25968;&#20869;&#65292;&#20043;&#21069;&#22312;&#24322;&#24120;&#31456;&#33410;&#30340;&#23398;&#20064;&#26102;&#20998;&#26512;&#36807;&#36825;&#20010;&#20989;&#25968;&#65292;&#36825;&#37324;&#25105;&#20204;&#20165;&#25991;&#23383;&#25551;&#36848;&#19968;&#19979;&#27969;&#31243;&#65292;&#19981;&#20877;&#37325;&#22797;&#30340;&#25130;&#22270;&#35299;&#37322;&#12290;</p>
<p   
>&#30001;&#20110;&#24403;&#21069;&#24322;&#24120;&#26469;&#33258;&#29992;&#25143;&#31354;&#38388;&#65292;&#25152;&#20197;&#25105;&#20204;&#30452;&#25509;&#30475;&#29992;&#25143;&#24322;&#24120;&#30340;&#22788;&#29702;&#27969;&#31243;&#65292;<strong class=" ">&#36825;&#37324;    <span style="color: #172b4d;">
&#19981;&#31649;&#26377;&#27809;&#26377;&#20869;&#26680;&#35843;&#35797;&#22120;&#65292;&#25110;&#20869;&#26680;&#35843;&#35797;&#22120;&#20989;&#25968;&#36820;&#22238;&#32467;&#26524;&#20026;0    </span>
&#65292;&#37117;&#20250;&#36339;&#36716;&#21040;&#22914;&#19979;&#22270;&#25152;&#31034;&#30340;&#20195;&#30721;&#29255;&#27573;</strong>&#65292;&#28982;&#21518;&#35843;&#29992;_DbgkForwardException&#20989;&#25968;&#65292;&#23558;&#24322;&#24120;&#21457;&#36865;&#32473;3&#29615;&#35843;&#35797;&#22120;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-24-19.png" alt="images/download/attachments/3440657/image2023-11-30_20-24-19.png" width="600"  />
    </p>
<p   
>&#22312;_DbgkForwardException&#20989;&#25968;&#20869;&#65292;&#26368;&#32456;&#20250;&#35843;&#29992;_DbgkpSendApiMessage&#20989;&#25968;&#65292;&#36825;&#20010;&#20989;&#25968;&#25105;&#20204;&#22312;&ldquo;&#35843;&#35797;&#20107;&#20214;&#30340;&#37319;&#38598;&rdquo;&#31687;&#30340;&#23398;&#20064;&#20013;&#24050;&#32463;&#20102;&#35299;&#65292;&#23427;&#30340;&#20316;&#29992;&#23601;&#26159;&#23558;&#24050;&#21019;&#24314;&#30340;&#35843;&#35797;&#20107;&#20214;&#21457;&#36865;&#21040;&#35843;&#35797;&#23545;&#35937;&#30340;&#20107;&#20214;&#38142;&#34920;&#20013;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-32-51.png" alt="images/download/attachments/3440657/image2023-11-30_20-32-51.png"  height="185" />
    </p>
<p   
>&#36827;&#20837;_DbgkpSendApiMessage&#20989;&#25968;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#23427;&#31435;&#21051;&#23601;&#21028;&#26029;&#20102;&#20256;&#36882;&#36807;&#26469;&#30340;&#31532;&#20108;&#20010;&#21442;&#25968;&#26159;&#21542;&#20026;0&#65292;&#22914;&#26524;&#19981;&#20026;0&#65292;&#21017;&#20250;&#35843;&#29992;_DbgkpSuspendProcess&#20989;&#25968;&#23558;&#24403;&#21069;&#36827;&#31243;&#65288;&#34987;&#35843;&#35797;&#36827;&#31243;&#65289;&#20869;&#38500;&#24403;&#21069;&#32447;&#31243;&#22806;&#30340;&#20854;&#20182;&#32447;&#31243;&#25346;&#36215;&#65292;&#24403;&#21069;&#20363;&#23376;&#20013;&#30340;INT 3&#24341;&#36215;&#30340;&#24322;&#24120;&#23601;&#20250;&#34987;&#25346;&#36215;&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-38-35.png" alt="images/download/attachments/3440657/image2023-11-30_20-38-35.png" width="600"  />
    </p>
<p   
>    <span style="color: #000000;">
&#22312;&#25346;&#36215;&#21518;&#65292;&#35843;&#35797;&#20107;&#20214;&#20250;&#34987;&#21457;&#36865;&#32473;&#35843;&#35797;&#23545;&#35937;&#65292;&#24182;&#22312;&#35843;&#35797;&#24490;&#29615;&#20013;&#34987;&#35843;&#35797;&#22120;&#25552;&#21462;&#12290;&#35843;&#35797;&#22120;&#23558;&#20351;&#29992;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;&#30340;&#32467;&#26500;&#20307;&#65292;&#21015;&#20986;&#30456;&#20851;&#20449;&#24687;&#65292;&#20363;&#22914;&#24403;&#21069;&#23492;&#23384;&#22120;&#30340;&#20540;&#21644;&#20869;&#23384;&#24773;&#20917;&#12290;&#28982;&#21518;&#65292;&#35843;&#35797;&#22120;&#30340;&#29992;&#25143;&#21487;&#20197;&#23545;&#36825;&#20123;&#20449;&#24687;&#36827;&#34892;&#22788;&#29702;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#24635;&#20307;&#27969;&#31243;&#21487;&#20197;&#21442;&#32771;&#19979;&#22270;&#65306;    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-11-30_20-49-7.png" alt="images/download/attachments/3440657/image2023-11-30_20-49-7.png" width="600"  />
    </p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWunumqjOS7o-eggQ">
        <h3 class="heading "><span>&#23454;&#39564;&#20195;&#30721;</span></h3>
<p   
>&#21018;&#21018;&#25105;&#20204;&#26159;&#20174;&#19968;&#20010;&#34987;&#35843;&#35797;&#22120;&#35282;&#24230;&#20102;&#35299;&#36719;&#20214;&#26029;&#28857;&#30340;&#25191;&#34892;&#27969;&#31243;&#65292;&#37027;&#20040;&#20174;&#35843;&#35797;&#22120;&#35282;&#24230;&#21448;&#22914;&#20309;&#21435;&#23454;&#29616;&#36719;&#20214;&#26029;&#28857;&#65292;&#36825;&#20540;&#24471;&#25105;&#20204;&#21435;&#20851;&#27880;&#12290;&#39318;&#20808;&#22312;&#36825;&#37324;&#65292;&#20026;&#20102;&#23454;&#29616;&#36719;&#20214;&#26029;&#28857;&#21151;&#33021;&#65292;&#38656;&#35201;&#25163;&#21160;&#32534;&#20889;&#19968;&#20010;SetInt3BreakPoint&#20989;&#25968;&#65292;&#20855;&#20307;&#23454;&#29616;&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;&#22788;&#29702;&#21019;&#24314;&#36827;&#31243;&#35843;&#35797;&#20107;&#20214;&#26102;&#65292;&#19979;&#35813;&#26029;&#28857;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VOID SetInt3BreakPoint(PCHAR pAddress)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    CHAR cInt3 = </code><code class="value">0xCC</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 备份原始代码</code></div>
<div class="line"><code class="plain">    ReadProcessMemory(hDebugeeProcess, pAddress, &amp;OriginalCode, </code><code class="value">1</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 设置软件断点</code></div>
<div class="line"><code class="plain">    WriteProcessMemory(hDebugeeProcess, pAddress, &amp;cInt3, </code><code class="value">1</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25509;&#30528;&#25105;&#20204;&#38656;&#35201;&#19968;&#20010;INT 3&#36719;&#20214;&#26029;&#28857;&#30340;&#22788;&#29702;&#20989;&#25968;&#65292;&#19979;&#38754;&#20165;&#21015;&#20986;&#30456;&#20851;&#20195;&#30721;&#65292;&#20854;&#27599;&#19968;&#27493;&#30340;&#24847;&#20041;&#22914;&#19979;&#65306;</p>
<ol class=" "><li class=" "><p   
>&#30001;&#20110;&#36719;&#20214;&#26029;&#28857;&#20250;&#20462;&#25913;&#21407;&#25351;&#20196;&#65292;&#22240;&#27492;<strong class=" ">&#22312;&#37325;&#26032;&#25191;&#34892;&#20043;&#21069;&#38656;&#35201;&#24674;&#22797;&#21407;&#30828;&#32534;&#30721;&#25351;&#20196;</strong>&#12290;&#22312;&#36825;&#37324;&#21028;&#26029;&#20102;&#24403;&#21069;&#30340;INT 3&#25351;&#20196;&#26159;&#21542;&#20026;&#31995;&#32479;&#26029;&#28857;&#65292;&#22914;&#26524;&#26159;&#31995;&#32479;&#26029;&#28857;&#65292;&#21017;&#26080;&#38656;&#20462;&#22797;&#12290;IsSystemInt3&#20989;&#25968;&#38656;&#35201;&#33258;&#34892;&#23454;&#29616;&#12290;&#22914;&#26524;&#19981;&#26159;&#31995;&#32479;&#26029;&#28857;&#21017;&#36890;&#36807;&#35843;&#35797;&#20107;&#20214;&#26469;&#33719;&#21462;&#23545;&#24212;&#30340;&#24322;&#24120;&#22320;&#22336;&#65292;&#28982;&#21518;&#23558;&#21407;&#25351;&#20196;&#20889;&#20837;&#22238;&#21435;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#26174;&#31034;&#26029;&#28857;&#22320;&#22336;</strong>&#65292;&#20415;&#20110;&#20351;&#29992;&#32773;&#26356;&#28165;&#26224;&#30340;&#30693;&#36947;&#24403;&#21069;&#34892;&#20026;&#25152;&#22312;&#20301;&#32622;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#33719;&#21462;&#32447;&#31243;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;</strong>&#65292;&#19968;&#26086;&#33719;&#24471;&#20102;&#32447;&#31243;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#65292;&#23601;&#21487;&#20197;&#33719;&#21462;&#24403;&#21069;&#29366;&#24577;&#19979;&#21508;&#20010;&#23492;&#23384;&#22120;&#30340;&#20540;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#20462;&#22797;EIP&#23492;&#23384;&#22120;&#30340;&#20540;</strong>&#65292;&#26159;&#23545;&#20110;&#19981;&#21516;&#31867;&#22411;&#30340;&#26029;&#28857;&#65292;&#22312;&#26029;&#28857;&#35302;&#21457;&#21518;&#65292;EIP&#23492;&#23384;&#22120;&#30340;&#20301;&#32622;&#20250;&#26377;&#25152;&#19981;&#21516;&#12290;&#23545;&#20110;&#36719;&#20214;&#26029;&#28857;IN T3&#26469;&#35828;&#65292;&#26029;&#28857;&#35302;&#21457;&#21518;&#65292;EIP&#20301;&#20110;&#21407;&#22987;&#22320;&#22336;&#30340;&#19979;&#19968;&#20010;&#23383;&#33410;&#20301;&#32622;&#65292;&#22240;&#27492;&#38656;&#35201;&#23558;EIP&#20943;&#21435;1&#26469;&#20462;&#22797;&#23427;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#26174;&#31034;&#21453;&#27719;&#32534;&#20195;&#30721;</strong>&#65292;&#22312;&#24120;&#35268;&#35843;&#35797;&#22120;&#20013;&#65292;&#33021;&#22815;&#23454;&#26102;&#26597;&#30475;&#31243;&#24207;&#30340;&#21453;&#27719;&#32534;&#20195;&#30721;&#33267;&#20851;&#37325;&#35201;&#12290;&#22240;&#27492;&#65292;&#22312;&#35302;&#21457;&#26029;&#28857;&#21518;&#65292;&#33267;&#23569;&#35201;&#26174;&#31034;&#26029;&#28857;&#21608;&#22260;&#30340;&#21453;&#27719;&#32534;&#20195;&#30721;&#12290;&#29992;&#25143;&#30693;&#36947;&#30340;&#20449;&#24687;&#36234;&#22810;&#33258;&#28982;&#23545;&#35843;&#35797;&#23601;&#36234;&#26377;&#24110;&#21161;&#12290;</p>
</li><li class=" "><p   
><strong class=" ">&#31561;&#24453;&#29992;&#25143;&#21629;&#20196;</strong>&#65292;&#35843;&#35797;&#22120;&#30340;&#26368;&#20027;&#35201;&#30340;&#20316;&#29992;&#23601;&#26159;&#21487;&#20197;&#23545;&#20195;&#30721;&#36827;&#34892;&#35843;&#35797;&#65292;&#21253;&#25324;&#20294;&#19981;&#38480;&#20110;&#21333;&#27493;&#25191;&#34892;&#12289;&#36880;&#34892;&#25191;&#34892;&#12289;&#32487;&#32493;&#25191;&#34892;&#31561;&#25805;&#20316;&#12290;&#22312;&#36825;&#37324;&#65292;&#36890;&#36807;&#19968;&#20010;&#24490;&#29615;&#26469;&#31561;&#24453;&#29992;&#25143;&#25191;&#34892;&#21629;&#20196;&#65292;&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#25191;&#34892;&#21629;&#20196;&#65292;&#23601;&#19968;&#30452;&#31561;&#24453;&#19979;&#21435;&#12290;WaitForUserCommand&#20989;&#25968;&#38656;&#35201;&#33258;&#34892;&#23454;&#29616;&#65292;&#22312;&#21518;&#32493;&#21333;&#27493;&#23398;&#20064;&#26102;&#20505;&#20250;&#20102;&#35299;&#21040;&#12290;</p>
</li></ol>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL Int3ExceptionProc(EXCEPTION_DEBUG_INFO* pExceptionInfo)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    BOOL bRet = FALSE;</code></div>
<div class="line"><code class="plain">    CONTEXT Context;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 如果是系统断点，不需要修复INT3</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (IsSystemInt3(pExceptionInfo))</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> TRUE;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        WriteProcessMemory(hDebugeeProcess, pExceptionInfo-&gt;ExceptionRecord.ExceptionAddress, &amp;OriginalCode, </code><code class="value">1</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 显示断点位置</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"INT3断点地址: 0x%p \n"</code><code class="plain">, pExceptionInfo-&gt;ExceptionRecord.ExceptionAddress);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 获取线程上下文</code></div>
<div class="line"><code class="plain">    Context.ContextFlags = CONTEXT_FULL | CONTEXT_DEBUG_REGISTERS;</code></div>
<div class="line"><code class="plain">    GetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 修复EIP</code></div>
<div class="line"><code class="plain">    Context.Eip--;</code></div>
<div class="line"><code class="plain">    SetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 显示反汇编</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 6. 等待用户命令</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (!bRet)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        bRet = WaitForUserCommand();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> bRet;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWGheWtmOaWreeCuQ">
        <h2 class="heading "><span>&#20869;&#23384;&#26029;&#28857;</span></h2>
<p   
>&#36719;&#20214;&#26029;&#28857;&#20462;&#25913;&#30340;&#26159;&#25351;&#20196;&#65292;&#20869;&#23384;&#26029;&#28857;&#20462;&#25913;&#30340;&#26159;&#29289;&#29702;&#39029;&#30340;&#23646;&#24615;&#12290;&#20363;&#22914;&#24403;&#26576;&#19968;&#22320;&#22336;&#65292;&#19979;&#20102;&#20869;&#23384;&#26029;&#28857;&#65292;&#24403;&#35813;&#22320;&#22336;&#34987;&#35835;&#21462;&#12289;&#20889;&#20837;&#26102;&#37117;&#20250;&#26029;&#19979;&#26469;&#12290;&#35843;&#35797;&#22120;&#36827;&#31243;&#36890;&#36807;&#35843;&#29992;VirtualProtectEx&#20989;&#25968;&#26469;&#36328;&#36827;&#31243;&#23545;&#34987;&#35843;&#35797;&#36827;&#31243;&#29289;&#29702;&#39029;&#23646;&#24615;&#36827;&#34892;&#20462;&#25913;&#12290;</p>
<p   
>VirtualProtectEx&#20989;&#25968;&#30340;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65292;&#20854;&#20013;&#38656;&#35201;&#20851;&#27880;&#30340;&#26159;flNewProtect&#21442;&#25968;&#65292;&#35813;&#21442;&#25968;&#21462;&#20915;&#23450;&#20102;&#20462;&#25913;&#30340;&#29289;&#29702;&#39029;&#30340;&#26032;&#23646;&#24615;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL VirtualProtectEx(</code></div>
<div class="line"><code class="plain">    HANDLE hProcess,            </code><code class="comments">// 要修改内存的进程句柄</code></div>
<div class="line"><code class="plain">    LPVOID lpAddress,           </code><code class="comments">// 要修改内存的起始地址</code></div>
<div class="line"><code class="plain">    SIZE_T dwSize,              </code><code class="comments">// 页区域大小</code></div>
<div class="line"><code class="plain">    DWORD flNewProtect,         </code><code class="comments">// 新物理页属性</code></div>
<div class="line"><code class="plain">    PDWORD lpflOldProtect       </code><code class="comments">// 原物理页属性，用于保存改变前的属性</code></div>
<div class="line"><code class="plain">)</code></div>
</div>
    </div>
<p   
>&#36825;&#36793;&#25105;&#20204;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#30001;&#20110;VirtualProtectEx&#20989;&#25968;&#20462;&#25913;&#30340;&#24182;&#19981;&#26159;&#26576;&#19968;&#22320;&#22336;&#30340;&#23646;&#24615;&#65292;&#32780;&#26159;&#22320;&#22336;&#25152;&#22312;&#29289;&#29702;&#39029;&#30340;&#23646;&#24615;&#65292;<strong class=" ">&#22240;&#27492;&#22312;&#23545;&#24212;&#29289;&#29702;&#39029;&#20869;&#30340;&#22320;&#22336;&#37117;&#26377;&#21487;&#33021;&#20986;&#29616;&#24322;&#24120;&#65292;&#25152;&#20197;&#23601;&#38656;&#35201;&#35843;&#35797;&#22120;&#21435;&#21028;&#26029;&#25509;&#25910;&#21040;&#30340;&#35843;&#35797;&#20107;&#20214;&#20013;&#30340;&#23545;&#24212;&#22320;&#22336;&#26159;&#21542;&#26159;&#19979;&#20869;&#23384;&#26029;&#28857;&#30340;&#22320;&#22336;&#65292;&#22914;&#26524;&#19981;&#26159;&#30340;&#35805;&#23601;&#24212;&#35813;&#25918;&#34892;</strong>&#12290;</p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeaJp-ihjOa1geeoiy4y">
        <h3 class="heading "><span>&#25191;&#34892;&#27969;&#31243;</span></h3>
<p   
>&#19979;&#23436;&#20869;&#23384;&#26029;&#28857;&#21518;&#65292;&#24403;&#34987;&#35843;&#35797;&#36827;&#31243;&#35797;&#22270;&#35775;&#38382;&#25110;&#20889;&#20837;&#34987;&#20462;&#25913;&#23646;&#24615;&#21518;&#30340;&#29289;&#29702;&#39029;&#26102;&#65292;&#23601;&#20250;&#35302;&#21457;&#39029;&#24322;&#24120;&#12290;&#28982;&#21518;&#23601;&#36827;&#34892;&#20102;&#24322;&#24120;&#30340;&#22788;&#29702;&#27969;&#31243;&#65306;</p>
<ol class=" "><li class=" "><p   
>CPU&#35775;&#38382;&#25110;&#20889;&#20837;&#35775;&#38382;&#25110;&#20889;&#20837;&#34987;&#20462;&#25913;&#23646;&#24615;&#21518;&#30340;&#29289;&#29702;&#39029;&#65292;&#35302;&#21457;&#39029;&#24322;&#24120;&#65307;</p>
</li><li class=" "><p   
>&#26597;IDT&#34920;&#25214;&#21040;&#23545;&#24212;&#30340;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#65288;&#36825;&#37324;&#39029;&#24322;&#24120;&#26159;0x0E&#21495;&#20013;&#26029;&#65289;&#65307;</p>
</li><li class=" "><p   
>&#35843;&#29992;CommonDispatchException&#20989;&#25968;&#65307;</p>
</li><li class=" "><p   
>&#35843;&#29992;KiDispatchException&#20989;&#25968;&#65307;</p>
</li><li class=" "><p   
>&#36827;&#20837;DbgkForwardException&#20989;&#25968;&#65292;&#25910;&#38598;&#35843;&#35797;&#20107;&#20214;&#24182;&#21457;&#36865;&#32473;&#35843;&#35797;&#23545;&#35937;&#65307;</p>
</li><li class=" "><p   
>&#26368;&#21518;&#20132;&#32473;&#35843;&#35797;&#22120;&#26469;&#22788;&#29702;&#12290;</p>
</li></ol><p   
>&#36825;&#20010;&#27969;&#31243;&#20854;&#23454;&#36319;&#36719;&#20214;&#26029;&#28857;&#30340;&#27969;&#31243;&#24046;&#19981;&#22810;&#65292;&#22240;&#27492;&#23601;&#19981;&#24517;&#20877;&#37325;&#22797;&#30340;&#21435;&#36319;&#36827;&#20195;&#30721;&#20102;&#12290;</p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWunumqjOS7o-eggS4x">
        <h3 class="heading "><span>&#23454;&#39564;&#20195;&#30721;</span></h3>
<p   
>&#20174;&#35843;&#35797;&#22120;&#35282;&#24230;&#65292;&#25105;&#20204;&#31532;&#19968;&#27493;&#20173;&#28982;&#26159;&#35201;&#19979;&#26029;&#28857;&#65292;&#22312;&#22788;&#29702;&#21019;&#24314;&#36827;&#31243;&#35843;&#35797;&#20107;&#20214;&#26102;&#65292;&#36873;&#25321;&#35201;&#19979;&#30340;&#26029;&#28857;&#31867;&#22411;&#65292;&#20197;&#19979;&#21482;&#26159;&#31034;&#20363;&#20195;&#30721;&#65292;&#20855;&#20307;&#30340;&#35201;&#26681;&#25454;&#19981;&#21516;&#30340;&#38656;&#27714;&#36827;&#34892;&#20998;&#25903;&#30340;&#21028;&#26029;&#21644;&#35843;&#25972;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VOID SetMemBreakPoint(PCHAR pAddress)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    DWORD dwOriginalProtect; </code><code class="comments">// 保存原物理页属性</code></div>
<div class="line"><code class="plain">    SIZE_T dwSize = </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置访问断点</code></div>
<div class="line"><code class="plain">    VirtualProtectEx(hDebugeeProcess, pAddress, dwSize, PAGE_NOACCESS, &amp;dwOriginalProtect);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置写入断点</code></div>
<div class="line"><code class="plain">    VirtualProtectEx(hDebugeeProcess, pAddress, dwSize, PAGE_EXECUTE_READ, &amp;dwOriginalProtect);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#24403;&#24322;&#24120;&#35302;&#21457;&#20043;&#21518;&#65292;&#35843;&#35797;&#22120;&#20250;&#25910;&#21040;&#24322;&#24120;&#35843;&#35797;&#20107;&#20214;&#65292;&#22240;&#27492;&#23601;&#38656;&#35201;&#21028;&#26029;&#35843;&#35797;&#20107;&#20214;&#30340;&#31867;&#22411;&#65292;&#24322;&#24120;&#31867;&#22411;&#30340;&#35843;&#35797;&#20107;&#20214;&#32467;&#26500;&#20307;&#20026;_EXCEPTION_DEBUG_INFO&#65288;&#35843;&#35797;&#24490;&#29615;&#26102;&#21363;&#21487;&#33719;&#21462;&#65306;_DEBUG_EVENT.u.Exception&#65289;&#65292;&#35813;&#32467;&#26500;&#20307;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;&#20026;ExceptionRecord&#65292;&#20854;&#20063;&#26159;&#19968;&#20010;&#32467;&#26500;&#20307;EXCEPTION_RECORD&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">typedef struct _EXCEPTION_RECORD {</code></div>
<div class="line"><code class="plain">    DWORD ExceptionCode;</code></div>
<div class="line"><code class="plain">    DWORD ExceptionFlags;</code></div>
<div class="line"><code class="plain">    struct _EXCEPTION_RECORD *ExceptionRecord;</code></div>
<div class="line"><code class="plain">    PVOID ExceptionAddress;</code></div>
<div class="line"><code class="plain">    DWORD NumberParameters;</code></div>
<div class="line"><code class="plain">    UINT_PTR ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];</code></div>
<div class="line"><code class="plain">} EXCEPTION_RECORD;</code></div>
</div>
    </div>
<p   
>&#22312;&#35813;&#32467;&#26500;&#20307;&#20013;    <span style="color: #000000;">
ExceptionCode&#25104;&#21592;&#34920;&#31034;&#24322;&#24120;&#30340;&#31867;&#22411;&#65292;&#31867;&#22411;&#26377;&#24456;&#22810;&#31181;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;STATUS_ACCESS_VIOLATION&#65288;0xC0000005&#65292;&#34920;&#31034;&#35775;&#38382;&#36829;&#20363;&#65289;&#36825;&#23601;&#26159;&#20869;&#23384;&#26029;&#28857;&#24341;&#21457;&#30340;&#24322;&#24120;&#31867;&#22411;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-12-1_17-45-54.png" alt="images/download/attachments/3440657/image2023-12-1_17-45-54.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22240;&#27492;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;switch&#20998;&#25903;&#26469;&#21028;&#26029;&#24322;&#24120;&#31867;&#22411;&#65292;&#20174;&#32780;&#36827;&#19968;&#27493;&#30340;&#22788;&#29702;&#30456;&#20851;&#24322;&#24120;&#24341;&#36215;&#30340;&#26029;&#28857;&#12290;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">swtich(pExceptionInfo-&gt;ExceptionRecord.ExceptionCode)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 软件断点（异常断点）</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> STATUS_BREAKPOINT:</code></div>
<div class="line"><code class="plain">        bRet = Int3ExceptionProc(pExceptionInfo);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 内存断点（访问违例）</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">case</code><code class="plain"> STATUS_ACCESS_VIOLATION:</code></div>
<div class="line"><code class="plain">        bRet = AccessExceptionProc(pExceptionInfo);</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#25509;&#30528;&#25105;&#20204;&#23601;&#38656;&#35201;&#22788;&#29702;&#20869;&#23384;&#26029;&#28857;&#20102;&#65292;&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#65292;&#36825;&#37324;&#30340;&#36923;&#36753;&#36319;&#36719;&#20214;&#26029;&#28857;&#30340;&#22788;&#29702;&#36923;&#36753;&#24046;&#19981;&#22810;&#65292;&#21807;&#19968;&#30340;&#21306;&#21035;&#23601;&#26159;&#31532;&#19968;&#27493;&#33719;&#21462;&#24322;&#24120;&#20449;&#24687;&#65292;&#22312;ExceptionRecord&#32467;&#26500;&#20307;&#20013;&#65292;&#26377;&#19968;&#20010;&#25968;&#32452;ExceptionInformation&#65292;&#26681;&#25454;MSDN Library&#30340;&#35828;&#26126;&#65292;&#35813;&#25968;&#32452;&#31532;&#19968;&#20010;&#25104;&#21592;&#29992;&#20110;&#34920;&#31034;&#24322;&#24120;&#30340;&#21407;&#22240;&#65288;&#20540;&#20026;0&#34920;&#31034;&#26377;&#32447;&#31243;&#35797;&#22270;&#35835;&#21462;&#65292;&#20540;&#20026;1&#34920;&#31034;&#26377;&#32447;&#31243;&#35797;&#22270;&#20889;&#20837;&#65289;&#12290;&#35813;&#25968;&#32452;&#31532;&#20108;&#20010;&#25104;&#21592;&#29992;&#20110;&#26631;&#35782;&#23548;&#33268;&#24322;&#24120;&#30340;&#34394;&#25311;&#22320;&#22336;&#12290;<strong class=" ">&#30001;&#20110;&#20869;&#23384;&#26029;&#28857;&#26159;&#38024;&#23545;&#25972;&#20010;&#29289;&#29702;&#39029;&#35774;&#32622;&#30340;&#65292;&#22240;&#27492;&#35302;&#21457;&#24322;&#24120;&#30340;&#20301;&#32622;&#21487;&#33021;&#19981;&#26159;&#25105;&#20204;&#35774;&#32622;&#26029;&#28857;&#30340;&#23454;&#38469;&#20301;&#32622;&#12290;&#22240;&#27492;&#65292;&#22312;&#27492;&#22788;&#36890;&#36807;&#31532;&#20108;&#20010;&#25104;&#21592;&#23545;&#22320;&#22336;&#36827;&#34892;&#26816;&#26597;&#65292;&#20197;&#30830;&#23450;&#26159;&#21542;&#20026;&#25105;&#20204;&#35774;&#32622;&#26029;&#28857;&#30340;&#20301;&#32622;&#12290;</strong>&#22914;&#26524;&#19981;&#26159;&#65292;&#21017;&#30452;&#25509;&#32487;&#32493;&#25191;&#34892;&#65292;&#22914;&#26524;&#26159;&#65292;&#21017;&#36827;&#34892;&#30456;&#24212;&#22788;&#29702;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL AccessExceptionProc(EXCEPTION_DEBUG_INFO* pExceptionInfo)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    BOOL bRet = FALSE;</code></div>
<div class="line"><code class="plain">    CONTEXT Context;</code></div>
<div class="line"><code class="plain">    DWORD dwAccessFlag;</code></div>
<div class="line"><code class="plain">    DWORD dwAccessAddr;</code></div>
<div class="line"><code class="plain">    DWORD dwUnused;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取异常信息，修改内存属性</code></div>
<div class="line"><code class="plain">    dwAccessFlag = pExceptionInfo-&gt;ExceptionRecord.ExceptionInformation[</code><code class="value">0</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    dwAccessAddr = pExceptionInfo-&gt;ExceptionRecord.ExceptionInformation[</code><code class="value">1</code><code class="plain">];</code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"内存断点 %x 0x%p\n"</code><code class="plain">, dwAccessFlag, dwAccessAddr);</code></div>
<div class="line"><code class="plain">    VirtualProtectEx(hDebugeeProcess, (PVOID)dwAccessAddr, </code><code class="value">1</code><code class="plain">, dwOriginalProtect, &amp;dwUnused);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 获取线程上下文</code></div>
<div class="line"><code class="plain">    Context.ContextFlags = CONTEXT_FULL | CONTEXT_DEBUG_REGISTERS;</code></div>
<div class="line"><code class="plain">    GetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 修复EIP，内存断点不需要修复EIP，软件断点需要</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 4. 显示反汇编</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="comments">// 5. 等待用户命令</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (bRet == FALSE)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        bRet = WaitForUserCommand();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> bRet;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeehrOS7tuaWreeCuQ">
        <h2 class="heading "><span>&#30828;&#20214;&#26029;&#28857;</span></h2>
<p   
>&#23545;&#20110;&#36719;&#20214;&#26029;&#28857;&#65292;&#21487;&#20197;&#20351;&#29992;CRC&#26657;&#39564;&#26469;&#36827;&#34892;&#26816;&#27979;&#65307;&#23545;&#20110;&#20869;&#23384;&#26029;&#28857;&#65292;&#21487;&#20197;&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#26469;&#19981;&#26029;&#21047;&#26032;PTE&#30340;&#23646;&#24615;&#65292;&#20197;&#38450;&#27490;&#20854;&#34987;&#20462;&#25913;&#12290;<strong class=" ">&#32780;&#26412;&#31687;&#35201;&#20171;&#32461;&#30340;&#30828;&#20214;&#26029;&#28857;&#27604;&#36739;&#38590;&#20197;&#38450;&#33539;&#65292;&#22240;&#20026;&#20854;&#19981;&#20381;&#36182;&#20110;&#20462;&#25913;&#34987;&#35843;&#35797;&#36827;&#31243;&#30340;&#25968;&#25454;&#65292;&#25152;&#20197;&#20063;&#20540;&#24471;&#25105;&#20204;&#28145;&#20837;&#23398;&#20064;&#12290;</strong></p>
<p   
>&#30828;&#20214;&#26029;&#28857;&#30340;&#23454;&#29616;&#38656;&#35201;&#20351;&#29992;&#35843;&#35797;&#23492;&#23384;&#22120;DR0&#21040;DR7&#65292;&#23427;&#20204;&#30340;&#32467;&#26500;&#22914;&#19979;&#65306;</p>
<p   
>Dr0-3&#29992;&#20110;&#35774;&#32622;&#30828;&#20214;&#26029;&#28857;&#65292;&#20063;&#23601;&#26159;&#23384;&#20648;&#23545;&#24212;&#30340;&#32447;&#24615;&#22320;&#22336;&#65292;&#30001;&#20110;&#21482;&#26377;4&#20010;&#26029;&#28857;&#23492;&#23384;&#22120;&#65292;&#25152;&#20197;&#26368;&#22810;&#21482;&#33021;&#35774;&#32622;4&#20010;&#30828;&#20214;&#35843;&#35797;&#26029;&#28857;&#12290;Dr4-5&#26159;&#20445;&#30041;&#30340;&#65292;&#25105;&#20204;&#21487;&#20197;&#19981;&#29992;&#30475;&#12290;</p>
<p   
>Dr7&#26159;&#26368;&#37325;&#35201;&#30340;&#23492;&#23384;&#22120;&#65292;&#23427;&#25511;&#21046;&#30528;&#26029;&#28857;&#30340;&#21508;&#31867;&#23646;&#24615;&#65292;&#26377;&#24456;&#22810;&#20010;&#20301;&#65292;&#27599;&#20301;&#30340;&#24847;&#24605;&#22914;&#19979;&#65288;<strong class=" ">0-3&#37117;&#26159;&#19982;Dr0-3&#20026;</strong><strong class=" ">&#23545;&#24212;&#20851;&#31995;&#65292;&#22914;Dr0&#23545;&#24212;L0&#12289;G0&#12289;LEN0&#12289;R/W0</strong>&#65289;&#65306;</p>
<ol class=" "><li class=" "><p   
>L0/G0 - L3/G3&#65306;&#25511;&#21046;Dr0-3&#23492;&#23384;&#22120;&#26159;&#21542;&#26377;&#25928;&#65292;&#30830;&#23450;&#26159;&#23616;&#37096;&#65288;Lx&#65289;&#36824;&#26159;&#20840;&#23616;&#65288;Gx&#65289;&#26029;&#28857;&#12290;&#27599;&#27425;&#24322;&#24120;&#35302;&#21457;&#21518;&#65292;Lx&#37117;&#34987;&#28165;&#38646;&#65292;Gx&#19981;&#28165;&#38646;&#12290;&#24403;&#20320;&#21521;Dr0-3&#23384;&#20648;&#32447;&#24615;&#22320;&#22336;&#21518;&#65292;Lx&#25110;Gx&#24517;&#39035;&#26377;&#19968;&#20010;&#20026;1&#65292;&#25165;&#20250;&#35302;&#21457;&#12290;</p>
</li><li class=" "><p   
>&#26029;&#28857;&#38271;&#24230;&#65288;LENx&#65289;&#65306;00&#65288;1&#23383;&#33410;&#65289;&#65292;01&#65288;2&#23383;&#33410;&#65289;&#65292;11&#65288;4&#23383;&#33410;&#65289;&#12290;</p>
</li><li class=" "><p   
>&#26029;&#28857;&#31867;&#22411;&#65288;R/Wx&#65289;&#65306;00&#65288;&#25191;&#34892;&#26029;&#28857;&#65289;&#65292;01&#65288;&#20889;&#20837;&#26029;&#28857;&#65289;&#65292;11&#65288;&#35775;&#38382;&#26029;&#28857;&#65289;&#12290;</p>
</li></ol><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-12-1_18-9-58.png" alt="images/download/attachments/3440657/image2023-12-1_18-9-58.png" width="300"  />
    </p>
<p   
>&#30828;&#20214;&#35843;&#35797;&#26029;&#28857;&#20135;&#29983;&#30340;&#24322;&#24120;&#26159;STATUS_SINGLE_STEP&#65288;&#21333;&#27493;&#24322;&#24120;&#65289;&#12290;&#38500;&#20102;&#30828;&#20214;&#26029;&#28857;&#22806;&#65292;&#24403;Eflags&#30340;TF&#26631;&#24535;&#20301;&#32622;&#20026;1&#26102;&#65292;&#20063;&#20250;&#20135;&#29983;&#21333;&#27493;&#24322;&#24120;&#12290;Dr6&#23492;&#23384;&#22120;&#30340;&#20316;&#29992;&#26159;<strong class=" ">&#30830;&#23450;&#20135;&#29983;&#30340;&#26159;&#21738;&#31181;&#31867;&#22411;&#30340;&#21333;&#27493;&#24322;&#24120;&#12290;</strong>&#24403;B0-3&#20013;&#26377;&#20540;&#26102;&#65292;&#21487;&#20197;&#30830;&#23450;&#26159;&#26576;&#20010;&#30828;&#20214;&#26029;&#28857;&#35302;&#21457;&#20102;&#21333;&#27493;&#24322;&#24120;&#12290;<strong class=" ">&#22914;&#26524;B0-3&#30340;&#20540;&#37117;&#20026;&#31354;&#65292;&#37027;&#20040;&#35828;&#26126;&#26159;&#30001;Eflags&#30340;TF&#26631;&#24535;&#20301;&#20026;1&#24341;&#36215;&#30340;&#21333;&#27493;&#24322;&#24120;&#12290;</strong></p>
<p   
>&#22312;&#35774;&#32622;&#26029;&#28857;&#26102;&#65292;&#25105;&#20204;&#38656;&#35201;&#23558;&#35201;&#26029;&#28857;&#30340;&#32447;&#24615;&#22320;&#22336;&#20889;&#20837;Dr0-3&#20013;&#30340;&#20219;&#24847;&#19968;&#20010;&#23492;&#23384;&#22120;&#12290;&#24403;CPU&#25191;&#34892;&#21040;&#35813;&#32447;&#24615;&#22320;&#22336;&#26102;&#65292;&#22914;&#26524;&#21457;&#29616;&#19982;&#35843;&#35797;&#23492;&#23384;&#22120;&#20013;&#30340;&#20540;&#30456;&#21516;&#65292;&#23601;&#20250;&#35302;&#21457;&#26029;&#28857;&#24322;&#24120;&#65292;&#36827;&#32780;&#26242;&#20572;&#25191;&#34892;&#12290;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#35774;&#32622;&#26029;&#28857;&#26159;&#20462;&#25913;&#24403;&#21069;&#32447;&#31243;Context&#20013;&#35760;&#24405;&#30340;&#35843;&#35797;&#23492;&#23384;&#22120;&#30340;&#20540;&#65292;&#19981;&#21516;&#32447;&#31243;&#20043;&#38388;&#26159;&#30456;&#20114;&#38548;&#31163;&#30340;&#65292;&#22240;&#27492;&#35774;&#32622;&#30828;&#20214;&#26029;&#28857;&#19981;&#20250;&#24433;&#21709;&#20854;&#20182;&#32447;&#31243;&#30340;&#25191;&#34892;&#12290;</p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeaJp-ihjOa1geeoiy4z">
        <h3 class="heading "><span>&#25191;&#34892;&#27969;&#31243;</span></h3>
<p   
>&#19979;&#23436;&#30828;&#20214;&#26029;&#28857;&#21518;&#65292;&#24403;CPU&#26816;&#27979;&#35843;&#35797;&#23492;&#23384;&#22120;&#65288;Dr0-3&#65289;&#21040;&#25191;&#34892;&#21040;&#23545;&#24212;&#30340;&#32447;&#24615;&#22320;&#22336;&#65292;&#23601;&#20250;&#35302;&#21457;&#21333;&#27493;&#24322;&#24120;&#12290;&#28982;&#21518;&#23601;&#36827;&#34892;&#20102;&#24322;&#24120;&#30340;&#22788;&#29702;&#27969;&#31243;&#65306;</p>
<ol class=" "><li class=" "><p   
>CPU&#26816;&#27979;&#35843;&#35797;&#23492;&#23384;&#22120;&#65288;Dr0-3&#65289;&#21040;&#25191;&#34892;&#21040;&#23545;&#24212;&#30340;&#32447;&#24615;&#22320;&#22336;&#65292;&#23601;&#20250;&#35302;&#21457;&#21333;&#27493;&#24322;&#24120;&#65307;</p>
</li><li class=" "><p   
>&#26597;IDT&#34920;&#25214;&#21040;&#23545;&#24212;&#30340;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#65288;&#36825;&#37324;&#26159;0x01&#21495;&#20013;&#26029;&#65289;&#65307;</p>
</li><li class=" "><p   
>&#35843;&#29992;CommonDispatchException&#20989;&#25968;&#65307;</p>
</li><li class=" "><p   
>&#35843;&#29992;KiDispatchException&#20989;&#25968;&#65307;</p>
</li><li class=" "><p   
>&#36827;&#20837;DbgkForwardException&#20989;&#25968;&#65292;&#25910;&#38598;&#35843;&#35797;&#20107;&#20214;&#24182;&#21457;&#36865;&#32473;&#35843;&#35797;&#23545;&#35937;&#65307;</p>
</li><li class=" "><p   
>&#26368;&#21518;&#20132;&#32473;&#35843;&#35797;&#22120;&#26469;&#22788;&#29702;&#12290;</p>
</li></ol><p   
>&#36825;&#20010;&#27969;&#31243;&#20854;&#23454;&#36319;&#36719;&#20214;&#26029;&#28857;&#30340;&#27969;&#31243;&#24046;&#19981;&#22810;&#65292;&#22240;&#27492;&#23601;&#19981;&#24517;&#20877;&#37325;&#22797;&#30340;&#21435;&#36319;&#36827;&#20195;&#30721;&#20102;&#12290;</p>
    </div>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWunumqjOS7o-eggS4y">
        <h3 class="heading "><span>&#23454;&#39564;&#20195;&#30721;</span></h3>
<p   
>&#30828;&#20214;&#26029;&#28857;&#19982;&#36719;&#20214;&#26029;&#28857;&#25110;&#20869;&#23384;&#26029;&#28857;&#26377;&#25152;&#19981;&#21516;&#12290;&#36719;&#20214;&#26029;&#28857;&#21644;&#20869;&#23384;&#26029;&#28857;&#21487;&#20197;&#22312;OEP&#65288;&#21407;&#22987;&#25191;&#34892;&#28857;&#65289;&#22788;&#35774;&#32622;&#26029;&#28857;&#65292;&#20294;&#26159;&#30828;&#20214;&#26029;&#28857;&#19981;&#33021;&#22312;OEP&#22788;&#35774;&#32622;&#26029;&#28857;&#65292;&#22240;&#20026;&#27492;&#26102;&#20027;&#32447;&#31243;&#36824;&#26410;&#21019;&#24314;&#20986;&#26469;&#65288;&#21442;&#32771;&#20351;&#29992;CreateProcess&#20989;&#25968;&#21019;&#24314;&#35843;&#35797;&#20851;&#31995;&#26102;&#25152;&#20135;&#29983;&#30340;&#35843;&#35797;&#20107;&#20214;&#65289;&#12290;</p>
<p   
>&#30828;&#20214;&#26029;&#28857;&#26159;&#22522;&#20110;&#32447;&#31243;&#30340;&#65292;&#27809;&#26377;&#32447;&#31243;&#30340;&#24773;&#20917;&#19979;&#26080;&#27861;&#35302;&#21457;&#30828;&#20214;&#26029;&#28857;&#12290;&#22240;&#27492;&#65292;&#21487;&#20197;&#37319;&#29992;&#21478;&#19968;&#31181;&#26041;&#27861;&#65292;&#22312;OEP&#22788;&#35774;&#32622;&#19968;&#20010;&#36719;&#20214;&#26029;&#28857;&#12290;&#24403;&#36719;&#20214;&#26029;&#28857;&#34987;&#35302;&#21457;&#26102;&#65292;&#23558;&#36827;&#20837;&#36719;&#20214;&#26029;&#28857;&#22788;&#29702;&#20989;&#25968;&#65292;&#36825;&#26679;&#23601;&#20250;&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#65292;&#22240;&#27492;&#25105;&#20204;&#21487;&#20197;&#22312;&#36719;&#20214;&#26029;&#28857;&#22788;&#29702;&#20989;&#25968;&#20013;&#26469;&#35774;&#32622;&#30828;&#20214;&#26029;&#28857;&#65288;&#21487;&#20197;&#22312;OEP+1&#22788;&#35774;&#32622;&#65289;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#35302;&#21457;&#30828;&#20214;&#26029;&#28857;&#12290;&#30828;&#20214;&#26029;&#28857;&#30340;&#23454;&#29616;&#22914;&#19979;&#25152;&#31034;&#65288;&#30465;&#30053;&#20102;&#36719;&#20214;&#26029;&#28857;&#22788;&#30340;&#20195;&#30721;&#65289;&#65306;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VOID SetHardBreakPoint(PVOID pAddress)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    CONTEXT Context;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 获取线程上下文</code></div>
<div class="line"><code class="plain">    Context.ContextFlags = CONTEXT_FULL | CONTEXT_DEBUG_REGISTERS;</code></div>
<div class="line"><code class="plain">    GetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置断点位置（使用Dr0作为断点寄存器）</code></div>
<div class="line"><code class="plain">    Context.Dr0 = (DWORD)pAddress;</code></div>
<div class="line"><code class="plain">    Context.Dr7 |= </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置断点长度</code></div>
<div class="line"><code class="plain">    Context.Dr7 &amp;= </code><code class="value">0xfff0ffff</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 设置线程上下文</code></div>
<div class="line"><code class="plain">    SetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#30001;&#20110;&#21333;&#27493;&#24322;&#24120;&#23384;&#22312;&#20004;&#31181;&#24773;&#20917;&#65292;&#22240;&#27492;&#22312;&#22788;&#29702;&#20989;&#25968;&#20869;&#37096;&#38656;&#35201;&#36827;&#34892;&#21028;&#26029;&#65292;&#20197;&#30830;&#23450;&#26159;&#21542;&#26159;&#30001;&#30828;&#20214;&#26029;&#28857;&#24341;&#36215;&#30340;&#24322;&#24120;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL SingleStepExceptionProc(EXCEPTION_DEBUG_INFO* pExceptionInfo)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    CONTEXT Context;</code></div>
<div class="line"><code class="plain">    BOOL bRet = FALSE;</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 1. 获取线程上下文</code></div>
<div class="line"><code class="plain">    Context.ContextFlags = CONTEXT_DEBUG_REGISTERS;</code></div>
<div class="line"><code class="plain">    GetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 2. 判断是否是硬件断点导致的异常</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (Context.Dr6 &amp; </code><code class="value">0xF</code><code class="plain">) </code><code class="comments">// B0-3不为空</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 显示硬件断点信息</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"硬件断点 %d 0x%p\n"</code><code class="plain">, Context.Dr7 &amp; </code><code class="value">0x00030000</code><code class="plain">, Context.Dr0);</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 移除断点</code></div>
<div class="line"><code class="plain">        Context.Dr0 = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        Context.Dr7 &amp;= </code><code class="value">0xfffffffe</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 显示单步异常信息</code></div>
<div class="line"><code class="plain">        printf(</code><code class="string">"单步异常 0x%p\n"</code><code class="plain">, Context.Eip);</code></div>
<div class="line"><code class="plain">        </code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 清除单步标志</code></div>
<div class="line"><code class="plain">        Context.EFlags &amp;= </code><code class="value">0xfffffeff</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 3. 等待用户命令</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">while</code><code class="plain"> (!bRet)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        bRet = WaitForUserCommand();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> bRet;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWNleatpeatpeWFpeWSjOatpei_hw">
        <h1 class="heading "><span>&#21333;&#27493;&#27493;&#20837;&#21644;&#27493;&#36807;</span></h1>
<p   
>&#25152;&#35859;&#21333;&#27493;&#27493;&#20837;&#21644;&#27493;&#36807;&#65292;&#23454;&#38469;&#19978;&#23601;&#26159;OD&#35843;&#35797;&#22120;&#30340;&#24555;&#25463;&#38190;F7&#21644;F8&#65292;&#21333;&#27493;&#27493;&#20837;&#26159;&#21487;&#20197;&#27599;&#19968;&#34892;&#25351;&#20196;&#36827;&#34892;&#21333;&#27493;&#25191;&#34892;&#65292;&#21333;&#27493;&#27493;&#36807;&#20063;&#26159;&#22914;&#27492;&#65292;&#19981;&#21516;&#30340;&#26159;<strong class=" ">&#21333;&#27493;&#27493;&#36807;&#19981;&#20250;&#36827;&#20837;&#35843;&#29992;&#20989;&#25968;&#30340;&#20869;&#37096;&#65288;CALL&#25351;&#20196;&#65289;</strong>&#12290;</p>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeatpeWFpQ">
        <h2 class="heading "><span>&#27493;&#20837;</span></h2>
<p   
>&#24819;&#35201;&#23454;&#29616;&#21333;&#27493;&#27493;&#20837;&#26377;&#24456;&#22810;&#31181;&#26041;&#24335;&#65292;&#20363;&#22914;&#25105;&#20204;&#21487;&#20197;&#23558;&#27599;&#19968;&#34892;&#35201;&#25191;&#34892;&#30340;&#25351;&#20196;&#19979;&#19968;&#22320;&#22336;&#30340;&#25351;&#20196;&#20013;&#35774;&#20026;INT 3&#65292;&#28982;&#21518;&#21333;&#27493;&#25191;&#34892;&#21518;&#23601;&#24674;&#22797;&#20877;&#20197;&#27492;&#31867;&#25512;&#21435;&#35774;&#32622;&#12290;&#20294;&#26159;&#36825;&#26679;&#30340;&#26041;&#24335;&#24456;&#31528;&#25305;&#65292;<strong class=" ">&#22240;&#27492;Intel&#22312;&#35774;&#35745;CPU&#26102;&#32771;&#34385;&#21040;&#20102;&#35843;&#35797;&#31243;&#24207;&#30340;&#24517;&#35201;&#24615;&#65292;&#23601;&#22312;EFlags&#23492;&#23384;&#22120;&#20013;&#35774;&#32622;&#20102;&#19968;&#20010;TF&#20301;</strong>&#12290;TF&#20301;&#25105;&#20204;&#21487;&#20197;&#31216;&#20043;&#20026;&#21333;&#27493;&#26631;&#24535;&#65292;<strong class=" ">&#24403;TF&#20301;&#34987;&#32622;1&#26102;&#65292;&#27599;&#25191;&#34892;&#23436;&#19968;&#34892;&#25351;&#20196;&#23601;&#20250;&#20135;&#29983;&#19968;&#20010;&#24322;&#24120;</strong>&#12290;</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/3440657/image2023-12-2_14-54-15.png" alt="images/download/attachments/3440657/image2023-12-2_14-54-15.png" width="600"  />
    </p>
<p   
>&#21333;&#27493;&#24322;&#24120;&#30340;&#22788;&#29702;&#27969;&#31243;&#19982;&#30828;&#20214;&#26029;&#28857;&#19968;&#33268;&#65292;&#37117;&#26159;CPU&#26816;&#27979;&#21040;&#24322;&#24120;&#21518;&#36890;&#36807;IDT&#34920;&#25214;&#21040;0x01&#21495;&#20013;&#26029;&#20989;&#25968;&#36827;&#34892;&#22788;&#29702;&#31561;&#31561;&#65292;&#22240;&#27492;&#27492;&#22788;&#23601;&#19981;&#20877;&#36184;&#36848;&#12290;</p>
    <div class="section section-3" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeWunumqjOS7o-eggS4z">
        <h3 class="heading "><span>&#23454;&#39564;&#20195;&#30721;</span></h3>
<p   
>&#21333;&#27493;&#27493;&#20837;&#65288;&#24322;&#24120;&#65289;&#30340;&#26029;&#28857;&#23454;&#29616;&#20063;&#24456;&#31616;&#21333;&#65292;&#23601;&#26159;&#33719;&#21462;&#32447;&#31243;&#19978;&#19979;&#25991;&#65292;&#23601;&#24471;&#21040;&#20102;&#30456;&#20851;&#30340;&#23492;&#23384;&#22120;&#65292;&#25509;&#30528;&#23558;EFlags&#23492;&#23384;&#22120;&#30340;TF&#20301;&#32622;1&#65292;&#28982;&#21518;&#20877;&#23558;&#19978;&#19979;&#25991;&#35774;&#32622;&#22238;&#21435;&#12290;</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">VOID SetSingleStep()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    CONTEXT Context;</code></div>
<div class="line"><code class="plain">    Context.ContextFlags = CONTEXT_DEBUG_REGISTERS;</code></div>
<div class="line"><code class="plain">    GetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 将EFlags寄存器的TF位置1</code></div>
<div class="line"><code class="plain">    Context.EFlags |= </code><code class="value">0x100</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    SetThreadContext(hDebugeeThread, &amp;Context);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>&#30001;&#20110;&#21333;&#27493;&#27493;&#20837;&#19982;&#30828;&#20214;&#26029;&#28857;&#35302;&#21457;&#30340;&#24322;&#24120;&#37117;&#23646;&#20110;&#21333;&#27493;&#24322;&#24120;&#65292;<strong class=" ">&#22240;&#27492;&#36825;&#20004;&#31181;&#24322;&#24120;&#21487;&#20197;&#20351;&#29992;&#21516;&#19968;&#20010;&#22788;&#29702;&#20989;&#25968;&#65292;&#21482;&#38656;&#23545;Dr6&#30340;&#20540;&#36827;&#34892;&#21028;&#26029;&#21363;&#21487;&#21306;&#20998;</strong>&#65292;&#36825;&#37096;&#20998;&#20195;&#30721;&#19982;&#30828;&#20214;&#26029;&#28857;&#30340;&#23454;&#29616;&#20195;&#30721;&#19968;&#33268;&#65292;&#25152;&#20197;&#20063;&#19981;&#20877;&#36184;&#36848;&#12290;</p>
    </div>
    </div>
    <div class="section section-2" id="src-3440657_safe-id-aWQt6L2v5Lu26LCD6K-VLeatpei_hw">
        <h2 class="heading "><span>&#27493;&#36807;</span></h2>
<p   
>&#24819;&#35201;&#23454;&#29616;&#21333;&#27493;&#27493;&#36807;&#65292;&#21487;&#20197;&#36890;&#36807;&#20004;&#31181;&#26041;&#24335;&#65306;&#30828;&#20214;&#26029;&#28857;&#12289;&#36719;&#20214;&#26029;&#28857;&#12290;&#23454;&#29616;&#30340;&#21407;&#29702;&#26159;&#22312;&#36935;&#21040;CALL&#25351;&#20196;&#65288;&#21253;&#25324;&#22810;&#31181;&#31867;&#22411;&#65289;&#21518;&#65292;&#35745;&#31639;&#24403;&#21069;&#25351;&#20196;&#30340;&#38271;&#24230;&#65292;&#24182;&#22312;&#24403;&#21069;EIP+&#24403;&#21069;&#25351;&#20196;&#38271;&#24230;&#30340;&#20301;&#32622;&#35774;&#32622;&#26029;&#28857;&#65292;&#21363;CALL&#25351;&#20196;&#30340;&#19979;&#19968;&#34892;&#65292;&#28982;&#21518;&#32487;&#32493;&#25191;&#34892;&#65292;&#20174;&#32780;&#23454;&#29616;&#21333;&#27493;&#27493;&#36807;&#30340;&#25928;&#26524;&#12290;</p>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>&#28040;&#24687;&#26426;&#21046;</span>
        </a>
        </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
