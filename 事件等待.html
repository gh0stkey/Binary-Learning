<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>&#20107;&#20214;&#31561;&#24453; - &#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="1015827">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">BinaryLearning</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Binary-Learning.html" class="ht-space-link">
                    <h2>&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</h2>
                </a>
                <p><br><a href="https://github.com/gh0stkey/Binary-Learning" target="_blank">ᴀᴜᴛʜᴏʀ: ᴋᴇʏ</a><br><br>不积跬步，无以至千里；<br>不积小流，无以成江海。</p>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=2424889"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Binary-Learning.html">&#28404;&#27700;&#36870;&#21521;&#35838;&#31243;&#31508;&#35760;</a></li>
                                                                                     <li><a href="%E4%B8%AD%E7%BA%A7%E7%AF%87.html">&#20013;&#32423;&#31687;</a></li>
                                                            </ul>
</div>            <h1 id="src-2424889"> <span>&#20107;&#20214;&#31561;&#24453;</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS4tOeVjOWMuiboh6rml4vplIE">
        <h1 class="heading "><span>&#20020;&#30028;&#21306;&amp;&#33258;&#26059;&#38145;</span></h1>
<p   
>    <span style="color: #000000;">
&#36825;&#20004;&#20010;&#31456;&#33410;<strong class=" ">&#22312;&rdquo;&#22810;&#26680;&#21516;&#27493;&ldquo;&#31687;&#24050;&#32463;&#23398;&#20064;&#36807;&#20102;</strong>&#65292;&#38656;&#35201;&#20102;&#35299;&#30340;&#21487;&#20197;&#33258;&#34892;&#26597;&#30475;&#23545;&#24212;&#31456;&#33410;&#12290;    </span>
</p>
    </div>
    <div class="section section-1" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLee6v-eoi-etieW-heS4juWUpOmGkg">
        <h1 class="heading "><span>&#32447;&#31243;&#31561;&#24453;&#19982;&#21796;&#37266;</span></h1>
<p   
>    <span style="color: #000000;">
&#25105;&#20204;&#22312;&#20043;&#21069;&#30340;&#35838;&#31243;&#37324;&#38754;&#20102;&#35299;&#20102;&#22914;&#20309;<strong class=" ">&#33258;&#24049;&#23454;&#29616;&#20020;&#30028;&#21306;</strong>&#20197;&#21450;<strong class=" ">&#20160;&#20040;&#26159;Windows&#33258;&#26059;&#38145;</strong>&#65292;&#36825;&#20004;&#31181;&#21516;&#27493;&#26041;&#26696;&#22312;&#32447;&#31243;&#26080;&#27861;&#36827;&#20837;&#20020;&#30028;&#21306;&#26102;&#37117;&#20250;&#35753;&#24403;&#21069;&#32447;&#31243;&#36827;&#20837;&#31561;&#24453;&#29366;&#24577;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#19968;&#31181;&#26159;&#36890;&#36807;Sleep&#20989;&#25968;&#23454;&#29616;&#30340;&#65292;&#19968;&#31181;&#26159;&#36890;&#36807;&#35753;&#24403;&#21069;&#30340;CPU&rdquo;&#31354;&#36716;&ldquo;&#23454;&#29616;&#30340;&#65292;&#20294;&#36825;&#20004;&#31181;&#31561;&#24453;&#26041;&#24335;&#37117;&#26377;&#23616;&#38480;&#24615;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#36890;&#36807;Sleep&#20989;&#25968;&#36827;&#34892;&#31561;&#24453;&#65292;&#24182;&#27809;&#26377;&#21150;&#27861;&#30830;&#23450;&#20855;&#20307;&#31561;&#24453;&#30340;&#26102;&#38388;&#65292;&#26377;&#21487;&#33021;&#20986;&#29616;<strong class=" ">&#31561;&#24453;&#36807;&#38271;&#25110;&#36807;&#30701;</strong>&#30340;&#24773;&#20917;&#65307;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
&#36890;&#36807;&#35753;CPU&rdquo;&#31354;&#36716;&ldquo;&#36827;&#34892;&#31561;&#24453;&#65292;&#21482;&#26377;&#22312;&#31561;&#24453;&#20107;&#20214;&#24456;&#30701;&#30340;&#24773;&#20917;&#19979;&#25165;&#26377;&#24847;&#20041;&#65292;&#21542;&#21017;&#31354;&#36716;&#26102;&#38388;&#36807;&#38271;&#65292;<strong class=" ">&#23545;CPU&#36164;&#28304;&#26469;&#35828;&#23601;&#26159;&#19968;&#31181;&#28010;&#36153;</strong>&#65292;&#24182;&#19988;&#33258;&#26059;&#38145;&#30340;&#26041;&#24335;<strong class=" ">&#21482;&#22312;&#22810;&#26680;&#30340;&#29615;&#22659;&#19979;&#23384;&#22312;</strong>&#12290;    </span>
</p>
</li></ol><p   
>    <span style="color: #000000;">
&#25105;&#20204;&#21457;&#29616;&#22914;&#19978;&#25152;&#35828;&#30340;&#20004;&#31181;&#26041;&#26696;&#65292;&#37117;&#26159;&#30001;&#20110;&#31561;&#24453;&#26465;&#20214;&#30340;&#19981;&#25104;&#29087;&#65292;&#25152;&#20135;&#29983;&#30340;&#23616;&#38480;&#12290;    </span>
</p>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeetieW-heS4juWUpOmGkuacuuWItg">
        <h2 class="heading "><span>&#31561;&#24453;&#19982;&#21796;&#37266;&#26426;&#21046;</span></h2>
<p   
>    <span style="color: #000000;">
&#22312;Windows&#20013;&#65292;&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#36890;&#36807;&#31561;&#24453;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#21487;&#31561;&#24453;&#23545;&#35937;&#65292;&#20174;&#32780;&#36827;&#20837;&#31561;&#24453;&#29366;&#24577;&#65292;&#21478;&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#22312;&#26576;&#20123;&#26102;&#21051;&#21796;&#37266;&#31561;&#24453;&#36825;&#20123;&#23545;&#35937;&#30340;&#20854;&#20182;&#32447;&#31243;&#65292;&#36825;&#23601;&#26159;<strong class=" ">Windows&#30340;&#31561;&#24453;&#19982;&#21796;&#37266;&#26426;&#21046;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-15_15-45-45.png" alt="images/download/attachments/2424889/image2023-5-15_15-45-45.png" width="600"  />
    </span>
</p>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeWPr-etieW-heWvueixoQ">
        <h2 class="heading "><span>&#21487;&#31561;&#24453;&#23545;&#35937;</span></h2>
<p   
>    <span style="color: #000000;">
&#25152;&#35859;&#21487;&#31561;&#24453;&#23545;&#35937;&#23601;&#26159;&#32467;&#26500;&#20307;&#65292;&#22914;&#19979;&#26159;&#19968;&#20123;&#32467;&#26500;&#20307;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;Windbg&#20013;&#26597;&#30475;&#36825;&#20123;&#32467;&#26500;&#20307;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-15_17-21-41.png" alt="images/download/attachments/2424889/image2023-5-15_17-21-41.png" width="400"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22312;Windbg&#20013;&#26597;&#30475;&#32467;&#26500;&#20307;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#36825;&#20123;<strong class=" ">&#32467;&#26500;&#20307;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;&#37117;&#26159;_DISPATCHER_HEADER</strong>&#65292;&#20063;&#23601;&#34920;&#31034;&#31532;&#19968;&#20010;&#25104;&#21592;&#20026;_DISPATCHER_HEADER&#30340;&#32467;&#26500;&#20307;&#23601;&#26159;&#21487;&#31561;&#24453;&#23545;&#35937;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-15_17-23-29.png" alt="images/download/attachments/2424889/image2023-5-15_17-23-29.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#38500;&#20102;&#36825;&#20010;&#20197;&#22806;&#65292;&#22312;Windows&#20013;&#36824;&#26377;&#19968;&#20123;&#29305;&#27530;&#30340;&#32467;&#26500;&#20307;&#65292;&#20063;&#31216;&#20043;&#20026;&#21487;&#31561;&#24453;&#23545;&#35937;&#65292;&#22914;_FILE_OBJECT&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#35813;&#32467;&#26500;&#20307;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;&#23601;&#19981;&#26159;_DISPATCHER_HEADER&#65292;<strong class=" ">&#20294;&#26159;&#22312;&#23427;&#30340;0x5C&#20559;&#31227;&#20301;&#25104;&#21592;&#26377;&#19968;&#20010;_KEVENT&#32467;&#26500;&#20307;&#65292;&#36825;&#20010;&#32467;&#26500;&#20307;&#26159;&#19968;&#20010;&#21487;&#31561;&#24453;&#23545;&#35937;</strong>&#65292;&#22240;&#27492;_FILE_OBJECT&#20063;&#26159;&#19968;&#20010;&#21487;&#31561;&#24453;&#23545;&#35937;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-15_17-26-32.png" alt="images/download/attachments/2424889/image2023-5-15_17-26-32.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22240;&#27492;&#65292;&#32508;&#19978;&#25152;&#36848;&#25105;&#20204;&#21487;&#20197;&#30693;&#36947;<strong class=" ">&#21482;&#35201;&#32467;&#26500;&#20307;&#20013;&#25104;&#21592;&#26377;_DISPATCHER_HEADER&#65292;&#25110;&#21253;&#21547;&#20102;_DISPATCHER_HEADER&#32467;&#26500;&#20307;&#30340;&#65292;&#25105;&#20204;&#37117;&#21487;&#20197;&#31216;&#20043;&#20026;&#21487;&#31561;&#24453;&#23545;&#35937;</strong>&#12290;    </span>
</p>
    <div class="section section-3" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeW3ruW8gg">
        <h3 class="heading "><span>&#24046;&#24322;</span></h3>
<p   
>    <span style="color: #000000;">
&#34429;&#28982;&#20197;&#19978;&#25152;&#36848;&#30340;&#20004;&#31181;&#31867;&#22411;&#32467;&#26500;&#20307;&#37117;&#31216;&#20043;&#20026;&#21487;&#31561;&#24453;&#23545;&#35937;&#65292;&#20294;&#20004;&#32773;&#20043;&#38388;&#20063;&#26159;&#26377;&#24046;&#24322;&#30340;&#12290;&#24046;&#24322;&#22312;&#31561;&#24453;&#20989;&#25968;&#35843;&#29992;&#36807;&#31243;&#20013;&#20307;&#29616;&#20986;&#26469;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#24403;&#25105;&#20204;&#20351;&#29992;WaitForSingleObject&#20989;&#25968;&#26102;&#65292;&#36827;&#20837;&#20869;&#26680;&#20989;&#25968;NtWaitForSingleObject&#65292;&#36825;&#20010;&#20869;&#26680;&#20989;&#25968;&#20250;&#36890;&#36807;3&#29615;&#29992;&#25143;&#25552;&#20379;&#30340;&#21477;&#26564;&#25214;&#21040;&#31561;&#24453;&#23545;&#35937;&#30340;&#20869;&#26680;&#22320;&#22336;&#65307;&#28982;&#21518;<strong class=" ">&#21028;&#26029;&#31561;&#24453;&#23545;&#35937;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;&#26159;&#21542;&#26159;_DISPATCHER_HEADER&#65292;&#22914;&#26524;&#26159;&#30340;&#35805;&#21017;&#30452;&#25509;&#20351;&#29992;</strong>&#65307;&#22914;&#26524;&#19981;&#26159;&#30340;&#35805;&#65292;<strong class=" ">&#21017;&#21435;&#31561;&#24453;&#23545;&#35937;&#20013;&#25214;&#21040;&#23884;&#20837;&#30340;_DISPATCHER_HEADER&#23545;&#35937;</strong>&#12290;&#26368;&#21518;<strong class=" ">&#20877;&#23558;&#25214;&#21040;&#30340;&#23545;&#35937;&#22320;&#22336;&#20316;&#20026;&#21442;&#25968;&#35843;&#29992;KeWaitForSingleObject&#20989;&#25968;</strong>&#65292;&#35813;&#20989;&#25968;&#26680;&#24515;&#21151;&#33021;&#20250;&#22312;&#21518;&#32493;&#31456;&#33410;&#20013;&#23398;&#20064;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-15_17-36-59.png" alt="images/download/attachments/2424889/image2023-5-15_17-36-59.png" width="600"  />
    </span>
</p>
    </div>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeetieW-heWdlw">
        <h2 class="heading "><span>&#31561;&#24453;&#22359;</span></h2>
<p   
>    <span style="color: #000000;">
&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#31561;&#24453;&#19968;&#20010;&#25110;&#22810;&#20010;&#23545;&#35937;&#65292;<strong class=" ">&#32447;&#31243;&#19982;&#31561;&#24453;&#23545;&#35937;&#24314;&#31435;&#32852;&#31995;&#20027;&#35201;&#36890;&#36807;&#31561;&#24453;&#22359;</strong>&#65292;&#25105;&#20204;&#21487;&#20197;&#20570;&#20010;&#23454;&#39564;&#26469;&#30475;&#19968;&#19979;&#12290;    </span>
</p>
    <div class="section section-3" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS4gOS4que6v-eoi-etieW-heS4gOS4quWvueixoQ">
        <h3 class="heading "><span>&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#19968;&#20010;&#23545;&#35937;</span></h3>
<p   
>    <span style="color: #000000;">
&#39318;&#20808;&#25105;&#20204;&#21487;&#20197;&#22312;XP&#20013;&#32534;&#35793;&#36825;&#26679;&#19968;&#27573;&#20195;&#30721;&#65292;&#26469;&#30475;&#19968;&#19979;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#19968;&#20010;&#23545;&#35937;&#30340;&#24773;&#20917;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdio.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HANDLE hEvent[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ::WaitForSingleObject(hEvent[</code><code class="value">0</code><code class="plain">], -</code><code class="value">1</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"ThreadProc函数执行...\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    hEvent[</code><code class="value">0</code><code class="plain">] = ::CreateEvent(NULL, TRUE, FALSE, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    ::CreateThread(NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#36816;&#34892;&#31243;&#24207;&#20043;&#21518;&#65292;&#22312;Windbg&#20013;&#26029;&#19968;&#19979;&#65292;&#28982;&#21518;&#36890;&#36807;&#22914;&#19979;&#22270;&#20013;&#30340;&#25351;&#20196;&#25214;&#21040;&#24403;&#21069;&#36827;&#31243;&#20013;&#27491;&#22312;&#31561;&#24453;&#30340;&#32447;&#31243;&#22320;&#22336;&#65306;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_16-33-2.png" alt="images/download/attachments/2424889/image2023-5-16_16-33-2.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#25509;&#30528;&#25105;&#20204;&#20197;&#32447;&#31243;&#32467;&#26500;&#20307;&#30340;&#26041;&#24335;&#20195;&#20837;&#32447;&#31243;&#22320;&#22336;&#26597;&#30475;&#65292;&#25214;&#21040;0x5C&#20559;&#31227;&#20301;&#25104;&#21592;&#65292;&#21363;&#31561;&#24453;&#22359;&#65306;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_16-36-7.png" alt="images/download/attachments/2424889/image2023-5-16_16-36-7.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#31561;&#24453;&#22359;&#26159;&#19968;&#20010;_KWAIT_BLOCK&#32467;&#26500;&#20307;&#65292;&#23427;&#23558;&#32447;&#31243;&#19982;&#34987;&#31561;&#24453;&#23545;&#35937;&#32852;&#31995;&#21040;&#20102;&#19968;&#36215;&#65292;&#25105;&#20204;&#25509;&#30528;&#26469;&#30475;&#19968;&#19979;&#23427;&#30340;&#25104;&#21592;&#21547;&#20041;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">nt!_KWAIT_BLOCK</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> WaitListEntry    : _LIST_ENTRY         </code><code class="comments">// 稍后了解</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x008</code><code class="plain"> Thread           : Ptr32 _KTHREAD      </code><code class="comments">// 当前线程地址</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x00c</code><code class="plain"> Object           : Ptr32 Void          </code><code class="comments">// 等待对象的地址（当前实验中为_KEVENT）</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x010</code><code class="plain"> NextWaitBlock    : Ptr32 _KWAIT_BLOCK  </code><code class="comments">// 下一个等待块地址，这是一个单向循环链表，存储的是与当前线程关联的多个等待块结构体地址，如果只有一个等待块则该地址指向当前等待快地址</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x014</code><code class="plain"> WaitKey          : Uint2B              </code><code class="comments">// 等待块的索引，当前为第一个等待块，因此该值为0</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x016</code><code class="plain"> WaitType         : Uint2B              </code><code class="comments">// 等待类型，若当前只要有一个等待对象符合条件就可以使得线程被唤醒，那么该值就是1；如果你等待多个对象必须全部符合条件才可以使得线程被唤醒，那么该值0</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_16-37-23.png" alt="images/download/attachments/2424889/image2023-5-16_16-37-23.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#32508;&#19978;&#25152;&#36848;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#22270;&#26469;&#34920;&#31034;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#19968;&#20010;&#23545;&#35937;&#30340;&#24773;&#20917;&#65306;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_16-43-26.png" alt="images/download/attachments/2424889/image2023-5-16_16-43-26.png" width="600"  />
    </span>
</p>
    </div>
    <div class="section section-3" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS4gOS4que6v-eoi-etieW-heWkmuS4quWvueixoQ">
        <h3 class="heading "><span>&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#22810;&#20010;&#23545;&#35937;</span></h3>
<p   
>    <span style="color: #000000;">
&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#22810;&#20010;&#23545;&#35937;&#30340;&#24773;&#20917;&#65292;&#25105;&#20204;&#38656;&#35201;&#23558;&#20195;&#30721;&#36827;&#34892;&#20462;&#25913;&#65292;&#22914;&#19979;&#20195;&#30721;&#25152;&#31034;&#65292;&#25105;&#20204;&#28155;&#21152;&#20004;&#20010;&#21487;&#31561;&#24453;&#23545;&#35937;&#65292;&#28982;&#21518;&#23558;WaitForSingleObject&#26367;&#25442;&#20026;WaitForMultipleObjects&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#20351;&#24471;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#22810;&#20010;&#23545;&#35937;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#65292;WaitForMultipleObjects&#20989;&#25968;&#22810;&#20986;&#20102;&#20004;&#20010;&#21442;&#25968;&#65292;&#20998;&#21035;&#26159;<strong class=" ">&#31532;&#19968;&#20010;&#21442;&#25968;nCount&#65288;&#21363;&#31561;&#24453;&#23545;&#35937;&#30340;&#25968;&#37327;&#65289;</strong>&#21644;<strong class=" ">&#31532;&#20108;&#20010;&#21442;&#25968;bWaitAll&#65288;&#21363;&#26159;&#21542;&#35201;&#25152;&#26377;&#31561;&#24453;&#23545;&#35937;&#31526;&#21512;&#26465;&#20214;&#65292;&#35813;&#20540;&#20915;&#23450;&#20102;&#31561;&#24453;&#22359;&#30340;WaitType&#25104;&#21592;&#30340;&#20540;&#65292;&#35813;&#20540;&#20026;FALSE&#65292;&#21017;WaitType&#20540;&#20026;1&#65292;&#21453;&#20043;&#20026;0&#65289;</strong>&#12290;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">#include &lt;windows.h&gt;</code></div>
<div class="line"><code class="plain">#include &lt;stdio.h&gt;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">HANDLE hEvent[</code><code class="value">2</code><code class="plain">];</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">DWORD WINAPI ThreadProc(LPVOID lpParameter)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// ::WaitForSingleObject(hEvent[0], -1);</code></div>
<div class="line"><code class="plain">    ::WaitForMultipleObjects(</code><code class="value">2</code><code class="plain">, hEvent, FALSE, -</code><code class="value">1</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    printf(</code><code class="string">"ThreadProc函数执行...\n"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">int</code><code class="plain"> main(</code><code class="keyword">int</code><code class="plain"> argc, </code><code class="keyword">char</code><code class="plain">* argv[])</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    hEvent[</code><code class="value">0</code><code class="plain">] = ::CreateEvent(NULL, TRUE, FALSE, NULL);</code></div>
<div class="line"><code class="plain">    hEvent[</code><code class="value">1</code><code class="plain">] = ::CreateEvent(NULL, TRUE, FALSE, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    ::CreateThread(NULL, </code><code class="value">0</code><code class="plain">, (LPTHREAD_START_ROUTINE)ThreadProc, NULL, </code><code class="value">0</code><code class="plain">, NULL);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    getchar();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#36824;&#26159;&#36319;&#20043;&#21069;&#30340;&#27493;&#39588;&#19968;&#26679;&#65292;&#25214;&#21040;&#27491;&#22312;&#31561;&#24453;&#30340;&#32447;&#31243;&#22320;&#22336;&#65292;&#28982;&#21518;&#25214;&#21040;&#31561;&#24453;&#22359;&#36827;&#34892;&#26597;&#30475;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#36825;&#26102;&#20505;&#23601;&#26377;&#20004;&#20010;&#31561;&#24453;&#22359;&#20102;&#65306;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_17-1-6.png" alt="images/download/attachments/2424889/image2023-5-16_17-1-6.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#37027;&#20040;&#25509;&#30528;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;Object&#25104;&#21592;&#25351;&#21521;&#30340;&#31561;&#24453;&#23545;&#35937;&#65292;&#25105;&#20204;&#30693;&#36947;&#23427;&#26159;&#19968;&#20010;_KEVENT&#32467;&#26500;&#20307;&#65292;<strong class=" ">&#35813;&#32467;&#26500;&#20307;&#21482;&#26377;&#19968;&#20010;&#25104;&#21592;&#65292;&#21363;_DISPATCHER_HEADER</strong>&#65292;&#22240;&#27492;&#25105;&#20204;&#21487;&#20197;&#26681;&#25454;Object&#30340;&#22320;&#22336;&#20195;&#20837;_DISPATCHER_HEADER&#32467;&#26500;&#20307;&#36827;&#34892;&#26597;&#30475;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#20250;&#21457;&#29616;&#65292;&#22312;_DISPATCHER_HEADER&#32467;&#26500;&#20307;&#30340;0x8&#20559;&#31227;&#20301;&#25104;&#21592;&#26159;&#19968;&#20010;WaitListHead&#65292;&#36825;&#26159;&#19968;&#20010;&#38142;&#34920;&#65292;&#35813;&#38142;&#34920;&#25351;&#21521;&#30340;&#23601;&#26159;&#24403;&#21069;&#31561;&#24453;&#23545;&#35937;_KEVENT<strong class=" ">&#23545;&#24212;&#32447;&#31243;&#30340;&#31561;&#24453;&#22359;</strong>&#65288;&#33509;&#21253;&#21547;&#22810;&#20010;&#31561;&#24453;&#22359;&#65292;&#20063;&#23601;&#34920;&#31034;&#26377;&#22810;&#20010;&#32447;&#31243;&#22312;&#31561;&#24453;&#19968;&#20010;&#31561;&#24453;&#23545;&#35937;&#65292;&#21017;&#20250;&#23558;&#36825;&#20123;&#31561;&#24453;&#22359;&#20381;&#27425;&#25554;&#20837;&#38142;&#34920;&#20013;&#65289;&#12290;&#25509;&#30528;&#25105;&#20204;&#20250;&#21457;&#29616;&#22312;&#24403;&#21069;&#32447;&#31243;&#31561;&#24453;&#22359;&#30340;&#31532;&#19968;&#20010;&#25104;&#21592;WaitListEntry&#20013;&#23384;&#20648;&#30340;&#23601;&#26159;WaitListHead&#30340;&#20540;&#65292;<strong class=" ">&#36825;&#26679;&#25105;&#20204;&#23601;&#23436;&#20840;&#26126;&#30333;&#20102;&#31561;&#24453;&#24555;&#19982;&#31561;&#24453;&#23545;&#35937;&#20043;&#38388;&#30340;&#20851;&#32852;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_17-7-38.png" alt="images/download/attachments/2424889/image2023-5-16_17-7-38.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#32508;&#19978;&#25152;&#36848;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#22270;&#26469;&#34920;&#31034;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#22810;&#20010;&#23545;&#35937;&#30340;&#24773;&#20917;&#65306;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_17-11-1.png" alt="images/download/attachments/2424889/image2023-5-16_17-11-1.png" width="600"  />
    </span>
</p>
    </div>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeetieW-hee9kQ">
        <h2 class="heading "><span>&#31561;&#24453;&#32593;</span></h2>
<p   
>    <span style="color: #000000;">
&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#36825;&#26159;&#28023;&#19996;&#32769;&#24072;&#26681;&#25454;&#31561;&#24453;&#20851;&#31995;&#26500;&#36896;&#30340;&#19968;&#24352;&#31561;&#24453;&#32593;&#65288;&#36825;&#21482;&#26159;&#33258;&#23450;&#20041;&#30340;&#27010;&#24565;&#65289;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#25152;&#26377;&#22788;&#20110;&#31561;&#24453;&#29366;&#24577;&#30340;&#32447;&#31243;&#65292;&#32447;&#31243;&#23545;&#24212;&#30340;&#31561;&#24453;&#22359;&#65292;&#20197;&#21450;&#34987;&#31561;&#24453;&#23545;&#35937;&#65292;&#37117;&#20250;&#20301;&#20110;&#31867;&#20284;&#30340;&#31561;&#24453;&#32593;&#19978;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_17-12-25.png" alt="images/download/attachments/2424889/image2023-5-16_17-12-25.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#31561;&#24453;&#20013;&#30340;&#32447;&#31243;&#19968;&#23450;&#20250;&#25346;&#20837;&#31561;&#24453;&#38142;&#34920;&#20013;&#65288;&#21363;KiWaitListHead&#65289;&#65292;&#21516;&#26102;&#20063;&#19968;&#23450;&#20301;&#20110;&#31561;&#24453;&#32593;&#19978;&#65288;&#21363;KThread+5C&#30340;&#20301;&#32622;&#19981;&#20026;&#31354;&#65289;&#12290;    </span>
</p>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLVdhaXRmRm90U2luZ2xlT2JqZWN05Ye95pWw5YiG5p6Q">
        <h2 class="heading "><span>WaitfFotSingleObject&#20989;&#25968;&#20998;&#26512;</span></h2>
<p   
>    <span style="color: #000000;">
&#26080;&#35770;&#21487;&#31561;&#24453;&#23545;&#35937;&#26159;&#20309;&#31181;&#31867;&#22411;&#65292;&#32447;&#31243;&#37117;&#26159;&#36890;&#36807;WaitForSingleObject&#12289;WaitForMultipleObjects&#20989;&#25968;&#36827;&#20837;&#31561;&#24453;&#29366;&#24577;&#30340;&#65292;<strong class=" ">&#36825;&#20004;&#20010;&#20989;&#25968;&#26159;&#29702;&#35299;&#32447;&#31243;&#31561;&#24453;&#19982;&#21796;&#37266;&#26426;&#21046;&#30340;&#26680;&#24515;</strong>&#12290;&#26412;&#31456;&#33410;&#65292;&#25105;&#20204;&#20197;WaitForSingleObject&#20989;&#25968;&#20026;&#20363;&#65292;&#36827;&#34892;&#20998;&#26512;&#65292;&#26469;&#20102;&#35299;&#32447;&#31243;&#31561;&#24453;&#19982;&#21796;&#37266;&#26426;&#21046;&#30340;&#26412;&#36136;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
WaitForSingleObject&#20989;&#25968;&#26684;&#24335;&#22914;&#19979;&#65292;&#23545;&#20110;&#25105;&#20204;&#26469;&#35828;&#23427;&#21482;&#26159;&#19968;&#20010;3&#29615;&#30340;API&#23553;&#35013;&#65292;&#36890;&#36807;&#31995;&#32479;&#35843;&#29992;&#30340;&#26041;&#24335;&#36827;&#20837;0&#29615;&#28982;&#21518;&#21435;&#35843;&#29992;NtWaitForSingleObject&#20989;&#25968;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">DWORD WaitForSingleObject(</code></div>
<div class="line"><code class="plain">    HANDLE hHandle,        </code><code class="comments">// 句柄</code></div>
<div class="line"><code class="plain">    DWORD dwMilliseconds   </code><code class="comments">// 超时时间</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
NtWaitForSingleObject&#20989;&#25968;&#26684;&#24335;&#22914;&#19979;&#65292;&#35813;&#20989;&#25968;&#20570;&#20102;&#20004;&#20214;&#20107;&#24773;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#35843;&#29992;ObReferenceObjectByHandle&#20989;&#25968;&#65292;&#36890;&#36807;&#23545;&#35937;&#21477;&#26564;&#25214;&#21040;&#31561;&#24453;&#23545;&#35937;&#32467;&#26500;&#20307;&#22320;&#22336;&#65307;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#23558;&#31561;&#24453;&#23545;&#35937;&#30340;&#22320;&#22336;&#20316;&#20026;&#20256;&#21442;&#65292;&#35843;&#29992;KeWaitForSingleObject&#20989;&#25968;</strong>&#65292;&#36827;&#20837;&#20851;&#38190;&#24490;&#29615;&#12290;    </span>
</p>
</li></ol>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">NTSTATUS NtWaitForSingleObject(</code></div>
<div class="line"><code class="plain">    [in] HANDLE         Handle,    </code><code class="comments">// 句柄</code></div>
<div class="line"><code class="plain">    [in] BOOLEAN        Alertable, </code><code class="comments">// 对应_KTHREAD结构体的Alertable属性，该值为1时插入用户APC，线程会被吵醒</code></div>
<div class="line"><code class="plain">    [in] PLARGE_INTEGER Timeout    </code><code class="comments">// 超时时间</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#22240;&#27492;&#65292;&#23454;&#38469;&#19978;<strong class=" ">KeWaitForSingleObject&#20989;&#25968;</strong>&#25165;&#26159;&#26680;&#24515;&#21151;&#33021;&#30340;&#23454;&#29616;&#12290;    </span>
</p>
    <div class="section section-3" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLUtlV2FpdEZvclNpbmdsZU9iamVjdOWHveaVsA">
        <h3 class="heading "><span>KeWaitForSingleObject&#20989;&#25968;</span></h3>
    <div class="section section-4" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeetieW-heWdl-eahOWhq-WFhQ">
        <h4 class="heading "><span>&#31561;&#24453;&#22359;&#30340;&#22635;&#20805;</span></h4>
<p   
>    <span style="color: #000000;">
KeWaitForSingleObject&#20989;&#25968;&#21487;&#20197;&#20998;&#20026;&#20004;&#37096;&#20998;&#65292;&#39318;&#20808;&#20570;&#30340;&#26159;&#35201;&#22312;&#32447;&#31243;&#32467;&#26500;&#20307;&#20013;&#21152;&#20837;&#31561;&#24453;&#22359;&#65292;&#24494;&#36719;&#22312;&#35774;&#35745;&#32447;&#31243;&#32467;&#26500;&#20307;&#26102;&#23454;&#38469;&#19978;&#24050;&#32463;&#39044;&#30041;&#20102;&#19968;&#20010;&#31354;&#38388;&#29992;&#20110;&#23384;&#20648;&#31561;&#24453;&#22359;&#65292;&#21363;_KTHREAD&#30340;0x70&#20559;&#31227;&#20301;&#25104;&#21592;WaitBlock&#65292;&#35813;&#25104;&#21592;&#39044;&#30041;&#20102;4&#20010;&#31561;&#24453;&#22359;&#30340;&#31354;&#38388;&#65292;&#21363;0x4 * _KWAIT_BLOCK&#30340;&#22823;&#23567;&#12290;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">kd&gt; dt _KTHREAD </code></div>
<div class="line"><code class="plain">nt!_KTHREAD</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Header           : _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   ...</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x05c</code><code class="plain"> WaitBlockList    : _KWAIT_BLOCK</code></div>
<div class="line"><code class="plain">   ...</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x070</code><code class="plain"> WaitBlock        : [</code><code class="value">4</code><code class="plain">] _KWAIT_BLOCK</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>    <span style="color: #000000;">
&#25105;&#20204;&#21487;&#20197;&#22522;&#20110;&rdquo;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#19968;&#20010;&#23545;&#35937;&ldquo;&#30340;&#20195;&#30721;&#20363;&#23376;&#26469;&#26597;&#30475;&#19979;&#35813;&#25104;&#21592;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;4&#20010;&#31561;&#24453;&#22359;&#30340;&#31354;&#38388;&#20013;&#65292;&#31532;&#19968;&#20010;&#21644;&#31532;&#22235;&#20010;&#37117;&#24050;&#32463;&#34987;&#25346;&#20837;&#20102;&#31561;&#24453;&#22359;&#65292;&#31532;&#19968;&#20010;&#26159;_KEVENT&#31561;&#24453;&#23545;&#35937;&#65292;<strong class=" ">&#32780;&#31532;&#22235;&#20010;&#23454;&#38469;&#19978;&#26159;&#22266;&#23450;&#30340;&#65292;&#23427;&#26159;&#19968;&#20010;&#23450;&#26102;&#22120;</strong>&#12290;&#22312;&#24403;&#21069;&#30340;&#29615;&#22659;&#20013;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#31532;&#22235;&#20010;&#31561;&#24453;&#22359;&#24182;&#27809;&#26377;&#34987;&#20351;&#29992;&#65288;NextWaitBlock&#25104;&#21592;&#20540;&#20026;&#31354;&#65289;&#65292;<strong class=" ">&#36825;&#26159;&#22240;&#20026;&#22312;&#25105;&#20204;&#20351;&#29992;WaitForSingleObject&#20989;&#25968;&#26102;&#65292;&#36229;&#26102;&#26102;&#38388;&#21442;&#25968;&#35774;&#32622;&#20026;&#20102;-1</strong>&#65292;&#22240;&#27492;&#23601;&#19981;&#20250;&#21435;&#20351;&#29992;&#23450;&#26102;&#22120;&#65292;<strong class=" ">&#22914;&#26524;&#25105;&#20204;&#35774;&#32622;&#20026;&#19968;&#20010;&#27491;&#25972;&#25968;&#20540;&#65292;&#21017;&#23450;&#26102;&#22120;&#23601;&#20250;&#34987;&#21551;&#29992;</strong>&#12290;    </span>
</p>
<p  class="auto-cursor-target" 
>    <span style="color: #000000;">
&#24403;&#23450;&#26102;&#22120;&#21551;&#29992;&#26102;&#65292;&#31532;&#22235;&#20010;&#31561;&#24453;&#22359;&#30340;NextWaitBlock&#25104;&#21592;&#23601;&#20250;&#25351;&#21521;&#31532;&#19968;&#20010;&#31561;&#24453;&#22359;&#30340;&#22320;&#22336;&#65292;&#21516;&#26679;&#31532;&#19968;&#20010;&#31561;&#24453;&#22359;&#30340;NextWaitBlock&#25104;&#21592;&#23601;&#20250;&#25351;&#21521;&#31532;&#22235;&#20010;&#31561;&#24453;&#22359;&#30340;&#22320;&#22336;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_20-36-30.png" alt="images/download/attachments/2424889/image2023-5-16_20-36-30.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#30001;&#20110;&#22312;&#36825;&#37324;&#24494;&#36719;&#21482;&#39044;&#30041;&#20102;4&#20010;&#31561;&#24453;&#22359;&#30340;&#31354;&#38388;&#65292;&#24182;&#19988;&#31532;&#22235;&#20010;&#31561;&#24453;&#22359;&#36824;&#26159;&#34987;&#22266;&#23450;&#20351;&#29992;&#30340;&#65292;&#22240;&#27492;&#25105;&#20204;&#22312;&#20351;&#29992;WaitForMultipleObjects&#20989;&#25968;&#26102;&#65292;&#24403;&#31561;&#24453;&#23545;&#35937;&#36229;&#36807;3&#20010;&#65292;&#23601;&#19981;&#20250;&#20877;&#32487;&#32493;&#20351;&#29992;&#36825;&#37324;&#30340;&#31354;&#38388;&#65292;&#32780;&#26159;&#21478;&#36767;&#19968;&#22359;&#26032;&#30340;&#31354;&#38388;&#23384;&#25918;&#31561;&#24453;&#22359;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#26377;4&#20010;&#31561;&#24453;&#23545;&#35937;&#26102;&#20505;&#65292;<strong class=" ">&#34429;&#28982;0x70&#20301;&#32622;&#22788;&#30340;&#31561;&#24453;&#22359;&#31354;&#38388;&#34987;&#20351;&#29992;&#20102;&#65292;&#20294;&#23454;&#38469;&#19978;&#22312;0x5C&#20301;&#32622;&#22788;&#30340;&#31561;&#24453;&#22359;&#22320;&#22336;&#24182;&#19981;&#26159;&#23427;&#65292;0x70&#20301;&#32622;&#22788;&#30340;&#31561;&#24453;&#22359;&#22320;&#22336;&#20063;&#24182;&#27809;&#26377;&#20986;&#29616;&#22312;0x5C&#23545;&#24212;&#31561;&#24453;&#22359;&#30340;&#19979;&#19968;&#31561;&#24453;&#22359;&#22320;&#22336;&#65288;&#21333;&#21521;&#24490;&#29615;&#38142;&#34920;&#65289;&#20013;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-16_21-10-51.png" alt="images/download/attachments/2424889/image2023-5-16_21-10-51.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20294;&#26159;&#22312;&rdquo;&#19968;&#20010;&#32447;&#31243;&#31561;&#24453;&#19981;&#36229;&#36807;3&#20010;&#23545;&#35937;&ldquo;&#30340;&#22330;&#26223;&#19979;&#65292;<strong class=" ">_KTHREAD+0x5C&#25152;&#25351;&#21521;&#30340;&#22320;&#22336;&#23601;&#26159;_KTHREAD+0x70&#30340;&#22320;&#22336;</strong>&#12290;    </span>
</p>
    </div>
    <div class="section section-4" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeWFs-mUruW-queOrw">
        <h4 class="heading "><span>&#20851;&#38190;&#24490;&#29615;</span></h4>
<p   
>    <span style="color: #000000;">
&#22312;&#31561;&#24453;&#22359;&#30340;&#22635;&#20805;&#21644;&#20934;&#22791;&#20043;&#21518;&#65292;KeWaitForSingleObject&#23601;&#20250;&#36827;&#20837;&#20851;&#38190;&#24490;&#29615;&#37096;&#20998;&#12290;&#65288;&#22312;&#35838;&#19978;&#65292;&#28023;&#19996;&#32769;&#24072;&#23558;&#35813;&#37096;&#20998;&#20197;&#20266;&#20195;&#30721;&#30340;&#24418;&#24335;&#36827;&#34892;&#35762;&#35299;&#65292;&#21487;&#20197;&#26356;&#24555;&#30340;&#36827;&#34892;&#29702;&#35299;&#65289;    </span>
</p>
<p  class="auto-cursor-target" 
>    <span style="color: #000000;">
&#20851;&#38190;&#24490;&#29615;&#37096;&#20998;&#30340;&#22823;&#33268;&#36923;&#36753;&#22914;&#19979;&#25152;&#31034;&#65292;&#36890;&#36807;&#20195;&#30721;&#25105;&#20204;&#30693;&#36947;&#22312;&#36825;&#37324;&#65292;SignalState&#21442;&#25968;&#36215;&#21040;&#20102;&#28608;&#27963;&#26465;&#20214;&#30340;&#21028;&#26029;&#20316;&#29992;&#65292;&#22240;&#27492;&#25105;&#20204;&#35201;&#20808;&#30693;&#36947;&#35813;&#21442;&#25968;&#30340;&#21547;&#20041;&#12290;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">while</code><code class="plain">(</code><code class="keyword">true</code><code class="plain">)               </code><code class="comments">// 每次线程被其他线程唤醒，都要进入这个循环</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain">(符合激活条件)      </code><code class="comments">// 激活条件：1.超时；2.等待对象的SignalState成员值大于0 </code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 1. 修改SignalState；</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 2. 退出循环。</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code><code class="plain">                   </code><code class="comments">// SignalState不大于0 也没超时</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain">(第一次执行)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 1. 将当前线程的等待块挂到等待对象的链表(WaitListHead) 中；</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 2. 将自己挂入等待链表(KiaitListHead)；</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// 3. 切换线程...再次获得CPU时，从这里开始执行。</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="value">1</code><code class="plain">. 线程将自己0x5C位置清0；</code></div>
<div class="line"><code class="value">2</code><code class="plain">. 释放_KWAIT_BLOCK所占内存。</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#19979;_DISPATCHER_HEADER&#32467;&#26500;&#20307;&#30340;&#21508;&#20010;&#25104;&#21592;&#21547;&#20041;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">kd&gt; dt _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">nt!_DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Type             : UChar      </code><code class="comments">// 可等待对象的类型</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x001</code><code class="plain"> Absolute         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x002</code><code class="plain"> Size             : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x003</code><code class="plain"> Inserted         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x004</code><code class="plain"> SignalState      : Int4B      </code><code class="comments">// 是否有信号，与信号量有关</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x008</code><code class="plain"> WaitListHead     : _LIST_ENTRY  </code><code class="comments">// 双向链表，所有的等待块都在这里</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#25509;&#30528;&#25105;&#20204;&#26469;&#29702;&#19968;&#19979;&#36825;&#27573;&#20266;&#20195;&#30721;&#30340;&#27969;&#31243;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#36827;&#20837;&#24490;&#29615;&#65292;&#21028;&#26029;&#24403;&#21069;&#34987;&#31561;&#24453;&#23545;&#35937;&#65288;&#20363;&#22914;Event&#65289;&#26159;&#21542;&#26377;&#20449;&#21495;&#65288;&#21363;&#21028;&#26029;_DISPATCHER_HEADER.SignalState&#30340;&#20540;&#65289;&#25110;&#32773;&#26159;&#21542;&#36229;&#26102;&#65288;&#21363;&#26159;&#21542;&#28385;&#36275;&#28608;&#27963;&#26465;&#20214;&#65289;&#65307;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#28385;&#36275;&#28608;&#27963;&#26465;&#20214;&#26102;</strong>&#65292;&#20462;&#25913;_DISPATCHER_HEADER.SignalState&#30340;&#20540;&#65292;<strong class=" ">&#36825;&#37324;&#19981;&#19968;&#23450;&#26159;&#28165;&#38646;</strong>&#65292;&#22240;&#20026;&#27599;&#31181;&#31561;&#24453;&#23545;&#35937;&#20462;&#25913;&#30340;&#26041;&#24335;&#19981;&#19968;&#26679;&#65292;<strong class=" ">&#26368;&#21518;&#36864;&#20986;&#24490;&#29615;</strong>&#12290;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#19981;&#28385;&#36275;&#28608;&#27963;&#26465;&#20214;&#26102;</strong>&#65292;&#21028;&#26029;&#26159;&#21542;&#26159;&#31532;&#19968;&#27425;&#25191;&#34892;&#12290;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#22914;&#26524;&#26159;&#31532;&#19968;&#27425;&#25191;&#34892;</strong>&#65292;&#23558;&#24403;&#21069;&#32447;&#31243;&#30340;&#31561;&#24453;&#22359;&#25346;&#21040;&#31561;&#24453;&#23545;&#35937;&#30340;&#38142;&#34920;&#65288;&#21363;_DISPATCHER_HEADER.WaitListHead&#65289;&#20013;&#65292;&#27492;&#26102;&#36827;&#20837;&#20102;&#31561;&#24453;&#32593;&#12290;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#25509;&#30528;&#23558;&#33258;&#24049;&#25346;&#20837;&#31561;&#24453;&#38142;&#34920;&#65288;KiWaitListHead&#65289;&#20013;</strong>&#65292;&#24403;&#32447;&#31243;&#33258;&#24049;&#25226;&#33258;&#24049;&#25346;&#20837;&#31561;&#24453;&#38142;&#34920;&#20197;&#21518;&#65292;&#23601;&#30456;&#24403;&#20110;&#20132;&#20986;&#21435;CPU&#25511;&#21046;&#26435;&#65292;&#24182;&#36827;&#34892;&#32447;&#31243;&#20999;&#25442;&#65307;&#27492;&#26102;&#24490;&#29615;&#25165;&#25191;&#34892;&#21040;&#19968;&#21322;&#65292;&#24182;&#26410;&#25191;&#34892;&#23436;&#65292;&#33258;&#24049;&#23601;&#34987;&#20999;&#25442;&#20986;&#21435;&#20102;&#12290;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">&#24403;&#32447;&#31243;&#23558;&#33258;&#24049;&#25346;&#20837;&#31561;&#24453;&#38431;&#21015;&#21518;</strong>&#65292;&#38656;&#35201;&#31561;&#24453;&#21478;&#19968;&#20010;&#32447;&#31243;&#23558;&#33258;&#24049;&#21796;&#37266;&#65288;<strong class=" ">&#35774;&#32622;&#31561;&#24453;&#23545;&#35937;&#20449;&#21495;SignalState&gt;0</strong>&#65289;&#65292;&#27492;&#26102;&#36825;&#20010;&#32447;&#31243;&#20250;&#26681;&#25454;&#20854;&#35774;&#32622;&#30340;&#31561;&#24453;&#23545;&#35937;WaitListHead&#38142;&#30528;&#30340;&#31561;&#24453;&#22359;&#65292;&#32473;&#25152;&#26377;&#31561;&#24453;&#22359;&#30340;&#25152;&#23646;&#32447;&#31243;&#19968;&#27425;<strong class=" ">&#20020;&#26102;&#22797;&#27963;</strong>&#30340;&#26426;&#20250;&#65307;&#36825;&#20010;&#20020;&#26102;&#22797;&#27963;&#24847;&#24605;&#26159;&#23558;&#36825;&#20123;&#32447;&#31243;<strong class=" ">&#20174;&#31561;&#24453;&#38142;&#34920;&#19978;&#25688;&#38500;</strong>&#65292;&#20294;&#26159;<strong class=" ">&#20381;&#26087;&#25346;&#22312;&#31561;&#24453;&#32593;&#19978;</strong>&#65292;&#25152;&#20197;&#34987;&#31216;&#20316;&#20020;&#26102;&#22797;&#27963;&#12290;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
&#21796;&#37266;&#30340;&#32447;&#31243;&#24182;&#19981;&#20250;&#23558;&#31561;&#24453;&#30340;&#32447;&#31243;&#20174;&#31561;&#24453;&#32593;&#19978;&#25688;&#38500;&#65292;<strong class=" ">&#36825;&#38656;&#35201;&#31561;&#24453;&#30340;&#32447;&#31243;&#33258;&#24049;&#36827;&#34892;&#25688;&#38500;&#65292;&#22240;&#27492;&#24403;&#31561;&#24453;&#30340;&#32447;&#31243;&#20877;&#27425;&#33719;&#24471;CPU&#25511;&#21046;&#26435;&#26102;&#65292;&#20250;&#22312;&rdquo;&#33258;&#24049;&#25226;&#33258;&#24049;&#25346;&#20837;&#31561;&#24453;&#38142;&#34920;&#65288;KiWaitListHead&#65289;&ldquo;&#21518;&#30340;&#20301;&#32622;&#65292;&#32487;&#32493;&#25191;&#34892;&#20195;&#30721;</strong>&#65292;&#24182;&#37325;&#26032;&#36827;&#20837;&#24490;&#29615;&#21028;&#26029;&#30340;&#20837;&#21475;&#65292;&#20877;&#21028;&#26029;&#33258;&#24049;&#26159;&#21542;&#31526;&#21512;&#28608;&#27963;&#26465;&#20214;&#65292;&#22914;&#26524;&#31526;&#21512;&#30340;&#35805;&#21017;&#20462;&#25913;SignalState&#30340;&#20540;&#65292;&#24182;&#36864;&#20986;&#24490;&#29615;&#12290;    </span>
</p>
</li></ol></li></ol></li><li class=" "><p   
>    <span style="color: #000000;">
&#36864;&#20986;&#24490;&#29615;&#20043;&#21518;&#65292;&#32447;&#31243;&#20250;&#23558;&#33258;&#24049;&#32467;&#26500;&#20307;0x5C&#30340;&#20301;&#32622;&#28165;0&#65292;&#37322;&#25918;_KWAIT_BLOCK&#25152;&#21344;&#20869;&#23384;&#65292;&#28982;&#21518;&#23558;&#33258;&#24049;&#20174;&#31561;&#24453;&#32593;&#19978;&#25688;&#38500;&#65292;<strong class=" ">&#25104;&#21151;&#22797;&#27963;&#65288;&#21796;&#37266;</strong>&#65289;&#12290;    </span>
</p>
</li></ol><p   
>    <span style="color: #000000;">
&#36825;&#37324;&#20026;&#20160;&#20040;&#31561;&#24453;&#30340;&#32447;&#31243;&#35201;&#33258;&#24049;&#25226;&#33258;&#24049;&#20174;&#31561;&#24453;&#32593;&#19978;&#36827;&#34892;&#25688;&#38500;&#65292;&#32780;&#19981;&#26159;&#36890;&#36807;&#21796;&#37266;&#30340;&#32447;&#31243;&#26469;&#25688;&#38500;&#65292;&#36825;&#26159;&#22240;&#20026;&#20250;<strong class=" ">&#20986;&#29616;&#31561;&#24453;&#30340;&#32447;&#31243;&#19981;&#27490;&#26377;&#19968;&#20010;&#31561;&#24453;&#23545;&#35937;&#65292;&#25110;&#32773;&#19968;&#20010;&#31561;&#24453;&#23545;&#35937;&#26377;&#22810;&#20010;&#32447;&#31243;&#22312;&#31561;&#24453;&#30340;&#22330;&#26223;</strong>&#65292;&#22914;&#26524;&#36890;&#36807;&#21796;&#37266;&#30340;&#32447;&#31243;&#21435;&#25688;&#38500;&#21017;&#19981;&#31526;&#21512;&#35774;&#35745;&#30340;&#36923;&#36753;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#25442;&#21477;&#35805;&#35828;&#65292;&#22312;&#24403;&#21069;&#30340;&#36923;&#36753;&#37324;&#65292;&#31561;&#24453;&#30340;&#32447;&#31243;&#20020;&#26102;&#22797;&#27963;&#65292;&#20250;&#25509;&#30528;&#25191;&#34892;&#24182;&#37325;&#26032;&#36827;&#20837;&#24490;&#29615;&#65292;&#22914;&#26524;&#23427;&#21482;&#26377;&#19968;&#20010;&#31561;&#24453;&#22359;&#65292;&#37027;&#20040;&#36825;&#20010;&#32447;&#31243;&#20250;&#31526;&#21512;&#28608;&#27963;&#26465;&#20214;&#65292;&#24182;&#36864;&#20986;&#24490;&#29615;&#12290;&#20294;&#21448;&#22240;&#20026;&#23427;&#36864;&#20986;&#24490;&#29615;&#20043;&#21069;&#65292;&#20462;&#25913;&#20102;SignalState&#30340;&#20540;&#65292;<strong class=" ">&#23548;&#33268;&#21518;&#38754;&#33719;&#24471;CPU&#25511;&#21046;&#26435;&#30340;&#32447;&#31243;&#65288;&#21516;&#26679;&#22312;&#31561;&#24453;&#35813;&#23545;&#35937;&#65289;&#19981;&#31526;&#21512;&#28608;&#27963;&#26465;&#20214;</strong>&#65292;&#24182;&#23558;&#37325;&#26032;&#25346;&#21040;KiWaitListHead&#31561;&#24453;&#38142;&#34920;&#19978;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22914;&#26524;&#23427;&#26377;&#22810;&#20010;&#31561;&#24453;&#22359;&#65292;&#22312;&#21028;&#26029;&#31532;&#20108;&#20010;&#31561;&#24453;&#22359;&#26102;&#65292;&#20063;&#20250;&#22240;&#20026;&#19981;&#31526;&#21512;&#28608;&#27963;&#26465;&#20214;&#65292;&#20063;&#35201;&#37325;&#26032;&#23558;&#33258;&#24049;&#25346;&#21040;KiWaitListHead&#19978;&#12290;&#20063;&#23601;&#26159;&#35828;&#65292;&#21482;&#26377;&#31532;&#19968;&#20010;&#33719;&#24471;CPU&#25511;&#21046;&#26435;&#65292;&#19988;&#21482;&#26377;&#19968;&#20010;&#31561;&#24453;&#22359;&#30340;&#32447;&#31243;&#65292;<strong class=" ">&#25165;&#33021;&#23436;&#20840;&#22797;&#27963;&#65292;&#21035;&#30340;&#20020;&#26102;&#22797;&#27963;&#30340;&#32447;&#31243;&#65292;&#35201;&#37325;&#26032;&#25346;&#21040;&#31561;&#24453;&#38142;&#34920;&#19978;</strong>&#12290;    </span>
</p>
    </div>
    </div>
    <div class="section section-3" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeWFs-S6juW8uuWItuWUpOmGkg">
        <h3 class="heading "><span>&#20851;&#20110;&#24378;&#21046;&#21796;&#37266;</span></h3>
<p   
>    <span style="color: #000000;">
&#22312;APC&#31456;&#33410;&#20013;&#20102;&#35299;&#36807;&#65292;&#24403;&#25105;&#20204;&#25554;&#20837;&#19968;&#20010;&#29992;&#25143;APC&#26102;&#65288;Alertable=1&#65289;&#65292;&#24403;&#21069;&#32447;&#31243;&#26159;&#21487;&#20197;&#34987;&#21796;&#37266;&#30340;&#65292;&#20294;&#24182;&#19981;&#26159;&#30495;&#27491;&#30340;&#21796;&#37266;&#12290;&#22240;&#20026;&#65292;<strong class=" ">&#22914;&#26524;&#24403;&#21069;&#30340;&#32447;&#31243;&#22312;&#31561;&#24453;&#32593;&#19978;&#65292;&#25191;&#34892;&#23436;&#29992;&#25143;APC&#21518;&#65292;&#20173;&#28982;&#35201;&#36827;&#20837;&#31561;&#24453;&#29366;&#24577;</strong>&#12290;    </span>
</p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeetieW-heWvueixoQ">
        <h1 class="heading "><span>&#31561;&#24453;&#23545;&#35937;</span></h1>
<p   
>    <span style="color: #000000;">
&#22312;&#20043;&#21069;&#30340;&#31456;&#33410;&#23398;&#20064;&#20013;&#25105;&#20204;&#20102;&#35299;&#21040;KeWaitForSingleObject&#20989;&#25968;&#20851;&#38190;&#24490;&#29615;&#37096;&#20998;&#65292;&#20250;&#21028;&#26029;&#32447;&#31243;&#30340;&#28608;&#27963;&#26465;&#20214;&#65292;&#22914;&#26524;&#31526;&#21512;&#26465;&#20214;&#23601;<strong class=" ">&#20462;&#25913;&#31561;&#24453;&#23545;&#35937;&#30340;SignalState</strong>&#24182;&#36864;&#20986;&#24490;&#29615;&#12290;&#32447;&#31243;&#30340;&#28608;&#27963;&#26465;&#20214;&#65288;&#31561;&#24453;&#23545;&#35937;&#30340;SignalState&#65289;&#26159;&#30001;&#31561;&#24453;&#23545;&#35937;&#31867;&#22411;&#23545;&#24212;&#20989;&#25968;&#20915;&#23450;&#30340;&#65292;&#19981;&#21516;&#30340;&#31561;&#24453;&#23545;&#35937;&#26377;&#19981;&#21516;&#30340;&#20989;&#25968;<strong class=" ">&#23558;&#32447;&#31243;&#36827;&#34892;&#20020;&#26102;&#21796;&#37266;</strong>&#65292;&#22914;_KEVENT&#20107;&#20214;&#23545;&#35937;&#65292;&#23427;&#23545;&#24212;&#20351;&#29992;&#30340;&#20020;&#26102;&#21796;&#37266;&#20989;&#25968;&#26159;SetEvent&#12290;&#19981;&#21516;&#30340;&#31561;&#24453;&#23545;&#35937;&#65292;&#22312;<strong class=" ">&#20020;&#26102;&#21796;&#37266;&#30340;&#22788;&#29702;</strong>&#19978;&#65292;&#20197;&#21450;<strong class=" ">&#20462;&#25913;&#31561;&#24453;&#23545;&#35937;&#30340;SignalState</strong>&#30340;&#27493;&#39588;&#19978;&#37117;&#20250;&#26377;&#25152;&#24046;&#24322;&#12290;    </span>
</p>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS6i-S7tg">
        <h2 class="heading "><span>&#20107;&#20214;</span></h2>
<p   
>    <span style="color: #000000;">
&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#19979;&#20107;&#20214;&#31867;&#22411;&#65292;&#20107;&#20214;&#23545;&#35937;&#21487;&#20197;&#36890;&#36807;CreateEvent&#20989;&#25968;&#36827;&#34892;&#21019;&#24314;&#65292;&#23427;&#30340;&#35821;&#27861;&#22914;&#19979;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateEvent(</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpEventAttributes, </code><code class="comments">// 决定返回的句柄是否可以被子进程继承,为NULL，则该句柄不能被继承</code></div>
<div class="line"><code class="plain">    BOOL bManualReset,                       </code><code class="comments">// 创建的事件对象类型</code></div>
<div class="line"><code class="plain">    BOOL bInitialState,                      </code><code class="comments">// 初始化的信号状态</code></div>
<div class="line"><code class="plain">    LPCTSTR lpName                           </code><code class="comments">// 指定事件对象的名称</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#22312;&#36825;&#37324;&#25105;&#20204;&#38656;&#35201;&#20851;&#27880;bManualReset&#21644;bInitialState&#20004;&#20010;&#21442;&#25968;&#65292;bInitialState&#21442;&#25968;&#20915;&#23450;&#20102;<strong class=" ">&#21021;&#22987;&#21270;&#30340;&#20449;&#21495;&#29366;&#24577;</strong>&#65292;&#22914;&#26524;&#35813;&#20540;<strong class=" ">&#20026;FALSE&#21017;&#20107;&#20214;&#23545;&#35937;&#30340;_DISPATCHER_HEADER.SignalState&#20540;&#20026;0&#65292;&#21453;&#20043;&#21017;&#20026;1</strong>&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#21457;&#29616;&#30830;&#23454;&#22914;&#27492;&#65292;<strong class=" ">&#21021;&#22987;&#21270;&#20449;&#21495;&#29366;&#24577;&#20026;TRUE&#26102;&#65292;&#27809;&#26377;&#31561;&#24453;&#30452;&#25509;&#23601;&#25191;&#34892;&#20102;&#19979;&#38754;&#30340;&#20195;&#30721;</strong>&#65292;&#32780;&#20026;FALSE&#26102;&#21017;&#19968;&#30452;&#22788;&#20110;&#31561;&#24453;&#29366;&#24577;&#65292;&#27809;&#26377;&#25191;&#34892;&#20195;&#30721;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_15-50-17.png" alt="images/download/attachments/2424889/image2023-5-17_15-50-17.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
bManualReset&#21442;&#25968;&#20915;&#23450;&#20102;<strong class=" ">&#21019;&#24314;&#30340;&#20107;&#20214;&#23545;&#35937;&#31867;&#22411;</strong>&#65292;&#35813;&#20540;&#20026;TRUE&#21017;&#34920;&#31034;&#24403;&#21069;&#20026;<strong class=" ">&#36890;&#30693;&#31867;&#22411;</strong>&#30340;&#23545;&#35937;&#65292;<strong class=" ">&#20107;&#20214;&#23545;&#35937;&#30340;_DISPATCHER_HEADER.Type&#20540;&#20026;0</strong>&#65307;&#35813;&#20540;&#20026;FALSE&#21017;&#34920;&#31034;&#24403;&#21069;&#20026;<strong class=" ">&#20107;&#20214;&#21516;&#27493;&#31867;&#22411;</strong>&#30340;&#23545;&#35937;&#65292;<strong class=" ">&#20107;&#20214;&#23545;&#35937;&#30340;_DISPATCHER_HEADER.Type&#20540;&#20026;1</strong>&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#25104;&#21151;&#24471;&#21040;&#36825;&#20010;&#32467;&#35770;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_16-1-4.png" alt="images/download/attachments/2424889/image2023-5-17_16-1-4.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#36890;&#30693;&#31867;&#22411;&#19982;&#21516;&#27493;&#31867;&#22411;&#30340;&#20107;&#20214;&#23545;&#35937;&#20063;&#26159;&#26377;&#24046;&#24322;&#30340;&#65292;&#20855;&#20307;&#20307;&#29616;&#22312;SetEvnet&#20989;&#25968;&#20351;&#29992;&#21518;&#65292;&#31561;&#24453;&#36890;&#30693;&#31867;&#22411;&#30340;&#20107;&#20214;&#23545;&#35937;&#32447;&#31243;&#20250;<strong class=" ">&#34987;&#21796;&#37266;&#28982;&#21518;&#21521;&#19979;&#25191;&#34892;&#20195;&#30721;</strong>&#65292;&#32780;&#31561;&#24453;&#21516;&#27493;&#31867;&#22411;&#30340;&#20107;&#20214;&#23545;&#35937;&#32447;&#31243;<strong class=" ">&#20173;&#28982;&#22788;&#20110;&#31561;&#24453;&#29366;&#24577;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_16-16-35.png" alt="images/download/attachments/2424889/image2023-5-17_16-16-35.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20043;&#21069;&#25105;&#20204;&#20102;&#35299;&#21040;&#19981;&#21516;&#30340;&#31561;&#24453;&#23545;&#35937;&#65292;&#22312;&#20020;&#26102;&#21796;&#37266;&#20197;&#21450;&#20851;&#38190;&#24490;&#29615;&#22788;&#20462;&#25913;SignalState&#20250;&#26377;&#24046;&#24322;&#65292;&#22240;&#27492;&#25105;&#20204;&#20808;&#26469;&#20855;&#20307;&#30475;&#19979;SetEvent&#20989;&#25968;&#30340;&#20316;&#29992;&#65292;<strong class=" ">&#35813;&#20989;&#25968;&#23545;&#24212;&#30340;&#20869;&#26680;&#20989;&#25968;&#20026;KeSetEvent</strong>&#65292;&#23427;&#20570;&#20102;&#36825;&#20123;&#20107;&#24773;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#20462;&#25913;SignalState&#20026;1&#65307;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
&#21028;&#26029;&#23545;&#35937;&#31867;&#22411;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#36890;&#30693;&#31867;&#22411;&#65292;&#21017;&#21796;&#37266;&#25152;&#26377;&#31561;&#24453;&#35813;&#29366;&#24577;&#30340;&#32447;&#31243;&#65292;&#20063;&#23601;&#26159;<strong class=" ">&#20174;&#31561;&#24453;&#38142;&#34920;&#20013;&#25688;&#38500;&#36825;&#20123;&#32447;&#31243;</strong>&#65307;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
&#21516;&#27493;&#31867;&#22411;&#65292;&#20174;&#31561;&#24453;&#38142;&#34920;&#20013;&#25214;&#21040;&#31532;&#19968;&#20010;&#32447;&#31243;&#30340;&#31561;&#24453;&#22359;_KWAIT_BLOCK.WaitType&#20540;&#20026;1&#30340;&#32447;&#31243;&#65292;<strong class=" ">&#23558;&#20854;&#20020;&#26102;&#21796;&#37266;</strong>&#12290;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#39564;&#35777;&#35813;&#32467;&#35770;&#65306;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_20-37-21.png" alt="images/download/attachments/2424889/image2023-5-17_20-37-21.png" width="600"  />
    </span>
</p>
</li></ol></li></ol></li></ol><p   
>    <span style="color: #000000;">
&#25509;&#30528;&#25105;&#20204;&#38656;&#35201;&#20998;&#26512;&#19968;&#19979;KeWaitForSingleObject&#20989;&#25968;&#65292;&#26469;&#30475;&#19979;&#23427;&#23545;&#19981;&#21516;&#30340;&#20107;&#20214;&#23545;&#35937;&#31867;&#22411;&#20570;&#30340;&#19981;&#21516;&#22788;&#29702;&#65292;&#36890;&#36807;IDA&#25171;&#24320;Ntoskrnl.exe&#21363;&#21487;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#24403;&#20107;&#20214;&#23545;&#35937;&#30340;Type&#20026;0&#26102;&#65288;&#21363;&#36890;&#30693;&#31867;&#22411;&#20107;&#20214;&#23545;&#35937;&#65289;&#65292;WaitForSingleObject&#20989;&#25968;&#22312;&#22788;&#29702;&#26102;<strong class=" ">&#24182;&#19981;&#20250;&#20462;&#25913;SignalState</strong>&#65292;&#22240;&#27492;&#27599;&#20010;&#31561;&#24453;&#35813;&#23545;&#35937;&#30340;&#36827;&#31243;&#37117;&#21487;&#20197;&#20174;&#31561;&#24453;&#32593;&#20013;&#25688;&#38500;&#65292;&#20174;&#32780;&#21796;&#37266;&#32447;&#31243;&#32487;&#32493;&#25191;&#34892;&#20195;&#30721;&#65307;&#24403;&#20107;&#20214;&#23545;&#35937;&#30340;Type&#20026;1&#26102;&#65288;&#21363;&#21516;&#27493;&#31867;&#22411;&#20107;&#20214;&#23545;&#35937;&#65289;&#65292;<strong class=" ">WaitForSingleObject&#20989;&#25968;&#22312;&#22788;&#29702;&#26102;&#20462;&#25913;SignalState&#20026;0</strong>&#65292;&#22240;&#27492;&#21482;&#26377;&#19968;&#20010;&#32447;&#31243;&#33021;&#22815;&#24471;&#21040;&#25191;&#34892;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_21-35-24.png" alt="images/download/attachments/2424889/image2023-5-17_21-35-24.png" width="800"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22312;&#22270;&#20013;&#20854;&#23454;&#25105;&#20204;&#20063;&#21487;&#20197;&#30475;&#35265;&#19968;&#20010;&#21028;&#26029;Type&#30340;&#20540;&#20026;5&#30340;&#24773;&#20917;&#19979;&#20250;&#23545;SignalState&#30340;&#20540;&#36827;&#34892;&#20943;1&#65292;&#36825;&#37324;Type&#20026;5&#26102;&#23454;&#38469;&#19978;&#31561;&#24453;&#23545;&#35937;&#30340;&#31867;&#22411;&#23601;&#26159;&#20449;&#21495;&#37327;&#20102;&#65292;&#22312;&#19979;&#19968;&#31456;&#33410;&#30340;&#23398;&#20064;&#20013;&#25105;&#20204;&#23601;&#38656;&#35201;&#26469;&#20102;&#35299;&#20449;&#21495;&#37327;&#12290;    </span>
</p>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS_oeWPt-mHjw">
        <h2 class="heading "><span>&#20449;&#21495;&#37327;</span></h2>
<p   
>    <span style="color: #000000;">
&#19978;&#19968;&#31456;&#30340;&#23398;&#20064;&#20013;&#65292;&#25105;&#20204;&#30693;&#36947;&#31561;&#24453;&#20107;&#20214;&#23545;&#35937;&#30340;&#32447;&#31243;&#22312;&#36827;&#20837;&#20020;&#30028;&#21306;&#20043;&#21069;&#20250;&#36890;&#36807;&#35843;&#29992;WaitForSingleObject&#25110;&#32773;WaitForMultipleObjects&#26469;&#21028;&#26029;&#24403;&#21069;&#30340;&#20107;&#20214;&#23545;&#35937;&#26159;&#21542;&#26377;&#20449;&#21495;&#65288;&#21363;SignalState&#30340;&#20540;&#22823;&#20110;0&#65289;&#65292;&#21482;&#26377;&#24403;&#20107;&#20214;&#23545;&#35937;&#26377;&#20449;&#21495;&#26102;&#65292;&#25165;&#21487;&#20197;&#36827;&#20837;&#20020;&#30028;&#21306;&#12290; &#38656;&#35201;&#35828;&#26126;&#30340;&#26159;&#65292;<strong class=" ">&#36825;&#37324;&#30340;&#20020;&#30028;&#21306;&#25351;&#30340;&#26159;&#24191;&#20041;&#19978;&#30340;&#20020;&#30028;&#21306;</strong>&#65292;&#21363;&#21482;&#20801;&#35768;&#19968;&#20010;&#32447;&#31243;&#36827;&#20837;&#30452;&#21040;&#36864;&#20986;&#30340;&#19968;&#27573;&#20195;&#30721;&#65288;&#19981;&#26159;&#25351;&#29992;EnterCriticalSection&#21644;LeaveCriticalSection&#20989;&#25968;&#32780;&#24418;&#25104;&#30340;&#20020;&#30028;&#21306;&#65289;&#65292;&#36825;&#37324;&#25105;&#20204;&#21487;&#20197;&#35748;&#20026;&#23601;&#26159;WaitForXX&#21644;SetEvent&#20989;&#25968;&#25152;&#24418;&#25104;&#30340;&#20020;&#30028;&#21306;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_16-31-13.png" alt="images/download/attachments/2424889/image2023-5-18_16-31-13.png" width="400"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20449;&#21495;&#37327;&#19982;&#20107;&#20214;&#30340;&#24046;&#24322;&#22312;&#20110;&#21069;&#32773;&#20801;&#35768;&#22810;&#20010;&#32447;&#31243;&#21516;&#26102;&#36827;&#20837;&#30001;WaitForXX&#21644;ReleaseSemaphore&#20989;&#25968;&#24418;&#25104;&#30340;&#20020;&#30028;&#21306;&#12290;&#20107;&#20214;&#21487;&#20197;&#22312;<strong class=" ">&#22810;&#20010;&#32447;&#31243;&#24819;&#35201;&#21516;&#26102;&#23545;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#36827;&#34892;&#22788;&#29702;&#26102;</strong>&#36827;&#34892;&#20351;&#29992;&#65292;&#30830;&#20445;&#21482;&#26377;&#19968;&#20010;&#32447;&#31243;&#20250;&#23545;&#20854;&#36827;&#34892;&#22788;&#29702;&#65292;&#22788;&#29702;&#23436;&#20043;&#21518;&#20877;&#32473;&#21040;&#21478;&#22806;&#19968;&#20010;&#32447;&#31243;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_16-34-47.png" alt="images/download/attachments/2424889/image2023-5-18_16-34-47.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20449;&#21495;&#37327;&#29992;&#20110;<strong class=" ">&#35299;&#20915;&#29983;&#20135;&#32773;&#19982;&#28040;&#36153;&#32773;&#38382;&#39064;</strong>&#65292;&#20063;&#23601;&#26159;&#22312;&#29983;&#20135;&#36164;&#28304;&#19982;&#28040;&#36153;&#32773;&#25968;&#37327;&#19981;&#23545;&#31561;&#30340;&#24773;&#20917;&#19979;&#65292;&#35813;&#22914;&#20309;&#30830;&#20445;&#32447;&#31243;&#21516;&#27493;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#26377;1&#20010;&#29983;&#20135;&#32773;&#32447;&#31243;&#65292;&#27599;&#27425;&#21487;&#20197;&#29983;&#20135;&#20986;3&#20010;&#36164;&#28304;&#65292;&#27492;&#26102;&#26377;5&#20010;&#28040;&#36153;&#32773;&#32447;&#31243;&#65292;&#38656;&#35201;&#20445;&#35777;&#19981;&#20250;&#26377;2&#20010;&#32447;&#31243;&#21516;&#26102;&#28040;&#36153;1&#20010;&#36164;&#28304;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_16-40-52.png" alt="images/download/attachments/2424889/image2023-5-18_16-40-52.png" width="400"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#22914;&#26524;&#25105;&#20204;&#20351;&#29992;&#20107;&#20214;&#23545;&#35937;&#26469;&#25511;&#21046;&#32447;&#31243;&#30340;&#21516;&#27493;&#23601;&#30456;&#24403;&#30340;&#22256;&#38590;&#65292;&#25928;&#29575;&#20063;&#30456;&#23545;&#36739;&#20302;&#12290;&#20363;&#22914;&#25105;&#20204;&#20351;&#29992;&#21516;&#27493;&#31867;&#22411;&#30340;&#20107;&#20214;&#23545;&#35937;&#65292;&#30001;&#20110;<strong class=" ">&#20107;&#20214;&#23545;&#35937;&#30340;SignalState&#30340;&#20540;&#21482;&#33021;&#20026;0&#25110;&#32773;1</strong>&#65292;<strong class=" ">&#25152;&#20197;&#21516;&#19968;&#26102;&#38388;&#21482;&#26377;&#19968;&#20010;&#28040;&#36153;&#32773;&#32447;&#31243;&#21487;&#20197;&#33719;&#24471;&#36164;&#28304;</strong>&#65292;&#27492;&#26102;&#25928;&#29575;&#23601;&#24456;&#20302;&#65307;&#22914;&#26524;&#20351;&#29992;&#36890;&#30693;&#31867;&#22411;&#30340;&#20107;&#20214;&#23545;&#35937;&#65292;&#36890;&#30693;&#31867;&#22411;&#23545;&#35937;&#21796;&#37266;&#30340;&#32447;&#31243;&#65292;&#22312;&#36827;&#20837;KeWaitForSingleObject&#30340;&#20851;&#38190;&#24490;&#29615;&#21518;&#65292;&#19981;&#20250;&#20462;&#25913;SignalState&#30340;&#20540;&#65292;<strong class=" ">&#25152;&#20197;5&#20010;&#28040;&#36153;&#32773;&#32447;&#31243;&#37117;&#20250;&#34987;&#21796;&#37266;</strong>&#65292;&#21448;&#30001;&#20110;&#27492;&#26102;&#20165;&#29983;&#20135;&#20102;3&#20010;&#36164;&#28304;&#65292;&#25152;&#20197;&#20250;&#36896;&#25104;&#24615;&#33021;&#30340;&#28010;&#36153;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#32508;&#19978;&#25152;&#36848;&#65292;&#25105;&#20204;&#21487;&#20197;&#20511;&#21161;&#20449;&#21495;&#37327;&#30340;&#29305;&#28857;&#26469;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;&#32780;&#20449;&#21495;&#37327;&#30340;&#29305;&#28857;&#23454;&#38469;&#19978;<strong class=" ">&#23601;&#26159;&#23545;&#20110;&#20449;&#21495;&#37327;&#23545;&#35937;&#30340;SignalState&#20540;&#30340;&#20462;&#25913;</strong>&#12290;&#25105;&#20204;&#39318;&#20808;&#26469;&#30475;&#19968;&#19979;&#22914;&#20309;&#21019;&#24314;&#20449;&#21495;&#37327;&#65292;&#20351;&#29992;&#30340;&#20989;&#25968;&#26159;CreateSemaphore&#65292;&#23427;&#30340;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateSemaphore(</code></div>
<div class="line"><code class="plain">    LPSECURITY_ATTRIBUTES lpSemaphoreAttributes,</code></div>
<div class="line"><code class="plain">    LONG lInitialCount,                          </code><code class="comments">// 初始化的SignalState值</code></div>
<div class="line"><code class="plain">    LONG lMaximumCount,                          </code><code class="comments">// 最大的数量</code></div>
<div class="line"><code class="plain">    LPCTSTR lpName</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#20449;&#21495;&#37327;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#22914;&#19979;&#65292;&#35813;&#32467;&#26500;&#20307;&#30001;_DISPATCHER_HEADER&#21644;Limit&#25104;&#21592;&#32452;&#25104;&#65292;<strong class=" ">&#21019;&#24314;&#20449;&#21495;&#37327;&#23545;&#35937;&#23601;&#26159;&#22635;&#20805;&#36825;&#20010;&#32467;&#26500;&#20307;</strong>&#65292;CreateSemaphore&#20989;&#25968;&#30340;lInitialCount&#22635;&#20805;_DISPATCHER_HEADER.SignalState&#65292;lMaximumCount&#22635;&#20805;Limit&#12290;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">kd&gt; dt _KSEMAPHORE</code></div>
<div class="line"><code class="plain">nt!_KSEMAPHORE</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Header           : _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x010</code><code class="plain"> Limit            : Int4B       </code><code class="comments">// lMaximumCount</code></div>
<div class="line"><code class="plain">kd&gt; dt _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">nt!_DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Type             : UChar       </code><code class="comments">// 信号量对应的值为5</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x001</code><code class="plain"> Absolute         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x002</code><code class="plain"> Size             : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x003</code><code class="plain"> Inserted         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x004</code><code class="plain"> SignalState      : Int4B       </code><code class="comments">// lInitialCount</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x008</code><code class="plain"> WaitListHead     : _LIST_ENTRY</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#37322;&#25918;&#20449;&#21495;&#37327;&#23545;&#35937;&#30340;&#20989;&#25968;&#23601;&#26159;ReleaseSemaphore&#65292;&#23427;&#30340;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">BOOL ReleaseSemaphore(</code></div>
<div class="line"><code class="plain">  HANDLE hSemaphore,       </code><code class="comments">// 信号量的句柄</code></div>
<div class="line"><code class="plain">  LONG lReleaseCount,      </code><code class="comments">// 增加的数量</code></div>
<div class="line"><code class="plain">  LPLONG lpPreviousCount   </code><code class="comments">// 输出增加前的数量</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#35813;&#20989;&#25968;&#22312;0&#29615;&#23601;&#26159;KeReleaseSemaphore&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;IDA&#20998;&#26512;&#30475;&#35265;&#65292;&#35813;&#20989;&#25968;&#39318;&#20808;<strong class=" ">&#23558;&#21407;SignalState&#19982;lReleaseCount&#30340;&#20540;&#30456;&#21152;</strong>&#65292;&#28982;&#21518;&#37325;&#26032;&#36171;&#32473;SignalState&#65292;&#25509;&#30528;&#36890;&#36807;&#21462;&#32447;&#31243;&#32467;&#26500;&#20307;&#30340;&#26041;&#24335;&#65292;&#23558;&#20854;WaitListEntry&#38142;&#34920;&#30340;Flink&#12289;Blink&#36827;&#34892;&#20301;&#32622;&#20132;&#25442;&#65292;&#20174;&#32780;&#23454;&#29616;&#20174;&#31561;&#24453;&#38142;&#34920;&#20013;&#25688;&#38500;&#24403;&#21069;&#32447;&#31243;&#65288;&#20351;&#29992;&#30340;&#26159;&#25105;&#20204;&#20043;&#21069;APC&#31456;&#33410;&#20013;&#25552;&#21040;&#30340;KiUnwaitThread&#20989;&#25968;&#65289;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_18-46-1.png" alt="images/download/attachments/2424889/image2023-5-18_18-46-1.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#38500;&#20102;&#36825;&#20010;&#25805;&#20316;&#20197;&#22806;&#65292;&#22312;WaitForSingleObject&#20989;&#25968;&#20869;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#30475;&#35265;&#65292;&#20043;&#25152;&#20197;&#20449;&#21495;&#37327;&#21487;&#20197;&#35299;&#20915;&#29983;&#20135;&#28040;&#36153;&#38382;&#39064;&#65292;&#26159;&#22240;&#20026;&#23545;SignalState&#20540;&#30340;&#20462;&#25913;&#26041;&#24335;&#26159;&#20943;1&#65292;&#36825;&#26679;&#20449;&#21495;&#37327;&#23601;&#21487;&#20197;&#31934;&#20934;&#25511;&#21046;&#36827;&#20837;&#20020;&#30028;&#21306;&#32447;&#31243;&#30340;&#25968;&#37327;&#65292;&#20174;&#32780;&#23454;&#29616;&#29983;&#20135;&#36164;&#28304;&#19982;&#28040;&#36153;&#32773;&#32447;&#31243;&#30340;&#25968;&#37327;&#23545;&#31561;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-17_21-35-24.png" alt="images/download/attachments/2424889/image2023-5-17_21-35-24.png" width="800"  />
    </span>
</p>
    </div>
    <div class="section section-2" id="src-2424889_safe-id-aWQt5LqL5Lu2562J5b6FLeS6kuaWpeS9kw">
        <h2 class="heading "><span>&#20114;&#26021;&#20307;</span></h2>
<p   
>    <span style="color: #000000;">
&#20114;&#26021;&#20307;&#65288;Mutant&#65289;&#19982;&#20107;&#20214;&#65288;Event&#65289;&#21644;&#20449;&#21495;&#37327;&#65288;Semaphore&#65289;&#19968;&#26679;&#65292;&#37117;&#21487;&#20197;&#29992;&#26469;&#36827;&#34892;&#32447;&#31243;&#30340;&#21516;&#27493;&#25511;&#21046;&#12290;&#22240;&#20026;&#36825;&#20123;&#37117;&#26159;&#20869;&#26680;&#23545;&#35937;&#65292;&#25152;&#20197;&#25105;&#20204;&#36890;&#36807;&#36825;&#20123;&#23545;&#35937;&#21487;&#20197;&#36827;&#34892;&#36328;&#36827;&#31243;&#30340;&#32447;&#31243;&#21516;&#27493;&#25511;&#21046;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_19-0-31.png" alt="images/download/attachments/2424889/image2023-5-18_19-0-31.png" width="400"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#37027;&#20040;&#21487;&#33021;&#20250;&#26377;&#19968;&#20123;&#26497;&#31471;&#30340;&#24773;&#20917;&#65292;&#22914;&#26524;B&#36827;&#31243;&#30340;Y&#32447;&#31243;&#36824;&#27809;&#26377;&#26469;&#24471;&#21450;&#35843;&#29992;&#20462;&#25913;SignalState&#30340;&#20989;&#25968;&#65288;&#20363;&#22914;SetEvent&#65289;&#23601;&#25346;&#25481;&#20102;&#65292;&#37027;&#20040;<strong class=" ">&#31561;&#24453;&#23545;&#35937;Z&#23558;&#34987;&#36951;&#24323;</strong>&#65292;&#36825;&#20063;&#23601;&#24847;&#21619;&#30528;X&#32447;&#31243;&#23558;&#27704;&#36828;&#31561;&#19979;&#21435;&#65292;&#22240;&#27492;&#20026;&#20102;&#36991;&#20813;&#36825;&#26679;&#30340;&#38382;&#39064;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#20114;&#26021;&#20307;&#23545;&#35937;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#38500;&#20102;&#23545;&#35937;&#34987;&#36951;&#24323;&#38382;&#39064;&#65292;&#20114;&#26021;&#20307;&#36824;&#21487;&#20197;&#35299;&#20915;&#37325;&#20837;&#23548;&#33268;&#30340;&#27515;&#38145;&#38382;&#39064;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#30001;&#20110;&#20195;&#30721;&#35774;&#35745;&#30340;&#38382;&#39064;&#65292;&#22312;WaitForSingleObject&#31561;&#24453;A&#23545;&#35937;&#21518;&#65292;&#20869;&#37096;&#20195;&#30721;&#21448;&#35843;&#29992;&#20102;WaitForMultipleObjects&#31561;&#24453;A&#23545;&#35937;&#65292;<strong class=" ">&#36825;&#31181;&#24773;&#20917;&#34987;&#31216;&#20026;&#37325;&#20837;</strong>&#12290;&#24403;&#35843;&#29992;&#19968;&#27425;WaitForSingleObject&#21518;&#65292;A&#23545;&#35937;&#30340;SignalState&#21464;&#20026;&#20102;0&#65292;&#27492;&#26102;&#24050;&#32463;&#27809;&#26377;&#20449;&#21495;&#20102;&#65292;&#24403;&#35843;&#29992;WaitForMultipleObjects&#26102;&#65292;&#30001;&#20110;&#34987;&#31561;&#24453;&#23545;&#35937;A&#26159;&#27809;&#26377;&#20449;&#21495;&#30340;&#65292;&#22240;&#27492;&#20195;&#30721;&#20250;&#27704;&#36828;&#22256;&#22312;&#35813;&#20989;&#25968;&#20869;&#37096;&#65292;<strong class=" ">&#36825;&#31181;&#24773;&#20917;&#21483;&#20570;&#27515;&#38145;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_20-5-42.png" alt="images/download/attachments/2424889/image2023-5-18_20-5-42.png" width="400"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#20114;&#26021;&#20307;&#30340;&#32467;&#26500;&#22914;&#19979;&#25152;&#31034;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#35265;&#23427;&#19968;&#20849;&#26377;4&#20010;&#25104;&#21592;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">kd&gt; dt _KMUTANT</code></div>
<div class="line"><code class="plain">nt!_KMUTANT</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Header           : _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x010</code><code class="plain"> MutantListEntry  : _LIST_ENTRY         </code><code class="comments">// 在_KTHREAD+0x10处有一个MutantListHead字段，指向链表头，链表圈着所有该线程拥有的互斥体对象，该值就表示挂在链表的位置</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x018</code><code class="plain"> OwnerThread      : Ptr32 _KTHREAD      </code><code class="comments">// 拥有互斥体的线程</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x01c</code><code class="plain"> Abandoned        : UChar               </code><code class="comments">// 是否已经被放弃不用</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x01d</code><code class="plain"> ApcDisable       : UChar               </code><code class="comments">// 是否禁用内核APC</code></div>
<div class="line"><code class="plain">kd&gt; dt _DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">nt!_DISPATCHER_HEADER</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x000</code><code class="plain"> Type             : UChar               </code><code class="comments">// 互斥体的Type值为2</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x001</code><code class="plain"> Absolute         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x002</code><code class="plain"> Size             : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x003</code><code class="plain"> Inserted         : UChar</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x004</code><code class="plain"> SignalState      : Int4B</code></div>
<div class="line"><code class="plain">   +</code><code class="value">0x008</code><code class="plain"> WaitListHead     : _LIST_ENTRY</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#20114;&#26021;&#20307;&#26159;&#36890;&#36807;CreateMutex&#20989;&#25968;&#21019;&#24314;&#30340;&#65292;&#23427;&#30340;&#35821;&#27861;&#26684;&#24335;&#22914;&#19979;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">HANDLE CreateMutex(</code></div>
<div class="line"><code class="plain">  LPSECURITY_ATTRIBUTES lpMutexAttributes,</code></div>
<div class="line"><code class="plain">  BOOL bInitialOwner,                       </code><code class="comments">// 表示当前创建的互斥体是否属于当前线程，互斥体结构体成员的OwnerThread就由它决定</code></div>
<div class="line"><code class="plain">  LPCTSTR lpName                            </code><code class="comments">// 对象名称</code></div>
<div class="line"><code class="plain">);</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
CreateMutex&#21040;0&#29615;&#30340;&#20250;&#25191;&#34892;KeInitianlizeMutant&#20989;&#25968;&#65292;&#35813;&#20989;&#25968;&#30340;&#20316;&#29992;&#23601;&#26159;&#21021;&#22987;&#21270;&#20114;&#26021;&#20307;&#65292;&#20027;&#35201;&#26377;&#20197;&#19979;&#20960;&#20010;&#20869;&#23481;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">MUTANT.Header.Type=</code><code class="value">2</code><code class="plain">;</code></div>
<div class="line"><code class="plain">MUTANT.Header.SignalState=bInitialOwner ? </code><code class="value">0</code><code class="plain"> : </code><code class="value">1</code><code class="plain">;</code></div>
<div class="line"><code class="plain">MUTANT.OwnerThread=bInitialOwner ? 当前线程 : NULL;</code></div>
<div class="line"><code class="plain">MUTANT.Abandoned=</code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">MUTANT.ApcDisable=</code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">if</code><code class="plain">(bInitialOwner==TRUE)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 将当前互斥体挂入到当前线程的互斥体链表</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// 即_KTHREAD+0x10 -&gt; MutantListHead</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#22522;&#26412;&#30340;&#35821;&#27861;&#21644;&#27010;&#24565;&#20102;&#35299;&#20043;&#21518;&#65292;&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#19979;&#20026;&#20160;&#20040;&#20114;&#26021;&#20307;&#21487;&#20197;&#37325;&#20837;&#65292;<strong class=" ">&#20114;&#26021;&#20307;&#26377;&#19968;&#20010;&#25104;&#21592;OwnerThread&#65292;&#23427;&#23601;&#26159;&#35299;&#20915;&#37325;&#20837;&#30340;&#20851;&#38190;</strong>&#12290;&#33509;&#19968;&#20010;&#20114;&#26021;&#20307;&#34987;&#21019;&#24314;&#26102;&#65292;&#23427;&#30340;OwnerThread&#23383;&#27573;&#19981;&#20026;&#31354;&#65292;&#21019;&#24314;&#23427;&#30340;&#32447;&#31243;&#21363;&#20026;&#20114;&#26021;&#20307;&#30340;&#25152;&#23646;&#32447;&#31243;&#12290;&#27492;&#26102;&#65292;&#21021;&#22987;&#21270;&#30340;&#20114;&#26021;&#20307;SignalState&#23383;&#27573;&#34987;&#35774;&#32622;&#20026;0&#65292;&#20063;&#23601;&#26159;&#27809;&#26377;&#20449;&#21495;&#65292;&#36825;&#20010;&#26102;&#20505;&#21035;&#30340;&#32447;&#31243;&#26159;&#27809;&#27861;&#20351;&#29992;&#36825;&#20010;&#20114;&#26021;&#20307;&#30340;&#12290;&#20294;&#26159;&#21019;&#24314;&#23427;&#30340;&#32447;&#31243;&#20173;&#28982;&#21487;&#20197;&#20351;&#29992;&#65292;<strong class=" ">&#24182;&#19988;&#21487;&#20197;&#37325;&#22797;&#20351;&#29992;0x8000000&#27425;</strong>&#65292;&#36825;&#20063;&#26159;&#20026;&#20160;&#20040;&#20114;&#26021;&#20307;&#21487;&#20197;&#37325;&#20837;&#30340;&#21407;&#22240;&#65292;&#22240;&#20026;&#21019;&#24314;&#23427;&#30340;&#32447;&#31243;&#21487;&#20197;&#22312;&#27809;&#26377;&#20449;&#21495;&#30340;&#24773;&#20917;&#19979;&#20351;&#29992;&#20114;&#26021;&#20307;&#65292;&#33267;&#20110;&#20026;&#20309;&#21019;&#24314;&#23427;&#30340;&#32447;&#31243;&#22312;&#20114;&#26021;&#20307;&#27809;&#26377;&#20449;&#21495;&#30340;&#24773;&#20917;&#19979;&#20063;&#21487;&#20197;&#20351;&#29992;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#25105;&#21487;&#20197;&#26469;&#21040;WaitForSingleObject&#30475;&#19968;&#19979;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;&#20250;&#20808;<strong class=" ">&#21028;&#26029;&#31561;&#24453;&#23545;&#35937;&#31867;&#22411;</strong>&#65292;&#33509;&#26159;&#20114;&#26021;&#20307;&#65292;&#32487;&#32493;&#25191;&#34892;&#65307;<strong class=" ">&#25509;&#30528;&#20250;&#21028;&#26029;SignalState&#30340;&#20540;</strong>&#65292;&#21363;&#26159;&#21542;&#26377;&#20449;&#21495;&#65292;&#22914;&#26524;&#26377;&#20449;&#21495;&#65292;&#23601;&#36339;&#36716;&#65307;&#22914;&#26524;&#27809;&#26377;&#20449;&#21495;&#65292;<strong class=" ">&#21028;&#26029;&#24403;&#21069;&#32447;&#31243;&#19982;&#20114;&#26021;&#20307;&#25152;&#23646;&#32447;&#31243;&#26159;&#21542;&#30456;&#21516;</strong>&#65292;&#22914;&#26524;&#30456;&#21516;&#65292;<strong class=" ">&#23601;&#20250;&#36339;&#21040;&#21644;&#26377;&#20449;&#21495;&#26102;&#19968;&#26679;&#30340;&#22320;&#26041;</strong>&#65292;&#21363;&#20351;&#27809;&#26377;&#20449;&#21495;&#65292;&#20114;&#26021;&#20307;&#20063;&#21487;&#20197;&#34987;&#23427;&#30340;&#25152;&#23646;&#32447;&#31243;&#20351;&#29992;&#65292;&#36825;&#26679;&#65292;&#23545;&#20110;&#25317;&#26377;&#20114;&#26021;&#20307;&#30340;&#32447;&#31243;&#65292;&#23601;&#21487;&#20197;&#37325;&#20837;&#35813;&#20114;&#26021;&#20307;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#25105;&#20204;&#25509;&#30528;&#26469;&#21040;&#36339;&#36716;&#21518;&#30340;&#20195;&#30721;&#65292;&#21457;&#29616;&#23427;&#20250;&#20808;&#21028;&#26029;SignalState&#30340;&#20540;&#26159;&#21542;&#19982;0x80000000&#30456;&#31561;&#65292;&#21482;&#35201;&#19981;&#31561;&#20110;0x80000000&#65292;&#23601;&#21487;&#20197;&#32487;&#32493;&#25191;&#34892;&#65292;&#25191;&#34892;&#21040;&#34013;&#33394;&#26041;&#26694;&#30340;&#26102;&#20505;&#65292;&#20250;&#32473;SignalState&#30340;&#20540;&#20943;&#21435;1&#12290;&#36825;&#37324;&#35201;&#20998;&#20004;&#31181;&#24773;&#20917;&#65306;    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">SignalState&#26377;&#20449;&#21495;</strong>&#65306;SignalState&#20540;&#22823;&#20110;0&#65292;&#20219;&#20309;&#32447;&#31243;&#21487;&#20197;&#31561;&#24453;&#36825;&#20010;&#20114;&#26021;&#20307;&#23545;&#35937;&#65307;    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">SignalState&#26080;&#20449;&#21495;</strong>&#65306;SignalState&#20540;&#20026;&#23567;&#20110;&#31561;&#20110;0&#65292;&#35828;&#26126;&#24403;&#21069;&#32447;&#31243;&#19968;&#23450;&#25317;&#26377;&#35813;&#20114;&#26021;&#20307;&#65292;&#27492;&#26102;SignalState&#20173;&#20250;&#20943;1&#65292;&#26368;&#22810;&#21487;&#20197;&#20943;&#23569;&#33267;0x80000000&#65292;&#20063;&#23601;&#34920;&#31034;<strong class=" ">&#21487;&#20197;&#37325;&#20837;0x8000000&#27425;</strong>&#12290;    </span>
</p>
</li></ol><p   
>    <span style="color: #000000;">
&#32508;&#19978;&#25152;&#36848;&#65292;&#25105;&#20204;&#30693;&#36947;&#22312;&#20114;&#26021;&#20307;&#23545;&#35937;&#20013;&#65292;&#25105;&#20204;&#24819;&#35201;&#28608;&#27963;&#31561;&#24453;&#35813;&#23545;&#35937;&#30340;&#32447;&#31243;&#65292;&#21482;&#38656;&#35201;&#28385;&#36275;SignalState&#22823;&#20110;0&#65292;&#25110;&#32773;&#20114;&#26021;&#20307;&#25152;&#23646;&#20026;&#24403;&#21069;&#32447;&#31243;&#65292;&#21363;&#21487;&#28385;&#36275;&#28608;&#27963;&#26465;&#20214;&#65292;&#22240;&#27492;&#23601;<strong class=" ">&#35299;&#20915;&#20102;&#37325;&#20837;&#27515;&#38145;</strong>&#38382;&#39064;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_20-42-29.png" alt="images/download/attachments/2424889/image2023-5-18_20-42-29.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
&#25509;&#19979;&#25105;&#20204;&#30475;&#19968;&#19979;&#20114;&#26021;&#20307;&#26159;&#22914;&#20309;<strong class=" ">&#35299;&#20915;&#31561;&#24453;&#23545;&#35937;&#34987;&#36951;&#24323;</strong>&#30340;&#38382;&#39064;&#65292;&#22312;&#22788;&#29702;&#31561;&#24453;&#23545;&#35937;&#36951;&#24323;&#30340;&#24773;&#20917;&#26102;&#20250;&#29992;&#21040;&#20114;&#26021;&#20307;&#30340;&#20004;&#20010;&#25104;&#21592;&#65292;&#21363;MutantListEntry&#21644;Abandoned&#12290;&#24403;&#19968;&#20010;&#32447;&#31243;&#24322;&#24120; &ldquo;&#27515;&#20129;&rdquo; &#26102;&#65292;&#31995;&#32479;&#20250;&#35843;&#29992;&#20869;&#26680;&#20989;&#25968;MmUnloadSystemImage&#22788;&#29702;&#21518;&#20107;&#65292;&#23427;&#20250;&#26681;&#25454; &ldquo;&#27515;&#20129;&#32447;&#31243;&rdquo; 0x10&#20301;&#32622;&#25351;&#21521;&#30340;&#38142;&#34920;&#22836;&#65292;&#25214;&#21040;&#23427;&#25152;&#25317;&#26377;&#30340;&#25152;&#26377;&#20114;&#26021;&#20307;&#65292;&#23558;&#36825;&#20123;&#20114;&#26021;&#20307;&#30340;Abandoned&#25104;&#21592;&#20540;&#35774;&#32622;&#20026;1&#65292;&#24182;&#23545;&#23427;&#20204;&#35843;&#29992;KeReleaseMutant(X, Y, Abandon, Z)&#20989;&#25968;&#65288;ReleaseMutant&#30340;&#20869;&#26680;&#20989;&#25968;&#65289;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_20-58-40.png" alt="images/download/attachments/2424889/image2023-5-18_20-58-40.png" width="600"  />
    </span>
</p>
<p   
>    <span style="color: #000000;">
KeReleaseMutant&#20989;&#25968;&#27491;&#24120;&#35843;&#29992;&#26102;&#23601;&#20250;<strong class=" ">&#23558;SignalState&#33258;&#22686;1</strong>&#65292;&#22914;&#26524;&#20986;&#29616;&#20114;&#26021;&#20307;&#25152;&#23646;&#32447;&#31243;&#31361;&#28982;&#27515;&#20129;&#30340;&#24773;&#20917;&#65288;&#21363;Abandon&#25104;&#21592;&#20540;&#20026;1&#65289;&#65292;&#35813;&#20989;&#25968;&#20250;&#23558;SignalState&#30452;&#25509;&#35774;&#32622;&#20026;1&#65292;&#24182;&#19988;&#23558;&#20114;&#26021;&#20307;&#25152;&#23646;&#32447;&#31243;&#35774;&#32622;&#20026;NULL&#65292;<strong class=" ">&#21516;&#26102;&#25226;&#33258;&#24049;&#20174;&#27515;&#20129;&#32447;&#31243;&#30340;&#20114;&#26021;&#20307;&#38142;&#34920;&#20013;&#31227;&#38500;</strong>&#65292;&#36825;&#26679;&#20114;&#26021;&#20307;&#20415;&#21487;&#20877;&#20026;&#20854;&#23427;&#32447;&#31243;&#25152;&#20351;&#29992;&#65292;<strong class=" ">&#20174;&#32780;&#35299;&#20915;&#20102;&#31561;&#24453;&#23545;&#35937;&#34987;&#36951;&#24323;&#38382;&#39064;</strong>&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
&#33267;&#27492;&#65292;&#22312;&#20114;&#26021;&#20307;&#20013;&#20173;&#26377;&#19968;&#20010;&#25104;&#21592;&#25105;&#20204;&#19981;&#20102;&#35299;&#65288;&#21363;ApcDisable&#65289;&#65292;&#26377;&#36825;&#20010;&#25104;&#21592;&#30340;&#23384;&#22312;&#26159;&#22240;&#20026;&#20114;&#26021;&#20307;&#20998;&#20026;&#20004;&#31181;&#65292;&#21363;&#29992;&#25143;&#12289;&#20869;&#26680;&#19979;&#20351;&#29992;&#30340;&#20114;&#26021;&#20307;&#65292;&#23427;&#20204;&#30340;&#21306;&#21035;&#22914;&#19979;&#65306;    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">&gt; 用户互斥体</code></div>
<div class="line"><code class="plain">  + 结构名：Mutant（在3环被创建）</code></div>
<div class="line"><code class="plain">  + 对应内核函数：NtCreateMutant</code></div>
<div class="line"><code class="plain">  + ApcDisable：</code><code class="value">0</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">&gt; 内核互斥体</code></div>
<div class="line"><code class="plain">  + 结构名：Mutex（在0环被创建）</code></div>
<div class="line"><code class="plain">  + 对应内核函数：NtCreateMutex</code></div>
<div class="line"><code class="plain">  + ApcDisable：</code><code class="value">1</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
&#29992;&#25143;&#20114;&#26021;&#20307;&#19982;&#20869;&#26680;&#20114;&#26021;&#20307;&#32467;&#26500;&#21517;&#19981;&#21516;&#65292;&#20294;&#26159;&#32467;&#26500;&#20307;&#30456;&#21516;&#65292;&#20027;&#35201;&#30340;&#21306;&#21035;&#22312;&#20110;ApcDisable&#25104;&#21592;&#12290;&#29992;&#25143;&#20114;&#26021;&#20307;&#26159;&#20801;&#35768;&#20869;&#26680;APC&#25191;&#34892;&#30340;&#65292;&#20294;&#26159;&#20869;&#26680;&#20114;&#26021;&#20307;&#26159;&#19981;&#20801;&#35768;&#20869;&#26680;APC&#36827;&#34892;&#25191;&#34892;&#30340;&#12290;&#22312;KeWaitForSingleObject&#30340;&#20195;&#30721;&#20013;&#65292;&#25105;&#20204;&#30693;&#36947;&#23427;<strong class=" ">&#20250;&#26681;&#25454;ApcDisable&#30340;&#20540;&#20462;&#25913;_KTHREAD.KernelApcDisable</strong>&#65288;&#21363;&#27491;&#22312;&#20351;&#29992;&#20114;&#26021;&#20307;&#30340;&#32447;&#31243;&#65289;&#65292;&#33509;ApcDisable&#20540;&#20026;0&#65292;&#21017;KernelApcDisable&#30340;&#20540;&#19981;&#20250;&#21457;&#29983;&#25913;&#21464;&#65307;&#33509;ApcDisable&#20540;&#20026;1&#65292;&#21017;KernelApcDisable&#30340;&#20540;&#23558;&#20250;&#20943;1&#65292;&#27492;&#26102;KernelApcDisable&#23558;&#20250;&#26159;&#19968;&#20010;&#19981;&#20026;0&#30340;&#20540;&#65292;&#20869;&#26680;APC&#23558;&#20250;&#34987;&#31105;&#29992;&#65288;&#26681;&#25454;&#20869;&#26680;APC&#25191;&#34892;&#36807;&#31243;&#65292;&#33509;KernelApcDisable&#30340;&#20540;&#19981;&#20026;0&#65292;&#20869;&#26680;APC&#23558;&#20250;&#34987;&#31105;&#29992;&#65289;&#12290;    </span>
</p>
<p   
>    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/2424889/image2023-5-18_21-10-34.png" alt="images/download/attachments/2424889/image2023-5-18_21-10-34.png" width="600"  />
    </span>
</p>
<p   
><br/></p>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="APC%E6%9C%BA%E5%88%B6.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>APC&#26426;&#21046;</span>
        </a>
                <a href="%E5%BC%82%E5%B8%B8.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>&#24322;&#24120;</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
